想了一种神奇的做法。

把序列的每个数 $a_i$ 表示为一个项 $x^{a_i}$，对于一段区间 $[l,r]$，它的区间和 $\sum_{i=l}^rx^{a_i}$ 是一个多项式。

设区间 $[l,r]$ 的最小值为 $v$（即 $v=\min\{a_i|l\le i\le r\}$），则区间 $[l,r]$ 满足条件当且仅当区间和 $\sum_{i=l}^rx^{a_i}$ 与多项式 $x^m\cdot\sum_{i=0}^{r-l}x^i$ 相等。

判断两个多项式是否相等有一种经典的随机化算法：随机质数 $x$ 和 $p$，在模 $p$ 意义下把 $x$ 代入算出多项式的值模 $p$ 的结果，判断是否相等，多次随机提高正确率（一般随机两次基本上没问题了？）。

我的实现方法是先随机两个 $10^8$ 级别的质数 $x_1,x_2$ 和两个 $10^9$ 级别的质数 $p_1,p_2$，$x_1<p_1$，$x_2<p_2$，预处理 $x_1,x_2$ 的幂以及幂的前缀和（模 $p_1,p_2$ 意义下），然后用线段树维护区间最小值、$\sum_{i=l}^rx_1^{a_i}\bmod p_1$ 和 $\sum_{i=l}^rx_2^{a_i}\bmod p_2$ 的值，询问时查询区间的这两个和判断对不对即可。

每次询问复杂度 $O(\log n)$，正确性的话……感觉很靠谱，不知道能不能卡掉。
