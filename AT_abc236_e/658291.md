# abc 236 e

## 题意

$n$ 个数 $a_{1} \dots a_n$ 排成一列。现在要选出一些数，满足 **任意两个相邻的数中至少有一个数被选择**。

请求出：

- 所有选择方案中，被选中的数字平均值的最大值，误差在 $10 ^ {-3}$ 以内视为正确；

- 所有选择方案中，被选中的数字中位数的的最大值。在这里，偶数 $2k$ 个数的中位数视作第 $k$ 小的数。

- $2 \le n \le 10 ^ 5$

- $1 \le a_i \le 10 ^ 9$

## 思路

二分 + dp

### 平均值

二分平均值（实数二分），$Check(x)$ 表示平均值为 $x$ 是否合法。

所以，我们设选择的数的下标为 $p_1, p_2, \dots , p_k$，那么就有：

$$\frac{a_{p_1} + a_{p_2} + \dots + a_{p_k}}{k} \ge x$$

$$\frac{a_{p_1} + a_{p_2} + \dots + a_{p_k}}{k} - x \ge 0$$

$$\frac{(a_{p_1} - x) + (a_{p_2} - x) + \dots + (a_{p_k} - x)}{k} \ge 0$$

$$(a_{p_1} - x) + (a_{p_2} - x) + \dots + (a_{p_k} - x) \ge 0$$

所以，$b_i = a_i - x$，$dp_i$ 表示子序列末尾为 $b_i$ 的满足要求的子序列的最大子序列和。

那么有转移：$dp_i = \max(dp_{i - 1}, dp_{i - 2}) + b_i$。

### 中位数

二分中位数（整数二分），$Check(x)$ 表示中位数为 $x$ 是否合法。

我们将小于 $x$ 的数都看做成 $-1$，大于等于 $x$ 的数看作 $1$，用序列 $b$ 记录这些映射后的值。

如果要使得中位数可以是 $x$，就是使得满足要求的子序列的和大于 $0$。

那么，$dp_i$ 为以 $b_i$ 结尾的满足要求的子序列的最大子序列和。

所以就有转移：$dp_i = \max(dp_{i - 1}, dp_{i - 2}) + b_i$。