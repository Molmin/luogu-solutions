### 代码啊实现啊其他$dalao$们都讲的很清楚了，我来从感性的层面讲讲我对这个题目的理解吧$QwQ$~,希望能对大家有所帮助。

- 我们做的询问，是问$x$串在$y$串中出现的次数。

- 很显然，大力遍历当然可以出结果。那么怎么用$AC$自动机优化我们的遍历方式？

- $Trie$树上：
	- 对于一个点$u$，它与根节点对应的链代表了串$u$的所有前缀。

- $Fail$树上：
	- 对于一个点$u$，它的子节点对应了所有能用后缀将其包含的串$v$。

#### 又是前缀又是后缀的，如果我们把它们一起用上会怎么样？比如——

- 我们认为串$x$是串$y$一个前缀的后缀。

	- 有多少这样的前缀是符合要求的呢？

#### 现在我们来脑补一个$Venn$图，其中一个集合是串$y$的所有前缀串，另一个集合是所有后缀包含串$x$的字串。

#### 先处理第一个集合。我们似乎可以遍历一下$Trie$树，当前点到根节点的链上所有节点，就是这个集合啦~

#### 第二个集合啊，不是正好挂在$Fail$树的当前点下面嘛？要取走还不容易，直接一棵子树砍走就完事了。

#### 仔细一想，欸？？是不是可以直接取一个交集？

#### 那么思路就变得清楚起来。我们每次在$Trie$树的当前点上取一条到根节点的链，对链上所有点$+1$。然后在$Fail$树的当前点上求一个子树和，问题就迎刃而解啦~

#### 这里我只是简单的总结一下思路。写法有很多，我的写法是记录一下$Fail$树的$dfs$序，然后按$dfs$序塞进树状数组理维护。

#### $Trie$树和$Fail$树一些节点映射略有繁琐，写的时候记得谨慎一点哦$QwQ$