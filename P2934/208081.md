先把最短路树建出来，然后我们考虑一条非树边$(u,v)$对于答案的贡献，我们不难发现如果一个点$x$在$v->lca(u,v)$的路径上，那么我们可以走$1->u->v->x$这样的路径来更新$x$的答案$val(u,v)+dis[u]+dis[v]-dis[x]$，不难发现这个不太好区间维护，那么我们考虑每个点的最优解，我们把边按照$val(u,v)+dis[u]+dis[v]$来排序即可，这样在前面的边对于答案的贡献一定比后面优，因此每个点只要更新一遍，并查集维护即可。

[$code$](https://pastebin.com/zjZeJFDZ)