**sol of AGC012F**

又是好题，又不会了。

将 $a$ 排序。先考虑 $a$ 两两不相同然后离散化。则 $a$ 序列可以看做值域。

先推个性质：$a_i \leq b_i \leq a_{2 \times n - i}$，这是根据 $b_i$ 的两边各有 $i$ 个数得到的。


考虑正着做不会可以倒着删。我们发现，刚开始的时候 $b_n$ 是只能取全局中位数的（其实按照正常的思路来说，倒着删的想法也是源于这个性质的观察），由上面对每一位的取值值域限制，随着 $i$ 向前的推进，$b$ 可以取的数的范围是越来越大的，并且向两边扩展，这是一个好的性质。

然后我们再推一个很强的性质：对于任意的 $i < j$，不存在 $b_j < b_i < b_{j + 1}$ 或者是 $b_{j + 1} < b_i < b_j$。

这个可以理解成，我们考虑从 $b_i$ 推到 $b_{i - 1}$，考虑相当于从 $b_i$ 在 $a$ 序列的值域上跳到**现未被删的数内的**前驱后继，此时你发现在任意形态下的一个 $b_{j},b_{j + 1}$，相当于夹在它们值域之间的数是已经不存在的了，由于 $i < j$，说明 $i$ 是一个后继状态，则自然不会存在上述的两个不等式。

那么对于任意的一个形态下的状态我们可以记为 $dp_{i,l,r}$ 表示 $b_i$ 确定后，**在当前可取的值域范围内**左边有 $l$ 个数右边有 $r$ 个数。我们枚举向左右跳跃多少步即可转移。

这个状态是高度压缩的。因为这只是一系列状态的统一表示形式，我们甚至跳到哪里去了都不能完全还原，但是我们知道它总对应一个值，并且转移到的都是不同的取值，那就是对的。



不友好的是此题的 $a$ 并不保证两两不同，所以得在扩增值域时特判去重。具体可看楼上@[Ruanap](https://www.luogu.com.cn/user/171554)的代码。

发现我还有一个没证明的东西，满足这样条件的 $b$ 序列一定是可以被构造出来的。

具体地，我们可以假设在 dp 的时候我们是状压了左右的值的状态，由于我们可以在 $b_i$ 时删到 $b_i$ 只有一个可取的值。所以跳跃后的状态一定可以通过之前 $a$ 序列上取值的反悔来构造出来。

