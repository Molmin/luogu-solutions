### 题目传送门

[洛谷](https://www.luogu.com.cn/problem/CF1735D)

[CF](https://codeforces.com/contest/1735/problem/D)

### 分析

这一题乍一看无从下手，我们先要推到一些结论：

+ 给出两个串，存在且仅存在一个串能和这两个串组成一个合法三元集。

证明：遍历串的每一位，当这两个串的这一位相等，构造第三个串的这一位也是这个数；否则，就是在集合 $\{0,1,2\}$ 中不与这两个数相等的另一个数。所以一定可以构造出一个串，而原题又说：所有的卡片都是不同的，故原命题得证。

+ 在一个合法五元集中，存在且仅存在两个合法三元集。

根据题意，我们先构造出两个合法三元集，令其为 $\{1,2,3\}$ 和 $\{1,4,5\}$，如果还有一个合法三元集，则三个串的来源一定来自一个合法三元集中的两个串和另一个合法三元集中的一个串，但根据前面的结论：
给出两个串，存在且仅存在一个串能和这两个串组成一个合法三元集。这两个串一定只能和原合法三元集中的串构成合法三元集，故原命题得证。

所以，我们发现，一个合法五元集中的两个合法三元集必定有一个重复数字，我们以这个数字来计算贡献，则方案数为：$\sum \frac{s_i \times (s_i-1)}{2}$，其中 $s_i$ 表示第 $i$ 个串可以形成的合法三元集的数量。

$s_i$ 的求法也不难，枚举两个串，根据第一个结论，可以得到唯一的第三个串，判断这个串是否在原数组中存在。如果存在，**并且三个下标满足一定相对顺序**，则更新 $s$ 数组。

已经讲得很详细了，代码就不附上了。
