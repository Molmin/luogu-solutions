显然二分 $s$，然后我们仅需判断某个 $s$ 是否合法，也就是求此时 $w=\sum_{i=1}^n(a_i-b_i)c_i$ 的最大值是否大于等于 $0$。

假设 $a$ 已经确定，那么显然满足 $a_i\ge b_i$ 的 $i$ 取 $c_i=r_i$，其余 $c_i=l_i$。

考虑开始所有 $a_i$ 均为 $0$，所以 $c_i$ 均为 $l_i$，$w=-\sum_{i=1}^nl_ib_i$，把 $s$ 个 $1$ 依次加进去。对于某个 $a_i$ 变为 $a_i+1$，当：

- $a_i < b_i$，此时 $w$ 加上 $l_i$；
- $a_i=b_i$，此时 $c_i$ 转为 $r_i$，$i$ 对 $w$ 的贡献突变为 $r_i$，而原本 $i$ 对 $w$ 的贡献为 $-l_ib_i+l_ib_i=0$，所以相当于在原贡献上加 $r_i$；
- $a_i > b_i$，此时 $w$ 加上 $r_i$。

于是不断给某个 $a_i$ 加一，$w$ 的变化为 $+l_i,+l_i,\cdots,+r_i,+r_i$。$i$ 对 $w$ 的贡献关于 $a_i$ 可以看作一个分段函数，两段均为一次函数且第二段斜率大于第一段。

即有 $n$ 个分段函数 $f_{1..n}(x)$：
$$
f_i(x)=\begin{cases} l_i~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~x\in[0,b_i]\cap \mathbb Z\\ l_ib_i+r_i(x-b_i)~~~~~~~~~~x\in(b_i,d]\cap\mathbb Z \\ \end{cases}
$$
不难发现 $f_i(x)$ 就是 $i$ 对 $w$ 贡献加上常数 $l_ib_i$，而 $\sum_{i=1}^n f_i(x_i)=w+\sum_{i=1}^nl_ib_i$。

然后我们仅需钦定 $x_{1,2,\cdots n}$，和为 $s$，使最后 $\sum_{i=1}^n f_i(x_i)$ 最大，判断其是否大于等于 $\sum_{i=1}^nl_ib_i$，这就等同于判断 $w_{max}$ 是否大于等于 $0$。

可以证明，最多存在一个 $i$，使得 $0<a_i<d$，而其它的要么取 $a_i=d$，要么取 $a_i=0$。

因为若存在两个这样的 $i$，我们显然可以通过调整其中一个加一，另一个减一，使他们对 $w$ 的贡献和更大。

贪心地考虑，显然我们优先让 $f_i(d)$ 最大的 $i$ 满足 $a_i=d$，直到剩余的 $s$ 小于 $d$，然枚举某个 $a_i=s$ 计算最大值即可。 

