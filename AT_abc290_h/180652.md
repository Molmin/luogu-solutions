实际上，尽管这题数据只有 $300$，除了吊打官方题解的退火（Another solution），还有能更进一步的 $O(n\log n)$ 解法！

首先，我们观察到一个简单的性质：令 $d_i$ 表示 $i$ 两边猫/狗的数量差，那么对于一种动物，它的位置的 $d$ 一定是先递减后递增。所以每种动物的排序一定是代价先递增后递减。

结论可以更深入一点。实际上，**纵观整个序列，不论猫狗，$d$ 都是先减后增的**。所以呢，我们可以把所有猫狗一起排序。然后 $f(i,j,k)$ 表示前 $i$ 只动物，前缀填了 $j$ 只狗，$k$ 只猫的最小代价。

其实我们还可以得到更强一点的性质。**举 $n,m$ 都为偶数为例：那么前一半位置中，一定有 $\frac{n}{2}$ 只狗，$\frac{m}{2}$ 只猫**。感性地，这不难证明：令狗为 A，猫为 B，假如前一半 A 的数量 $<\frac{n}{2}$，那么找到右边的第一个 A，把它挪到分界线左边的位置。那么当前位置和目标位置之间全是 B，且这些 B 的 $d$ 都会减小 $1$，且这个 A 的 $d$ 会减少这些 B 的数量。

如果 $n,m$ 中有奇数，那么区别不大，只是需要把最大的放在最中间，证明类似。同时我们可以把最大的给剔除，于是就变成了都是偶数的情况。

其实我们观察到另一件重要的事情。在符合我们上述条件的序列中，$\sum d$ 总是一样的。这启发我们其实这里也可以贪心，让 $a$ 更大的值，$d$ 尽量地小。

考虑如下的贪心过程：我们从中心开始往两侧填。假如目前这个是狗，且右边能放（即右边数量 $<\frac{n}{2}$），那就放右边，代价为右边猫的个数乘上 $2a_i$；假如这是猫，且左边能放，那就放左边，代价为左边狗的数量乘上 $2a_i$。这样能在保证 $\sum d$ 最小的前提下最小化 $\sum d\times a$。

https://atcoder.jp/contests/abc290/submissions/39979876