首先我们通过预处理可以求出每一个点的$f$。

考虑到能更新一个点的$f$的点一定会是一条直径的两个端点，因此我们找出直径后两遍$dfs$来求$f$数组即可。

继续挖掘性质，发现这个$f$值是具有单调性的，换而言之，如果我们钦定直径的中点作为根节点，那么每颗子树的$f$都具有小根堆的性质。

这样我们考虑从大到小枚举连通块中最小的$f$，$twopointer$做一下就可以了，统计连通块大小用并查集维护即可。

考虑这样做为什么是对的呢，根据小根堆性质，如果一个点被删除了，那么它的子树中所有点都会被删除，因此我们就保证了联通的单调性，删除直接在并查集的$siz$减一即可。