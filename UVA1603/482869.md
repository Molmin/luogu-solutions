[题目在这里](https://www.luogu.com.cn/problem/UVA1603)

首先这是一道~~恶心~~的细节题，也是我的一道考题。

考试时预处理纯手打，因为 $n \le 5$，所以其实也没什么难度……

然后如果用普通搜索，`TLE` 。考虑优化：

1. `IDA*`，枚举层数，当然也会超时到飞起……

2.估价函数：如果当剩下的**最小正方形数量**为 $num$，剩余的规定层数（剩下的删除火柴数量）为 $ret$，如果 $\frac{num}{2} \ge ret$，可以证明无法满足，因为**删除一根火柴只能最多消除 $2$ 个最小正方形**。

3.一些细节优化：一些地方直接 `return`。

因为改代码格式化后~~过于美观~~，所以放上源代码：

```cpp
#include<bits/stdc++.h>
using namespace std;
inline int read(){
	int num=0,ch=0;
	char c=getchar();
	while(!isdigit(c))ch|=(c=='-'),c=getchar();
	while(isdigit(c))num=(num<<1)+(num<<3)+(c^48),c=getchar();
	return ch?-num:num;
}
inline void write(int x){
	if(x<0)putchar('-'),x=-x;
	if(x>=10)write(x/10);
	putchar(x%10+'0');
}
bool vis[72],flag[72],ch;
//vis[i]:标记 i 号边是否删除
//flag[i]:临时数组，方便处理判断
int n,k,cnt,ans;
//cnt:正方形个数
//ans:枚举层数
int cnt2[5]={3,3,3,3,7};
int z2[5][8]={{1,3,4,6},{2,4,5,7},{6,8,9,11},{7,9,10,12},{1,2,3,5,8,10,11,12}};
int cnt3[14]={3,3,3,3,3,3,3,3,3,7,7,7,7,11};
int z3[14][12]={{1,4,5,8},{2,5,6,9},{3,6,7,10},{8,11,12,15},{9,12,13,16},{10,13,14,17},{15,18,19,22},
{16,19,20,23},{17,20,21,24},{1,2,4,6,11,13,15,16},{2,3,5,7,12,14,16,17},{8,9,11,13,18,20,22,23},{9,10,12,14,19,21,23,24},
{1,2,3,4,7,11,14,18,21,22,23,24}};
int cnt4[30]={3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,7,7,7,7,7,7,7,7,7,11,11,11,11,15};
int z4[30][16]={{1,5,6,10},{2,6,7,11},{3,7,8,12},{4,8,9,13},{10,14,15,19},{11,15,16,20},{12,16,17,21},{13,17,18,22},
{19,23,24,28},{20,24,25,29},{21,25,26,30},{22,26,27,31},{28,32,33,37},{29,33,34,38},{30,34,35,39},{31,35,36,40},
{1,2,5,7,14,16,19,20},{2,3,6,8,15,17,20,21},{3,4,7,9,15,17,21,22},{10,11,14,16,23,25,28,29},{11,12,15,17,24,26,29,30},
{12,13,16,18,25,27,30,31},{19,20,23,25,32,34,37,38},{20,21,24,26,33,35,38,39},{21,22,25,27,34,36,39,40},{1,2,3,5,8,14,17,23,26,28,29,30},
{2,3,4,6,9,15,18,24,27,29,30,31},{10,11,12,14,17,23,26,32,35,37,38,39},{11,12,13,15,18,24,27,33,36,38,39,40},{1,2,3,4,5,9,14,18,23,27,32,36,37,38,39,40}};
int cnt5[55]={3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,11,11,11,11,11,11,11,11,11,15,15,15,15,19};
int z5[55][20]={{1,6,7,12},{2,7,8,13},{3,8,9,14},{4,9,10,15},{5,10,11,16},{12,17,18,23},{13,18,19,24},{14,19,20,25},{15,20,21,26},{16,21,22,27},{23,28,29,34},
{24,29,30,35},{25,30,31,36},{26,31,32,37},{27,32,33,38},{34,39,40,45},{35,40,41,46},{36,41,42,47},{37,42,43,48},{38,43,44,49},{45,50,51,56},{46,51,52,57},{47,52,53,58},
{48,53,54,59},{49,54,55,60},{1,2,6,8,17,19,23,24},{2,3,7,9,18,20,24,25},{3,4,8,10,19,21,25,26},{4,5,9,11,20,22,26,27},{12,13,17,19,28,30,34,35},{13,14,18,20,29,31,35,36},
{14,15,19,21,30,32,36,37},{15,16,20,22,31,33,37,38},{23,24,28,30,39,41,45,46},{24,25,29,31,40,42,46,47},{25,26,30,32,41,43,47,48},{26,27,31,33,42,44,48,49},{34,35,39,41,50,52,56,57},
{35,36,40,42,51,53,57,58},{36,37,41,43,52,54,58,59},{37,38,42,44,53,55,59,60},{1,2,3,6,9,17,20,28,31,34,35,36},{2,3,4,7,10,18,21,29,32,35,36,37},{3,4,5,8,11,19,22,30,33,36,37,38},
{12,13,14,17,20,28,31,39,42,45,46,47},{13,14,15,18,21,29,32,40,43,46,47,48},{14,15,16,19,22,30,33,41,44,47,48,49},{23,24,25,28,31,39,42,50,53,56,57,58},{24,25,26,29,32,40,43,51,54,57,58,59},
{25,26,27,30,33,41,44,52,55,58,59,60},{1,2,3,4,6,10,17,21,28,32,39,43,45,46,47,48},{2,3,4,5,7,11,18,22,29,33,40,44,46,47,48,49},{12,13,14,15,17,21,28,32,39,43,50,54,56,57,58,59},
{13,14,15,16,18,22,29,33,40,44,51,55,57,58,59,60},{1,2,3,4,5,6,11,17,22,28,33,39,44,50,55,56,57,58,59,60}};
inline bool check(int x){
    if(n==2){
        for(int i=0;i<=cnt2[x];++i){
            if(flag[z2[x][i]])return false;
        }
        return true;
    }
    if(n==3){
        for(int i=0;i<=cnt3[x];++i){
            if(flag[z3[x][i]])return false;
        }
        return true;
    }
    if(n==4){
        for(int i=0;i<=cnt4[x];++i){
            if(flag[z4[x][i]])return false;
        }
        return true;
    }
    if(n==5){
        for(int i=0;i<=cnt5[x];++i){
            if(flag[z5[x][i]])return false;
        }
        return true;
    }
}
inline bool Check(int x){
    if(n==2){
        for(int i=0;i<=cnt2[x];++i){
            if(vis[z2[x][i]])return false;
        }
        return true;
    }
    if(n==3){
        for(int i=0;i<=cnt3[x];++i){
            if(vis[z3[x][i]])return false;
        }
        return true;
    }
    if(n==4){
        for(int i=0;i<=cnt4[x];++i){
            if(vis[z4[x][i]])return false;
        }
        return true;
    }
    if(n==5){
        for(int i=0;i<=cnt5[x];++i){
            if(vis[z5[x][i]])return false;
        }
        return true;
    }
}
inline int h(){
    int ret=0;
    for(int i=1;i<=n*(n+1)*2;++i)flag[i]=vis[i];
    for(int i=0;i<cnt;++i){
        if(check(i)){
            ++ret;
            if(n==2){for(int j=0;j<=cnt2[i];++j)flag[z2[i][j]]=1;}
            if(n==3){for(int j=0;j<=cnt3[i];++j)flag[z3[i][j]]=1;}
            if(n==4){for(int j=0;j<=cnt4[i];++j)flag[z4[i][j]]=1;}
            if(n==5){for(int j=0;j<=cnt5[i];++j)flag[z5[i][j]]=1;}
        }
    }
    return ret;
}
inline void dfs(int x){
    if(x+h()>ans)return;
    for(int i=0;i<cnt;++i){
        if(Check(i)){
            if(n==2){
                for(int j=0;j<=cnt2[i];++j){
                    vis[z2[i][j]]=1;
                    dfs(x+1);
                    vis[z2[i][j]]=0;
                    if(ch)return;
                }return;
            }
            if(n==3){
                for(int j=0;j<=cnt3[i];++j){
                    vis[z3[i][j]]=1;
                    dfs(x+1);
                    vis[z3[i][j]]=0;
                    if(ch)return;
                }return;
            }
            if(n==4){
                for(int j=0;j<=cnt4[i];++j){
                    vis[z4[i][j]]=1;
                    dfs(x+1);
                    vis[z4[i][j]]=0;
                    if(ch)return;
                }return;
            }
            if(n==5){
                for(int j=0;j<=cnt5[i];++j){
                    vis[z5[i][j]]=1;
                    dfs(x+1);
                    vis[z5[i][j]]=0;
                    if(ch)return;
                }return;
            }
        }
    }ch=1;return;
}
signed main(){
    int T=read();
    while(T--){
        n=read(),k=read(),ch=false;
        if(n==2)cnt=5;
        if(n==3)cnt=14;
        if(n==4)cnt=30;
        if(n==5)cnt=55;
        memset(vis,0,sizeof(vis));
        while(k--)vis[read()]=1;
        for(ans=0;;++ans){
            dfs(0);
            if(ch){
                write(ans),puts("");break;
            }
        }
    }
    return 0;
}
```