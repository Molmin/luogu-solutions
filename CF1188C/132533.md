美丽值等同于将序列按顺序排好后相邻之间相距最小的数的距离。

由于是对子序列计数，受上述启发直接排序，问题的答案等价于原问题，并且此时我们只要知道一个子序列中任意相邻数之间的距离就可以算出一个子序列的美丽值。

根据插板法，任意子序列的美丽值不超过 $\frac{V}{k - 1}$，想到枚举美丽值进行计数。                

最后询问的是美丽值之和，等价于所有美丽值不小于某个数的子序列个数，所以定义 $dp_{i,j}$ 表示前 $i$ 个数里面选了 $j$ 个数且不小于当前枚举的美丽值 $W$ 的子序列个数，则可以进行转移：               

$dp_{i,j} = \sum_{p = 0} ^ {pos} dp_{k,j - 1}$，其中 $pos$ 是 $a$ 的前缀中最后一个满足 $v \leq a_i - a_{pos}$ 的位置。                

发现 $pos$ 随着 $i$ 的递增具有单调性，可以双指针求，此时再滚一个 $dp_{k,j - 1}$ 的前缀和即可做到 $O(1)$ 转移。                

时间复杂度 $O(\frac{nkV}{k - 1})$。

