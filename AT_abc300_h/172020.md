### ABC300Ex - Fibonacci: Revisited

线性递推题。

我们知道 $a_n=\sum_{i=0}^k[x^i](x^n\bmod F(x))$，其中 $F(x)=1+x+x^2+\cdots+x^{k-1}-x^k$。这时我们得到了一个 $O(k\log k\log n)$ 查询一个 $a_x$ 的算法：多项式快速幂的过程中每乘一次取个模即可。

然后考虑题目所求怎么做。我们不妨设 $A(n)=x^n\bmod F(x)$，注意到 $\sum_{m\subseteq n}A(m)=\prod_{i\in n}(A(2^i)+1)$。

我们求出所有 $A(2^i)$ 然后全部乘起来即可，时间复杂度 $O(k\log k\log^2 n)$。

注意到计算 $A(2^i)$ 的时候，本来就要将两个 $A(2^{i-1})$ 乘在一起，所以我们不需要额外算 $A(2^{i-1})$ 了，时间复杂度其实是 $O(k\log k\log n)$ 的，可以通过本题。

有一些小技巧，例如我们可以注意到，$F(x)$ 是很有规律的！所以我们取模可以直接写一个树状数组或者用差分来做，就很好写了。

~~其实都是没用的东西，到最后我还是没学会多项式取模。~~

取模的这个优化真的很快，时限别开 6s 了，改成 2s 吧！

