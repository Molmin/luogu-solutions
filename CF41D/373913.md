动态规划，考虑自上而下递推。定义 $f_{i,j,k}$ 表示递推到 $(i,j)$ 时是否能够收集到 $k$ 颗豌豆，因为是自上而下地递推，所以依题意得， $(i,j)$ 这个格子只能由 $(i-1,j-1)$ 或者 $(i-1,j+1)$ 的格子转移得来。所以得到状态转移方程：

$$f_{i,j,k} = \begin{cases}1 ,& f_{i-1,j-1,k-a_{i,j}} = 1 \lor f_{i-1,j+1,k-a_{i,j}} = 1\\0 ,& \text{otherwise.}\end{cases}$$

特别的，对于第一行，有且仅有 $f_{1,j,a_{1,j}} = 1$ 。

对于最大值和起点，我们枚举最后一行的每个格子的每一个可行的数，如果是 $k$ 的倍数，那么更新最大值，反之没有，就表示无解。

同时，这道题要求输出方案。我们可以在状态转移的过程中添加一个数组 $g$ 记录方案，同 $f$ 数组，$g_{i,j,k}$ 表示如何在 $(i,j)$ 这个格子收集到 $k$ 颗豌豆。若 $g_{i,j,k} = \texttt{L}$，代表其是由 $(i-1,j-1)$ 转移得到；若 $g_{i,j,k} = \texttt{R}$，代表其是由 $(i-1,j+1)$ 转移得到。

通过 $g$ 数组，输出方案就很容易了。运用逆推，起始点在 $(n,p)$，其中 $p$ 是前文得到的起点，接下来每次判断 $g_{i,j,k}$ 的值，若是 $\texttt{L}$ 则变为 $(i-1,j-1)$，反之变为 $(i-1,j+1)$，注意每次向上走后，都需要将当前 $k$ 减去 $a_{i,j}$。
[代码](https://codeforces.com/contest/41/submission/186982637) 。
