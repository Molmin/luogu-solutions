首先看到集合数量虽然多，但是集合里的数最多只有 $10^5$ 个，这启示我们可以根号分治，将大小 $< \sqrt{n}$ 和大小 $\ge \sqrt{n}$ 的集合分开处理。

（以下称大小 $<\sqrt{n}$ 的集合为小集合，反之则为大集合。

由于大集合最多只有 $\sqrt{n}$ 个，我们的重点自然是怎么快速更新大集合中的信息。

先处理每个集合和每个大集合交集的大小，这步可以 $O(n\sqrt{n})$ 预处理；在给一个小集合中的数加上 $x$ 的时候，就可以 $O(1)$ 计算每个大集合答案的增量。

因为小集合中的数比较少，我们可以在询问的时候直接枚举每个数算和；当修改大集合中的数时，显然我们直接不能直接修改，这时候我们使用懒标记，询问的时候枚举大集合上的 $\text{tag}$ 看对答案的贡献。

具体来说：

* 修改小集合中的数，枚举大集合，计算答案增量；在原数组中把对应的数 $+x$。

* 修改大集合中的数，直接打懒标记。

* 询问小集合，先枚举对应的数算和，再枚举大集合把对应的贡献加进答案。

* 询问大集合，直接输出存好的答案即可。

总复杂度 $O(n \sqrt{n})$。