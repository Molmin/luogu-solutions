字符串萌萌题。

刚开始的时候看成字符串可以嵌套压缩，想用区间 DP 乱搞。大家不要学 FGgirl，FGgirl 不好。

$f_i$ 表示压缩完前 $i$ 位，最少的长度是多少。转移很简单，关键是这个问题：

> 求出区间 $[l,r]$ 中的最长循环节是多少。

如果你做过 [这道题](https://www.luogu.com.cn/problem/P4391) 就会知道，答案就是 $n-next_n$。具体证明可以看那道题的题解。

所以，我们只需要对于每一个后缀，做一遍 KMP 即可。

注意:

- 看那道题原题可以知道，用这种方法求出的最大周期，不一定是 $n$ 的因数，所以转移时要判断，只有周期长度整除 $n$ 时才能这样转移，否则只能整个字串压缩。

- KMP 是对于每个后缀求的，下标不要像我一样写错。

- 转移时，还要考虑数字的位数。

祝您 AC。

[**Code**](https://www.luogu.com.cn/paste/leanx16q)