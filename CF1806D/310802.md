比较简单的计数。~~感觉题目难点在于看懂题~~

题目大意就是维护一个类似并查集的东西，每次拿出 $p_i,p_i+1$，找到两个点所在连通块的根节点，根据 $a_{p_i}$ 决定谁连向谁，问所有方案中 $1$ 的入度之和。

显然如果 $a_1=1$ 那答案是 $0$。

先转期望，我们对每个点 $u$ 统计 $u$ 直接连向 $1$ 的概率。

我们发现 $u$ 能直接连向 $1$ 当且仅当：

- $a_{u-1}=0$。
- 在 $p$ 中 $u-1$ 要在 $[1,u-1]$ 中最后出现。（也就是连接 $u,u-1$ 的时候前面 $u-1$ 个点构成连通块）
- 前面 $u-1$ 个点的连通块根节点是 $1$。

第一个条件好办，第二个条件相当于在一个长度 $u-1$ 的随机排列中问某个点在末尾的概率，也就是 $\frac1{u-1}$。

第三个条件等价于对于每一个 $1$ 的情况，我们要求这个 $1$ 不是前面的所有点中最后一个，对于第 $i$ 个位置，这个概率是 $1-\frac 1i$。

我们发现对于每个 $1$，这个事情是独立的，所以我们每次只需要把前缀答案乘起来即可，复杂度 $O(\sum n\log p)$，可以通过预处理逆元做到 $O(\sum n)$，但感觉没必要。