不知道为什么能评上`*2500`。

~~可能是题意描述的问题。~~

注意题目中的「排列」是 $\{a_i\}$ 的排列，而 $\{a_i\}$ 是决定 $i$ 与 $i+1$ 所在弱连通分量的连边情况的。

容易知道如果从 $1$ 连出去了任意一条边，后续的操作便不会产生贡献了。考虑到这是一个临界情况，递推之。

设 $f_i$ 为考虑操作序列 $[1,i]$ 的排列，最终 $1$ 仍然没有出边的方案数。

若 $a_i=0$，那么在 $f_{i-1}$ 中一定是从 $i+1$ 连向 $1$，随便放即可。

否则 $1$ 一定不能是 $i$ 所在弱连通分量的无出边点，考虑在 $f_{i-1}$ 中，若 $a_1$ 在最后面，那么只要放到除了 $a_1$ 后面的 $i-1$ 个位置即可。

否则设 $a_1$ 的位置是 $p$，在这之前的所有位置可以任选。考虑操作排列 $[p,i-1]$ 内一定不存在从 $1$ 所在弱连通分量 $G'$ 连出去的边，因此要么是连入 $G'$ 的边，要么是相对孤立的两个点连边，此时证明 $i-1 \notin G'$。

>假设如此，那么如果 $i-1$ 连入了 $G'$，那么一定有 $i-2 \in G'$ 中，进而 $i-3 \in G'$。由此递归下去得到此时必须连完了所有边，与 $p \neq i-1$ 矛盾。

由于 $i-1 \notin G'$，所以 $a_i$ 的操作不影响 $1$，仅仅不能放在最后一个位置，方案仍然是 $i-1$。

于是

$$

f_i = \begin{cases}

f_{i-1} \cdot i & a_i = 0

\\

f_{i-1} \cdot (i-1) & a_i =1

\end{cases}

$$

考虑统计答案，设 $ans_i$ 为 $[1,i]$ 的贡献。考虑 $ans_{i-1} \rightarrow ans_i$，首先把 $a_i$ 扔到里面任何位置不会改变原有的贡献。其次如果 $a_i = 0$，那么有 $f_{i-1}$ 种方法使得 $ans_{i-1}$ 贡献 $f_{i-1}$ 个 $1$ 出去；而当 $a_i = 1$ 时，无论如何都无法使得 $1$ 的入边增加。

$$

ans_i = ans_{i-1} \cdot i + (1-a_i) \cdot f_{i-1}

$$

