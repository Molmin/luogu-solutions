# 题解

- 树链剖分 $+$ 线段树。

- 考虑操作 $1$，对于一个点 $x$，一个点 $y$ 的修改能够使 $x$ 变成黑色，当且仅当 $y$ 是 $x$ 的祖先，并且 $x$ 到 $y$ 路径上所有点的操作次数之和大于  $x,y$ 之间的距离。

- 然后将模型进行如下转化：每个点有一个点权，初始是 $-1$，每次操作将某个点的点权加 $1$，或者询问一个点 $x$ 到根路径上是否存在另一个点 $y$，满足 $x,y$ 之间路径上的点权之和 $\ge0$，线段树 $+$ 树链剖分维护后缀最大值即可。

- 接下来考虑操作 $2$，即使 $x$ 和 $x$ 子树内的点到根节点路径上权值的最大前缀和为 $-1$。很明显，我们需要让 $x$ 点的权值减去此时 $x$ 点到根节点路径上的最大前缀和 $+1$，线段树单点修改即可。注意还需将 $x$ 子树内除 $x$ 的点权值设为 $-1$。

- 时间复杂度 $\mathcal O(n \log^2 n)$，代码不放了。