[题目传送门](https://www.luogu.com.cn/problem/P3182)

## 题目分析

本题是一道**错排**问题。

首先我们发现，本题的矩阵实际上是没有任何作用的。因为题目已经保证了每一个障碍都不在同一列上，每一列都必定有且仅有一个棋子。在 $n$ 相同的情况下，如果我们不考虑输入的矩阵，不会对结果造成影响。因此我们直接将其定义为：**在第 $i$ 列的障碍物在第 $i$ 行上**。

接着我们讨论解法。

我们令 $f(n)$ 为有效的将编号为 $n$ 的棋子放置在 $n$ 个位置上的情况。因为除了第 $n$ 个位置都可以放，所以一共有 $n - 1$ 种放法。

假设第 $n$ 位棋子放置在第 $i$ 位上，那么就有两种情况：

1. 编号为 $i$ 的棋子放在第 $n$ 个位置上，此时可以化简为 $f(n-2)$ 的情况。

2. 编号为 $i$ 的棋子不放在第 $n$ 个位置上，此时可以化简为 $f(n-1)$ 的情况。

则有式子：

$f(n) = (n-1) \times (f(n - 1) + f(n-2))$ 。

特别的，有 $f(1) = 0$ 和 $f(2) = 1$ 。

值得一提的是，此题是一道**高精度**。因此直接使用 $\text{python}$ 解决！

## 贴上代码

```python
ans=0
tot1=0
tot2=0
n=int(input())
i=3
tot2+=1
while i<=n:
	ans=(tot1+tot2)*(i-1)
	tot1=tot2
	tot2=ans
	i+=1
if n==1: 
	print(0)
elif n==2:
	print(1)
else:
	print(ans)
```