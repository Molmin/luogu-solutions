**upd on 220811** 修改了递推式中的笔误。

Python 题解。

## 题意转化

输入给定的矩阵是干扰项，可以排除。

为什么这么说？

对于同一个 $n$，因为任意棋子不在同一列，最后我们总能找到某一行的障碍在第 $1,2,\cdots,n$ 列。

而在 $n$ 相同的情况下，不同的矩阵之间的差异仅仅在于障碍落在第 $1,2,\cdots,n$ 列上的行的排列顺序。

因为我们关心方案数，所以行的顺序怎么变都不会产生影响。

所以，我们干脆不管输入的矩阵，令矩阵第 $i$ 行的障碍必须在第 $i$ 列上。

这样问题就变成了：在 $n\times n$ 的矩阵中放置 $n$ 个棋子，第 $i$ 行的棋子不能落在第 $i$ 列上，任意两个棋子不同行、不同列，求方案数。

## 求解问题

这是一个经典的错排问题。可以先完成 [P1595 信封问题](https://www.luogu.com.cn/problem/P1595) 作为铺垫。

对于 Python 来说，两道题没有任何区别。

接下来，我们称「第 $i$ 行的棋子不落在第 $i$ 列上」为「错排」。

令前 $i$ 项满足错排的方案数为 $f_i$，易发现：

1. 当前 $i-1$ 项已经错排时

   将 $i$ 与前面任意一项交换。
   
   * 对于其余 $i-2$ 项：
   
      位置不变，依旧满足错排。
      
   * 对于 $i$：
   
      不在第 $i$ 个位置，满足错排。
      
   * 对于被选中数：
   
      因为被选中数在前 $i-1$ 项当中，放到位置 $i$ 上来后满足错排性质。
      
   综上，当前 $i-1$ 项满足错排时，一定可以插入一个 $i$ 使其依然满足错排。因为选择的用于与 $i$ 交换的数有 $i-1$ 种可能，故有：
   
   $$
   f_i=(i-1)\times f_{i-1}
   $$
   
1. 当前 $i-1$ 项中有一个数不满足错排，其余皆满足错排时：

   将 $i$ 与其交换。
   
   * 对于其余 $i-2$ 项：
   
      位置不变，依旧满足错排。
      
   * 对于 $i$：
   
      不在第 $i$ 个位置，满足错排。
      
   * 对于被选中数：
   
      因为被选中数在前 $i-1$ 项当中，放到位置 $i$ 上来后满足错排性质。
      
   综上，当前 $i-1$ 项中有一个数不满足错排，其余皆满足错排时，一定可以插入一个 $i$ 使其依然满足错排。因为与 $i$ 交换的数已经固定，所以方案数为 $1$。
   
   因为我们不关心数的具体数值，所以可以在长度 $i-2$ 的错排序列中插入一个不满足错排的数（有 $i-1$ 种可能的选择，对于任意一个选择的值，因为不满足错排，所以插入位置固定，即方案数为 $1$），再插入一个 $i$（方案数为 $1$）。
   
   故有：
   
   $$
   f_i=(i-1)\times f_{i-2}
   $$
   
综上，有：

$$
f_i=(i-1)\times(f_{i-1}+f_{i-2})
$$

以 $f_{1,2}=0,1$ 为初值，按此递推式求解 $f_n$ 即可。

#### 代码


```python
f = [0, 0, 1]
n = int (input())
for i in range (3, n + 1):
    f.append ((i - 1) * (f[i - 1] + f[i - 2]))
print (f[n])
```