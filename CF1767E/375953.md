$m=40$，这种数据范围，怎么可能不是折半算法？

把 $m$ 种颜色分成两半，左边 $k$ 种颜色，右边 $m-k$ 种。

先独立考虑左边和右边的答案。怎么算就是直接二进制枚举，常数小。

如何判断一个状态 $i$ 是否合法，我们不需要跑一遍所有平台，而是可以建图。发现，对于原来 $n$ 个平台，相邻两个平台中不能全部不买，我们可以把相邻两个平台的颜色连边，然后可以算最多可以留下不买的颜色的最大价值，总代价减一下就是答案。

这其实就是算一张图的带权最大独立集，设 $p_u$ 为颜色 $u$ 连向的点集合。对于状态 $i$，枚举 $i$ 中的每一个颜色 $u$，判断 $p_u$ 和 $i$ 是否有交集即可。

既然左右两边的独立答案都算完了，那么接下来要合并两边的答案。

枚举一遍的颜色状态 $i$，那么我们不难算出另一边不能选择的颜色集合 $j$，把 $j$ 一取反就是另一边可选的颜色集合。我们需要快速知道在这个可选的颜色集合中的最大独立集，可以直接 $sos\space dp$。