对$O(nlogn)$的做法奋战最后顺利bzoj和洛谷rk1，做法和cls的基本一样

首先如果m为质数就是道简单题，逐位考虑，设$now_j$为后缀中j的次数

$$
ans(k)=ans(k+1)+\frac{(n-k)!}{\prod_j now_j!}(\sum_j now_j)
$$

一开始用树状数组预处理出每个数后面更小的数字和，这样就是$O(nlogn)$的

现在m比较一般，可以有很多种处理方法，这里只介绍最直接自然的CRT，设当前模数为$d^k$，那么因为有阶乘除法需要把d提出来算

不妨搞个二元组$(a,b)=a+d^b$，把阶乘之类的用这个二元组搞，定义一下乘除法就好了，网上也基本上是这样，然而复杂度还是log方，主要是求逆元的问题。

cls用的是线性递推逆元，这我不是很理解在$p^k$的k>1的时候为什么能用，故我采用的是线筛+欧拉定理，因为素数为分布约为n/ln，然后注意到$p^k$只会超过$\sqrt m$最多一次，可以用exgcd求逆元；

综合复杂度为$O(nlogn)$

[code](https://www.luogu.org/paste/wune6kr6)

