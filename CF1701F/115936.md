这场 edu 应该是最近最简单的一次了。

考虑简化统计问题的答案，对于每个存在的数 $x$ 维护 $cnt_x$ 表示 $[x+1,x+d]$ 有多少个数，那么答案为 $\sum\binom{cnt_x}{2}$，考虑怎么维护。

考虑插入一个数 $x$ 的时候 ，相当于令 $cnt_{[x-d,x-1]}$ 区间加 $1$，随便列一下式子就会发现 $\binom{x}{2}\to\binom{x+1}{2}$ 相当于 $+x$，那么只要维护一个区间的 $cnt$ 的和即可。

然后求 $[x+1,x+d]$ 有多少个数存在，相当于直接求 $cnt_x$，这就是一个简单的单点修改。

删除反过来即可，相当于区间减，单点清空，最后都是查询全局和。

复杂度 $O(q\log n)$，$n$ 是值域。

https://codeforces.com/contest/1701/submission/163386880