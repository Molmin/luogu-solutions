当时场上水平特别差，只 pp 了 5 个题还 fst 了两题，现在随到这个题发现非常简单。。

首先可以在一分钟内看出答案必定 $\le2$，你考虑奇偶性，如果两个偶数答案就是 $0$，一奇一偶答案至多是 $1$，两个奇数答案至多是 $2$（一次操作可以把一个奇数变成一个偶数，两个偶数的 $\gcd\ge2$）。

然后考虑怎么判断答案，显然是先判断答案是不是 $0$，再判断 $1$ ，如果都不行的话就是 $2$。

先考虑 $0$ 的情况，根据套路，图上判联通距离之类的先去想想能不能生成树/并查集去搞，发现后者是可行的。由于 $10^6$ 之内的数的质因子个数最多为 $7$ 个（$2\times 3\times5\times7\times11\times13\times17=510510$），于是你可以把每个数的质因子预处理出来，然后对于每个质因子开一个集合，把有这个质因子的数放进去，最后再用并查集把**每个**集合里面的数都合并起来。判断的时候如果两个数在这个图内联通（有同一个祖先）那就是可行的，答案就是 $0$。  
然后考虑 $1$ 的情况。有三种可行的方法：  
1.  对 s 进行操作
2.  对 t 进行操作
3. 对一个别的数进行操作

前两种情况直接判掉，不多赘述。对于第三种情况，同样我们可以把  $a_i\times (a_i+1)$  质因子搞出来（只需要把预处理出的 $a_i$ 和 $a_i+1$ 合并起来就行） 然后考虑如果对他进行操作的话，可以使得 $a_i\times (a_i+1)$ 所含的**任意两个质因子所在的集合的祖先**联通，暴力二重循环，把它们塞进一个哈希表（或者 map）就可以了，查询的时候就看 $(find(s),find(t))$ 是否出现过即可。  
否则答案就是 $2$。

时间复杂度 $O(nx^2\log n)$，x 为质因子个数。

[代码](https://codeforces.com/contest/1553/submission/155021476)