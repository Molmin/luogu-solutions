查询一个点的直径不难，我们考虑怎样合并两棵树使得新树的直径最小。

记两棵树分别为 $i, j$，直径为 $d_i, d_j$。因为原来两颗树存在，所以直径至少是 $\max{\{d_i, d_j\}}$（0）。

假设连接点对 $(u, v)$，那么根据直径的性质（一个点能到达最远的点是直径的一个端点），通过这条边的最大路径即为 **$u$ 到树 $i$ 直径两端点距离的较大值（1）** + **$v$ 到树 $j$ 直径两端点距离的较大值（2）** + 1。

因此我们可以分别最小化（1）（2）的值。

假如 $u$ 不在直径上，那 $u$ 到直径两端点的路径一定是经过一些边到达直径的链上再走到直径，一定不优。因此 $u$ 要在直径上。显然，当 $u$ 是直径的中点的时候（1）式最小。$v$ 同理。

当 $d_i$ 为奇数时很好处理，偶数时（1）式则会是 $\lceil d_i / 2 \rceil$ (需要取较长一端）。$v$ 同理。

最终答案就是 $\lceil d_i / 2 \rceil + \lceil d_j / 2 \rceil + 1$。
当 $d_i = d_j$ 且是奇数时，有更优的连法（一条上取整，一条下取整，再 +1），然而长度也等于 $d_i$。

最终取个 max 即可。

[丑陋的代码](https://www.luogu.com.cn/paste/mn4y2uzs)