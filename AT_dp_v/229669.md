题意：有一棵 $n$ 个节点的数，你要给它黑白染色，但是限定染黑的节点必须连在一起（即形成一个连通块），对于每一个 $i=1...n$，问如果强制将 $i$ 节点染黑的染色方案数。（注意：模数不保证为质数）

数据范围：$n\leq 10^5$。

$O(N)$ 的 DP 且要对于每个 $i$ 都求的要么就是一次全算出来，要么是换根 DP。

你需要分两类，即 $u$ 子树里（不含 $u$）和除了 $u$ 的子树（含 $u$）。

对这两类分别使用 $f(u),g(u)$ 来表示强制 $u$ 染色的代价。

首先考虑 $f(u)$ 的转移，这是简单的：

$$
f(u)=\prod_{v\in son(u)}(f(v)+1)
$$

这个式子就表示每个子树都可以染或不染，染就 $f(v)$ 种，不染就 1 种。

但是 $g(u)$ 的转移就需要从 $f(u)$ 进行倒推了：

$$
g(u)=g(p)\cdot\prod_{v\in son(p)}(f(v)+1)+1
$$

这个转移分成 2 类：

+ 父亲及祖先（$g(p)$）
+ 兄弟的子树（$\prod_{v\in son(p)}(f(v)+1)$）

剩下的 $1$ 就是啥都不染的代价。

这样就可以得到一个 $O(N^2)$ 的做法了。

**一些优化:**

考虑到复杂度瓶颈为枚举兄弟节点，容易想到一个优化就是 $\prod_{v\in son(p)}(f(v)+1)=\frac{f(p)}{f(u)+1}$，但是不能直接用乘法逆元搞。

仔细想想维护前缀和后缀积就行，这样时间复杂度 $O(N)$。

**[代码](https://atcoder.jp/contests/dp/submissions/33886306)**