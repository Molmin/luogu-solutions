考虑这么几个性质：

在六角网络中，从 $(0,0)$ 到 $(x,y)$ 的距离是: 
$\max(|x|,|y|,|x-y|)$ 。

证明：对于右上方向和左下方向，我们的 $x,y$ 是同时同向改变的，所以可以先让某一维到位然后再改变另一维。答案是 $\max(|x|,|y|)$ 可以证明的是此时 $|x-y|$ 是小于这个值的，对于右下和左上方向，我们的 $x,y$ 是反向改变的，所以此时的距离可以认为是先改变一维，再改变另一维，答案是 $|x-y|$ 。

从 $(x_1,y_1)$ 到 $(x_2,y_2)$ 的距离可以认为是从 $(0,0)$ 到 $(x_2-x_1,y_2-y_1)$ 的距离。这个结论具体证明可以分类讨论，这里不展开了。

所以说，这两个点的距离就是 $\max(|x_2-x_1|,|y_2-y_1|,|(x_2-y_2)-(x_1-y_1)|)$ 。这里设 $c_i=x_i-y_i$ ，那么这个式子本质就在告诉我们，在以 $(x,y,c)$ 构成的立体坐标系中边长 $<=D$ 的正方形所包含的点构成的任意一个点集，自然地，我们会想到枚举这个正方形的三维都最小的点，设其为 $(x,y,z)$ ,计算以这个点出发的正方形的答案，但是这样直接算是会算重的。所以我们钦定这个点集每一维的最小值是 $(x,y,z)$，考虑某个点是否在某一维上等于我们枚举的这个点的那一维。相当于是，根据三个坐标是否是 $(x,y,z)$ 划分出三个集合，从这三个集合里选出某些点使得这些点构成的点集满足上述条件即可。

启发：想到转换距离，转化为正方形的计数，枚举点集每一维的最小值计数，比较巧妙。