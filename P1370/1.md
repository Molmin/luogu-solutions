1 题⽬⼤意

令 F ( l , r )表⽰序列 a [ l : r ]的本质不同的⼦序列个数，求 ∑F ( l , r )，1 ≤ l ≤ r ≤ n


2 关键词

递推 动态规划

3 简要算法

考虑单独求 F ( l , r )，使⽤动态规划。

令 dp [ i ]表⽰ F ( l , i ) − 1的值（即不包含空序列）。那么状态转移⽅程为

dp [ i ] = ( dp [ i − 1] + 1) ∗ 2 − ( last [ a [ i ]]?0 : dp [ last [ a [ i ]] − 1] + 1) − 1

其中 last [ i ]表⽰值 a [ i ]上⼀次出现的位置。

那么考虑求 ∑F ( l , r )，1 ≤ l ≤ r ≤ n，同样使⽤动态规划。


改变 dp [ i ]的含义，令 dp [ i ]表⽰以 i为右端点时的⾮空的本质不同的⼦序列的数

量。沿⽤单独求 F ( l , r )的思路，状态转移⽅程为


dp [ i ] = i +∑dp [ j ] − sum [ a [ i ]]，j=1 to i-1

sum [ i ] =∑[ a [ j ] = a [ i ]] ∗ dp [ j ]，j=1 to i-1

其中 [ p ]表⽰ p为 tr ue时值为1， p为 f al se时值为0。

那么答案就是∑( dp [ i ] + 1) ∗ ( n − i + 1)。i=1 to n
