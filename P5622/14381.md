看到下面的题解没有给出具体的复杂度证明，这里稍微简单证明一下吧。

用$\text{lct}$维护一棵节点数为$O(n)$的圆方树，操作三就是查询路径权值和，操作二是单点修改。显然单次复杂度都是$O(logn)$。

最主要的是操作一，添加一条边$\text{(u,v)}$后，把$\text{u}$到$\text{v}$路径上的所有点连接到同一个方点上。

一条路径上所有点连接到同一个方点上时，这条路径的大小就变成$O(1)$了，也就是说路径上的点都“消失”了。由于每个点只会消失一次，总共只有$O(n)$个点，因此单次操作的均摊复杂度依然是$O(logn)$。