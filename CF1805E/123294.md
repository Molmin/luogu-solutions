### [CF1805E There Should Be a Lot of Maximums](https://www.luogu.com.cn/problem/CF1805E)

提供一个不基于 $\mathrm{occ} = 2$ 的，时间复杂度 $\mathcal{O}(n\log n)$，空间复杂度 $\mathcal{O}(n)$ 的做法（这个比题解区现有题解均优秀）。

考虑快速描述一条边的两侧，自然想到 DFS 序拍平，子树是一段区间，子树外是一段前缀拼上一段后缀。将 DFS 序复制一遍，两部分都是区间。

问题来到：区间查询出现次数不小于 $k$ 的数的最大值。将询问离线扫描线，用权值线段树实时维护每个数当前的倒数第 $k$ 次出现的位置，查询相当于线段树上值不小于 $l$ 的最大下标，这个线段树二分即可。

代码想必不难写。