*[CF1299E So Mean](https://www.luogu.com.cn/problem/CF1299E)

很厉害的交互题。

我们来一步步分析题目。

初步思考问题，我们可以感知到回答为 $0$ 的询问几乎无法带来任何信息。这将我们的思考范围限制在 **用回答为 $1$ 的询问推断信息**。

进一步地，我们发现在随机询问时，期望 $k$ 次可以得到一个回答为 $1$ 的大小为 $k$ 的询问。因此，**大部分询问的 $k$ 一定很小**。

由于题目给出的信息形如 “和为 $k$ 的倍数”，在其中 $k - 1$ 个数已知的前提下，可以得到唯一未知数模 $k$ 的值。结合 $k$ 很小的限制，这启发我们从 **合并同余方程** 的角度思考。

自然地，我们选取一些两两互质的数 $q_1 < q_2 < \cdots < q_c$，保证它们的积不小于 $800$。但根据前提，在此之前我们必须确定一些数，使得对于任意 $q_i$ 和 $r\in [0, q_i - 1]$，存在大小为 $q_i - 1$ 且和模 $q_i$ 余 $r$ 的已知数的子集。

现在，为了确定一些数，肯定不能从很小的 $k$ 入手。考虑较为特殊的 $k = n - 1$，注意到题目保证 $n$ 为偶数，我们发现回答为 $1$ 当且仅当不含 $1$ 或 $n$，据此可以确定 $1$ 和 $n$ 的位置，并选择一个位置固定为 $1$，另一个位置为 $n$。

进一步地，确定 $1$ 和 $n$ 之后，我们可以类似确定 $2$ 和 $n - 1$，但它们的位置不能任选，可以通过和 $1$ 询问确定奇偶性从而确定哪个是 $2$，哪个是 $n - 1$，以此类推。

注意到 $3\times 5\times 7\times 8 = 840$，所以不妨令 $q = \{3, 5, 7, 8\}$。这样，确定 $1\sim 5$ 和 $n - 4\sim n$ 即可满足条件。为什么确定 $1\sim 4$ 和 $n - 3\sim n$ 不行呢？这样对于 $q_4 = 8$，已知数的七元子集只有所有已知数减去其中之一，当 $1\sim 4$ 和 $n - 3\sim n$ 模 $8$ 没有取遍 $0\sim 7$ 就寄了。那为什么 $1\sim 5$ 和 $n - 4\sim n$ 就行了呢？因为此时七元子集数就相当多了。这部分询问数为 $5n$。

对于 $q_i$ 和 $a_j$，从小到大枚举它模 $q_i$ 的值并检验。在这种策略下，确定每个 $a_j$ 模 $q_i$ 需要的总询问数为 $\sum\limits_{v = 6} ^ {n - 5} (v\bmod q_i) + 1$，为 $\dfrac {(q_i + 1)n} 2$ 级别。

算一下发现最坏情况要用 $18.5n$ 次，寄。但是我们发现当余数为 $0\sim q_i - 2$ 均不合法时，可直接确定 $a_j\bmod q_i = q_i - 1$。这样可将询问次数减去 $\sum \dfrac n {q_i}$，大概是 $17.7n$，可以通过。[代码](https://codeforces.com/contest/1299/submission/180260832)。