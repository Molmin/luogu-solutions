@kkksc03 管理员大大，我已经在本题讨论区给出本题翻译及 `markdown` 源码，请注意查收！

# 题目

## 背景

这是一道交互题。

一共有 $n$ 个人做成一圈，他们的编号从 $1$ 到 $n$。

现在每个人的手里面都有一个数字 $a_i$ ，并且保证每个人与他周围两个人的数字差为 $1$ ，即 $\mid a_i-a_{i\pm 1}\mid =1$ ，特别地，编号为 $1$ 与 $n$ 的人也满足这个规则。

在这个圈里面，编号为 $i$ 的人的对面坐着的是编号为 $i+\frac{n}{2}$ 的人（其中 $i\le \frac{n}{2}$），现在要你找到哪个人与他对面坐着的那个人手中的数字一样。

## 程序输出

在最开始，交互程序会给你一个 $n(2\mid n, n\le 10^5)$ ，表示这个圈里面的人数，然后你可以输出以下两种格式的操作：

1. `? x` 表示你想询问位置为 $x$ 的人手中的数字，询问不可执行超过 $60$ 次；
2. `! x` 表示你的程序的答案，即满足 $a_x=a_{x+\frac{n}{2}}(x\le \frac{n}{2})$ ，特别地，如果找不到答案，则输出 `! -1` ；

## 交互程序输入

对于操作 $1$ ，交互程序会输出一个整数 $a_x$ 表示 $x$ 编号的人手中的数字。

对于操作 $2$ ，如果你的答案是错误的，程序会直接退出，且测试结果为 `Wrong Answer` ，否则**若无其他问题**则测试结果为 `Accepted` 。

# 题解

一道十分有思维含量的好题 ~~我太弱了，想了一个小时~~ 。

首先，若 $n=4k+2$ ，那么 $\frac{n}{2}=2k+1$ ，即对于位置 $i$ ，它对面的位置 $i+\frac{n}{2}=i+2k-1$ ，可以发现他们相差**奇数个**位置，那么一定有他们的奇偶性不同，即他们一定不同，所以当 $n=4k+2$ 时一定无解，至于 $n=4k+1$ 或者 $n=4k+3$ ，那是不可能的，题目保证 $2\mid n$ 。

所以，只有当 $4\mid n$ 时才有解，现在我们考虑如何快速求解。

对于位置 $i,i\in [1,n]$ ，我们设它对面的位置为 $i'$ ，再记 $a_i-a_{i'}=t_i$ ，那么一定有 $2\mid t_i$ 且 $t_i-t_{i+1}=\pm 2 或 0$，下面给出后者的解释：

1.  当 $a_i=a_{i+1}+1$ ，且 $a_{i'}=a_{(i+1)'}+1$ 时，$t_{i+1}=a_i-1-a_{i'}+1=a_i-a_{i'}$ ，即 $t_i-t_{i+1}=0$ ；
2. 3. 种情况可以用上面的方法自行思考

现在我们要求的，就是一个位置 $i$ 能够满足 $d_i=0$ 。

而我们已经证明 $t_i$ 之间的差为 $\pm 2 或 0$ ，那么，假设我们枚举一个区间到一个区间 $[l,r]$ ，如果 $t_l$ 与 $t_r$ 异号，则满足 $t_i=0$ 的 $i$ 一定属于区间 $[l,r]$ 。

如果还有一些问题，可见程序。

[程序看这里](https://www.cnblogs.com/Arextre/p/12260753.html) ~~很不要脸地安利自己地博客~~