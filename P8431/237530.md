# P8431 题解  

题目链接：[P8431 「WHOI-2」彗星蜜月](https://www.luogu.com.cn/problem/P8431)。 

奇怪的做法，$\mathcal{O}(T \log n)$。  

首先，通过观察样例可以知道，答案和 $n$ 中开头连续 $9$ 的个数、结尾连续 $0$ 的个数有关，对于每一个 $n$，先预处理出这两个信息，记为 $c_9$ 和 $c_0$，设数字长度为 $l$。  

然后分类讨论。

## $l=1$  

只有一位，翻转还是自己，所以 $0\le n \le 8$ 时，小于等于 $n$ 最大的数就是 $n$，直接输出。  

$9$ 是特殊情况，$9+1=10$ 不再是 $1$ 位数，它翻转后是 $1\le9$，而 $11$ 翻转后是 $11\gt 9$，所以 $n=9$ 时 $m=10$。  

## $l\ge 2,c_9=l$  

所有位都是 $9$，$n$ 就是 $l$ 位数中最大的，所以对于任意 $l$ 位数 $x$，$f(x)$ 一定不超过 $n$，考虑 $(l+1)$ 位数，最小的是 $10^l$，它翻转后是 $1$，一定也小于 $n$；而 $10^l+1$ 翻转后仍然是 $10^l+1$，一定大于 $n$，所以答案是 $10^l$，也就是 $1$ 后加 $l$ 个 $0$。  

## $l\ge 2,c_9=0,c_0=l-1$  

也就是 $n=k\times 10^l(k\neq 9)$ 的情况。  

**确定最高位。** 如果 $m$ 的最高位 $\gt 1$，那 $[1,m]$ 中一定存在 $19\cdots9$ 这种数字，翻转后吊打 $n$，所以 $m$ 最高位一定是 $1$。  

**确定中间位。** 如果 $2\sim (l-1)$ 位不是 $0$，也一定存在一个 $1\cdots9$ 这种情况（中间可以是任意数字），翻转也大于 $n$，所以这些位一定是 $0$。  

**确定最低位。** 如果 $m$ 最后一位大于 $n$ 的最高位，翻转后肯定大；如果等于，前面都一样，最后一位 $1\gt 0$，也不行，所以 $m$ 的最后一位是 $n$ 的最高位 $-1$。  

## $l\ge 2,c_9=0,c_0\lt l-1$  

最高位和中间位与上一种情况相同，主要说最低位。  

最低位如果大于 $n$ 最高位，毫无疑问也不行；如果等于，因为 $n\gt k\times 10^l(k\neq 9)$，所以等于也可以，所以 $m$ 的最后一位就是 $n$ 的最高位。  

## $l\ge 2,c_9=l-1$  

**最高位。** 最高位如果是 $n$ 的最低位，就算后面全是 $9$ 也只和 $n$ 相等，还可以更大；再加 $1$，只要后面处理一下也可以小；如果加 $2$，就又有了后面都是 $9$ 的情况，翻转后大于 $n$，不行。所以最高位是 $n$ 最低位 $+1$。  

**中间位。** $n$ 前面都是 $9$，$m$ 中间全是 $9$ 也超不过，$f(m)$ 和 $n$ 的大小关系是由最后一位决定的，所以中间全填 $9$。  

**最低位。** 最低位如果还是 $9$，$f(m)\gt n$，所以最低位应该是 $8$。  

## $l\ge 2,c_9\lt l-1$  

**最高位。** 最高位如果大于 $1$，还是有 $199\cdots 9$ 这种数字，翻转后大于 $n$，所以最高位是 $1$。  

**$2\sim (l-c_9-1)$。** 这些位上只要不是 $0$,就可以给它 $-1$ 然后把后面都变成 $9$,翻转后就又比 $n$ 大了。所以这些都是 $0$。  

**第 $(l-c_9)$ 位。** 这一位对应 $n$ 的第 $(c_9+1)$ 位，类似于上一种情况的中间位，如果除了 $9$ 和 $9$ 后这一位外都是 $0$，即 $c_9+c_0+1\ge l$，$m$ 的第 $(l-c_9)$ 位就应该是 $n$ 的连续 $9$ 后出现的数字，否则就要加 $1$。  

**第 $(l-c_9+1)\sim (l-1)$ 位。** 也类似于上一种情况，全填 $9$ 后大小由最后一位决定，所以全填 $9$。  

**最低位。** 也类似于上一种，需要填 $8$。  

## 代码  

```cpp
#include <bits/stdc++.h>
#define gc getchar()
#define pc(c) putchar(c)
using namespace std;
char s[29];
int len;
inline int read(){
	register int t=0,f=1;
	register char c=gc;
	while(c!='-'&&(c<'0'||c>'9')) c=gc;
	if(c=='-') c=gc,f=-1;
	while(c>='0'&&c<='9') t=10*t+(c^48),c=gc;
	return f*t;
}
signed main(){
	int t=read();
	while(t--){
		int c9=0,c0=0;
		scanf("%s",s+1);
		len=strlen(s+1);
		if(len==1){
			if(s[1]=='9'){
				puts("10");
			}
			else{
				puts(s+1);
			}
			continue;
		}
		for(int i=1;i<=len;++i){
			if(s[i]!='9'){
				break;
			}
			++c9;
		}
		for(int i=len;i>=1;--i){
			if(s[i]!='0'){
				break;
			}
			++c0;
		}
		if(c9==len){
			pc('1');
			for(int i=1;i<=len;++i) pc('0');
			puts("");
		}
		else if(c9==0){
			pc('1');
			for(int i=2;i<len;++i){
				pc('0');
			}
			if(c0==len-1) pc(s[1]-1);
			else pc(s[1]);
			puts("");
		}
		else if(c9==len-1){
			pc(s[len]+1);
			for(int i=2;i<len;++i) pc('9');
			pc('8');
			puts("");
		}
		else{
			pc('1');
			for(int i=2;i<=len-c9-1;++i) pc('0');
			if(c0+c9+1>=len) pc(s[c9+1]);
			else pc(s[c9+1]+1);
			for(int i=len-c9+1;i<len;++i) pc('9');
			pc('8');
			puts("");
		}
	}
	return 0;
}
```