可以非常显然的发现： 有用的点只有起点、 终点和梯子的两个端点。 所以我们可以对图重新编号， 所以只剩下了 $\Theta(k)$ 个节点。

对于第 $x$ 层的层内转移， 有 dp 方程：

$f(i)=\min_{j}\{f(j)+a_x\times |i-j|\}$

我们按照这一层的房间编号顺序分别从左往右、 从右往左扫一遍。 注意到一个点要么能作为最优决策点， 要么一直无法作为最优决策点。 并且一个点一旦不是最优决策点， 后面都不会成为最优决策点。 所以我们可以通过这个性质减小枚举量。

对于层间转移， 按照梯子转移即可。

每次时间复杂度 $\Theta(n\log n)$ （瓶颈在重新编号）, 可以通过。

[AC记录](https://codeforces.com/contest/1627/submission/143483527)