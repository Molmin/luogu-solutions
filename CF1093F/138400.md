我们考虑 $dp_{i,j}$ 表示考虑到第 $i$ 个，最后一个为 $j$ 的方案数。转移就枚举最近一个连续段的左端点。显然要满足两个条件，其一是长度 $<len$，其二要都是 $j$ 或 $-1$。这个左端点显然对于每个 $j$ 都是可以一路实时更新的。

然后不就是个前缀和优化的事了吗？复杂度 $\mathrm O(nk)$。