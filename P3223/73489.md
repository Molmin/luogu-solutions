这是真正可以放进高考的数学题啊， 有高二数学能力的同学应该都可以推出来。注意男生女生和老师都是不同的。

因为老师只有2个，男的可以乱排，所以从这里入手。

### 1. 两个老师由男生隔开

那么男生和老师一共`N+2`个，不考虑老师的顺序就有$A_{N+2}^{N+2}$种方案。

把两个老师A,B捆在一起当做一个人(排列有`AB`和`BA`两种)，这样还剩`N+1`人的方案数就是$A_{N+1}^{N+1}$，相减就是$A_{N+2}^{N+2}-2A_{N+1}^{N+1}$。

此时有`N+3`个空隙，可以随意插入`M`个女生，所以总的答案为

$$(A_{N+2}^{N+2}-2A_{N+1}^{N+1})*A_{N+3}^{M}$$

### 2. 两个老师由女生隔开

容易发现在情况一时，即使第一步放置男生和老师时，即使把老师放在一起，也有可能被后面的女生又分开，这种情况没有考虑到。

我们可以直接把两个老师和中间的女生看做一个整体，任选一个女生和一种老师的排列(`AB`|`BA`)，有$2*M$种方案。

此时将三人与`N`个男生一同放置，显然方案数为$A_{N+1}^{N+1}$。

此时有`N+2`个空隙，可以随意插入剩余`M-1`个女生，所以总的答案为

$$2M*A_{N+1}^{N+1}*A_{N+2}^{M-1}$$

最终答案为
$$(A_{N+2}^{N+2}-2A_{N+1}^{N+1})*A_{N+3}^{M}+2M*A_{N+1}^{N+1}*A_{N+2}^{M-1}$$

计算时很多地方是可以合并化简的。

其中涉及高精乘低精，高精乘高精，高精加减高精。

代码太丑，就不贴了。