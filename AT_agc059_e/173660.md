考虑猜结论。

在猜测了 114514 个结论后，我们发现了一个不会 WA 的但是不知道为什么的结论：

对于图上的每一条竖线，我们把这条横线右边的点从左到右贪心“匹配”。匹配的过程是每次把 ``... x y x`` 变成 ``... x``。如果最后剩下的元素个数大于 $n$，那么返回 ``NO``。把它旋转 90，180 和 270 度再做一次。如果都符合条件就返回 ``YES``。可能比较抽象，可以看看这份[代码](https://atcoder.jp/contests/agc059/submissions/41152475)。

对于每个方向，提前预处理出来每个点下一个可能匹配的点，然后使用 LCT 维护即可。

时间复杂度 $\Theta(n \log n)$。

[AC CODE](https://atcoder.jp/contests/agc059/submissions/41152809)

----

理性分析一下，不难发现该做法与标算等价。