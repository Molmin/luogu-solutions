设 $f_{u,0/1}$ 为 $u$ 的子树，$u$ 是否在匹配内的最大匹配数。

注意到对于一个匹配，在它深度较浅的点上才会被计入答案。

转移大概是 $f_{u,0}$ 取 $\sum\limits_{v \in son_u} \max(f_{v,0}, f_{v,1})$，$f_{u,1}$ 要从儿子中选一个 $f_{v,0}$，剩下的选 $\max(f_{v,0}, f_{v,1})$。先假设全部选 $\max(f_{v,0}, f_{v,1})$，求出 $\max\limits_{v \in son_u} f_{v,0} - \max(f_{v,0}, f_{v,1})$，加进 $f_{u,1}$ 即可。

发现还要求以父亲为根的子树的最大匹配，这个是换根基础操作，转移式同上。减去儿子的 $\max$ 部分，维护前缀 $\max$ 和后缀 $\max$ 即可。注意特殊处理根。

[code](https://atcoder.jp/contests/abc223/submissions/41445506)