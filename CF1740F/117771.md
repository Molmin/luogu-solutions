

考虑如何判定一组可重集的大小 $x_1,x_2\cdots,x_k$ 合法。

因为所有的集合都是从一元集合并形成的，所以在不重复的情况下可以随意挪动里面的元素。

这里不妨规定 $x_1\ge x_2\ge \cdots\ge x_k$，然后此时可以发现，若 $x_i>x_j$，那么一定可以将 $i$ 可重集里面的一个元素挪到 $j$ 里面。

然后此时考虑 $y_i=\sum_{j=1}^i x_j$，若进行上述操作，则 $y_i,y_{i+1},\cdots,y_{j-1}$ 都会减一。所以感性理解一下，$y_i$ 整体越大，就越不容易满足条件。

所以我们现在考虑 $y_k$ 的上界是多少；直接从集合的角度不好考虑，我们换成从元素的角度考虑。我们依次枚举 $i$，对于 $i$ 来说，在这 $k$ 个集合之中最多有 $k$ 个，且 $i$ 在原序列中只有 $cnt_i$ 个，所以 $y_k \le \sum_{i=1}^n \min\{cnt_i,k \}$。

此时 $\text{DP}$ 的思路就很清晰了，我们令 $f_{i,j,k}$ 表示当前已经钦定了 $x_1,x_2,\cdots,x_i$ 的值，$y_i=j,x_i=k$ 时的方案数。

暴力转移即为直接枚举 $x_{i+1}$ 的值，可以用前缀和优化，复杂度 $O(n
^3)$。

注意到 $x_1,\cdots,x_i \ge k$，所以 $i\times k\le n$，状态数直接下降到 $O(n^2 \ln n)$，可以通过。

