# 前言

较为基础的概率 DP, 但是被题面搞傻了所以不会。

# 正文

设 $f_{i, 0}$ 为第 $i$ 次操作之后这个数仍然在原位的概率，$f_{i, 1}$ 为第 $i$ 次操作之后这个数不在原位的概率。

那么总共有 $N^2$ 种可能，有 $2$ 种可能 $i, j$ 相同，所以第一个转移方程为：

$$
f_{i, 0} = \frac{2}{N^2} f_{i - 1, 0} + \frac{N^2 - 2}{N^2} f_{i - 1, 1}
$$

那么来考虑第二类，~~根据容斥原理~~排除一类剩下 $N - 1$，有两个变量，多排除了一个重合的所以是 $(N - 1)^2 + 1$，于是可知第二个方程为：

$$
f_{i, 1} = \frac{(N - 1)^2 + 1}{N^2} f_{i - 1, 0} + \frac{2N - 2}{N^2} f_{i - 1, 1}
$$

可惜无法通过，考虑优化。

我们发现四个项前面系数是常数，所以可以使用矩阵快速幂优化 DP. 复杂度为 $\mathcal{O}(\log_2 K)$，可以通过。

# 后言

感谢出题人出的 DP 题目！