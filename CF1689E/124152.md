首先很蠢的是要先将所有的 $0$ 变为 $1$。

然后我们判断一下原图是否连通。

然后我们可以将每个 $a_i$ 进行 $+1 / -1$，判断图是否连通。

如果图还是不连通，那么答案就是 $2$，证明如下：

考虑原图的连通块，所有奇数必定在一个连通块里，剩下的连通块中一定全都是偶数。

我们把一个偶数加 $1$，将它的最后一位变为 $1$，而把一个偶数减 $1$ 则让它的 $\text{lowbit}$ 位变为 $0$，这之后的位都变为 $1$。

我们选出 $\text{lowbit}$ 最大的那一位减 $1$，实际上就让所有奇数和 $\text{lowbit}$ 比它小的数连通了，不难发现这样一定是最优的。

如果把 $\text{lowbit}$ 最大的这个数减 $1$ 后图仍然不连通，说明有多个 $\text{lowbit}$ 相同的数，这些数必然在一个连通块里，任取一个数加 $1$ 就能让这些数和奇数连通。

最后的问题就是如何判断图是否连通，一个很简单的做法是直接枚举点对，用并查集维护连通性，时间复杂度 $O(n^3 \log n)$（只有路径压缩）。看似过不了，没想到 CF 神机直接过了...