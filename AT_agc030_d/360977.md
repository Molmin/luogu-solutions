# AGC030D

感觉这种，将期望与将所有方案求和相互转换的 trick 很厉害啊（）。

首先，有个暴力的思路是设 $f_{i,j}$ 表示在当前状态下有多少种方案使得 $a_i>a_j$，转移时我们可以发现除了 $i,j$ 等于 $x$  或 $y$ 的情况，其他的答案都乘了 $2$，显然，每次暴力将其他数乘二的复杂度是不可接受的，但是，我们可以选择每次将 $i,j$ 等于 $x$ 或 $y$ 时的方案数除以二，最后再乘上 $2^q$，此时 $f_{i,j}$ 的实际意义是在每次有二分之一的概率下进行操作的情况下，$a_i>a_j$ 的概率。我们最后求的答案即为逆序对期望个数乘 $2^q$。这两种思路殊途同归。

转移可以注意到只有 $i,j$ 等于 $x$ 或 $y$ 时 dp 数组才会发生变化。

[Code](https://atcoder.jp/contests/agc030/submissions/44220666)