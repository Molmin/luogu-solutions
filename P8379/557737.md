本题解为官方题解

先只考虑 ```Query``` 的情况（下文中所有参与的集合都是非空集）。

我们定义 $G_1→G_2$ 代表将 $G_1$ 合并到 $G_2$，$\text{Sum}(G)$ 代表组 $G$ 内糖果数总和。

首先要证明出 $G_1→G_2→G_3$  优于 $G_1→(G_2→G_3)$。证明略，只要按照要求，就遍最大值进行比较即可。

那么最后的合并情况只有可能表示为： $G_{a_{1}}→G_{a_{2}}→...→G_{a_{n-1}}→G_{a_{n}}$。，其中 $a_1,a_2,...a_n$ 构成 $1,2,...,n$ 的一种排列。

**引理：若 $G_{a_{1}}→G_{a_{2}}→...→G_{a_{n-1}}→G_{a_{n}}$，$G_{b_{1}}→G_{b_{2}}→...→G_{b_{n-1}}→G_{b_{n}}$，$a_n=b_n$，那么这两个合并序列等价。（即合并后组内最大值一致）**

证明：不妨设 $G_{a_{1}}→G_{a_{2}}→...→G_{a_{n-1}}=S$，$G_{b_{1}}→G_{b_{2}}→...→G_{b_{n-1}}=T$。

可以发现 $|S|=|T|$，但 $\max(S)$ 不一定等于 $\max(T)$。

记 $\max(G_{a_{1}}→G_{a_{2}}→...→G_{a_{n-1}}→G_{a_{n}})=m_1,\max(G_{b_{1}}→G_{b_{2}}→...→G_{b_{n-1}}→G_{b_{n}})=m_2$，其中 $\max(P)$ 代表组 $P$ 内拥有糖果数最大值。

则 $m_1=\max(G_{a_{n}})+\frac{\sum_{i=1}^{n-1}\text{Sum}(G_{a_i})}{n},m_2=\max(G_{b_{n}})+\frac{\sum_{i=1}^{n-1}\text{Sum}(G_{b_i})}{n}$，又因为 $a_n=b_n$，所以 $m_1=m_2$。得证。

所以我们设 $M_i$ 代表 $G_{x_{1}}→G_{x_{2}}→...→G_{x_{n-1}}→G_{x_{n}}$ 中 $x_n=i$ 时 $\max(G_{x_{1}}→G_{x_{2}}→...→G_{x_{n-1}}→G_{x_{n}})$  的值。

有 $M_i=\max(G_{i})+\frac{\sum_{k=1}^{n-1}\text{Sum}(G_{x_k})}{n}=\max(G_{i})+\frac{\sum_{k=1}^{n}\text{Sum}(G_{k})-\text{Sum}(G_i)}{n}$。

显然 $\sum_{k=1}^{n}\text{Sum}(G_{k})$  可以预处理，如果没有 ```Change``` 操作，时间复杂度为 $O(n+k+m)$。

如果有 ```Change``` 操作，因为要屏蔽空集，所以用一个并查集维护上述元素即可。时间复杂度 $\text{O(nα(n))}$（视 $n,m$ 同阶）