从 $n\le500$ 以及题意中的“合并”不难猜出是区间动态规划问题。

考虑如何进行动态规划。

想到一个很朴素的方法，设 $v_{i,j,k}$ 表示区间 $[i,j]$ 合并后只剩下 $k$ 是否可行，$f_{i,j}$ 表示区间 $[i,j]$ 合并后最少数字个数。不难有：

+ 若存在 $p$ 和 $k$，使得 $v_{i,k,p}$ 和 $v_{k+1,j,p}$ 均可行，则 $f_{i,j}=1$，$v_{i,j,p+1}$ 标记为可行。
+ 否则，$f_{i,j}=\min\{f_{i,k}+f_{k+1,j}\}$。

这是一个 $O(n^3 V)$ 的抽象做法，但是为我们的解法提供方向。

我们考虑将第一步的 $O(nV)$ 降为 $O(n)$，使得总复杂度变为 $O(n^3)$。

发现 $p$ 的枚举是不必要的，人类智慧可得，一个区间若能缩成一个数，这个数唯一。

引入辅助数组 $q_{i,j}$ 表示若 $[i,j]$ 是可以缩成一个数的，那么这个数的值。

转移变为这样：

+ 若存在 $k$ 使得 $q_{i,k}=q_{k+1,j}$，则 $f_{i,j}=1$ 并且 $q_{i,j}=q_{i,k}+1$。
+ 否则，$f_{i,j}=\min\{f_{i,k}+f_{k+1,j}\}$。

[AC record](https://codeforces.com/contest/1312/submission/199717542)