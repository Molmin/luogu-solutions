#### Description

> 两个序列 $a_i,b_i$，A 和 B 任意在两个序列中任意取出两个连续区间，如果 A 的和大于 B 的和，A 就赢了。求 A 赢的概率。

#### Solution

感谢 lmpp 推荐这题！

首先问题不难转化为求：

$$\frac{\sum\limits_{i=1}^n \sum\limits_{j=1}^m[a_i>b_j]}{n \times m}$$

分母简单，求分子。

考虑归并排序，首先先把归并排序模板套上，也就是给序列排个序，排序的同时可以直接执行计算。因为我们都知道归并排序的时候会存在一个值 $pil$，将需要排序的区间 $a_{[l,r]}$ 拆分为三个部分：$<pil$ 的，$=pil$ 的和 $>pil$ 的，然后再分别排序。那么问题其实可以转化为在区间 $b_{[l,r]}$ 中固定一个值 $k$，寻找有多少个数小于 $k$，可以直接将归并里的 $pil$ 设为 $k$，然后在函数里排序的同时进行操作。最终在题目中实现的时候就从 $1$ 到 $n$ 枚举 $a_i$ 然后在 $b_{[1,n]}$ 中归并查找即可。

复杂度 $\mathcal O(n m\log m)$。