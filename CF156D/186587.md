记原图的连通块数为 $k$，各个连通块的大小为 $c_i$。

把两个连通块连起来的方案数显然为 $c_ic_j$，确定树的形态后，连出来的方案数就是把每条边的方案数乘起来。

把连通块看作点。把边权摊到点上。记最终的树上第 $i$ 个连通块的度数为 $d_i$，那么它对答案的贡献就是 $c_i^{d_i}$。

考虑 prufer 序列以保证可以连成一棵树。一个点每在 prufer 序列上出现一次，对答案的贡献就是 $c_i$。因为一个度数为 $x$ 的点只会在 prufer 序列上出现 $x-1$ 次，所以还需要额外算一次贡献。

最终的答案就是 $\prod c_i \times (\sum c_i)^{k-2}=\prod c_i \times n^{k-2}$。