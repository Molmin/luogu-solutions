我来当小丑了

----

### 题意

初始一个大小为 $n$ 的排列 $p_i=i$，并给定一个最大交换次数 $a_{1\cdots n}$。

每次可以选择 $u,v (u\not= v)$，将 $p_u,p_v$ 交换，并将 $a_u,a_v$ 都减 1。

在所有 $a_i$ 都非负的前提下，最后可能的 $p$ 的个数是？输出它模 $10^9+7$ 的值。

$n\le 10^6,a_i\in\{1,2\}$。

### 题解

我们考虑一个置换由若干个环组成，对于每个环，能交换过来当且仅当 $a_i=1$ 的个数不多于 2，这可以通过 ~~打表~~ 构造证明。

那么我们考虑我们要求的就是

$$
\begin{aligned}
& A!B![x^A][y^B] \exp \Big(\sum_{i\le 2,i+j>0} \frac{(i+j-1)!}{i!j!}x^iy^j \Big) \\
& = A!B![x^A][y^B] \exp \Big( \ln \frac{1}{1-y} + \frac{x}{1-y}+\frac{x^2}{2(1-y)^2} \Big) \\
&= A!B![x^A][y^B]\frac{1}{1-y}f(\frac{x}{1-y})
\end{aligned}
$$

其中 $f(x)=\exp (x+\frac{x^2}{2})$，两边求导可得 $f'(x)=(1+x)f$，所以

$$
if_i=f_{i-1}+f_{i-2},f_0=1
$$

所以我们最后要求的就是

$$
A!B!f_A[y^B](\frac{1}{1-y})^{A+1}=A!B!f_A\binom{A+B}{A}=f_An!
$$

时间复杂度 $O(n)$。