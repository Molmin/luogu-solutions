首先考虑一种怪物的情况，我们假设在第 $a_i$ 次操作中发动了第 $i$ 次攻击，那么造成的总攻击量显然是 $\sum\limits a_i-i$，如果我们记 $S$ 表示发动所有攻击的时间之和，$C$ 表示发动攻击的次数，那么有造成的总伤害就是 $S-\dfrac{C(C+1)}{2}$，也就是说总伤害只取决于 $S$ 和 $C$。

现在我们尝试扩展到两个怪物的情况。我们考虑将所有操作归类：

- $X$ 不固定，$Y$ 不固定，且它们不同。
- $X$ 不固定，$Y$ 不固定，且它们相同。
- $X$ 固定，$Y$ 不固定。
- $X$ 不固定，$Y$ 固定。
- $X$ 固定，$Y$ 固定。

考虑对这些类分开来处理。先考虑如果所有操作的类型都相同的情况怎么处理。

- 对于最后一类，答案是定值，直接算出来即可。
- 对于第二、三类和第四类，我们考虑枚举它们分别发动了多少次攻击，那么根据贪心的思想，我们肯定希望这些攻击的位置尽可能靠后，以最大化 $S$，而枚举攻击次数后 $C$ 就固定下来了，因此直接如果只有 2 或 3 或 4，就直接前缀和即可。
- 对于第一类，它对 $S$ 的贡献是定值，因此只有 $C$ 是有用的，而如果我们枚举第一类操作中有多少次让 $X$ 发动进攻。，那么哪几次发动 $X$ 哪几次发动 $Y$ 显然是不会对答案产生影响的。枚举所有 $C$ 然后简单计算一下即可。

这样我们可以得到一个四方的做法：枚举 1、2、3、4 类发动攻击的次数然后 $O(1)$ 算下答案取 $\max$ 即可。

考虑优化。可以发现 3、4 类是独立的，因此我们其实可以预处理出 $f_k$ 表示如果我们 1、2、5 类操作中对 $X$ 进行了 $k$ 次进攻，那么最终的攻击量最大能是多少，$g_k$ 也同理，预处理复杂度大概是 $n^2$ 的。预处理完之后我们就直接枚举 1、2 类对应的 $C$，剩余部分的贡献就是 $O(1)$ 的了。这样总复杂度可以做到 $O(n^2)$。