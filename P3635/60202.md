~~这种题口胡一下，并且谴责一下出题人就好了，千万别像我一样头铁去写7个k。~~

这篇题解就讲一下大致思路，具体细节太多，就不一一阐述了，~~希望管理员看在没有题解的份上通过~~。

考虑算出每一个苦无经过的格子，最后矩形面积并。

只要求出每一个苦无和哪一个苦无相撞，就容易求出它经过的格子。

苦无相撞无非就六种情况，分方向讨论，然后维护每一条平行于坐标轴的直线，以及与坐标轴成45度角的直线（两个苦无会相撞仅当它们初始的$x,y,x+y,x-y$中至少有一个相同）。

具体来说，按照直线的位置为第一关键字，在直线上的位置为第二关键字将点排序，建线段树，线段树上维护区间内距离最近的一对苦无，以及向两个方向移动的苦无中最靠左/靠右的，这个信息可以合并。

每次取出最早相撞的苦无，并将它们从线段树中删除，注意多个苦无同时相撞的情况。

对于删除，找到对应的线段树，把对应节点信息清空即可。

代码太丑就不贴了，需要的私信我。