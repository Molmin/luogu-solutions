经典好题。

我们发现，只有一个逆序对的排列就是 $1,2,\cdots,n$ 经过一次交换相邻两数产生的东西。因此我们可以先考虑至少交换多少次使其有序。

这是个典题。如果位置 $i$ 上的数需要去位置 $j$，那么将 $i,j$ 之间连有向边，在题目中就是 $i$ 向 $p_i$ 连边。显然所形成的是若干个环。对于一个环内，将这些点归位所需的操作次数是 $\text{环的大小}-1$。因为如果位置集合不变的话，交换完前面的位置后面的那一对就自动归位了。那么，使其变得有序的最少交换次数就是 $n-\text{环的个数}$。可以用并查集维护。那么，答案似乎是这个值加一了。

但是这样不一定是最优解。有可能我们数 $i,i+1$ 进行了一次交换，最后又换回来了，相当于浪费了操作。那么，我们只需要判断相邻两个数同时在环中的情况。这样，我们就可以直接留下这两个数不交换，省去了最后一步的操作。这样，答案就是这个值减一，特判一下即可。

时间复杂度 $O(n\log n)$，即普通并查集的复杂度。[代码](https://codeforces.com/contest/1768/submission/209176374)。