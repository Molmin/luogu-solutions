为啥官方题解是 $O(n\log n)$ 的啊。给个 $O(n\alpha(n))$ 做法。

显然我们可以通过最终序列的最大值和每次减少数的数量确定操作的轮数。

可以说明原序列的形态完全取决于最终序列的 $a_i\leq n$ 的数的排列形态，即我们只需要关注这些位置的值。因为对于 $a_i\leq n$ 和 $a_i>n$ 的数，可以把它们看成 $0$ 和 $1$，显然形态是确定的。每次操作加入数的位置和顺序都是相同的，所以 $1$ 内部的顺序也是确定的。于是我们只需要关注剩下的数。

可以把操作看成每次操作后并不删除，转移看做一个集合的继承，最后这个位置的答案就是集合内的所有数取 $\min$。于是我们用一些方法求出所有位置最终被转移到什么地方，那么最终序列带来的约束就是原序列中一些位置的 $\min$ 值为某个确定的值。我们把每个约束的最小值填到满足要求的编号最小的位置，剩下位置从前往后用并查集找到合法的最小值即可。

https://codeforces.com/contest/1647/submission/149897614

