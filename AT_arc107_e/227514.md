性质别的题解已经说的很明了了，就是几条对角线状物经过几轮迭代后就不变了，然后按照这个结论小范围暴力就能过了，时间复杂度 $\Theta(n)$。

[Submission](https://atcoder.jp/contests/arc107/submissions/42079739)。

下面是关于这个性质的一种证明，仅供参考，来自 CF：

断言：
1. 方阵中不可能存在形为 `x x` 的子矩阵。
2. 方阵中不可能存在子矩阵 `2 1 2`。
3. 方阵中不可能存在子矩阵 `1 2 1`。
4. 方阵中不可能存在子矩阵 `0 2 0`。

证明：

断言 1 是显然的。

对于断言 2，如果存在一行 `2 1 2`，不难推出上一行必然是 `? 0 0`，这显然是不可能的，断言 3 类似。

对于断言 4，如果存在一行 `2 1 2`，不难推出上一行必然是 `2 1 2`，这是不可能的。

由此，证明了四个断言。

从而，对于子矩阵 `x y z` 来说，通过讨论 $y$ 的取值可以得到必有 $y=\operatorname{mex}(x,z)$，过程繁而不难，略去。

从而，可以得到：
$$a_{n,m}=\operatorname{mex}(a_{n,m-1},a_{n-1,m})=\operatorname{mex}(a_{n-1,m-2},a_{n-1,m})=a_{n-1,m-1}$$

然而，对于第一行，最基础的断言是不正确的，从而需要对 $n,m$ 较小的情况特殊处理，也就是需要证明，经过常数步之后，四个断言被同时满足（或者结论成立）。这个常数不能太大。

断言 1 总是正确的，所以之后的讨论只能基于断言 1 进行。让我们讨论一个最基本的 $4\times 4$ 方格，其中不含第一行第一列：
```plain
. . . .
. . . .
. . x z
. . w y
```
那么：
- 如果 $w\neq z$，则根据断言 1，$x,y$ 肯定与 $w,z$ 都不同，因为值域大小只有 2，所以 $x=y$。
- 如果 $w=z$，假设 $x\neq y$，于是局面可以被重写为：
  ```plain
  . . . .
  . . . ?
  . . a b
  . ? b c
  ```
  根据断言 1，两个 `?` 只能等于 $a$ 或 $c$，接下来，有两种情况：
  - 两个 `?` 都是 $c$。那么根据断言 1，可以填出：
    ```plain
    . . . .
    . . b c
    . b a b
    . c b c
    ```
    这表明 $a=\operatorname{mex}(b,b)=c$，矛盾。
  - 两个 `?` 中至少有一个 $a$。不妨令左面那个问号是 $a$：
    ```plain
    . . . .
    . . . ?
    . . a b
    . a b c
    ```
    那么可以得到 $\operatorname{mex}(a,a)=b$ 和 $\operatorname{mex}(b,b)=c$，那么经过讨论可以得出必然有 $a=2,\ b=0,\ c=1$：
    ```plain
    . . . .      
    . x v ? 
    x u a b
    t a b c
    ```
    用类似的方法，可以导出 `t u v` 必然是 `0 1 0` 或 `1 0 1`，则根据断言 1 可以知道，其左上的两个位置 `x` 都是 `2`，从而根据 $\operatorname{mex}(2,2)=0$，可以知道 $t=1,\ u=0,\ v=1$，那么根据断言 1，`?` 肯定是 2，然后不难根据 mex 的定义得出他的上面是一个 `0`，又根据断言 1，肯定 `0` 的左边是 `2`。有点麻烦，看一下图：
    ```plain
    . . 2 0
    . 2 1 2
    2 0 2 0
    1 2 0 1
    ```
    但是，我们发现这个构造一定是不合法的，因为它指出 $\operatorname{mex}(2,2)=1$，矛盾。
  
  从而，$w=z$ 时，必然有 $x=y$。


从而，命题得证。也可以由此知道，4 次迭代之后，结论一定成立。