# CF1436E Complicated Computations

## 题意简化

> 给定一个 $n$ 个元素的数列 $a$，求 $a$ 所有非空子序列的 $MEX$ 所构成的数列的 $MEX$。

## 题目分析

首先，考虑枚举 $MEX$ 的 $MEX$。假设当前枚举到了 $x$。

在此之后，取出所有不含 $x$ 的区间，如下图。

![break.png](https://s1.ax1x.com/2020/10/26/BuM0dx.png)

黑色线段表示的是需要取出的区间。

现在，问题转换为快速（$log$）求区间 $MEX$。

以权值为下标，数组位置为时间轴（$rt$）建一颗主席树。

每次单点修改，区间查询，维护当前区间中每个权值最后一个出现位置的最小值。

查询区间 $[l,r]$ 的 $MEX$ 时，在主席树上 `ask(rt[r],1,n+1,l)`，其中，如果左区间的最小值小于 $l$ 就向左走，不然就向右走。

时间复杂度最坏 $O(n\times log\space n)$。