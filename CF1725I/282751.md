首先不难想到对原树建重构树，因为它保证了边权递增，也就是重构树的形态是固定的，这样对于重构树上一个节点 $u$ 两个儿子的集合 $S_1,S_2$，$S_1,S_2$ 满足原图的性质， 现在连上这条边 $i$ 以后，$S_1$ 和 $S_2$ 中的任意两个 $u,v$，均有一个简单环经过，即下面的情况：

![](https://cdn.luogu.com.cn/upload/image_hosting/o58nj8ym.png)

就是说必然存在 $j<i$ 先行连接了 $S_1$ 和 $S_2$。

然后我们注意到图上共有 $2n-2$ 条边，而这样的情况会出现 $n-1$ 次，那么每个 $i$ 能且仅能对应一个 $j$。

我们可以看成有 $n-1$ 种颜色，给一个长度为 $2n-2$ 的序列染色，每个颜色只能用两次，且对于 $i<j$，$i$ 最后一次出现的位置早于 $j$ 最后一次出现的位置。

这样就把边权分配给了每条边，然后对于 $i,j$ 的端点，均有 $|S1|\times|S2|$ 种可能性。

而上面那个问题也是可以直接做的，注意到在满足每个颜色只用两次的情况下，恰有 $\frac{(2n-2)!}{(n-1)!}$ 种合法序列，所以总答案就是 $\frac{(2n-2)!}{(n-1)!2^{n-1}}$ 乘上每条边可能的取值。

代码就不放了，很好写。