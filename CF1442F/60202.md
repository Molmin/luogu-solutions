[宣传，有参考代码](https://www.cnblogs.com/2005lz/p/14725659.html)

以下内容搬运自cf官方题解

真是毒瘤。

先考虑对于一张空图怎么做。

如果最后是一张有向无环图，则每一个点有唯一的SG函数值。通过嬴或者是输的询问只能确定目标节点的SG函数值，对于SG函数值相同的点便无能为力。

于是需要$O(n^2)$条边使得每一个点的SG值均不同，而且每次询问只能排除一个点，单个阶段需要$O(n)$次询问，这样无论如何都是无法通过的。

于是需要利用环的性质。

但是有环时不容易判断游戏的结果。

考虑到有一个点有连向自己的边并且该点上有至少一枚棋子，则先手不会失败（没有必胜策略时，操作方可以沿自环移动已保证不败）。

考虑将点集划分为$S_1$和$S_2$，不存在边$e:i->j$同时使$i \in S_1$和$j \in S_2$成立，且：

$$\underset{i \in S_1}{\text{mex}} \space SG_i=|S_1|+1$$

设$j \in S_2$出边连向点与$S_1$交集为$T_j$，且$T_j$互不相同，$S_2$中所有点向自己有边。

然后，牛逼的来了，只需要做$|S_1|$次询问，每次询问一个点，便可确定答案。

假设答案是点$x$。

如果询问点$i$时先手必败，说明$x \notin S_2$（原因如上），由$SG_i \space \text{xor} \space SG_x=0$知$x=i$。

如果没有先手必败的情况，则平局点集即为$T_x$！证明显然。

只需取$|S_1|=20$，连最少的边使$T_j$互不相同即可。

非空图类似，用拓扑序找$S_1$，然后改变最少的边使$T_j$互不相同（可以删边）即可。

稍加计算得改变边数在$4000$以内，可以通过本题。