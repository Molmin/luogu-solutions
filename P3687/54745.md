### Description 

给定一张 $n$ 个点 $m$ 条边的无向简单连通图，问有多少种加边方法使其是一颗仙人掌。

$n \leq 5\cdot 10^5, m \leq \min\{\frac{n\cdot(n+1)}{2}, 10^6\}$  

### Solution

若原图不是一颗仙人掌，直接输出 $0$ 即可。

若其是一颗仙人掌，其中的环对答案没有贡献（既不能在其中加边，也不能向外连边），可以直接把与这个环相关的边删掉。剩下的即是一颗森林。求出每棵树的方案数将其直接累乘即可。

如果图是树的情况下怎么做？发现如果在一颗树找出若干个不相交的链，每个链的首尾连一条边，那么这个图一定是仙人掌；反之，最后加完边的图，加上的每一条边都对应一条链，每一条边也只会属于至多一个环即至多属于一个树链加上加上的边。所以问题转化成在一棵树中找出若干不相交的链的方案数。 这样还是不是特别好做，如果我们把那些没有在任何一个环的树边看成在他与他自己的环里，那么问题就转化成了 **用若干条不相交的链覆盖整颗树的方案数** 。

考虑树形dp。令 $dp_u$ 为 $u$ 的子树中所有边加上他到父亲的一条边的方案数。令 $f_x$ 表示一个点的度数为 $x$，把所有与它相连的边用长度不超过 $2$ 的链全部覆盖的方案数，则 $dp_u = f_{deg_u}\Pi _vdp_{v}$ 。其中 $v$ 是 $u$ 的子节点，$deg_u$ 是 $u$ 的度数。

$f$ 考虑用递推求。每次新加入一条边，他可以自己是一条链，也可以与之前的一条匹配成一条链。易得 $f_n = f_{n-1}+(n-1)\cdot f_{n-2}$ 并且 $f_0 = f_1= 1$ 。

复杂度 $O(n+m)$ 

### Code

[看代码戳这里](https://acfunction.github.io/2019/06/21/BZOJ4784/#Code)