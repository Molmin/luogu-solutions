随便画几下，发现利用儿子贡献父亲好像要很多条件……所以，思考利用祖先的条件计算儿子。

对于一个点 $u$，从它到 $n$ 的路径上，每条边都会有一个删除顺序。比如，路径为 $u-u_1,u_1-u_2,u_2-n$。为了 DP 顺利，思考 $u_1-u_2,u_2-n$ 两条边对 $u-u_1$ 删边的影响。

1. 先删 $u_1-u_2$：那么我们发现，$u$ 在 $G$ 中的边必定连不到 $u_2$，无论如何安排顺序，只能连到 $u_1,n$ 两个点。

2. 先删 $u_2-n$：则 $u$ 在 $G$ 中存在一种顺序，能连到 $3$ 个点。

更一般化，我们设路径上每条边的删除时间为 $t_1,t_2,...,t_m$，那么 $u$ 其实只能连到 $t_{p_1},t_{p_2},...$ 所对应边的儿子，其中 $p_i$ 为按时间排序后从上到下的顺序递增（贪心处理的）的第 $i$ 条边。

能连到的点个数是一个变量，设 $f_{u,i}$ 表示当前 $u$ 能连到的父亲有 $i$ 种选择，对于 $u$ 子树的方案数。

枚举一下 $u$ 连向的父亲是从上到下第 $j$ 个点，那么在第 $j$ 个点删完边后直接跳到 $u$，对于所有儿子来说共有 $j+1$ 个点可选择。

$$f_{u,i}=\sum_{j=1}^i\prod_{v}f_{v,j+1}$$

发现 $f_{u,i}$ 比 $f_{u,i-1}$ 只多了 $j=i$ 的情况，前缀和优化即可。