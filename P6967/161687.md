## Description

你要构造一个长度为 $n$ 的 $01$ 序列，每个位置选 $0/1$ 的权值给定。

要求在任意 $k$ 连续段的 $0$ 的数量大于 $m_s$，$1$ 的数量大于 $m_e$，在这种状态下最大的总权值。

还要输出一种方案。

## Solution

这题和 [NOI2008 志愿者招募](https://www.cnblogs.com/dmoransky/p/13592442.html) 挺像的。

看起来很像 DP，但 DP 要记录每个点选的啥才能保证满足限制，因此不能用 DP。

发现要满足的限制是一个带变量的不等式，我们需要在限制内，选择一种变量的方案，使答案最大化。

可以考虑设置一些变量，变不等式为等式，利用网络流的流量守恒，使每个点等于一个等式，我们只需要将等式变换让每个变量最多出现在一个等式的左侧和另一个等式的右侧（或者只出现一次）：

* 若出现两次，让右侧的等式点指向左侧的等式点连一条边。
* 若出现一次，若右侧则让这个等式点指向网络流虚拟汇点连一条边。

对于等式中的常量，左右侧连和源汇点连边，考虑到费用流首先保证最大流，因此一定会让它充满。

这条边的流量就映射着这个变量的选择，因此变量的形式应该是 $0 \le x \le a$。（$x$ 为变量，$a$ 为常量），这样可以保证每个变量在所有等式中是同一个值。

因为睡觉和吃是补集关系，我们不妨只考虑在那些位置吃饭。设最初我们都选择睡觉，然后考虑每个点的权值为 $e_i - s_i$，即从睡觉到吃变换的权值。

设 $x_i \in \{ 1, 0\}$ 为第 $i$ 天是否选择吃饭，那么需要满足对于任意 $K \le i \le n$， $m_e \le \displaystyle \sum_{j=i-k+1}^i x_j \le k - m_s$。

化不等式为等式，设 $t_i$ 为这个等式的一个阙值，满足 $0 \le t_i \le k - m_s - m_e$，这样上面那个式子就等价变成了：

$$\displaystyle \sum_{j=i-k+1}^i x_j + t_i = k - m_s$$

但是呢现在每个变量出现在了多个等式中，考虑把等式进行等价变换，保留 $i = k$ 的等式，$i > k$ 的等式做一个差分，等价变成 $i$ 减去 $i - 1$ 的等式，如此，我们得到了 $n - k + 1$ 个等式：

* $i = k$：$\displaystyle \sum_{j=i-k+1}^i x_j + t_i = k - m_s$
* $i > k$：$t_i + x_i = t_{i-1} + x_{i-k}$

然后我们发现变量就最多出现在两个式子中了，因此跑最大费用最大流就好了。

还要输出方案，根据实际意义在网络流里看对应边有没有流满就好了。

网络点边数都是 $n$ 级别的。由于网络流不容易卡满，因此可以跑过。