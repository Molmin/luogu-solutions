（致审核管理：我改成分块了，现在小块复杂度确实没有 $\log$ 了阿）

首先根号分治，对于大小小于 $\sqrt n$ 的块用分块维护（具体的，$O(\sqrt n)-O(1)$ 修改查询），求连通块和的时候暴力求和即可。对于大小大于 $\sqrt n$ 的块最多有 $\sqrt n$ 个，所以考虑对于每个块维护结点标号组成的有序序列和连通块的点权和，合并时启发式归并排序，那么这里大块的总复杂度就是 $O(n\log n)$。

修改的时候扫一遍所有大块，考虑对其产生的影响，那么问题就变成找后继，找到之后容易 $O(1)$ 计算影响。

那么因为最多 $\sqrt n$ 个块所以合并次数不超过 $\sqrt n$，于是用分散层叠维护之，每次合并的时候暴力重构即可。

根据分析可以得到时间复杂度为 $O((n+q)\sqrt n)$。

纯口胡，不过应该没啥大问题。