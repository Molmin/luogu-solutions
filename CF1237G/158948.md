\*3500

设 $v=\frac{\sum a_i}n$，我们要把每个数都摊成 $v$。

先不考虑环，考虑序列上的一个区间，它能摊成功当且仅当 $\sum_{i=l}^ra_i=v\times(r-l+1)$。

考虑能摊成功的最小步数，我们只考虑能摊成功的**连续区间**，其中连续区间定义为不存在一个位置 $p\in[l,r]$ 使得我们的会议只在这个位置的右边和左边（not inclusive）。

有一个很明显的结论是连续区间可以在 $\lceil\frac{len-1}{k-1}\rceil$ 次会议内完成，我没模没看题解也看出来了。

xyx 的证明没看懂，我写个我的：

- 考虑最左边的 $k$ 个是否有 $\sum a\ge v\times k$，如果有就把最左边的 $k-1$ 个摊平，剩下的堆在第 $k$ 个位置继续考虑。
- 否则考虑往后平移 $k-1$ 个位置，直到平移到一个位置 $p$ 有 $\sum a\ge v\times p$。
- 这时我们从 $p$ 这个位置 $k-1$ 个 $k-1$ 个往回摊平即可，由于有 $\sum_{i=l}^ra_i=v\times(r-l+1)$ 所以肯定找得到这样的位置。

接下来没想到，我们抓住分母 $k-1$ 考虑：对于连续区间考虑 $len-1 \bmod (k-1)$ 的余数 $r$。

设有两个相邻连续区间的余数分别为 $r1,r2$，考虑合并的变化，整除的部分不变，余数部分 $\lceil\frac {r1}{k-1}\rceil+\lceil\frac {r2}{k-1}\rceil\to\lceil\frac {r1+r2+1}{k-1}\rceil$。

首先有 $r1,r2\in[0,k-1)$，于是 $r1+r2+1\in[1,2k-3)$，也就是说 $\lceil\frac {r1+r2+1}{k-1}\rceil\in[1,2]$，分类讨论：

- $\lceil\frac {r1+r2+1}{k-1}\rceil=2$，首先 $\lceil\frac {r1}{k-1}\rceil+\lceil\frac {r2}{k-1}\rceil\le 2$，考虑是否可能优于合并，有：
  
  $\lceil\frac {r1}{k-1}\rceil+\lceil\frac {r2}{k-1}\rceil=1$，不妨令 $r1=0$，显然 $\lceil\frac {r2+1}{k-1}\rceil\le 1$，不可能。
  
- $\lceil\frac {r1+r2+1}{k-1}\rceil=1$，劣于合并是很有可能的，考虑什么时候会优于合并，有：

  $\lceil\frac {r1}{k-1}\rceil+\lceil\frac {r2}{k-1}\rceil=0$，则 $r1=r2=0$，此时确实优于合并。
  
综上讨论只有当 $r1=r2=0$ 时可能优于合并，其他情况合并都不劣。

考虑环形答案，首先 $\lceil\frac{len-1}{k-1}\rceil$ 的下界是卡得很紧的，我们直接把整个环当成一个连续区间是优选方案之一。

其他情况只可能是分成一些连续区间做，又由于余数 $r\pmod{(k-1)}\neq0$ 时合并不劣，所以只考虑连续区间余数 $r$ 都为 $0$。

此时答案为：$\sum\lceil\frac{len-1}{k-1}\rceil=\sum\frac{len-1}{k-1}=\frac n{k-1}-\sum\frac 1{k-1}$，那么区间越多白嫖的 $-\sum\frac 1{k-1}$ 就越多。

于是我们贪心选取尽量多的连续区间即可。

枚举起点，一个以它为左端点的连续区间右端点是定的，我们预处理一下，可以倍增确定起点后的 $n$ 个数有多少个连续区间。