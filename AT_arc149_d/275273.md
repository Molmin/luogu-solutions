很妙的一个题。

没法用数据结构直接维护点的移动。可以挖掘一些性质。

发现对于两个点 $x$ 和 $-x$，它们的移动关于原点对称。可以根据对称性维护森林。

维护当前的区间，初始为 $[1,10^6]$ 并且这个区间总是位于 $x$ 轴的同一个半轴中。假设当前遇到了操作 $d_i$，将区间根据正负向左或向右移 $d_i$ 格。若区间覆盖了原点，就把区间以原点为分界点分割，将较短的那一边对称到较长的那一边。

参考官方题解给的一张图：

![](https://img.atcoder.jp/arc149/9aa345ea3aa518aa46d7cd6f112c0760.png)

初始区间为 $[1,12]$，左移 $8$ 位，则 $8$ 到达了原点，接下来不用考虑了。剩下的两个区间 $[1,7]$ 和 $[9,12]$，将 $[9,12]$ 对称到 $[1,7]$ 中，在树中连向相应的边 $7 \to 9$，$6 \to 10$，$5 \to 11$，$4 \to 12$，表示将来的 $9$ 就继承 $7$ 的状态，等等。最后位置再取个反。后面的右移 $2$ 位同理。

最后一遍 dfs 求出最后每个点的状态。

实现时维护了一个 $add$ 表示整个区间的偏移量。

[code](https://atcoder.jp/contests/arc149/submissions/36366723)