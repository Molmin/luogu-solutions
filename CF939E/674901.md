容易发现，为了让选出部分的最大值减去平均值最小，选出的部分一定是最大值和一个连续前缀。

证明：连续的前缀是为了使得选出部分的平均数尽量的小，而最大值则是为了让 $\max$ 变成序列的最大值。

序列具有单调性，可以使用双指针，二分等单调的算法进行枚举。这里使用的是双指针维护选择前缀的右端点。由于一直插入更大的，所以也许可以继续往右边选择一些新的数，满足平均值变得更小。注意平均数是小数。

时间复杂度 $\Theta(n + q)$。