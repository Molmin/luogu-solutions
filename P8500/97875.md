题意：

对长度为 $n$ 的序列 $a$，已知 $m$ 个条件：区间 $[l,r]$ 的最小值为 $v$。

最小化逆序对数。

---

易知存在最优解满足每个 $a_i$ 一定是某个 $v$。

考虑性质 B：$l_i=r_i$。

即可以确定每个被限制的 $a_i$，没有被限制的位置可以任意放。

容易发现没有被限制的位置一定放成一个不降的子序列，那么在每个位置上贪心放产生逆序对数目最少的数字即可。

接下来考虑性质 C： $[l_i,r_i]$ 不交。

容易想到这样的策略：每个区间的最前端钦定放 $v$。这样只是在 $B$ 性质的基础上多了一个某些位置的数字有不小于某个数的限制。

事实上，从前往后考虑，在这些未被钦定的位置上放下产生逆序对数目最少的数字就是最优的。

有一个比较奇怪的解释是：

考虑另外一种填法：

1. 我们考虑从小往大填数字，每次将一些位置都变成一个数。容易发现这些位置一定是可以填的数的一个前缀。
1. 考虑这样一件事：一个被填的位置与没有被钦定的位置产生的贡献是它前面的没有被填的位置的数量。这样的话每次二分就可以找到应当被填的前缀了。

可以发现这两种填法其实是等价的。

数据结构维护一下就可以得到 $28$ 分。

对于原问题，我们也猜测：给一些位置钦定等于某个数，其余位置不小于某个数，这等价于原问题的限制。

不妨先考虑性质 A，显然可以转化为一些位置钦定为 $1$，另外限制某些区间存在 $0$。

事实上，我们去除有包含关系的限制，把限制按照左端点排序，从后往前考虑，每次贪心在不导致有区间不合法的情况下把最前的位置变成 $0$ 就是对的。

那么原题就是将限制对 $v$ 从大到小排序后，每次提取出 $v$ 相同的区间做一次性质 A 得到被钦定的位置，最后把没有钦定的位置做一次性质 C 就行了。

$\color{white}{\text{bonus: 请不要把线段树二分写成 2log。/ll/ll/ll}}$