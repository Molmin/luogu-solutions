其他题解在干什么啊（

---

简单 $O(3^n)$。

竞赛图。缩点后为链，所求为链头强联通块大小。

因为边权各不相同，需要大力枚举已取点的状态。

一种状态的贡献即集合内构成强联通分量的概率乘上对外外向边的概率。

后者 $O(2^nn)$ 转移是 trivial 的。

前者可以子集 dp，大力枚举得到所有情况。

设 $f_{S}$ 为状态为 $S$ 时构成强联通分量的概率。

简单容斥得到 
$$
f_{S}=1-\sum_{T\subseteq S}f_T\cdot p_{T,\complement_ST}
$$

此处 $p_{T,\complement_ST}$ 表示 $T$ 中点向 $\complement_ST$ 中点连边的概率积。

直接暴力计算是 $O(3^nn^2)$ 的。

预处理单个点对一个集合的点可以做到时间 $O(3^nn)$，空间 $O(2^nn)$。

可以平衡复杂度，对所有 $S$ 预处理出 $p_{S,T}$，其中 $T\subseteq U$。

递推预处理复杂度是 
$$
\sum_{i=1}^n\binom{n}{i}2^{n-i}=\sum_{i=1}^n\binom{n}{i}2^{i}=3^n
$$

需要使用 unordered_map 保存，空间也是 $O(3^n)$ 的。

然后就爆了。

这部分可以再次容斥，用 $T$ 中每个点对 $S$ 连边的概率积再乘上 $T$ 内部连边的逆元解决。计算 $f$ 时用 $lowbit$ 递推，就可以每次加入一个点，还原旧贡献，乘上新贡献即可。

对每个 $S$ 保存一个双向边完全图概率积即可。

这样空间仍然是 $O(2^nn)$ 的。

但是怎么感觉这还是垃圾做法（）

不给代码了（只写了 $O(3^nn)$，懒得写优化）。