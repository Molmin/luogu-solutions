趣题。

首先题面中给出的限制有点抽象，不方便直接做。于是不难想到找一种方式刻画 “二分的” 排列。

充要条件 $1$

>一个排列是 “二分的”，当且仅当不存在一个长度超过 $3$ 的下降子序列。

充分性：如果不存在长度超过 $3$ 的下降子序列，那么原图必然不存在环。考虑一个环是由两个首尾相同、中间元素不交的下降子序列拼接而成的，而下降子序列长度不超过 $2$，那么必然不存在环，更不可能存在奇环。故原图为二分图。

必要性：考虑反证。假设一个排列是二分的，且存在长度超过 $3$ 的下降子序列，那么必然存在长度恰好为 $3$ 的下降子序列。于是便形成了一个长度为 $3$ 的奇环，原图显然不是二分图。

充要条件 $2$

>一个排列不存在长度超过 $3$ 的下降子序列，当且仅当原排列可以划分为两个上升子序列。

充分性：考虑反证，假设我们在原序列能划分为两个上升子序列且存在长度超过 $3$ 的子序列，那么下降子序列中的三个数必定有两个来自同一上升子序列，显然矛盾。

必要性：我们画出排列的折线图，发现结构必然如下，满足蓝点、红点分别单调递增，且蓝点和红点见必然没有其他的点。于是我们只需要将排列划分为黑色折线和黄色折线对应的点集即可。

![image-20230626185409483](https://cdn.luogu.com.cn/upload/image_hosting/ud5cn7au.png)

把原问题转化到这里基本也就可以做了。考虑从前向后 dp，设到当前位置时，两个子序列最后的元素组成二元组 $(x,y)$，且满足 $x<y$ (因为两个序列并不需要区分)。不难发现二元组其中一个元素必然为 $\pm a_i$，另一个元素自然越小越优。所以合法状态其实只有两个。每一步记录一下转移，倒着输出即可。