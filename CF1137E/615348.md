想写一篇比较简短而清楚的题解。

时间复杂度是线性的，是 $\text{CF}$ 上的最优解。

---

性质 $1$：

我们发现对于两个数 $x, y$，如果 $A_x > A_y$ 且 $x > y$，那么 $x$ 这个位置肯定是没用了，原因比较显然。

---

所以说我们初步的想法是维护一个从大到小的单调栈，但是我们发现从大到小并不能很好的利用题目中的性质。

性质 $2$：

我们发现对于 $x, y$，如果 $A_x > A_y$ 且 $x < y$ 的话 $y$ 超过 $x$ 的操作的 $s$ 和 $\geq\dfrac{A_x-A_y}{y-x}$，然后我们发现这个东西很像斜率，于是对于 $x, y, z$，若 $x>y>z$，那么根据性质 $1$ 有 $A_x<A_y<A_z$，而若 $\dfrac{A_y-A_x}{x-y}\geq\dfrac{A_z-A_y}{y-z}$ 表明 $y$ 已经没有用了，因为这意味着在 $x$ 超过 $y$ 前 $y$ 就超过 $z$ 了，$y$ 不可能在某个时刻成为最小值。

---

这样我们发现维护的东西就是一个坐标为 $(x,A_x)$ 的凸壳状物，有了这个凸壳之后，我们只需要用一个栈来维护，操作 $1$ 直接清空栈（性质 $1$），操作 $2$ 直接用性质 $1$ 和 $2$ 来维护凸壳，操作 $3$ 直接从栈顶开始弹就行了。

直接维护这个凸壳上的每个点也是不太好直接做的，但是我们维护最后一个值和差分是好做的，于是这题就做完了。

代码写的很乱，[需要对拍的可以康康](https://codeforces.com/contest/1137/submission/202470393)。