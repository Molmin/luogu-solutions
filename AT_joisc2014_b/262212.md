前置知识：对于一个序列，只能相邻两两交换时，排成有序序列的最小次数为逆序对的个数。

假如我们知道了每个数在序列中的排名，且确定了最终的某个可能最优解时（假单峰函数），我们把下标重新赋给每个数，这时的最小次数就是下标的逆序对数。

证明考虑微扰相邻。
假如现在改变最优解，且之变动一个数 $x$ 时：
这时 $x$ 有两种可能，一最后在最大值的左侧，二最后在右侧。且我们又能发现无论怎么变动，x对于比它权值小的数大小情况都不会改变，所以只考虑比 $x$ 大的数。
这时我们发现，在左侧时，$x$ 与 $x$ 左侧的权值比它大的数构成逆序对；在右侧时，$x$ 与 $x$ 右侧权值比它大的数构成逆序对。
所以综上，应对每个数统计左侧大的数和右侧大的数，取个数最小值。

代码就看楼上的吧