[Link](https://www.luogu.com.cn/problem/AT1218)。

### 题目大意

给定一个序列，已知序列中每个数的值，你可以交换相邻两数的值。

最终，你要使得整个序列呈一个山峰型，即序列的前一部分为**不降**序列，后一部分为**不升**序列，求这个最小的交换次数。

### 思路

由于我们需要构造一个山峰型，所以越大的数应该在越中间。反之，越小的数应该在越旁边。

所以，我们就需要将中间的较小的数向旁边移动，那具体该怎样移动呢？

我们认真观察一下题目：**交换相邻两数**。相信大家都学过冒泡排序吧，所以大家应该都知道：将一个数反复同相邻数交换，是不会改变其他数的相对位置的。

因此，在这道题中，将位于中间部分的较小数向旁边移动时并不会改变其他数的相对位置，也就是说将 $a_x$ 向旁边交换，若交换前 $a_i$ 在 $a_j$ 左边，则在 $a_x$ 换完后 $a_i$ 依旧在 $a_j$ 左边（右边同理）。

所以我们将较小的数向旁边移动即可，那么什么是较小的数呢？

其实较小的数就是那种在它的左边和右边**都有**比它**大**的数，因为我们需要山峰型，所以这样的数一定还要往旁边移动。

那么每个数应该向哪边移动呢？

其实既可以向左，又可以向右，因为不影响其他数相对位置。但为了保证答案是最小的，所以往哪边移动的交换次数少，就往哪边移动。

可是我们怎么知道具体的交换次数呢？

刚才说了，要保证左边**或**右边**没有**大于此数的数，因此交换次数就是左边（或右边）比当前数大的数的个数。

万一在交换完成前出现小于等于当前数的数呢？

其实这种情况并不会发生，因为比它小的数已经同它交换过了。

那我们如何求到左边（右边）有多少数比当前数大呢？

这其实大家都能想到了，就是从前往后（从后往前）的逆序对数即可，所以维护树状数组即可~~（你要写归并排序或树链剖分我也不介意，但这里就不讲了）~~。