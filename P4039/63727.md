从下往上一行一行处理，每个点预处理向上延伸长度

对于每行，拿右边一部分+完整的块+左边的块拼一下

拿堆按高度维护一下完整的块的长度，一个一个的拿走最低高度，扔到另一个集合里

对另一个集合维护一下每个高度的最长长度就可以了（从左边或右边）

可以直接可以持久化硬艹(恩注意一下左边右边不能来自一个块)

不过还可以发现每一行的高度个数不超过$\sqrt 1e5$，离散化一下就可以直接暴力了