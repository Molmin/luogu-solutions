
这里只讨论狭义容斥做法。

实际上选择补集来得更容易一些。

所以就变成：恰好0行0列颜色相同

然后可以用至少$i$行$j$列容斥。

先随机钦点$i(i>0)$行，发现如果此时再钦点$j(j>0)$行只能涂三种颜色。

剩下的$(n-i)\times(n-j)$任意。

于是就有$\sum_{i=1}^n\sum_{j=1}^n(-1)^{i+j}C_n^iC_n^j\times3^{(n-i)(n-j)+1}$

当$i$或$j$其中任意一个是0时显然这$i$或$j$行可以每行一个颜色。

因为只有一个上界$n$，所以$i=0,j=s$的情况和$i=s,j=0$的情况是一样的

上述式子$3$的指数$+1$变为$+i$。

当然发现$i=j=0$的情况被算了两次，减掉就好了

当然$\sum_{i=1}^n\sum_{j=1}^n(-1)^{i+j}C_n^iC_n^j\times3^{(n-i)(n-j)+1}$这个式子发现不能$nlogn$算。

实际上把3提到最前边后边变成$(3^{n-i})^{n-j}$就可以套二项式定理了。

所以实际上啥硬核操作也不需要，也不需要乱蒙式子。

当然也可以直接1维容斥，不过二维容斥显得更好理解。

复杂度$nlogn$