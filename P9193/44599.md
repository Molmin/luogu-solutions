这是一篇纯粹找规律的题解，思路源自 @[YeahPotato](https://www.luogu.com.cn/user/94976) orz。

---

坐稳了！

注意到题目的输入输出量都是 $O(1)$ 的，于是考虑打表。

暴力就随便写，只要能正确跑出 $1\le n,m\le 30$ 即可。

然后对于所有的 $n,m$ 组合打出第一张表（行为 $n$，列为 $m$，下同）：

![](https://cdn.luogu.com.cn/upload/image_hosting/9ox9uya9.png)

瞄了一眼，很乱啊，啥都看不出来，不过还是有几条（~~没啥用的性质~~）

- $f(n,1)=f(1,n)=n$

- $f(n,n)=n$

考虑到这个题看起来是个数论问题，因此可以尝试打出 $f(n,m)$ 与 $f(n/g,m/g)$（其中 $g=\gcd(n,m)$），比如对每组互质的 $n,m$ 打出 $f(kn,km)$，得到下面这个表：

```
   1    1:    1   2   3   4   5   6   7   8   9  10
   1    2:    2   4   6   8  10  12  14  16  18  20
   1    3:    3   5   7   9  11  13  15  17  19  21
   1    4:    4   6   8  10  12  14  16  18  20  22
   1    5:    5   7   9  11  13  15  17  19  21  23
   1    6:    6   8  10  12  14  16  18  20  22  24
   1    7:    7   9  11  13  15  17  19  21  23  25
   1    8:    8  10  12  14  16  18  20  22  24  26
   1    9:    9  11  13  15  17  19  21  23  25  27
   1   10:   10  12  14  16  18  20  22  24  26  28

   2    1:    2   4   6   8  10  12  14  16  18  20
   2    3:    3   5   7   9  11  13  15  17  19  21
   2    5:    4   6   8  10  12  14  16  18  20  22
   2    7:    5   7   9  11  13  15  17  19  21  23
   2    9:    6   8  10  12  14  16  18  20  22  24

   3    1:    3   5   7   9  11  13  15  17  19  21
   3    2:    4   6   8  10  12  14  16  18  20  22
   3    4:    4   6   8  10  12  14  16  18  20  22
   3    5:    5   7   9  11  13  15  17  19  21  23
   3    7:    5   7   9  11  13  15  17  19  21  23
   3    8:    6   8  10  12  14  16  18  20  22  24
   3   10:    6   8  10  12  14  16  18  20  22  24

   4    1:    4   6   8  10  12  14  16  18  20  22
   4    3:    6   8  10  12  14  16  18  20  22  24
   4    5:    5   7   9  11  13  15  17  19  21  23
   4    7:    7   9  11  13  15  17  19  21  23  25
   4    9:    6   8  10  12  14  16  18  20  22  24

   5    1:    5   7   9  11  13  15  17  19  21  23
   5    2:    5   7   9  11  13  15  17  19  21  23
   5    3:    5   7   9  11  13  15  17  19  21  23
   5    4:    8  10  12  14  16  18  20  22  24  26
   5    6:    6   8  10  12  14  16  18  20  22  24
   5    7:    6   8  10  12  14  16  18  20  22  24
   5    8:    6   8  10  12  14  16  18  20  22  24
   5    9:    9  11  13  15  17  19  21  23  25  27

   6    1:    6   8  10  12  14  16  18  20  22  24
   6    5:   10  12  14  16  18  20  22  24  26  28
   6    7:    7   9  11  13  15  17  19  21  23  25

   7    1:    7   9  11  13  15  17  19  21  23  25
   7    2:    6   8  10  12  14  16  18  20  22  24
   7    3:    7   9  11  13  15  17  19  21  23  25
   7    4:    6   8  10  12  14  16  18  20  22  24
   7    5:    7   9  11  13  15  17  19  21  23  25
   7    6:   12  14  16  18  20  22  24  26  28  30
   7    8:    8  10  12  14  16  18  20  22  24  26
   7    9:    7   9  11  13  15  17  19  21  23  25
   7   10:    8  10  12  14  16  18  20  22  24  26

   8    1:    8  10  12  14  16  18  20  22  24  26
   8    3:    6   8  10  12  14  16  18  20  22  24
   8    5:    7   9  11  13  15  17  19  21  23  25
   8    7:   14  16  18  20  22  24  26  28  30  32
   8    9:    9  11  13  15  17  19  21  23  25  27

   9    1:    9  11  13  15  17  19  21  23  25  27
   9    2:    7   9  11  13  15  17  19  21  23  25
   9    4:    9  11  13  15  17  19  21  23  25  27
   9    5:    7   9  11  13  15  17  19  21  23  25
   9    7:    9  11  13  15  17  19  21  23  25  27
   9    8:   16  18  20  22  24  26  28  30  32  34
   9   10:   10  12  14  16  18  20  22  24  26  28

  10    1:   10  12  14  16  18  20  22  24  26  28
  10    3:    8  10  12  14  16  18  20  22  24  26
  10    7:    8  10  12  14  16  18  20  22  24  26
  10    9:   18  20  22  24  26  28  30  32  34  36
```

第一行 $n=m$ 的不看，对其他的，可以发现均形成一个公差为 $2$ 的等差数列，于是我们又找到一条性质：

- $f(n,m)=f(n/g,m/g)+2g$，其中 $g=\gcd(n,m)$

~~虽然这个性质并没有什么用，因为它被包含在下面的规律里了~~

于是我们只用关心两维互质的位置了，再打出一张表：

![](https://cdn.luogu.com.cn/upload/image_hosting/e56gmziv.png)

我们发现了一些奇怪的事情！

![](https://cdn.luogu.com.cn/upload/image_hosting/z7y896gw.png)

仔细端详一下，每一行每一列，在对角线上下的部分都有递推关系，于是我们得到：

- $f(n,m)=f(n-m,m)+1$，对 $n-m\ge 2m$

- $f(n,m)=f(n,m-n)+1$，对 $m-n\ge 2n$

于是问题变为关心 $n<2m \cap m<2n$ 的情况了，打出这部分点值继续观察：

![](https://cdn.luogu.com.cn/upload/image_hosting/juwch0ew.png)

然后我们又发现了一些奇怪的事情！

![](https://cdn.luogu.com.cn/upload/image_hosting/lfbv7ge5.png)

仔细观察每一对横竖的方框，可以发现一个离谱的关系：

![](https://cdn.luogu.com.cn/upload/image_hosting/gb5tl3n5.png)

每一对横竖的方框，横着的最右边等于竖着的最上面减一，横着的右边第二个等于竖着的上面第二个减一，依次类推。

这个规律用数学语言写出来就是：

- $f(n,m)=f(3n-m,n)-1$，对 $n<m<2n$

- $f(n,m)=f(m,3m-n)+1$，对 $m<n<2m$

好吧看起来很厉害但是似乎没法递推问题啊？

那就继续观察啊！

![](https://cdn.luogu.com.cn/upload/image_hosting/6e9y2w9b.png)

可以发现，对角线上面的部分是 $\pm1$，对角线下面的部分是 $\pm2$，这也是一个递推关系，写成数学语言就是：

- $f(n,m)=f(n-d,m-d)+1$，对 $n<m<2n$，其中 $d=m-n$

- $f(n,m)=f(n-d,m-d)+2$，对 $m<n<2m$，其中 $d=n-m$

**注意，这里只有当 $n-d,m-d$ 仍然满足 $n'<2m',m'<2n'$ 时才能递推**，如果不满足的话，可以先用一手用上面 $f(n,m)=f(3n-m,n)-1$ 或 $f(n,m)=f(m,3m-n)+1$ 的式子，然后递推。

找规律部分到此结束，来总结一下

---

- $f(n,m)=f(n-m,m)+1$，对 $n-m\ge 2m$

- $f(n,m)=f(n,m-n)+1$，对 $m-n\ge 2n$

这两条是用于递推 $n,m$ 其中一个相对另一个特别大的。

- $f(n,m)=f(3n-m,n)-1$，对 $n<m<2n$

- $f(n,m)=f(m,3m-n)+1$，对 $m<n<2m$

- $f(n,m)=f(n-d,m-d)+1$，对 $n<m<2n$，其中 $d=m-n$

- $f(n,m)=f(n-d,m-d)+2$，对 $m<n<2m$，其中 $d=n-m$

这四条合起来，可以对 $n<2m \cap m<2n$ 的情况进行递推，具体的使用方式就是：

- 如果下面的两条不能直接用，那么先用一下上面的两条

- 然后用下面两条。注意到 $d$ 可能很小，不能暴力递归，但是 $n-m$ 的值始终是不变的，因此可以算出 $-d$ 的次数一次性做完。

base case 是 $f(n,n)=n$ 以及 $f(n,2n)=f(2n,n)=2n$ 的情况。

~~上面 $6$ 个性质全部不会证明~~

最后，来两个例子直观感受一下递推过程：

![](https://cdn.luogu.com.cn/upload/image_hosting/lq4rizsq.png)

代码非常短

```c++
typedef long long ll;
ll x,y; int T;
ll solve(ll x, ll y){
	if (x==y) return x;
	if (x==y*2) return x;
	if (y==x*2) return y;
	if (x>y*2){
		ll d=(x/y)+(x%y==0?0:1)-2;
		return solve(x-d*y,y)+d;
	}
	if (y>x*2){
		ll d=(y/x)+(y%x==0?0:1)-2;
		return solve(x,y-d*x)+d;
	}
	if (x<y){
		ll d=y-x,k=(2*x-y)/d;
		if (k) return solve(x-d*k,y-d*k)+k;
		else return solve(3*x-y,x)-1;
	} else {
		ll d=x-y,k=(2*y-x)/d;
		if (k) return solve(x-d*k,y-d*k)+k*2;
		else return solve(y,3*y-x)+1;
	}
}
int main(){
	for (cin>>T; T; T--){
		scanf("%lld%lld",&x,&y);
		printf("%lld\n",solve(x,y));
	}
}
/*
6
3 5
8 20
1 1
4 7
4 10
27 21
*/
```