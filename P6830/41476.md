发现我居然会 IOI 的题？

先口胡一下，可能代码细节多？不是很想写，但应该是对的。

首先看到两两之间的路径条数不超过 $3$，想到分类讨论。

再思考另外一个问题：如何在不重边的情况下使得两个点之间有多条路径？

方法：在中间加入环。

如果加入一个环就有两条路径，但有两个环无论怎样都有四条，永远都不可能只有三条。

也就是说，如果存在三条就一定无解！（怪不得只有 $4$ 分）

考虑两条，也就是说构造的图一定是一个基环树森林，对于每一个连通块考虑，将这个环提到最上面（感性理解），然后假如删掉环得到的树叫做子树，那么每一个子树内点对路径条数都是 $1$，不在同一子树且连通的点对之间有两条路径。

具体实现（口胡）：先把路径条数为 $1$ 的连成森林，然后再把需要连 $2$ 的连成一个环，最后判一下合不合法。