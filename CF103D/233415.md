利用剩余系的性质，可以给出一种在线的分块做法。

首先设置块长，取一个最小的 $p\in\mathbb{P}$ 使得 $p\ge \sqrt n$ 。通过粗略地估计素数的分布密度，知道 $p$ 和 $\sqrt n$ 大小差距不大，因此计算渐进复杂度时可以将 $p$ 认为是 $\sqrt n$ ，同时 $p$ 的选取并不需要过多的时间。

考虑每一次查询：

若 $b\ge p$ ，那么最多跳 $p$ 步。时间 $O(p)$ 。

反之，$\gcd(p,b)=1$，可知 $\{a,a+b,a+2b,\cdots,a+(p-1)b\}$ 构成一个模 $p$ 意义下的完系，所以最多跳 $p$ 步，就可以跳到一个位置 $pos$ 使得 $pos\equiv 1\mod p$ 。因此我们预处理出 $pre_{ij}$ 代表从第 $i$ 个块的左端点开始，步长为 $j\le p-1$ 的后缀和，$O(1)$ 查询。时间 $O(p)$ 。

对于后缀和的预处理，同样对于每个状态，最多只需要 $p$ 步可以到达另一个 $i$ 比它大的状态，递推即可。时间 $O(p^3)$ 。

因此总时间 $O(q\sqrt n +n^{\frac{3}{2}})$ 。