一种方法是离线差分转为根到点的贡献然后算一下，比较常见的差分方法。

但是如果你~~困了~~思维僵化了：

先观察到，所有权的质因子个数 $\le n \log$,然后一个一个质因子考虑，设当前质因子为 $p$，把包含 $p$ 这个质因子的点建虚树。对于每个包含 $p$ 这个质因子的询问，按含 $p$ 的次数排序，容易发现不同的次数 $\le \log$，就对于每个次数，限制一下虚树上的权。

然后讨论一下。设询问的两个点为 $x,y(dep_x \le dep_y)$，在虚树上第一个 $dep < dep_{x/y}$ 的点为 $X,Y$，如果两点都在原树上的 $LCA$ 之上，就跳过。否则

设虚树上 $LCA$ 为 $l2$ ,当前 $lim$ 的桶为 $finval$。

1. $x=X:finval[y]-finval[x]$。

2. $y=Y:finval[x]-finval[y]$。

else 3.$finval[x]+finval[y]-finval[l2]-finval[fa[l2]]$。

如果不考虑排序的复杂度，理论时间复杂度也是不优的，上限为 ：$n \log n \times $ 不同质因子个数。但是常数实际很小（？），可以跑进一秒。

比较好想，比较难写。

[代码太长了，被要求放了。](https://www.luogu.com.cn/paste/2hsfeodm)

太蠢了，打个公式又冗余又丑！！