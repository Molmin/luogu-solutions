很明显，这个题应该不同颜色分开考虑。

一种显然的 $O(n^2)$ 暴力：对于一种颜色 $c$ ，把所有颜色为 $c$ 的边取出来，会形成若干个连通块；同一个连通块当中的点 $u,v$，$(u,v)$ 的答案 $+1$。

这种做法忽略了一个很关键的点：有 $k$ 条边的连通块至多只有 $k+1$ 个点，所以每一种颜色形成的有效连通块的大小总和最多是 $2\times 10^5$。

所有连通块的总大小被控制了，自然想到根号分治。

* 如果连通块的大小 $>\sqrt{m}$ ，那么记录连通块中的所有点。

* 如果连通块的大小 $\le \sqrt{m}$ ，那么暴力更新点对的答案。

第一种情况的大连通块最多只有 $\sqrt{m}$ 个，因此预处理复杂度 $O(m \sqrt{m})$；第二种情况，设连通块大小为 $x$ ，那么有复杂度 $O(\sum x) \le O(m \sqrt{m} \cdot T)$。

询问的时候，依次扫一遍所有大连通块中 $u,v$ 是否共存，再调用小连通块处理好的答案就行；不难发现单次查询复杂度 $O(\sqrt{m} \cdot T)$。

综上，复杂度 $O(m \sqrt{m} \cdot T)$ ，$T$ 为数据结构单次操作复杂度，使用 `STL::unordered_map` 即可做到 $O(m \sqrt{m})$ ，用 `STL::map` $O(m \sqrt{m} \log m)$ 也可以。