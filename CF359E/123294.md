### [CF359E Neatness](https://www.luogu.com.cn/problem/CF359E)

挺趣味的一道题。

注意到如果我们一路走一路开，就可以在已经走过的地方自由移动。

这启发我们从 $(x_0, y_0)$ 开始 DFS，每到一个位置就将它的灯打开，保证可以回到已经经过的位置。一边回溯一边关灯，回溯时上一层的灯还是亮着的，所以合法。

有解当且仅当每个原来有灯的位置都被 DFS 到了，即 DFS 结束后整张图没有亮灯。

正确性证明：称一个点合法当且仅当它被 DFS 到。只需证明每个可达的位置均合法。如果一个局面可以继续扩展，那么第一个被扩展的位置上下（或左右）均有合法点。假设存在可达的位置不合法，那么存在一个上下（或左右）均有合法点的非法点。不妨设其上方的合法点较后被 DFS 到，那么该合法点的下方是非法点。但可以从该合法点向下 DFS，与其下方是非法点矛盾。

时间复杂度 $\mathcal{O}(n ^ 3)$。[代码](https://codeforces.com/contest/359/submission/210720468)。