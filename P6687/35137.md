先看图：   

![](https://cdn.luogu.com.cn/upload/image_hosting/jvefuegq.png)  
~~（略丑，用的mspaint，我还是没搞明白怎么把图调小）~~

___

我们发现，如果我们对于表格黑白染色（如图），那么对于每一次旋转操作，**仅会发生黑格与黑格交换，白格与白格交换，且原先上下对应（在同一列）的黑白两格仍保持上下对应**，原来在下面的交换到了上面，原来在上面的交换到了下面。   

____

根据这一性质，我们可以做出以下判断：   
1. **如果原来两个数上下对应，任意次旋转后两个数一定仍保持上下对应。**   
2. **原先在黑格的数只能被转到黑格上；原先在白格的数只能被转到白格上。**   

____

据此，我们可以做出对初始状态到目标状态可行性的判断，方法如下：   
1. 将偶数列的数上下对调（为了将同色格全转化到同一行讨论）   
2. 比较初始状态同一黑格（数字相同）对应白格是否相同，若不同，则不可到达   

____

由于已知黑白格相互对应，所以我们接下来可以仅取黑格（对调后的第一行）进行讨论，因为如果 黑格 转到 目标位置，其 对应白格 也一定转到 该黑格的目标位置 所对应的目标位置。 

我们发现，问题变成，已知两个排列，每次可以把相邻两数交换，问至少几次交换可以使两排列相同。   

我们惊喜地发现，这不就是 [P1966 火柴排队](https://www.luogu.com.cn/problem/P1966) 的简化版吗！   

这个 **最小次数** 相当于把 目标排列中的 **数的位置** 当做权值的 **一次排序中交换的最小次数** ，   
而我们知道 **排序中最小交换次数** 等于 **逆序对个数**（[P1774 最接近神的人](https://www.luogu.com.cn/problem/P1774)），   
于是我们使用 **归并排序** 求一次逆序对（[P1908 逆序对](https://www.luogu.com.cn/problem/P1908)）就好了！

___

[AC代码](https://www.luogu.com.cn/paste/hb32umxg)（常数巨大，勿喷）