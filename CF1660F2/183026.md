省流助手：秒了。

首先瞎几把猜结论，一个区间是有希望的，当且仅当区间内 **`+` 的数量减去 `-` 的数量是 3 的倍数且小于 0.**

浅浅的证明一下。

显然每次操作就是将两个 `-` 换成 `+`，所以三个 `-` 只要有两个是相连的，则必然可以自我抵消。

所以我们需要证明，如果 `-` 比 `+` 至少多两个，则至少有一对 `--`.

考虑反证，如果没有，必然是形如 `-+-+ ... -+` 这样的，那么 `+` 就不会比 `-` 多至少两个。

考虑如何维护这个结论，一个常见套路是利用前缀和，把 `-` 标记为 -1， `+` 标记为 1.

暴力枚举左右端点可以轻松做到 $\mathcal{O}\left(n^2\right)$，但我们想想，会产生贡献的左右端点必然 $\bmod \ 3$ 同余，那么问题转化为二维偏序，直接利用值域树状数组维护同余即可。

考虑到可以离线，归并排序求逆序对就好了。（