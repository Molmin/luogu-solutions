- 作者太菜不会打 LCT，所以这是一篇线段树分治的博客。
- 希望能讲到一些本质上的东西。

**引入**
- 需要你维护一个数据结构，支持加边，删边，维护连通性，怎么做？
- 我们知道普通的并查集加边是很容易的，但删除边却很困难（读者可以自行尝试一下，作者发现按秩合并，路径压缩都很难用）。
- 但是如果需要你维护一个数据结构，支持加边，回退到上一个操作之前的状态，维护连通性。
- 这其实是很容易的，我们只需要使用按秩合并的并查集，用一个栈记录一下每次合并更改了哪个的父亲，就可以轻易地维护。
- 事实上，非均摊复杂度的数据结构普遍能够高效维护“回退到上一个操作之前的状态”。（均摊复杂度的数据结构会打破当前的势）
- 但是我们怎么做到这一点呢？

**线段树分治**
- 它分治，分治的是什么，是时间。
- 线段树上的节点，存的，是包含该区间（实际上是一个时间段）的操作（同时操作不下传）。
- 那么 $n$ 个操作会变成 $n\lg t$ 个操作。
- 然后我们可以对线段树进行先序遍历，节点入栈就加入操作，节点出栈就撤回，如果插入和撤回的操作复杂度是 $f(m)$，那么总的复杂度就是 $n\lg t\cdot f(m)$。

**例题**
- [例题](https://www.luogu.com.cn/problem/P5787)。
- 在一个时间段 $[l,r]$ 内加入一条边（$l$ 时刻插入 $r$ 时刻删除）。
- 维护图是不是二分图。
- 所讲的跟上面的几乎一样，但选用的维护数据结构需要用到一种[特殊的并查集](https://www.luogu.com.cn/blog/luo1gu1zui1bang1/bing-zha-ji)。
- [代码实现](https://www.luogu.com.cn/paste/o5n7k9np)。

**后记**
- 作者认为的难度。
- 可追溯化数据结构 $>$ 可持久化数据结构 $>$ 可撤回化数据结构 $\ge$ 画风正常的数据结构。