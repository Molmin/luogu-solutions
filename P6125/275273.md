## 思路

考虑建出 AC 自动机之后 `dp`。对于每一个人分别计算它的胜率，设当前计算到第 $i$ 个人的胜率，设 $f_u$ 表示当前在 AC 自动机上的 $u$ 号结点获胜的概率，对 AC 自动机上每个结点 $u$ 写出它的转移方程：

- 若 $u$ 为第 $i$ 个字符串的叶子结点，$f_u = 1$。

- 若 $u$ 为叶子结点但 $u$ 不为第 $i$ 个字符串的叶子结点，$f_u = 0$。

- 若 $u$ 不为叶子结点，$f_u = \sum\limits_{i=0}^m f_{ch_{u,i}} \times \dfrac{p_i}{q_i}$。

答案即为 $f_0$。

发现这个转移是有环的，不能直接转移，因此高斯消元后得出答案。

时间复杂度 $O(n^2ml + n^4l^3)$。

## 代码

[code](https://pastebin.ubuntu.com/p/HcsSSYWnHn/)