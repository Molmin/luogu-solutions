这道题目是一道非常不错的题目，做法也不难想到，我就来讲解一下各个部分分怎么得，其实也是我在比赛时的经历以及赛后的总结，本篇题解的代码在结尾。

--------

### $25$ 分做法（子任务 $1,2$）：  

观察到 $n \le 17$，所以可以枚举选哪些数，选完以后判断一下选到的数列是否合法，时间复杂度为 $O(n^22^n)$。

--------

### $55$ 分做法（子任务 $1,2,3,4$）：

发现条件 $b_i<b_j$ 且 $b_i+b_j+\gcd(b_i,b_j)=\text{lcm}(b_i,b_j)$，在比赛的时候我就想到了图论，对于 $a$ 数组，先去重与离散化，统计 $a$ 数组每个数出现的次数（用另一个数组备份 $a$ 数组，$a_i$ 出现的次数记为 $cnt_i$），接着两重循环枚举 $i,j$，如果满足 $a_i<a_j$ 且 $a_i+a_j+\gcd(a_i,a_j)=\text{lcm}(a_i,a_j)$，就由 $i$ 号节点向 $j$ 号节点连边，并将 $j$ 号节点的入度加一。做完以后先给 $f$ 数组赋初值，$f_i$ 表示以 $a_i$ 结尾的最大数列之和，$f_i=a_i \times cnt_i$。然后做一个拓扑排序，对于节点 $v$，则 $f_v=\max(f_u)+a_i \times cnt_i$，其中 $u$ 为连向 $v$ 的节点，时间复杂度为 $O(n^2)$，但子任务 $3$ 由于 $a_i \le 2 \times 10^3$，去重后不同的 $a_i$ 的数量也会小于 $2 \times 10^3$，所以也是可过的。

--------

### $100$ 分做法（赛时）：

$55$ 分做法的改进，设 $x=ak,y=bk$，则 $\gcd(x,y)=k,\text{lcm}(x,y)=abk$，若 $x+y+\gcd(x,y)=\text{lcm}(x,y)$，则有 $ak+bk+k=abk$，由于 $k \neq 0$，所以 $1+a+b=ab$，设 $a<b$，则唯一的整数解为 $a=2,b=3$。所以只需枚举 $i$，找 $a_i$ 的 $1.5$ 倍，这个可以用 `lower_bound` 来找，如果存在，设其为 $a_j$，就由 $i$ 号节点向 $j$ 号节点连边，接下来的做法就同 $55$ 分做法了，时间复杂度为 $O(n \log n)$。

--------

### $100$ 分做法（赛后）：

可以发现，一个状态只由上一个状态得来，所以在去重、离散化、统计操作之后，可以枚举 $i$，先将 $f_i$ 赋值为 $a_i \times cnt_i$，找 $a_i$ 的 $2/3$，如果存在，设其为 $a_j$，则 $f_i$ 还要额外加上 $f_j$，代码复杂度可以降低，时间复杂度仍为 $O(n \log n)$。

--------

如果不太会实现的话，可以看代码，别忘记开 LL，[代码在此](https://www.luogu.com.cn/paste/56us13yw)，有注释，请大家做好学术诚信，抵制抄题解行为。
