安利个人 blog：https://www.cnblogs.com/ET2006/

先预处理出 $dis_{u,v}$ 表示从 $u\to v$ 只经过编号 $\leq\max(u,v)$ 的点，所经过的距离的最小值。显然 $dis_{u,v}$ 可用 Floyd 在 $n^3$ 的复杂度内处理出来。

假设 $k$ 个人所摧毁的据点的序列分别为 $(a_{1,1},a_{1,2},\dots,a_{1,c_1}),(a_{2,1},a_{2,2},\dots,a_{2,c_2}),\dots,(a_{k,1},a_{k,2},\dots,a_{k,c_k})$（$a_{i,j}<a_{i,j+1}$）。那么需要花费的最小时间就是 $\sum\limits_{i=1}^k\sum\limits_{j=1}^{c_i-1}dis_{a_{i,j},a_{i,j+1}}+\sum\limits_{i=1}^kdis_{0,a_{i,1}}$

为什么？考虑编号为 $1$ 的据点是谁摧毁的，假设 $1$ 号据点是第 $x_1$ 个人第 $y_1$ 个摧毁的据点，那么它从自己第 $y_1-1$ 个摧毁的据点（默认每个人第 $0$ 个摧毁的据点就是 $0$）到达 $1$ 号据点的过程中不能经过编号 $>1$ 的据点，故所花费的最小时间就是 $dis_{a_{x_1,y_1-1},a_{x_1,y_1}}$。$1$ 号据点摧毁了，接下来考虑 $2$ 号据点，同理假设 $2$ 号据点是第 $x_2$ 个人第 $y_2$ 个摧毁的据点，那么第 $x_2$ 个人从自己第 $y_2-1$ 个摧毁的据点赶过来需要花费的时间就是 $dis_{a_{x_2,y_2-1},a_{x_2,y_2}}$，以此类推可得上式。

看到这样类似于路径覆盖的问题，可想到用网络流解决。我们用一条流来表示一个人摧毁据点的路径。借鉴 P4553 80人环游世界 的建图方式可得：

- 将每个点 $u$ 拆成两个点 $in_u$ 和 $out_u$。对于 $u\geq 1$ 连边上下界均为 $1$ 费用 $0$ 的边表示每个据点必须被恰好一个人摧毁。对于 $u=0$ 连上界 $k$ 下界 $0$ 费用 $0$ 的边，表示最多 $k$ 个人经过 $0$ 号据点。
- 连一条从 $S$ 到 $in_0$，上界 $k$ 下界 $0$ 费用 $0$ 的边表示 $k$ 个人必须从 $0$ 号节点开始摧毁据点。对于 $u=0,1,2,\dots,n$ 连一条从 $out_u$ 到 $T$，上界 $k$ 下界 $0$ 费用 $0$ 的边表示每个人可以在任意节点结束摧毁。
- 对于每对满足 $(i<j)$ 的 $(i,j)$ 连一条从 $out_i$ 到 $in_j$ 上界 $1$ 下界 $0$ 费用 $dis_{i,j}$ 的边表示从 $i$ 到 $j$ 需要的时间为 $dis_{i,j}$。

然后跑上下界最小费用最大流即可。

但是题解区总有比我更优秀的做法。事实上，本题也有不用上下界网络流的做法。观察一下上面的做法可以发现，这个所谓的“摧毁据点的路径”，不就是不可相交的路径覆盖吗！路径的开头元素还有一个代价 $dis_{0,a_{i,1}}$。立马想到 P2469 [SDOI2010]星际竞速。只不过此题要求路径个数 $\leq k$。所以你在 P2469 [SDOI2010]星际竞速 新建一个超级源点 $S'$ 并连一条从 $S'$ 到 $S$ 容量为 $k$ 费用为 $0$ 的边，然后跑 Minimum Cost Maximum Flow 就行了。