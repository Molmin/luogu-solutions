## 题目传送门

[Flipping and Bonus](https://www.luogu.com.cn/problem/AT_abc261_d)

## 思路

看到这种和硬币有关的，求利益最大化的，一般都是用贪心和动规。

但对于贪心来说，这道题贪心很难打，并且就算打出来那大概率也是假的。

于是我们就需要进行**动态规划**！

这是一个很简单的 dp 题，可以当动规初学的练手题。

这篇题解已经假设您已经理解了简单的动规，并且接触过二维动规。

我们先假设 $dp_i$ 表示前 $i$ 个硬币的最大利益。

但这样根据题意，我们还需要维护当前的计数器，因为还有 $M$ 种**额外连胜奖励**需要用到计数器。

所以，我们再假设 $dp_{i,j,k}(k\in[0,1])$ 来表示前 $i$ 个硬币，当前计数器为 $j$，选（或不选）第 $i$ 个（$k=1$ 或 $k=0$）的最大利益。

可以得出：

$$dp_{i,0,0}=\max dp_{i-1,j(0\to i),k(1\text{ or }0)}$$

$$dp_{i,j(j>0),1}=\max(dp_{i-1,j-1,1},dp_{i-1,j-1,0})+X_i$$

$$dp_{i,j(j>0),0}=\max(dp_{i-1,j-1,1},dp_{i-1,j-1,0})$$

并且，对于 $\forall j>0$ 且 $k=1$：

$$if(C_{l(1\to m)}=j)\text{ }dp_{i,j,k}\leftarrow dp_{i,j,k}+Y_l$$

对于以上思路，时间复杂度是 $O(n^2m)$，显然不能AC。

考虑**优化**：

我们可以设定一个数组 $g$，在输入程序的时候 $g_{C_l}=Y_l$，这样就能 $O(1)$ 的复杂度来查询当前的 $j$ 是否能加钱，省去一个 $m$。

同时在最外层的 $for(i\to n)$ 内定义一个变量 $last=-1$，然后在内层的 $for((j=1)\to i)$ 中每求出一个 $dp_{i,j,k}$ 就和 $last$ 取一个 $\max$。然后下一个 $dp_{i,0,0}=last$ 就好了，又优化了一点。

现在的复杂度为小于 $O(n^2)$，可以切爆本题。

但大家都发现了，这是个三维动规，那我们可以优化成二维吗？

**当然可以**！

我们发现当 $j=0$ 时，$k$ 也等 $0$，反之毅然，且可以证明 $dp_{i,j(j>0),1}>dp_{i,j(j>0),0}$，多了一个转移方程，我们完全可以把 $k$ 优化掉。

于是：

$$dp_{i,0}=last$$

$$dp_{i,j}=dp_{i-1,j-1}+X_i+g_j$$

$$ans=\max\text{ }dp_{n,p(0\to n)}$$

然后这道题就做完了，代码也比较好写，一共二三十行，我就不放代码了。