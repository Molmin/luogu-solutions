~~/bx /bx /bx ?~~

### 题意

给定长度为 $n$ 的序列 $\{a_n\}$，表示 $i$ 与 $a_i$ 之间有一条无向边，若 $a_i=-1$，则表示不确定。请对于所有可能的 $\{a_n\}$ 求出无向图的连通块个数，答案对 $998244353$ 取模。

$n \le 2000$。

### 分析

发现这图有个性质：$n$ 个点，$n$ 条边；所以每个连通块都是一颗基环树！也就是说：数连通块的方案和数基环树的方案是等价的，那么也就等价于数简单环的数量。

先把所有非 $-1$ 的边连上，显然每个连通块要么是基环树，要么是树；那么每棵树里面就至多有一个 $-1$ 节点。我们考虑基环树部分不论 $-1$ 节点怎么连，对答案的贡献都是一样的，可以预处理。

我们将树抽象成一个点，那么相当于求点与点连边产生的环数。我们考虑统计长度为 $i$ 的环的贡献，我们可以简单设计 dp，$(i-1)!f_i$ 表示长度为 $i$ 的环出现的个数，那么可以有 $f_i \gets f_{i-1}v_u$，其中 $u$ 为当前考虑的树的大小。

复杂度 $\mathcal O(n^2)$。

### Code

提交记录：<https://atcoder.jp/contests/arc140/submissions/43693365>。