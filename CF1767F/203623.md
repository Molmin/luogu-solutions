萌萌数据结构题。~~鉴定为嘴巴~~

根号分治，对 $\le \sqrt n$ 的颜色建虚树，枚举两两虚树边，拍平成 dfn 序，问题就是给 $O(n\sqrt n)$ 个点求 $O(n)$ 次矩形最大值。二维分块应该可以处理不过要用一些方法，常数比较大。

可以对行分块，整块对列维护 $O(n)-O(1)$ RMQ。对每行也离散地建 $O(n)-O(1)$ RMQ，因为点数总和 $O(n\sqrt n)$。然后到散块的时候 $l,r$ 要对应地离散化。在线可以用 P8525 的分散层叠小技巧，离线直接排序然后单调扫描。

$>\sqrt n$ 的颜色直接做就行。

然而根号分治是烂做法，其实应该是用 MST 结构构造双子树莫队。可以找时间构造一下看看能不能给出个 $O(n\sqrt n)$ 的上界。