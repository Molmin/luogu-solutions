？这啥啊，不会。

考虑行和列分别作为左部点和右部点建二分图（实际上这个建图只是辅助理解，不需要显式建图），每个左部点和每个右部点，边权为格子中的数。

容易想到一个 dp，设 $f_{i, j}$ 为走了 $i$ 步，当前在点 $j$，走过的所有边权组成的不同整数的数量。但是你会发现根本没法做，因为不同的状态有可能包含相同的整数，很尴尬。

然后就是奇妙的部分了。更改状态为 $f_{i, S}$ 表示走了 $i$ 步，不同整数的数量，使得**所有走过这些整数的路径的终点集合为 $S$ 的方案数**。注意到如果 $S$ 不同，那走过的整数一定不同。因此这个状态设计是没问题的。

转移是平凡的。枚举下一步填的位，沿着边权为它的边走，即可得知终点集合。

注意到若 $i$ 为偶数，$S$ 为左部点集子集；若 $i$ 为奇数，$S$ 为右部点集子集。所以朴素实现的时间复杂度是 $O(10N (2^H + 2^W) HW)$。显然可以预处理一些东西做到更优，但是这个复杂度足以通过了。

[code](https://atcoder.jp/contests/abc228/submissions/43005744)