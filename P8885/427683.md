下文视题面中的 $0$ 为 $-1$。

一个字符串有奇数个非空子序列，当且仅当它奇数位的和减去偶数位的和是 $3$ 的倍数。   

因此快速计算一个字符串的答案是平凡的，只需要检查每种和的前缀数量即可。

然后就是纯套路，因为一个区间的状态只有 $s=48$ 个（如果你有些细节没想清楚可能是 $64$ 个），直接动态 dp。

朴素在线段树上做时间复杂度高达 $O(ms^2\log n)$，感觉不太行。

注意到这个东西插入快合并慢，直接上回滚莫队或者猫树，时间复杂度 $O(ns\sqrt m)$ 或 $O(ns\log n+ms^2)$。