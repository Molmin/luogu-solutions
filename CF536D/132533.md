**CF536D**

感觉有点套路了。虽然我被一个神笔 corner 卡了下。

一个想法是这并不是个公平游戏，我们只能压缩状态进行动态规划来达到最优化转移。

再观察一下，这个图是平凡的，因为在求出所有点到端点的最短路后，将所有点用坐标表示成二维平面上的点即可。

发现 $n \leq 2 \times 10 ^ 3$，猜是 $O(n ^ 2)$ 的，刚好对于这类博弈问题中带先后手且最优化分差的题有一个很套路的状态设计：设 $dp_{0/1,l,r}$ 表示满足 $x \leq l,y \leq r$ 条件之一的节点已被决策，该状态由先手/后手意义下执行后的最优化差值。在此题中先手是最大化差值，后手是最小化差值。

可以发现未被考虑的范围被两条扫描线夹着形成一个矩形，但是该性质没有太大的用处。

刚开始我维护了单维度的区间数点，但是后来发现怎么转移都是 $O(n ^ 3)$ 的，观察到扫描线的大幅挪动也可以被化为一次次单独挪动，所以我们考虑每次只扩展一行/一列。

发现决策的因素之和相邻状态有关。逆向操作，这样我们最后一步的决策者是谁就在这个过程中被决策掉。（虽然我觉得正向好像对于此题没问题）

维护一下 $x/y$ 维固定时的一个后缀内点的数量及和，设为 $num_{0/1,x,y},sum_{0/1,x,y}$，设两维的边界为 $X,Y$，那么转移方程：

- $dp_{0,l,r} = \max(dp_{0,l + 1,r},dp_{1,l + 1,r}) + sum_{0,l+1,Y} - sum_{0,l+1,r}$

- $dp_{1,l,r} = \max(dp_{0,l,r + 1},dp_{1,l,r+1}) - sum_{1,X,r + 1}-  sum_{1,l,r + 1}$

时间复杂度 $O(n ^ 2)$。