$2\log$ 树剖做法，常数巨大。

每次修改一个节点，$f$ 会变化的点只能是它的祖先，因此考虑动态维护 $f$。

注意到向上枚举祖先的过程中，如果 $size_i>\frac12size_{fa}$，那么 $f_{fa}$ 一定等于 $f_i$。因此我们可以找出所有的 $fa$ 满足 $size_{fa}\geq2size_i$，这些点显然只有不超过 $\log V$ 个，对每个点计算答案，然后对于这些 $fa$ 之间的点，利用树剖区间赋值。

如何找到这些 $fa$ 呢，根据一些显然的套路，我们可以先得到当前节点的 $size_x$，然后向上找到第一个 $size_{fa}\geq2size_x$，接着验证 $size_{fa}$ 是否为儿子大小的两倍。最多找 $\log V+\log n$ 次，每次寻找可以直接用线段树完成。

然后考虑对这 $\log V$ 个 $fa$ 计算答案。我们需要维护的是每个儿子的 $size_i-size_{pre}$，这可以用[上一场](https://www.luogu.com.cn/contest/78024)[另一道题](https://www.luogu.com.cn/problem/P8479)的方法维护。具体地，对于每一条重链，从上向下（反向也可以）依次将编号大于重儿子的轻儿子按编号加入 dfn 序。每次修改时，会把一条重链上每个点编号比它大的兄弟修改，这在 dfn 序上恰好是一段连续区间。之后只要处理轻儿子的边界情况，这部分较好维护。