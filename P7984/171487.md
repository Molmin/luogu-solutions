这个东西一脸可以 DS 优化建图。

对于一张票，连边 $(u,ticket,w),(ticket,P,0)$，$P$ 是线段树上所有对应的区间。

考虑倒着跑，分别求出 $1,n$ 到每个点的最短路。

那现在要同时访问到 $1,n$。。

对每个点（包括线段树的那些虚点和表示票的点）执行加边 $(S,i,dis1_i+disn_i)$，

然后再跑 $S$ 开始的最短路。

这个东西为什么是对的？其实就类似于最短路。

相当于 $1$ 和 $n$ 同时先走到一个点，然后剩下的路程可以合走。

同时到一个点就是距离相加，合走就是在原来的图上转移。