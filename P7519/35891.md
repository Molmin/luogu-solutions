对于一种排名情况 $t_1 \dots t_n$ ，考虑 $b_{a_i}$ 的取值。

由题，要满足：

$b_{t_i}>\max(b_{t_{i-1}},b_{t_{i-1}}+a_{t_{i-1}}-a_{t_{i}}+[t_{i-1}<t_{i}])$

显然， $\forall i\not = n\ \ ,\ b_i$ 最小是最优的。（只要把多余出来的 $m$ 放到最后的 $b$ 里面）

于是，令 $b_{t_i}=\max(b_{t_{i-1}},b_{t_{i-1}}+a_{t_{i-1}}-a_{t_{i}}+[t_{i-1}<t_{i}])$

这时就可以直接状压了。就是设 $dp_{i,j,k,h}$ 为 $t_i=j$ ， $b_{i}=k$ 且 $\sum_{x=1}^ib_x=h$ ，于是可以直接枚举 $t_{i+1}$ 来转移，复杂度 $O(n^2m^22^n)$ 。

显然有可以优化的地方，套路的，考虑：

$b_{t_i}=\max(b_{t_{i-1}},b_{t_{i-1}}+a_{t_{i-1}}-a_{t_{i}}+[t_{i-1}<t_{i}])$

$b_{t_i}=b_{t_{i-1}}+\max(0,a_{t_{i-1}}-a_{t_{i}}+[t_{i-1}<t_{i}])$

于是转移时就可以节省掉一维 $b$。

复杂度 $O(n^2m2^n)$ ，可以通过此题。