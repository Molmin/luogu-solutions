赛时把式子推出来了，很开心，但是忘了线性求逆元 TLE 了。

***

根据题意，对于任意 $a_i$，有 $1\le a_i\le k$。

我们建立一个长度为 $k$ 的哈希表 $b$，$b_i$ 表示 $i$ 在 $a$ 中出现的次数。

考虑分类讨论。

- ### 当 $k$ 为偶数时：

  根据题目中第二个条件，可以得到：

  因为 $a_i+a_j\ne k+1$，所以对于 $b$ 中的任意一个位置 $b_i$，与其沿中心对称的点 $b_{k-i+1}$ 两者中必然有一个为 $0$。即：

  $$b_ib_{k-i+1}=0$$

- ### 当 $k$ 为奇数时：

  设 $k=2s+1$。

  有对于 $1\le i\le s$，仍满足

  $$b_ib_{k-i+1}=0$$

  而对于中间的元素 $b_{s+1}$，仅有可能为 $0$ 或 $1$。因为当 $b_{s+1}\ge 2$ 时，说明存在超过两个 $s+1$ 元素，而任意两个 $s+1$ 相加等于 $2s+2=k+1$，不满足条件。

  这个时候，我们再进行分类讨论：

  - #### 如果 $b_{s+1}=0$：
  
  	 问题转换为，将 $n$ 分到前 $s$ 个格子，可以不分的方案数，然后因为左右两边只有一个可以放东西，所以乘上 $2^i$ 就可以了。
    
    但是，如果有一个格子没有放，那么左右交换以后实际上分法没有改变，不能算作两种情况。
    
    所以，我们枚举 $1\sim s$ 内的 $i$，表示将 $n$ 分到任意 $i$ 个格子的方案数。
    
    总方案数为：
    
    $$\sum_{i=1}^{s}C_{s}^{i}\times 2^i\times C_{n-1}^{i-1}$$
    
  - #### 如果 $b_{s+1}=1$：
  
  	 容易得到，我们只是在 $b_{s+1}$ 位置占用了一个，$n$ 相应减少 $1$ 即可。总方案数为：
     
     $$\sum_{i=1}^{s}C_{s}^{i}\times 2^i\times C_{n-2}^{i-1}$$
     
  综上，当 $k$ 为奇数时，方案数为
  
  $$\sum_{i=1}^{s}C_{s}^{i}\times 2^i\times (C_{n-1}^{i-1} + C_{n-2}^{i-1})$$
  
而对于偶数，设 $k=2s$，因为没有中间部分的额外方案数，所以总方案数为

$$\sum_{i=1}^{s}C_{s}^{i}\times 2^i\times C_{n-1}^{i-1}$$

那么，如何优化时间复杂度呢？

我们知道，$C_{n}^{m}=\dfrac{n!}{(n-m)!m!}$。

故我们先预处理 $x!\bmod p$，然后对于上式，线性求逆元即可。

这样，总时间复杂度为 $O(tn)$。

式子给的这么清楚了，代码就不附了吧。