妙啊！

首先一维的问题是 trivial 的，直接用斐蜀定理转化为得到答案为所有 $k$ 的 $\gcd$。

对于二维的问题，我们首先将 $b,c,d$ 均减去 $a$，这样相当于对于所有 $x$，合并 $(x,(x+b)\bmod n)$ 与 $((x+c)\bmod n,(x+d)\bmod n)$。注意到我们对行列进行平移是不影响答案的，因此我们将第 $x$ 行向左平移 $x$ 位，即坐标 $(x,x+y)$ 变为 $(x,y)$，这样相当于合并 $(x,b)$ 与 $((x+c)\bmod n,(d-c)\bmod n)$。

我们先考虑两种特殊情况：

- $b=(d-c)\bmod n$，这样显然每一列都是独立的，对其做一维的问题即可。
- $c=0$，这样相当于并查集。

我们考虑将两者结合起来，即这样一个思想：我们先假设我们搞出了一个序列 $e$ 并将所有 $(x,y)$ 变换为 $(x+e_y,y)$（即，对每一列进行一定大小的轮换），我们希望，对于每次操作的 $b$ 与 $(d-c)\bmod n$，如果我们在每次操作都对这两个点进行并查集上的合并操作，且对于每次在合并前 $b$ 与 $(d-c)\bmod n$ 不在同一集合中的操作，都有进行坐标变换后的 $c=0$，那么这个问题就是可以解的了。因为如果在后面的合并中，我们合并的 $b$ 与 $(d-c)\bmod n$ 在同一集合中，我们就可以将其转化为一维的问题了。而这个 $e_x$ 的求法很简单——因为在每次有效合并的时，我们可以知道 $e_b$ 与 $e_{(d-c)\bmod n}$ 的差，建出图来 DFS 即可。

时间复杂度 $n\alpha(n)$。