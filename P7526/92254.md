~~今天~~ 昨天学了多点求值相关内容啊，虽然这样说但下午主要还是去研究 Virtual Self 的新做法去了。

之前一直觉得这东西很离谱，今天静下心来思考学习了以后发现并没有想象中的那么困难。虽然对其运用还不是很熟练但这肯定也需要更多的练习。不过我现在功利心很重阿！估计也不会更深地研究这个技巧了。大概会套用一下方法就可以了。感觉有很多题目很值得花时间来研究，收获真的很大。闲话就说这么多吧。

---

下面讲一个第二问（没有 A 性质）的另解，虽然没有官方正解优秀，但是比较好想。下面记给出序列对应的集合幂级数为 $A(x)$。

首先我们将这 $m$ 个数有序化，最后除以 $m!$。设 $F_i(x)=\sum_Sa_Sx^S$ 表示长度为 $i$，内部元素两两不同，异或和为 $S$ 的序列个数。考虑在长度为 $i-1$ 的序列后面添加一个新数来递推到长度 $i$ 的序列，也就是 $F_{i-1}(x)\times A(x)$。这样得到的序列有两种情况：

1. 新数和前面任意一个数不同。这个的方案为 $F_i(x)$
2. 新数和前面某个数相同，这时候这两个相同数抵消，异或和不变，序列长度减二。此时方案数为 $F_{i-2}(x)\times(n-(i-2))\times(i-1)$。这里乘的系数的意思是选择一个和 $i-2$ 个数不同的新数，然后选择上一次出现时的位置。

综合起来我们得到了这个递推式：

$$
F_i(x)=F_{i-1}(x)\times A(x)+F_{i-2}(x)\times(n-(i-2))\times(i-1)
$$

这是一个关于集合幂级数的递推，我们首先对它做 FWT，然后对于每一项分别递推。也就是：

$$
FWT(F_i(x))_S=FWT(F_{i-1}(x))_SFWT(A)_S+(n-(i-2))(i-1)FWT(F_{i-2}(x))
$$

将这个递推写成矩阵的形式，就是：

$$
\prod_{i=1}^m \begin{bmatrix}
0  &  (n-(i-2))(i-1) \\
1 & FWT(A)_S
\end{bmatrix}
$$

将 $FWT(A)_S$ 看成变量 $x$，然后用分治 NTT 求出上面的多项式，然后多点求值即可得到答案的 FWT。

常数非常大，还是需要拼上暴力才能拿到满分。

代码非常长，需要可以私信领取。