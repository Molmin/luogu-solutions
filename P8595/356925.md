出题人题解。

------------
#### 思路

考虑操作进行顺序。可以证明，先进行操作 $1$ 一定不会比先进行操作 $2$ 更劣。因为先连的边后面也有可能被炸毁，那么这次连边操作就是无意义的。因此，我们应该先考虑将每个连通块炸成若干条链，最后再将它们连接起来。

假设点 $u$ 的子树已经被炸成若干条链。

定义 $f_{u,0}$ 表示点 $u$ 本身被炸了的最小代价。

定义 $f_{u,1}$ 表示点 $u$ 没有被炸且与它的父亲有连边的最小代价。

定义 $f_{u,2}$ 表示点 $u$ 没有被炸且与它的父亲没有连边的最小代价。

考虑转移。记 $d_u$ 为点 $u$ 度数。


对于 $f_{u,0}$，其代价为本次被炸掉的边数加一，因为最后还需要把这几条边连上。而其儿子可以选择被炸或不保留其与父亲的连边。如果其儿子被炸了，那么它连向它儿子的那条边就已经被炸过了，它现有的边数就要减一。得到转移方程为 $f_{u,0}=\sum_{v\in son[u]} \min(f_{v,0}-1,f_{v,2})+d_u+1$。

定义 $cost_v$ 为 $f_{v,0}-f_{v,1}$。假设点 $u$ 的儿子是点 $v$，记 $F_u$ 为点 $u$ 所有儿子中最大的 $cost_v$。$S_u$ 为点 $u$ 所有儿子中次大的 $cost_v$。

对于 $f_{u,1}$，它最多就只能和一个儿子保留连边，其它儿子都要炸掉。那么显然，应当保留代价最小的那个儿子。得到转移方程为 $f_{u,1}=\sum_{v\in son[u]}f_{v,0}-F_u$。

对于 $f_{u,2}$，它最多就只能和两个儿子保留连边，其它儿子都要炸掉。则只需在保留一个儿子的基础上，再保留一个代价次小的儿子就行了。得到转移方程为 $f_{u,2}=f_{u,1}-S_u$。

假设每棵树根节点为 $u$，最后每棵树的答案即为 $\min(f_{u,0},f_{u,2})$。

最终答案为每棵树的答案加上树的棵数减一。

总时间复杂度为 $O(n)$。