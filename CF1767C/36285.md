
# CF1767C - Count Binary Strings

## 题意

有一个长度为 $n$ 的 01 串 $s$ 和一些限制 $a_{i,j}(1 \le i \le j \le n)$。

$a_{i,j}$ 的含义如下：

| $a_{i,j}$ | 含义 |
| :----------: | :----------: |
| $0$ | 没有限制 |
| $1$ | 该区间里的数字完全相同 |
| $2$ | 该区间里的数字不能完全相同 |

求可能的 $s$ 的个数。

## 思路（区间DP）

为了计数不重不漏，我们令 $dp[l][r][0/1/2/3]$ 分别代表在区间 $[i,j]$ 中，整个区间都是 $0$，整个区间都是 $1$，整个区间 $01$ 都有但最左边放的是 $0$，整个区间 $01$ 都有但最左边放的是 $1$ 的方案数。

如果一个区间 $01$ 都有，那么可以这样计数：

- 枚举中间端点 $k$，使得区间 $[l,k]$ 全是 $0$，但 $k$ 处一定是 $1$，并且 $[k+1,r]$ 随便放。
- 枚举中间端点 $k$，使得区间 $[l,k]$ 全是 $1$，但 $k$ 处一定是 $0$，并且 $[k+1,r]$ 随便放。

同时注意检查区间限制的合法性。

- 枚举中间端点 $k$ 后，那么对于所有跨越该端点的区间 $[l,r]$，都不能有 $a_{l,r}=1$。
- 若某区间的限制为 $1$，那么对于所有完全包含于该端点的区间 $[l,r]$，都不能有 $a_{l,r}=2$。



转移时，枚举中间端点 $k$，在检查区间限制的合法性后，计数即可。