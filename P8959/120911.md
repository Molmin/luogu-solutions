先考虑只查询当前值怎么做。

修改相当于把从当前点开始一条不断向上跳的链上的每个点点权加，查询相当于从当前点开始一条不断向上跳反向边的链上的每个点点权和。

考虑等价于修改相当于把从当前点开始一条不断向上跳的链上的每个点所往下能到的点点权加，查询单点查询。

那么只要把这些点贴在一起形成一个区间我们就能够把区间加区间减查询历史最大值套上去了。

考虑每个由向上的边形成的连通块，对连通块进行树剖，然后将每个重链按顺序把每个点往下能够跳到的点加入序列即可。

直接做 $O(n\log^2n)$，利用全局平衡二叉树可以做到 $O(n\log n)$。 