有一个函数 $f(x)$，两种操作。

1. 将 $f(x)$ 变为 $f(x)+\left|x-a\right|+b$。
2. 求 $f(x)$ 的最小值点。如有多个，取横坐标最小的一个。

-----
通过初中数学知识可以发现，当 $x$ 取到所有 $a$ 的中位数时 $f(x)$ 有最小值。假设已经进行了 $2n-1$ 次操作 $1$，每个 $a$ 从小到大分别为 $a_1,a_2,\ldots,a_{2n-1}$，则 $x=a_n$ 时  $ f(x)=(a_n-a_1)+(a_n-a_2)+\ldots +(a_n-a_{n-1})+(a_{n+1}-a_n)+\ldots+(a_{2n-1}-a_n)+\sum b=\sum_{i=n+1}^{2n+1}a_i-\sum_{i=1}^{n-1}a_i+\sum b $。操作次数为偶数时类似。所以我们要维护以下三个东西：

+ 中位数；

+ 比中位数大的数字总和；

+ 比中位数小的数字总和。

于是考虑用两个堆来维护。开一个大根堆存小于中位数的数，开一个小根堆存大于中位数的数。则为了使中位数有多个时取最小的，应该让大根堆堆顶存储当前的中位数。这样大根堆中的元素个数一定大于等于小根堆中的元素个数。

考虑如何插入。如果当前的数据个数是偶数，那我们要在大根堆中新插入一个数。明显的，我要插入的数一定是小根堆堆顶和当前插入的数的最小值，并将剩下那个数放入小根堆中，这样才能保证满足原有性质。如果数据个数是偶数，类似的，取大根堆堆顶和当前数的较大值放入小根堆，剩下那个放入大根堆。

这样我们就可以 $O(n\log n)$ 维护中位数了。计算两个总和就很简单了，在数据出入堆时顺便对总和进行修改即可。

[Code](https://atcoder.jp/contests/abc127/submissions/31454143)