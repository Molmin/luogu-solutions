### 题目描述:

给一个无向图，你需要给所有边定向，使定向之后存在最多的点对 $(a,b)$ 使得从 $a$ 能到 $b$。

### 想法：
考虑到这道题目环的重要性（有环点对肯定多），我们就容易想到这样一个引理：

**对于一个边双来说，总会存在一种方法使得把所有无向边改为有向边的方法，使得边双内的点可以互相到达。**

显然，我们对这个图进行边双缩点，**而且此图缩完点后必为一颗树，两边双之间的桥即是边。**

接下来问题便简化成了: 对于一颗树，如何对他的所有边进行定向使得他的价值最大。

首先，对于这种树型结构的东西上面搞 $dp$ ，枚举点 $O(n^3)$ 的算法往往可以被均摊压成 $O(n^2)$ 的，这不由得加深了我对这道题目是 $dp$ 的怀疑。

对于价值贡献来说，内部点的贡献为 $cnt^2$ ，而外部点的贡献取决于我们如何去安排。

我们考虑构造最优解，发现总是有 **中流砥柱** 的那一条路的出现。像是这样：

![](https://cdn.luogu.com.cn/upload/image_hosting/wmz07jx2.png)


中间的那个点起到至关重要的一步，他的存在使得所有的点可以通过最优解的有向边到达他本身，也可以从它本身到达其他所有的点。


我们把中间的点称为 **中流点** ，那么我们就可以通过枚举中流点的方法，（把他当作根）做一个类树型背包的 $dp$ 就可以了。

记 $s_i$ 为编号为 $i$ 的边双大小，$sz_i$ 记以 $i$ 为根的子树大小。

那么每个节点 $i$ 的子树内贡献的答案就是 $s_i\cdot(sz_i-s_i)$

所以最后我们还得统计一下过中流点的答案，也就是决定连着中流点的那些边的朝向。

假设朝向中流点的节点的 $sz$ 总和为 $sumsz$ ，那么另一部分就是 $(n-s_i-sumsz)$ 那么过中流点的答案就是 $sumsz\cdot(n-s_i-sumsz)$

把它尽可能地搞成一样，直接莽 $dp$ 。时间复杂度均摊 $O(n^2)$ 。