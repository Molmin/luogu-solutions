确实是不错的好题，至少能把我这种弱智给区分掉。

注意到 $D$ 不大，$N$ 巨大。那你考虑枚举每一条边有几个白石子。不妨设枚举到了 $d$ 个。

然后是最妙的：考虑一个 dp。也就是说 $dp_{{i},{c_1},{c_2}}$ 表示第一个点（就是最开始那角）的颜色 $c_1$ 开始，到了第 $i$ 条边，这条边最后一个点（也就是这条边的角上）的颜色为 $c_2$。显然绕一圈回来刚好那个角重合了，因此这俩玩意儿颜色得一样，答案就是 $dp_{n,0,0}+dp_{n,1,1}$。

考虑如何转移。你发现本质上只跟你在这条边剩几个位置能填（实际上一定是 $D-1$），以及还需要几个白石子有关。这时枚举 $d$ 的好处就出来了：你可以直接确定从 $dp_{i,c_1,c_2}\to dp_{i,c_1,c_2'}$ 的过程中还有几个白石子需要填（实际上就是 $d-[c_2=0]-[c_2'=0]$）。这样一来系数就是从 $D-1$ 里选 $d-[c_2=0]-[c_2'=0]$ 个。然后你发现它是一个标准的矩阵加速形式。然后就做完了。

复杂度 $O(D\log N)$。还是很好写的。