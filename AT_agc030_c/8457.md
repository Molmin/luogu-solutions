# [AGC030C] Coloring Torus

感觉这个题比我之前做的构造都更神仙，感受到了智商的碾压。

首先得看懂 $cnt_{i,j,v}$ 的意思，因为翻译里面 $n$ 写的是 $mod$。它的意思是 $A_{i,j}$ 为中心，上下左右（不包含 $A_{i,j}$ 这个点）四个点等于 $v$ 的值的个数（如果越过边界就到另一端）。

最开始想的是当 $k$ 为完全平方数的时候，可以从左上到右下一个一个数填过去，正确性显然。然后差点被带偏，想如何填充 $k$ 不为完全平方数后多出的那些空白（（（

我们先考虑若 $k \leq n_{\max}$ 的时候的构造。如果要满足 $\forall v \in [1,k],A_{i,j}=A_{x,y}$ 则 $cnt_{i,j,v}=cnt_{x,y,v}$，我们会很自然地考虑，固定住一行或者一列填满同一个数字，且每行/每列填的数字互不相同。这样的话，以每行为例，那么 $A_{i,j-1}$ 和 $A_{i,j+1}$ 这两个值是相同的，而 $A_{i-1,j} \neq A_{i+1,j}$，且 $A_{i-1,j} \neq A_{i,j-1}$。这样 $cnt_{i,j,A_{i,j-1}}$ 肯定为 $2$。而且因为只有这一行填这一个数字，别的每一行都不填这个数字，因此就能满足一开始提到的那个约束了。

说白了，也就是当 $k \leq 500$ 的时候构造出下列矩形是很省事的：

| $1$     | $1$     | $\dots$ | $1$      |
| ------- | ------- | ------- | -------- |
| $2$     | $2$     | $\dots$ | $2$      |
| $\dots$ | $\dots$ | $\dots$ | $\dots $ |
| $k$     | $k$     | $\dots$ | $k$      |

但是如果当 $k>500$ 的时候，上述构造方法就失效了，因为题目条件要求 $n \in [1,500]$，那么要点就在于，如何让在 $k=500$ 的做法拓展到 $k=1000$。我们会发现一个很妙的一点，如果我们画一个 $n \times n$ 的矩阵，我们会发现，其中对于每一个方向，正好有 $2n-1$ 条对角线。下图是对于一个 $4 \times 4$ 的矩阵，一共有 $7$ 条对角线。

![QQ截图20200510192512.png](https://i.loli.net/2020/05/10/86yZ4pvwQxBYtEm.png)

如果我们斜着填上 $[1,k]$，可以做完 $k \leq n_{\max}$，具体方法是以最中心的对角线为分界点，左下填上 $[1,k]$，右上就做一个翻转过去即可。以 $k=n=4$ 为例，也就是这样的。

| $4$  | $1$  | $2$  | $3$  |
| ---- | ---- | ---- | ---- |
| $3$  | $4$  | $1$  | $2$  |
| $2$  | $3$  | $4$  | $1$  |
| $1$  | $2$  | $3$  | $4$  |

此时也能保证  $\forall v \in [1,k],A_{i,j}=A_{x,y}$ 则 $cnt_{i,j,v}=cnt_{x,y,v}$。但是如何拓展开来呢？

举一个很小的例子，在 $k=5$ 的时候，如果我把 $A_{2,1}$，$A_{3,4}$ 以及 $A_{1,4}$ 改成 $5$，其实也并没有影响到什么：

| $4$  | $1$  | $2$  | $5$  |
| ---- | ---- | ---- | ---- |
| $5$  | $4$  | $1$  | $2$  |
| $2$  | $3$  | $4$  | $1$  |
| $1$  | $2$  | $5$  | $4$  |

这暗示了我们，我们可以在每个对角线上，交替放置数字，最后还是合规的。因此我们就可以如此构造即可。实际代码中，我是拿 $1$ 作为对角线的，其实也差不多。时间复杂度 $O(k^2)$。

```cpp
#include <iostream>
#include <cstdio>
#include <cstring>
#include <algorithm>
#include <cmath>
#include <cctype>
#include <queue>
#include <vector>

using namespace std;

inline int read()
{
	int x=0,f=1;char ch=getchar();
	while (!isdigit(ch)){if (ch=='-') f=-1;ch=getchar();}
	while (isdigit(ch)){x=x*10+ch-48;ch=getchar();}
	return x*f;
}

int main()
{
	int k=read();
	if (k<=500)
	{
		cout << k << endl;
		for (int i=1;i<=k;i++)
		{
			for (int j=1;j<=k;j++)
				cout << j << " ";
			cout << endl;
		}
		return 0;
	}
	cout << 500 << endl;
	int a[505][505]={0};
	for (int i=1;i<=500;i++)
	{
		for (int j=1;j<=500;j++)
			a[i][j]=(i+j-2)%500+1;
	}
	for (int i=501;i<=k;i++)
	{
		for (int j=1;j<=500;j++)
		{
			if (j&1)
				a[(i-j+500-2)%500+1][j]=i;
		}
	}
	for (int i=1;i<=500;i++)
	{
		for (int j=1;j<=500;j++)
			cout << a[i][j] << " ";
		cout << endl;
	}
	return 0;
}

```

