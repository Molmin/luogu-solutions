我们考虑以子序列为贡献。为了去重，我们对每个子序列数以它为最前面的子序列的数列。

我们考虑对于一个长度为 $len$ 的子序列 $v_{1\sim len}$，将它放在位置 $pos_{1\sim len}$，有多少种数列。显然这 $len$ 个位置是固定的了，然后在 $p_{i-1}+1\sim p_i-1$ 的地方，不能有 $v_i$ 出现，其它值都能取（我当时课上没做出来就是因为这个地方想假了。我以为 $v_{i\sim len}$ 都不可以取的，实际上可以）。然后 $p_{len}+1\sim n$ 是都可以。那么方案数就是 $m^{n-p_{len}}(m-1)^{p_{len}-len}$。

然后因为对每个长度相同的、最后一个位置相同的子序列，贡献都是一样的，于是乘法原理可得答案式 $\sum\limits_{i=1}^n\sum\limits_{j=1}^n\dbinom{j-1}{i-1}m^{n-j+i}(m-1)^{j-i}$。直接算会炸，它一脸二项式定理的样子，考虑先交换 $i,j$，然后随便推得 $\sum\limits_{i=1}^nm^n\left(\dfrac{m-1}m+1\right)^{i-1}$。线对显然是会的，又显然可以做到线性。