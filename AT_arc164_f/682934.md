我来复读官方题解。

首先，一个节点的翻转次数是固定的，定义深度为到根经过的边数，则深度为偶数的节点最终颜色与刚刚放置时的颜色相等，深度为奇数的节点的最终颜色与刚刚放置时的颜色相反。假设深度为偶数的节点为红色，深度为奇数的节点为蓝色，那么假设 Alice 取了 $a$ 个蓝色节点，Bob 取了 $b$ 个蓝色节点，那么最后的答案是 $\left\lceil\dfrac{n}{2}\right\rceil-a+b$，说明 Alice 和 Bob 都希望能够最小化取到的蓝色节点个数。

假设 Bob 和 Alice 的策略均为：尽可能取红色节点，如果没有红色节点取则尽可能不让对方取到红色节点。那么如果某人取了一个节点，那么取完之后会引发一系列连锁反应，我们把取完某个节点之后，紧接着被取到的节点划分为一组。划分规则为：

* 如果有红色节点为叶子，那么红色节点为一组。
* 否则，去除所有已经分组了的节点，考虑所有满足其父亲有不止一个子节点的蓝色节点，将蓝色结点个数最小的满足上述条件的蓝色节点的子树划分为一组。
* 如此重复操作直至不能操作，剩下的节点为一组。

定义一组节点的权值为其中蓝色节点的个数，那么如果一个人取了这一组中的元素，那么它会取走这一组中所有的蓝色节点。那么策略为：按权值从小到大排序，两人一次取完一整组。注意到不会出现不合法的情况，即取完一个点的祖先再取这个点，因为可以发现存在祖先关系的组的权值是由子树到祖先递增的（由于我们率先取走了蓝色结点个数最小的子树）

为什么这样做是对的呢？考虑归纳证明。假设对于 $n$ 个点的树均满足上述规则，我们证明大小为 $n+1$ 的树仍然满足上述规则。

考虑反证，假设权值从小到大排序的结果为 $a,b,c\cdots,k,\cdots$，我们率先从权值为 $k$ 的组里面取走了一个结点，分类讨论：

* $k>1$，那么操作完之后会诞生一个红色叶子，取完红色叶子之后剩下的按规则处理，即两人取走的权值依次为 $1\to 0\to a\to b\to c\to \cdots \to k-1$，可以发现相比于原方案 $a\to b\to c\to \cdots \to k-1$，如果原本的方案中由后手取走了 $k$，那么后手相对于原来的方案要少取走一个结点，否则后手的方案不变。所以先手亏了。
* $k=1$，那么只有在 $a=0$ 的情况下才会有影响，此时方案为 $k=1\to a=0\to b\to c$，原来的方案为 $a=0\to k=1\to b\to c$，可以发现先手还是多取了一个结点。

所以结论成立。

[code](https://atcoder.jp/contests/arc164/submissions/43544520)