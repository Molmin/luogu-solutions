先来考虑所有堆均有偶数张牌的情形。

我们将要证明，最终 C 会取走每堆牌顶端一半的牌，J 会取走每堆牌底端一半的牌。将这个局面简称为 $\star$。

考虑 $\star$ 局面的特殊性质：

1.  无论 J 如何操作，C 都可以迫使局面到达 $\star$。
2.  无论 C 如何操作，J 都可以迫使局面到达 $\star$。

1 情形中 C 的策略为，每次取牌时，若已经取过的所有牌对称，则任意取一张；否则从 J 上次取牌的牌堆取牌。2 情形中 J 的策略为：每次从 C 取牌的牌堆取牌。

因此，考虑任意一个与 $\star$ 不同的最终局面 $\circ$ 。若 J 在 $\circ$ 中的得分比他在 $\star$ 中的得分低，则他一定不会让游戏以 $\circ$ 结束；对于 C 也是同理。这样看来，所有其他的局面都不可能成为结束局面，最终的局面就是 $\star$ 了。 

注意这里的过程与先后手无关。

---

接下来我们考虑有奇数的情形。

因为每堆牌堆是相互独立的，所以对于那些偶数堆的牌，我们可以放在一边了。最后直接顶一半给 C，底一半给 J。

考虑 C 取一堆奇数的牌会发生什么？

![img](https://cdn.luogu.com.cn/upload/image_hosting/l3q5tkv2.png)

C 从奇数堆中取走第一张牌，把它变成偶数堆的时候，最中间这张牌的归宿就已经确定了，然后这堆牌变成了偶数我们就不管了。也就是说，对于奇数堆来讲，谁先从中取牌，谁就会最终取走中间那个牌。那么这一步的策略显然应该是贪心，C 先从中间那个数最大的奇数堆取牌，然后轮到 J 取，直到没有奇数堆了，就转化为先前的问题了。因为前面那个问题先后手无关，因此这里我们不需要额外考虑是谁取了最后一个奇数堆的石子。

这时候还有一个问题，如果在最开始轮流取奇数堆的时候有人突然跑去取偶数堆了怎么办？这样的策略是不优的，因为你的对手可以取走对称的牌来抵消你的操作，因此这样的策略不可能使得分变高，还可能使得分变低，因此不会出现。

这样，我们就完成了对整个游戏过程的分析：

1.  双方玩家轮流选择中间的牌价值最高的、含有奇数张的牌堆，取走此牌堆中间的牌。
2.  剩下的牌，牌堆顶的一半由 C 获得，底的一半由 J 获得。

第一部分可以将所有中间的牌放进一个数组从大到小排序，双方轮流取走剩下的最大的数。