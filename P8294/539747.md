[题目链接](https://www.luogu.com.cn/problem/P8294)。

### 正文

其它两篇已经讲的很详细了，本篇题解主讲 `dp` 的设计状态。

一个比较好的理解是 `dp[x][v][i]` 表示 $x$ 子树被扔到子树外的是 $v$ 这个点的值，然后被扔进来的数在子树内对答案贡献了 $i$。

我们注意到这个状态是 $n^2$ 的，但由于是二叉树，我们可以 $3!$ 阶乘枚举子树根节点周围的边断边顺序。

只要把需要在转移时用的数据预处理出来就可以了。

个人感觉还是很好理解的。