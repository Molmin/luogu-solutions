## Solution

先考虑暴力。考虑对于一个字符串他需要修改几个字符才能使得其回文，那么显然，每个字符都是开头结尾一一对应的，如果这两个字符不同，那就需要改其中一个，贡献加一；如果相同，则不需要。

那么我们自然地想到，可以计算每一个字符对于全局的贡献，即确定一个 $i$，去考虑一个 $j$ 可以和他配对且 $s_i\neq s_j$，设有 $a_{i,j}$ 个字符串可以让他们配对，则答案即为 $\sum\limits_{i=1}^n\sum\limits_{j=i+1}^n [s_i\neq s_j]\times a_{i,j}$。接下来考虑计算 $a_{i,j}$，我们不妨以他们两个先为一个字符串的开头和结尾，显然他们两个配对，然后接下来分别向左向右扩展，显然依旧配对，而且有且仅有这种情况配对，则得到共可以拓展 $\min\{i,n-j+1\}$ 个，所以答案 $=\sum\limits_{i=1}^n\sum\limits_{j=i+1}^n [s_i\neq s_j]\times \min\{i,n-j+1\}$。

最后的问题就是如何 $\Theta(n)$ 或 $\Theta(n\log n)$ 去计算他。

首先我们把他拆成 $(\sum\limits_{i}\sum\limits_j [s_i\neq s_j]\times i)+(\sum\limits_{i}\sum\limits_j [s_i\neq s_j]\times (n-j+1))$，然后去解不等式计算前后 $i,j$ 的取值范围，可以得到：前者为 $i<j<n+1-i$，后者为 $\max\{i,n-i\}<j$，然后；类似地把后者再拆一下。接下来我们就可以用常用的类似于换根 dp 的方法开个桶（下标为值域）计算偏差（再挪动时加减），设 $t_i$ 为所有 $s_j=i$ 的贡献，则通过容斥原理可计算，最后求和。

然后就做完了。

## Code

正解：<https://atcoder.jp/contests/abc290/submissions/39037891>。