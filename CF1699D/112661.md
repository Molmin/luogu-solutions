## Description

给定一个数列 $S$，现对其进行若干次操作，每次操作将相邻两个不相等的数从数列中删去，其余数字相对次序不变，问在操作过后，若数列里仅剩同一种数字，数列长度最大为多少。（$1 \leq S_i \leq |S| \leq 5 \times 10^3$）

## Solution

首先，对于一个序列 $l$，倘若其能被完全删去，不难发现如下性质：

- $|l|$ 应为偶数。
- 序列内众数的出现次数不应超过 $\frac{|l|}{2}$。

我们发现 $S$ 的长度较小，考虑 $O(N^2)$ 的线性dp。

定义 $f[i]$ 表示最终数列以第 $i$ 位为**结尾**时的数列长度，易知枚举断点时仅能从开头或者与 $S_i$ 相同的位转移，同时需要满足断点与当前点之间可以完全删去。

此时复杂度为 $O(N^2)$，发现若枚举断点时暴力判断是否合法，则会使复杂度乘上一个 $N$，因此我们可以进行预处理，提前处理每段序列是否能被删去即可。

## [code](https://www.luogu.com.cn/paste/o9krlkbb)