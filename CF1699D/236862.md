
设 $f_i$ 表示留下 $a_i$，处理 $1$ 到 $i$ 可以得到的最优值。

则 $f_{i}= \max \{f_j+1\}$，其中 $a_i=a_j$ 且 $a_{j+1}$ 至 $a_{i-1}$ 可以被全部消除。

然后容易发现对于长度为偶数的区间 $a[l,r]$，其可以被全部消除当且仅当区间众数出现的次数不大于区间长度一半。

答案为 $\max ⁡\{f_i\}$，其中 $a_{i+1}$ 至 $a_n$ 能够被全部消除。

[code](https://codeforces.com/contest/1699/submission/162796997)
