令 $perm$ 为满足以下条件的长度为 $n$ 的排列 $p$ 的个数：

* $a_{p[1]}<a_{p[2]}>a_{p[3]}<a_{p[4]}>.....<a_{p[n]}$

* $a_{p[2]}<a_{p[4]}<a_{p[4]}<....<a_{p[n]}$

令 $cnt[i]$ 表示权值 $i$ 出现的次数，那么答案即为：

$$
\dfrac{perm}{\prod\limits_{i=1}^n(cnt[i])!}
$$

因为 $cnt[i]>1$ 的情况可能会出现相邻的元素相等的情况，所以先考虑一种更简单的情形：$a[]$ 是长度为 $n$ 的排列。

考虑按权值大小从大到小往排列中加入元素，如果 $a_i$ 在排列在偶数位，如果该位置是 $pos$，那么当前排列的 $[1,pos]$ 位都不应该有元素，并且 $pos+1$ 位也不应该有元素。并且 $>pos$ 的所有偶数位置上都应该有元素。

即如果当前将 $a_i$ 加入到排列的偶数位置中，那么其加入到的位置我们是能够唯一确定的：令当前排列中有元素的最靠左的位置为 $pos$，$pos$ 是偶数位置，那么 $a_i$ 只能被加入到位置 $pos-2$。因此我们可以得到一个基础的结论：如果当前存在偶数位置上没有元素，那么最靠左有元素的位置一定是偶数位置。并且只要确定了当前向偶数位置中加入了多少个元素就能够唯一确定该位置。

考虑如果将 $a_i$ 加入到排列的奇数位置中，那么当前与其相邻的偶数位置上都应该有元素。

不难发现，如果我们确定了当前已经有多少个偶数位置已经确定了，即可确定 $a_i$ 能放的位置个数。

因此不难想到一种 DP：令 $f[i,j]$ 表示考虑将 $a[i+1,n]$ 向排列中填，有恰好 $j$ 个元素填到偶数位置上的合法方案数。

接下来考虑有重复权值的情况。

不难发现若 $cnt[i]>1$，那么其实至多有一个 $i$ 能够往偶数位置上填。

令 $get(j)$ 表示如果有恰好 $j$ 个偶数位置上有元素，有多少个奇数位置可以填数，$sum[i]$ 表示 $cnt[i]$ 的后缀和。

因此不难写出转移方程：

$$
f[i-1,j+1]\gets cnt[i-1]\times f[i,j]\times \prod_{k=1}^{cnt[i]-1}(get(j)-(sum[i]-j+k-1))
$$

$$
f[i-1,j]\gets f[i,j]\times \prod_{k=1}^{cnt[i]}(get(j)-(sum[i]-j+k-1))
$$

