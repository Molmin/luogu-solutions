# 前言

~~退役以后~~ 口胡一道还算不错的 DP. 

由一道我在 LOJ 做过的数位 DP 加强而来: [Link Here](https://www.luogu.com.cn/problem/P4317)

# 正文

看到 $10^{1000}$ 显然就是要在数位上操作，不然你咋做。

显然 20 pts 送的，直接预处理。然鹅想要拿到 100pts 就要祭出数位 DP.

我们考虑把它转换成二进制，最多 $1000 \times \log_2 10$ 位。

那么这个复杂度就差不多可以上数位 DP 了。设 $f_{i, j}$ 为 $[1, i]$ 区间内的，二进制表达下有且仅有 $j$ 位为 $1$ 的数字个数。

那么这就简单了。按照常规套路，数位 DP 要有区间，所以肯定是跟 $f_l, f_r$ 有关的两项相减。

令 $g_i$ 为 $[1, i]$ 区间内的数字的二进制表达中 $1$ 的个数总和，则有 $sum_i = \sum\limits_{j=1}^{\log_2 i}f_{i, j} \times j$，$mul_i = \prod\limits_{j=1}^{\log_2 i}j ^ {f_{i, j}}$。

这样设计的答案 1 为 $sum_r - sum_{l - 1}$，答案 2 为 $\dfrac{mul_r}{mul_{l - 1}}$。问题现在在如何求解 $f_{i, j}$ 上。那么考虑从高到低枚举每一位：

1. 这一位是 $0$

没有任何贡献, Skip.

2. 这一位是 $1$

为了防止多讨论，我们细分一下：

想要统计这一位是 $1$ 但是会被后面限制大小的合法的数，则需要继续考虑。

想要统计这一位是 $0$ 的合法的数，那么直接统计合法的数即可。

---

然鹅代码还是不太好写捏，这里我们不使用刷表法而是改用推表法：

从低到高枚举第 $k$ 位，如果这一位有 $1$ 就去枚举右边 $k - 1$ 个位填了 $t$ 个 $1$。记这一位左边的 $1$ 的个数为 $cnt$，然后 $f_{t, k + cnt}$ 加上一个组合数 $C_{t}^{k - 1}$，表示右边 $k - 1$ 个位填了 $t$ 个 $1$ 的方案个数。

这样子就完成了，记得最后统计不要忘记自己。但是复杂度仍然爆炸，因为有了组合数就要除法，模意义下除法就要乘法逆元。

所以不能采用 $\log_2$ 复杂度的费马小定理每次都求一遍。我们可以花 $\mathcal{O}(\log_2^2 N)$ 预处理组合数，这样就不必再计算了。

这样总的复杂度为 $\mathcal{O}(\log_2^2 N)$ 加上有点巨大的常数，但是仍可以通过此题。

# 后言

数位 DP 加上数论真令人头疼，以前还没碰到过。