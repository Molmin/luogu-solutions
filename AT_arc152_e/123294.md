好厉害的题目。

考虑到所有点的权值异或和为 $0$，所以对于一个球 $x$，若其左侧异或和为 $L$，则其右侧异或和为 $L \oplus x$。这个形式启发我们想到求出权值序列的前缀异或和 $p_i$，则第 $i$ 个点左侧异或和为 $p_{i - 1}$，右侧异或和为 $p_i$。

两球 $i, i + 1$ 相撞时，手动模拟发现相当于从序列中删去 $p_i$。因为每个球会向较大的一侧移动，所以对于 $1 \leq i < m$，其中 $m$ 为当前序列长度也即小球数，若 $p_i \geq p_{i - 1}$ 且 $p_i \geq p_{i + 1}$ 且 **至少一个判断式不取等**（否则两个球都是 $0$，不会相撞）时，则从序列中删去 $p_i$。执行该操作直到无法继续执行。

因为 $p_0 = p_m = Z$，所以终止态有两种，一是所有数全部等于 $Z$，二是所有数全部小于 $Z$ 且单谷。对于前者，所有球静止。对于后者，谷底左侧的向左移动，谷底右侧的向右移动，球不静止。

考虑 $p_1\sim p_{m - 1}$ 的最小值 $p_{\min}$，它一定不会被删去。因此，若 $p_{\min} \geq Z$，则所有球静止，否则所有球不静止。对 $Z = 0$ 求出 $p_i$，问题转化为使得对于任意 $p_i$ 均有 $Z\leq (p_i\oplus Z)$ 的 $Z$ 的数量。考虑每个 $p_i$，若其不为 $0$，设其最高位为 $t$，则 $Z$ 的第 $t$ 位显然不能为 $1$。

设不为某个 $p_i$ 的最高位的位的数量为 $c$，则答案为 $2 ^ c$。时间复杂度 $\mathcal{O}(2 ^ n)$。[代码](https://atcoder.jp/contests/arc152/submissions/36889079)。