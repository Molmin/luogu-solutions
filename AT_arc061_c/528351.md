[传送门](https://www.luogu.com.cn/problem/AT2069)

### 分析

这题的建图非常巧妙。

发现题目要求两点之间的钱数最小值，不难往最短路方面想。

由于切换连通块一定会导致答案 $+1$，因此只要统计连通块的个数即可。最朴素的建图方式是：把连在一起的同一城市的道路两端的点放进一个连通块内，块内每个点两两之间连一条权值为 $1$ 的边。但是，这样建图边数最多可以达到 $\dfrac{n(n-1)}{2}$ 条，显然会爆空间。

考虑优化。

边数爆炸，则尝试建立虚点。对于每个连通块，建立一个虚点。把连通块内每个点和虚点连一条权值为 $0.5$ 的边。这样，任意两点都能以虚点为中转站来保持距离仍为 $1$。优化后，点的数量不超过 $n+m$，边的数量不超过 $2m$，时间、空间复杂度都 OK。

样例 $2$ 原图（边上的数是城市编号）：

![](https://cdn.luogu.com.cn/upload/image_hosting/qq1u3kgk.png)

以本样例中城市 $1$ 唯一的连通块来对比优化前后（边上的数是边权）。

优化前：

![](https://cdn.luogu.com.cn/upload/image_hosting/r69qruet.png)

优化后（$9$ 为虚点）：

![](https://cdn.luogu.com.cn/upload/image_hosting/0ecclvlb.png)

为了方便计算，将全部边权 $\times 2$ 来变成整数，最后答案再 $\div 2$ 即可。

具体流程：

1. 把每条边的两端点按城市保存在 vector 里面（省空间）。
2. 循环遍历每个出现过的城市，用并查集维护连通块，找出连通块内所有点，和该连通块的虚点连边。
3. 跑一遍最短路，得出答案。

注意：

- 对于每个不同的城市，并查集和保存虚点编号的数组都要初始化。
- 存 vector 时，可能会把同一个点放入同一个城市所对应的 vector 多次，所以需要去重。

### 代码

[click](https://atcoder.jp/contests/arc061/submissions/28663640)