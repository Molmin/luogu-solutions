[Luogu CF1765G Guess the String](https://www.luogu.com.cn/problem/CF1765G)

观察到交互器不是自适应的，$789$ 很接近 $n=1000$，且一次询问一定能确定至少 $1$ 个未知字符，于是猜测本题每次随机一种询问，一次询问尽可能地直接确定 $2$ 个未知字符。如果一次询问不能直接确定 $2$ 个未知字符，则再使用一次询问。

先使用一次询问 `1 2` 确定 $s_2$ 。

从 $s[3..4]$ 开始从左往右两个一对确定字符 $s[i-1..i]$。

随机一种询问 `op i`（$op\in[1,2]$），交互器回答 $j$。

- 若 $j≥2$，则可直接确定 $s[i-1..i]$。

若 $j<2$，看上去似乎只能确定 $s_i$，如果此时直接再使用一次询问 `op i-1`，就很容易通过构造字符串把询问次数卡到超过 $789$（e.g.串 $s$ 为 $011111\dots$）。现在的问题就在于没有充分利用已知的信息。

$s[i-1..i]:j(j\le 2)$ 与 $s[1..2],op$ 的关系如下图所示：

![](https://cdn.luogu.com.cn/upload/image_hosting/ip2o53s4.png)

- 若 $j=1$ 且 $s_2=0$，或 $j=0$ 且 $s_2=1$ 时，依然可以唯一确定 $s[i-1..i]$。
- 否则，当前只能确定 $s_i$，需要再使用一次询问 `1 i-1` 确定 $s_{i-1}$。

当 $n$ 为奇数时，$s_n$ 没有和其他字符组成一对，最后还需要单独询问 `1 n` 确定 $s_n$。

计算询问的期望次数：根据上文的分析，因为每次随机一种询问，所以一次询问直接确定 $2$ 个未知字符的概率与字符串的内容无关，概率为 $\frac{1}{2}$。$s[3..n]$ 构成约 $\frac{n}{2}$ 对，故可省下约 $\frac{n}{2}\times\frac{1}{2}=\frac{n}{4}$ 次询问。所以询问的期望次数约为 $n-\frac{n}{4}=\frac{3n}{4}$，当 $n=1000$ 时需要约 $750$ 次询问。

[详细代码见云剪贴板。](https://www.luogu.com.cn/paste/s2tsxw24)