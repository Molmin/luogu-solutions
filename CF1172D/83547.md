先不看竖着的限制，如果仅需要满足横着的限制，那么我们每次在同一列放下一个传送门，相当于交换排列的两个位置，我们要通过这种操作把一个顺序的排列变成给定的排列。这样是容易达成的，我们考虑每次将一个数换到它本来的位置，那么只需要至多 $n-1$ 次，所以我们可以将这些传送门放在不同列中。

现在加入了竖着的限制，考虑一对传送门 $(x_1,y_1),(x_2,y_2)$，它的实际意义是交换横着的排列的 $(x_1,x_2)$，交换竖着的排列 $(y_1,y_2)$。

我们希望依次将 $1\sim n$ 的位置填好，假设现在是第 $i$ 次操作，横目标排列的第 $i$ 位是 $x$，竖目标排列的第 $i$ 位是 $y$。我们先找到 $x$ 在横现在排列中的位置 $p_x$ 与 $y$ 在竖现在排列中的位置 $p_y$，然后 $(i,p_x),(p_y,i)$ 就行了，注意判掉两点相等的情况。

PS：题目中给出的排列并非目标排列，只是说某个值要在某个位置。