大无语，div2 不会 C 和 D，真就 adhocforces 了？？？

感觉 E 小于 C 和 D 啊？？？但是由于被 CD 卡了一年所以没写完 E。。。

两题遗憾离场！

言归正传，来讲下这题怎么做。

首先，由于要求出所有合法的 $(a,b)$ 的长度之和，  
所以可以枚举长度，算出合法的 $(a,b)$ 数量。

因为 $a$ 序列和 $b$ 序列的开头和结尾的数是固定的，  
我们不妨枚举在中间插入了 $i$ 个数，即序列长度为 $i+2$。

然后，由于 $a$ 序列和 $b$ 序列是单调不降的，  
所以 $a_l+b_l\not=a_{l-1}+b_{l-1}$ 这个条件就是不能同时满足 $a_l=a_{l-1}$ 和 $b_l=b_{l-1}$。

考虑得到 $a$ 和 $b$ 的差分数组 $A$ 和 $B$，则差分数组长度为 $i+1$，  
那么一组满足以下条件的 $(A,B)$ 就能得到一组合法的 $(a,b)$：

$$
\begin{cases}
\sum_{l=1}^{i+1}A_l=n\\
\sum_{l=1}^{i+1}B_l=m\\
\forall l\in [1,i+1],A_l\not=0\  \text{or}\ B_{l}\not=0
\end{cases}
$$

第一个条件和第二个条件容易插板法解决，  
第三个条件不太好直接统计，考虑容斥。

我们钦定有 $j$ 个位置满足 $A_l=B_l=0$，有 $\binom{i+1}{j}$ 种选择，  
其它位置随便分的方案数通过插板法可以得到是 $\binom{n+i-j}{i-j}\binom{m+i-j}{i-j}$。

那么插入了 $i$ 个数的合法 $(a,b)$ 数量为：$\sum_{j=0}^i(-1)^j\binom{n+i-j}{i-j}\binom{m+i-j}{i-j}$。

因为 $A_l$ 和 $B_l$ 至少要有一个不为 $0$，所以最多填 $n+m$ 个数，最后答案为：

$$
\sum_{i=0}^{n+m}(i+2)\sum_{j=0}^i(-1)^j\binom{i+1}{j}\binom{n+i-j}{i-j}\binom{m+i-j}{i-j}
$$

直接算是 $O(n^2)$ 的。

这题的时间限制与数据范围限制了我们只能用线性做法解决，考虑优化。

不妨设 $T=n+m$。

发现式子中 $i-j$ 出现得比较多，  
考虑枚举 $t=i-j$，再枚举 $i$，那么 $j$ 就等于 $i-t$。

原式通过转化得到：

$$
\sum_{t=0}^T\binom{n+t}{t}\binom{m+t}{t}\sum_{i=t}^T(-1)^{i-t}(i+2)\binom{i+1}{i-t}
$$

于是我们只需要求出 $\sum_{i=t}^T(-1)^{i-t}(i+2)\binom{i+1}{i-t}$ 的值。

先把 $(-1)^{-t}$ 提出去，然后通过组合恒等式把 $(i+2)\binom{i+1}{i-t}$ 变成 $(t+2)\binom{i+2}{t+2}$。

然后我们只需要求出 $\sum_{i=t}^T(-1)^i\binom{i+2}{t+2}$。

由于这个东西看起来没有组合恒等式，并且要对于 $t=0\sim T$ 都求出来，我们不难想到递推。

感觉这个 $(-1)^i$ 比较难搞，我们可以对于 $i$ 为偶数和 $i$ 为奇数单独计算然后相减。

设 $f(t)=\sum_{i=t}^T[i\bmod2=0]\binom{i+2}{t+2}$，$g(t)=\sum_{i=t}^T[i\bmod2=1]\binom{i+2}{t+2}$。

由于每个 $t$ 都求的是一段后缀，不难想到从后往前递推。

我们考虑如何从 $f(t+1)$ 和 $g(t+1)$ 转移到 $f(t)$ 和 $g(t)$。

我们发现，$f(t)$ 和 $g(t)$ 的每个组合数在杨辉三角上是在第 $t+2$ 列上交错的。

考虑杨辉三角上 $\binom{i+2}{t+2}+\binom{i+2}{t+3}=\binom{i+3}{t+3}$。

也就是说 $g(t)+g(t+1)=f(t+1)$，$f(t)+f(t+1)=g(t+1)$。

但是直接递推会发现少算了一项，即 $\binom{T+2}{t+2}$，加上就完事了。

递推出 $f$ 和 $g$ 后答案就是

$$
\sum_{t=0}^T\binom{n+t}{t}\binom{m+t}{t}(-1)^t(t+2)(f(t)-g(t))
$$