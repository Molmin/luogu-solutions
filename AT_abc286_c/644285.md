因为 $n\le 5\times 10^3$，所以可以使用 $O(n^2)$ 的暴力枚举。

那么考虑枚举 $A$ 操作的次数，判断需要执行多少次 $B$ 操作即可。

容易发现，执行 $A$ 操作后的字符串可以直接暴力算出来，然后使用类似于判断回文字符串的方式判断需要执行几次 $B$ 操作，求最小值即可。

然而需要特判全部执行 $B$ 操作的花费。

注意开 `long long`。