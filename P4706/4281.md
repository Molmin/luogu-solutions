　　我们发现，对于每一个数，如果以其幂指数之和为下标来将它们重新排列成一个数组，这个问题就变成了[阶梯$Nim$问题](https://www.cnblogs.com/RogerDTZ/p/9439540.html)。一次操作，相当于将一个数移动到其左边。不能移动者输。

　　事实上我们不需要实现这个重排操作。我们只需要知道每个数重排后是否在奇位置即可。

　　记输入数列为$a$，我们统计出所有处于奇位置的数$x$的$a_x$的异或和$sum$。

　　我们要统计Yopilla一开始的随机操作一共有多少种可能、以及总共有多少种可能，使得操作后局面的先手必败。前者很好计算，就是$\sum_x a_x*b_x$，其中$b_x$表示$x$这个数的不同质因子个数。

　　后者如何计算呢？对操作分类：（1）移动奇位置的数至偶位置、（2）移动偶位置的数至奇位置。

　　我们枚举所有奇位置的数。假设对该位置$i$操作后，总异或和$sum$等于0，即操作后先手必败，则$a_i$应该由$a_i$变成$target=sum\; \text{xor}\; a_i$，

　　如果原值比目标值大，那么显然（1）容易满足，选出$a_i-target$个数，并将它们通过任意一个质因子移动到偶位置，一共有$b_i$种合法情况。
  
　　如果原值与目标值相等，则什么也做不了，一改就不满足要求，不作为合法情况考虑。
  
　　若原值小于目标值，则考虑（2），枚举所有能转移到$i$的偶位置$j=i*p$（其中$p$是枚举的质数），如果$a_j \ge target-a_i$，那么合法情况就多了一种，因为$j$可以选$target-a_i$个数通过唯一一种方式——除去$p$——来到达$i$。

　　那么概率也就很好计算了。