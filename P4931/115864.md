十三个月前看到这题时，根本不会啊...  
最近在看《组合数学》，回看此题，恍然大悟。  
于是写一篇题解来纪念一下。  
顺便补充一下 EI 神仙写的简略的地方...
****
还是考虑记 $D_n$ 为 $n$ 对情侣全都不配对的方案数。  
要计算有 $k$ 对配对的方案数，那么选男女分别 $\binom{n}{k}$ 种方案。  
这 $k$ 对情侣随便排列，两排之间还可以互换，剩下的错排，所以答案为：  

$$\binom{n}{k}^2D_{n-k}2^kk!$$

把 $k \in [0,n]$ 的答案全加起来，自然是全部排列的方案数：  

$$\sum\limits_{k=0}^n\binom{n}{k}^2D_{n-k}2^kk!=(2n)!$$  
把这个式子稍微变形  

$$\sum\limits_{k=0}^n\frac{2^k}{k!}\times\frac{D_{n-k}}{(n-k)!^2}=\frac{(2n)!}{n!^2}$$  
左边这显然是个卷积式，设 $\{\frac {D_n}{n!^2}\}$ 的生成函数为 $D(x)$，那么有：  

$$\text e^{2x}D(x)= \sum\limits_{k=0}^\infty\binom{2k}{k}x^k$$
根据广义二项式可以知道右面的式子其实是  
$$\frac{1}{\sqrt{1-4x}}$$  
于是就能得到 $D(x)$ 了：  
$$D(x)=\frac{\text e^{-2x}}{\sqrt{1-4x}}$$
根据书中的套路，要求其递推式，可以把它先求个导  
$$D'(x)=8x(1-4x)^{-3/2}\text e^{-2x}$$
把 $D'(x)$ 用 $D(x)$ 表示，就能得到
$$D'(x)=\frac{8xD(x)}{1-4x}$$
$$(1-4x)D'(x)=8xD(x)$$
$$D'(x)=4xD'(x)+8xD(x)$$  
有两个显然的事实
$$[x^n]D'(x)=(n+1)[x^{n+1}]D(x)$$
$$[x^n]xD(x)=[x^{n-1}]D(x)$$
然后提取上式的系数
$$\frac{D_{n+1}}{n!(n+1)!}=\frac{4D_n}{n!(n-1)!}+\frac{8D_{n-1}}{(n-1)!^2}$$  
移项得到
$$D_{n+1}=4n(n+1)D_n+8n^2(n+1)D_{n-1}$$
$$D_n=4n(n-1)D_{n-1}+8n(n-1)^2D_{n-2}$$
对于临界条件，显然有 $D_0=1,D_1=0$。