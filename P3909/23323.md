**沙发题解！**

//注：我讲的是我的想法，正解可能有十几种

分数分为三档，显然就是为O（N³），O（N²）和O（N）的算法而设立的。

题目比较直接的给了一个O（N³）的循环的公式，直接照搬就有30分。

\_-----30分到60分的分割线-----\_

接下来要做的就是优化这个循环公式，需要用到一些小学数学：

首先A（3,3）= 6，就是最前面那个常数6的意义

举个例子，6×A1×A2×A3=A1×A2×A3+A1×A3×A2+A2×A1×A3+A2×A3×A1+A3×A1×A2+A3×A2×A1

熟悉的同学就可以发现其实就是把1,2,3给全排列了一下，刚好有3×2×1=6种

所以要想拿到60分，需要进行一个O（N²）的预处理，加上一个O（N）的统计就可以了

预处理些什么呢？

看上面的例子，其实题目就是要求所有不同的三元组元素之积的总和。

（其中三元组即有3个不同元素的组合，3个相同的元素不同的顺序也可以）

先看O（N）的统计要统计一些什么：

对于每个Ai，需要往答案累加所有不同的（Ai×Aj×Ak），其中i,j,k互不相等，i不变，j,k**无大小顺序**

根据**乘法分配律**（这个不知道那你是真的强），也就是Ai×（所有不同的Aj×Ak之和）。

所以这个也就是我们要预处理的，因为我们枚举的是i，所以我们希望在O（1）的时间内求出“所有不同的Aj×Ak之和”

然后只要想象一下，就可以发现

#“所有不同的Aj×Ak之和（j,k都不等于i）”=“所有不同的Aj×Ak之和（j,k可以等于i）”-“所有不同的Ai×Ak之和”-“所有不同的Aj×Ai之和”

因为j和k是等价的，所以最后两项相等，于是就是

#“所有不同的Aj×Ak之和（j,k都不等于i）”=“所有不同的Aj×Ak之和（j,k可以等于i）”-“所有不同的Aj×Ak之和（j=i，k≠i）”×2

所以只要用一个常数记一下“所有不同的Aj×Ak之和（j,k可以等于i）”，开一个数组s记一下“所有不同的Aj×Ak之和（j=i，k≠i）”

就可以做到空间复杂度O（N），时间复杂度O（N²）的预处理，时间复杂度O（N）的统计，拿到60分。

\_-----马上就要满分了好激动啊-----\_

其实60分优化到100分简单得让你想哭，无非就是用**乘法分配律**优化一下预处理的过程

首先看一下怎么O（N）统计“所有不同的Aj×Ak之和（j,k可以等于i）”之和：

其实就是数组s的所有元素之和。。。

由于j=i或k=i，所以i分别取值1~n，再全部相加，就是“所有不同的Aj×Ak之和（j,k可以等于i）”

那么如何O（N）写出数组s呢？换句话说，对于每个i，如何O（1）得到“所有不同的Aj×Ak之和（j=i，k≠i）”呢？

其实已经非常明显了，“所有不同的Aj×Ak之和（j=i，k≠i）”=Ai×（所有不同的Ak（k≠i）之和）。

所以记一个常数sum为整个数组的和，O（N）计算一下sum，那么

“所有不同的Aj×Ak之和（j=i，k≠i）”=Ai×（sum-Ai）

于是O（N）预处理（计算sum和s数组和s数组所有元素的和），O（N）统计，总时间复杂度O（N）

-----为什么不贴代码呢？-----

因为题解又臭又长，肯定没人会看完的。如果贴了代码，总会有一些孩子就Ctrl+C了。

为了不害了他们，我的代码没有复制在这上面。

但是我可以跟你们保证：只要你们看了题解，60分一定是写的出来的。

达到60分，就可以去评测记录里搜索我的满分代码了（洛谷有代码公开计划，如果你没有加入，快加！）

保证代码和我的题解会一一对应息息相关。

顺便提示：最好开longlong以免计算过程会爆炸，最好边算边模（否则s数组的元素之和longlong也不够），模的时候加上模数再模！（不然WA一堆）

再顺便提示：10的六次方是一百万，我拿十万的数组教了n遍都是re
