好像没用到正方形和边长相等这两个条件？

有点卡常的单 $\log$ 做法。

由于任意两个矩形的边界不交，所以只有平行于不同坐标轴的两个矩形会出现“不可分离”。

考虑一个平行于 $x$ 轴的矩形 $i$ 和一个平行于 $y$ 轴的矩形 $j$ 要满足以下三个条件才会不可分离。

- $xl_j<x_i<xr_j$。

- $yl_i<y_j<yr_i$。

- 区间 $[zl_i, zr_i]$ 和区间 $[zl_j, zr_j]$ 有交且互不包含。

$x$ 轴和 $z$ 轴，$y$ 轴和 $z$ 轴同理。

考虑建图。将可以分离的矩形之间连边，如果最后只有一个连通块就无法分成两个集合。

直接建图是 $O(n^2)$ 的，考虑优化。

由于只要求连通块数量，所以可以用并查集优化。

因为两个矩形只要有任意一个条件不满足就会连边，并且对于每个维度是独立的。所以我们可以将三个维度单独拿出来连边。

考虑对于 $x$ 轴的连边方法。$y$ 轴和 $z$ 轴同理。

- 两个平行于 $x$ 轴的矩形，一定会有连边。

- 一个平行于 $x$ 轴的矩形和一个不平行于 $x$ 轴的矩形 $j$，当 $x_i\leq xl_j$ 或 $x_i \geq xr_j$ 的时候会和矩形 $i$ 有连边。

这种情况按照区间的结尾或开头排序，然后把单点从小到大或从大到小排序，每种情况分别扫一遍即可。

- 两个不平行于 $x$ 轴的矩形 $i,j$，当区间 $[xl_i,xr_i]$ 和区间 $[xl_j,xr_j]$ 不交或包含时会有连边。

这种情况以右端点为第一关键字，左端点为第二关键字排序，再用个栈维护一下即可。

~~不知道咋描述，代码可能更清晰。~~

复杂度 $O(n\log n)$，瓶颈在排序。

[Code](https://www.luogu.com.cn/paste/sf2iok8n)