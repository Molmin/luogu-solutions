[题目传送门](https://www.luogu.com.cn/problem/CF1292C)。

[$\text{cnblogs}$](https://www.cnblogs.com/UperFicial/p/16657535.html)。

考虑增量法，枚举一个答案 $x$，它的贡献为路径 $\operatorname{mex}$ 不小于 $x$ 的路径数量。

那么我们顺次放入边权 $w=[0,1,\cdots,n-2]$。

考虑边权 $1$ 的放置，它的贡献为与边权 $0$ 形成的路径左右两侧子树大小的乘积。

我们想让收益最大，所以我们把 $1$ 放到 $0$ 相邻的位置。

而对于 $2$ 呢？要想收益最大，必须与 $1$ 和 $0$ 构成一条连续的简单路径。

这样我们以此类推。

考虑一条路径 $u\to v$，中间经过的边权形成了一个单谷序列，这个可以反证。

也就是说，对于一条路径 $u\to v$，我们在这条路径上填入一段单谷序列，最大值一定处于路径的左端点或右端点。

这样的话就可以暴力 DP 了，分讨一下最大值放在右端还是左端，之后往剩余路径上 DP。

[代码](https://codeforc.es/contest/1292/submission/170907212)。