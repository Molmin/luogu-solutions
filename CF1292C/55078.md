自从做过树上的数之后心里就埋下了对这种树上排列的题深深的恐惧。

但其实这题难度并不是特别高。

首先，我们观察出这是一个计算路径属性和的问题。做这类问题有一个普遍的方法，就是把所有路径的和转化为所有边对答案贡献的和。

这个时候就可以枚举边了。从特殊到一般来考虑。

对于边权为$0$的边，设其两端的点分别为$u$, $v$。那么显然，这条边把整棵树分成了两棵树$tr_u, tr_v$。对于任意一对$tr_u$中的点和$tr_v$中的点，他们之间的$mex$从$0$变为了$1$（因为经过了边权为$0$的边）。所以这条边对答案的贡献就是$siz_{tr_u} \cdot siz_{tr_v}$。

那么边权为$1$的边放哪儿？

我们手玩一下可以发现，放在$0$旁边一定是最优的。这很好理解。再往下，把新的边放在已经选择的边构成的链两端一定是最优的。一直到最后，放新边已经对答案没有贡献了。这时候可以随便放

但是我们不知道新边应该放哪端怎么办？

$dp$.

先枚举一手$u$, $v$。设这条边把整棵树分成了两棵树$tr_u, tr_v$。$siz[i]$为以点$i$为根构成的**子子**树的大小。$dp[i][j]$表示$u$这棵子树下的链长到了$i$，$v$这棵子树下的链长到了$j$是**还能**得到的最大和。则有$dp[i][j] = siz[i] \cdot siz[j] + max(dp[son[i]][j], dp[son[j]][i]) $

再之后类似换根DP地做就可以实现$n^2$的复杂度了。