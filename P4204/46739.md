[题目链接](https://www.luogu.org/problemnew/show/P4204)

更好的阅读体验？
[本题解同时发布于csdn](https://blog.csdn.net/CH_Vaniteux/article/details/85055971)

题意：
有t种颜色的球，最开始袋中每种颜色的小球各有a~1~, a~2~, a~3~……a~t~个。Polya抽小球**多次**，每次抽球的结果为c~1~, c~2~, c~3~……（注意，至少有n个）。每次抽出一个颜色为ci的小球后，会再放入d个颜色为c~i~的小球。
现给出n个约束条件，每个条件形如x~i~，y~i~ 
表示c[x~i~] = y~i~ 
求满足所有条件的机率

这道题乱搞是很容易搞出来的
关键就是在证明 
【小声：蒟蒻最不擅长概率题了qvq
 
 首先 如果我们只有一个约束条件c[x] = y
 考虑第x - 1步时 每个颜色有a~1~, a~2~……a~t~个小球
 
 x-1步选的颜色 | x步时的小球总数 | x步时的y球总数
 ---|---|---
 y | sum + d | a~y~ + d
 不是y | sum + d | a~y~
 
此时满足条件c[x] = y的概率显然为

$$ \frac{a[y]}{sum} * \frac{a[y] + d}{sum + d} + \frac{sun - a[y]}{sum} * \frac{a[y]}{sum + d} $$

动笔算一下 这个式子等价于$$ \frac{a[y]}{sum}$$

其实到这里 这道题就okk了
但可以更进一步
既然我们可以证明一个约束不受顺序影响
自然可以想到去证多个约束也不被影响
~~式子懒得打了 借一下yyb大神仙的orz~~
y[i] == y[i + 1]那肯定不用说
如果y[i] != y[i + 1]
$$ P1 = \frac{a[y[i]]}{sum} * \frac{a[y[i+1]]}{sum+d} $$ ​
交换之后考虑概率 
$$ P2 = \frac{a[y[i+1]]}{sum} * \frac{a[y[i]]}{sum+d} $$ ​
这样直接按照输入顺序处理就可以了

至于分数的处理
要么高精度
要么处理出它的质因数分解
对于每一个质因数 p^r1^ / p^r2^ = p^r1-r2^

 






 









