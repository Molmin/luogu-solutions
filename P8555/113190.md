先考虑 $m=1$，肯定是要求前 $n-1$ 个递增，最后一个无所谓。就是因为无所谓，导致我们判断很麻烦。不妨考虑计算非法，即前面若干个递增，最后一个非增。

拓展到 $m=2$，首先最优策略肯定是每次放弃比上一次放弃的数大的数中，最小的那个。举个例子，对于 $\{1,4,2,8,5,7,3,6,9,10\}$ 我们会依次拿出 $\{1,2,4,5,7,8\}$，然后指针指到 $\{3,6\}$ 也加进去。变成 $\{1,2,4,5,7,8,3,6\}$ 。现在我们考虑设计一个 split 方案，使得 $m=2$ 可以分裂成两个 $m=1$ 的问题，这样就可以分开算了。

考虑如下染色：我们维护指针 $t=m+1$，每次对于原序列 $a_t$ 令其颜色，等同于 $b_{t-m}$ 的颜色（$b$ 是拿出序列，前 $m$ 项各染一个颜色）。显然若 $a_t=i$ 那么 $i$ 应该在 $b$ 中出现在 $t-m$ 更靠前的位置，所以染色必然合法。于是，按照上面的例子，染色为 $\{4,5,7,3\},\{1,2,8,6\}$（标号由最后的终结位置，按顺序确定）。

可以发现，$m=2$ 的结构可以 split 成唯一两个 $m=1$ 的结构。而两个 $m=1$ 的结构可以 merge 成一个唯一的 $m=2$ 的结构（前面归并，后面按标号排序）。

一个原序列显然对应一个唯一的已经染色的拿出序列。而一个已经染色拿出序列，也可以对应恰好 $(n-t)!$ 个原序列：原序列后 $n-t$ 随意（反正非法）。因为拿出序列最后 $m$ 个已定，又因为 $a_{m+t}$ 的颜色与 $b_t$ 相同，只要倒着进行，取与 $b_t$ 相同颜色的上一个位置即可。

于是我们要算的就是 $m$ 个 $m=1$ 的子问题，有标号选择的方案数。$i-1$ 即一个大小为 $i$ 的 $m=1$ 的子问题的方案数。要算的应当是：令 $F=\sum\limits_{i\geq 1}\frac{i-1}{i!}x^i$，求 $\sum\limits_{i=m}^{n-1}i![x^i]F^i{n\choose i}(n-i)!$ 。即求 $n![x^{n-1}]\frac{F^m}{1-x}$ 。

令 $F=G^2$，于是 $G$ 的最低次项为 $x$ 。令 $H\circ G=\frac{G^{2m}}{1-x}$，于是 $H=\frac{x^{2m}}{1-G^{-1}}$ 。应用拉格朗日反演有：$[x^{n-1}](H\circ G)=\frac{1}{n-1}[x^{n-2}]H'\left(\frac{x}{G^{-1}}\right)^n$。把 $H'$ 展开就好了（用另类拉反展开简单不少）。