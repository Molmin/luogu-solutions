令 $S_i \gets S_i \oplus T_i$，那么代价中 $D$ 变成 $S_i = 1$ 的 $i$ 数量。转化为对所有 $f(S)$ 求和，最后答案乘上 $2^n$。

考虑贪心地求 $f(S)$。肯定是先选择小的 $C_i$，把 $S_i$ 变成 $0$。正确性显然。下面把 $C_i$ 从大到小排序。

考虑拆贡献。对于一个 $C_i$，考虑它一共被算了多少次。显然 $i$ 自己会贡献 $2^{n - 1}$ 次（除去 $S_i = 0$ 的情况），对于 $j < i$，因为 $C_j \ge C_i$，所以改变 $S_i$ 时 $S_j$ 必定还没被改变。有 $2^{n - 2}$ 种情况使得 $S_j = 1$，一共有 $i - 1$ 个 $j < i$ 的 $j$，所以 $C_i$ 的贡献系数就是 $2^{n - 2} \times (i - 1) + 2^{n - 1}$。

因此最后答案就是：

$$2^n \times \sum\limits_{i = 1}^n (2^{n - 2} \times (i - 1) + 2^{n - 1}) \times C_i$$

[code](https://atcoder.jp/contests/abc150/submissions/42059541)