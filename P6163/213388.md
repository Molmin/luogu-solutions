### [Cnoi2020]领域极限 官方拾遗

#### Subtask1( 20% ) : $n \le 5, r_i-l_i\le 5$ ( 暴力枚举 )

直接枚举每个每个数地取值，枚举次数小于等于 $6^5=7776$，可以轻松通过。

#### Subtask2( 20% ) : $n \le 20$ ( 随机化算法 )

数据范围比较小，使用爬山退火等随机算法都很容易得到最优解。

#### Subtask3( 20% ) : $n \le 1000$ ( 观察性质 )

考虑调整一个数的取值，且各数相对顺序未发生变化，答案的变化等于移动距离乘以该数两边数的个数的差。所以一个显然的贪心是让所有数都尽可能靠近数列的中位数。然后 $2n$ 个端点将数轴分割成 $2n+1$ 个线段，所以枚举中位数所在段即可做到 $O(n^2)$。

注意，中位数在某些段不能取得。

#### Subtask4( 40% ) : $n \le 100000$ ( 三分法 or 继承优化 or 进一步观察性质 )

**三分法** : 其它题解大多选用三分法，却没有给出正确性证明，这里补充一下。我们将离散化后的端点序列看成一个括号序列，令 $f(x)$ 表示中位数取在序列 $x$ 位置时的答案。我们可以知道 $\Delta f(x) = f(x)-f(x-1)=L_x\times ( nxt_x - pre_x )$。$L_x$ 表示 $x$ 段的长度,$pre_x$ 表示 $x$ 前的左括号数, $nxt_x$ 表示 $x$ 后的右括号数。可以知道 $\Delta f(x)$ 单调递减，所以 $f(x)$ 是凹函数。

注意，二分法是错误的，因为中位数不能在某些段取得，那些区域不具有单调性。

**继承优化** : 通过三分法中 $\Delta f(x)$ 的式子可以 $O(1)$ 的从 $f(x)$ 递推到 $f(x+1)$，然后即可 $O(n)$ 求出所有的 $f(x)$ 的值。

**进一步观察性质** : 这是 std 的做法，我自认为比上述两种做法都优秀，但是没有人写。。。

即，当 $x$ 取得括号序列的正中间时 $f(x)$ 必然最小。证明也很简单。我们将括号序列从中间切开，由于序列合法，所以左侧未匹配的左括号与右侧未匹配的右括号数相等，所以此时 $\Delta f(x)=0$ , 凹函数 $f(x)$ 有最小值，于是我们做到 $O(1)$ 确定最优的 $x$。
