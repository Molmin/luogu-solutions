题目有两种操作，分别是赋值和加。

显然如果最终操作序列有赋值的话，这次赋值操作之前的所有操作都是无效的。  
即最终有效操作序列有且仅有一个赋值操作，而且必在操作序列的第一个。

那么问题就转化为，对于原操作序列的某一个以复制操作为首的操作序列，无视其中不多于 $k$ 个加操作，能得到的最大值。

等价于：给定序列 $a$，求 $\sum\limits a_ic_i$ 最大值，其中有不大于 $k$ 个 $c_i=0$，其余 $c_i=1$。  
经典反悔贪心。

复杂度 $\mathcal{O(n\log n)}$。

细节看代码。

[$\color{green}{\checkmark}$](https://atcoder.jp/contests/abc249/submissions/39837693)