考虑将 $(x_1,y_1,x_2,y_2)$ 边界上的点转化为 $(x_1,y_1,x_2,y_2)$ 内部的点减去 $(x_1+1,y_1+1,x_2-1,y_2-1)$ 内部的点。然后这个题就变成了一道二维数点。建议使用离线树状数组做法，因为实际询问次数是 $4p$ 级别的，用别的东西容易 TLE。复杂度 $O(n \log n)$。