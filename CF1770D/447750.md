假设有值域为 $[1,n]$ 的三个序列 $a_{1\cdots n},b_{1\cdots n},c_{1\cdots n}$，两人博弈，在第 $1\leq i\leq n$ 轮中，先手从可重集 $\{a_i,b_i,c_i\}$ 中任意移除一个元素，后手在剩余两个元素中任取一个，记为 $d_i$。最终如果 $d$ 是一个排列，则后手胜。给出 $a,b$，求有多少个 $c$ 可以让后手必胜。

$n\leq 10^5$。

刚开始转化歪了，从先手移除之后的可重集怎样合法入手，发现先手移除后若剩下 $X_i,Y_i$，则连边形成的图要是基环森林后手才能赢。但是对于连通性是几乎无法刻画的，于是重新开始思考，如果给出 $a,b,c$，先手的最优策略是什么？因为“$d$ 是排列”这个限制比较紧，所以它的反面“存在一个元素不出现在 $d$ 中”是很松的，这导出了先手的一个策略：选定一个元素 $x$，在包含 $x$ 的集合中一定删除 $x$，以求最终其不出现在 $d$ 中。那么，如果对于这个 $x$，它在某个集合中出现了两次，那是无法阻止它进入 $d$ 的。

至此得到一个性质：若每个 $x$ 都在某一个集合中出现了至少两次，那么后手必胜；否则如果存在某个 $x$ 在每个集合中都只出现至多一次，则先手可以让 $x$ 不在 $d$ 中。也就是得到了后手必胜的充要条件：每个 $x$ 都在某一个集合中出现了至少两次。由于每个集合的大小是 3，$x$ 和集合的个数均为 $n$ 个，于是每个集合如果初始是 $\{x,y\}$（$x\neq y$），则可以选择添加一个 $x$ 或添加一个 $y$，即连边 $(x,y)$，要求其是基环森林才能合法，且环上有两种走法，于是对答案的贡献是 $\times 2$；特殊地，如果出现了自环，则对应集合任意添加都是可以的，对答案的贡献是 $\times n$，于是只需要并查集维护基环森林结构。$O(n\log n)$。