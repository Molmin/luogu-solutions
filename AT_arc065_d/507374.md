[in Luogu](https://www.luogu.com.cn/problem/AT_arc065_d),[in AT](https://atcoder.jp/contests/arc065/tasks/arc065_d)

~~学长竟然群体背着我卷题~~，当然可能是我没做。

$n,m\le3000$，一眼 $O(n^2)$。

考虑 DP。

我们定义 $dp_i$ 为前 $i$ 个字符有多少种情况。

我们发现此时不好转移，我们尝试增加一位。

定义 $dp_{i,j}$ 为前 $i$ 个字符，用了 $j$ 个 ``1`` 是的总情况数。

很明显，DP 方程非常容易推。

$$dp_{i,j} = dp_{i,j} + dp_{i - 1,j}$$

当 $j \ge 1$ 时，有以下转移方程：

$$dp_{i,j} = dp_{i,j} + dp_{i - 1,j - 1}$$

但是，我们发现 ``1`` 的位置不能随便移动。

我们先考虑下限。

我们希望前 $i$ 位尽量摆 ``0`` 所以先把 $i$ 到 $r_i$ 全摆上 ``1``。

所以下限就是 $\max(0,i - (maxr_i - a_{maxr_i}))$。

其中 $maxr_i$ 指第 $i$ 的数能的位置的右端点。

上限就是前面全部先摆 ``1`` 就行了。

于是上限就是 $\max(i,a_{maxr_i})$。

这题就做完了。

代码不放了自己写。