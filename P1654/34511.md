# P1654 OSU!

- - **617**通过
  - **815**提交
- **难度** **省选/NOI-**
- **时空限制**1000ms / 128MB

## 题目描述

osu 是一款群众喜闻乐见的休闲软件。

我们可以把osu的规则简化与改编成以下的样子:

一共有$n$次操作，每次操作只有成功与失败之分，成功对应$1$，失败对应$0$，$n$次操作对应为$1$个长度为$n$的$01$串。在这个串中连续的 $X$ 个 $1$ 可以贡献 $X^3$ 的分数，这$x$个$1$不能被其他连续的$1$所包含（也就是极长的一串$1$，具体见样例解释）

现在给出$n$，以及每个操作的成功率，请你输出期望分数，**输出四舍五入后保留$1$位小数**。

## 输入输出格式

### 输入格式：

第一行有一个正整数$n$,表示操作个数。接下去$n$行每行有一个$[0,1]$的实数，表示每个操作的成功率。

### 输出格式：

只有一个实数，表示答案。答案**四舍五入后保留$1$位小数**。

## 输入输出样例

### 输入样例#1：

```
3
0.5
0.5
0.5
```

### 输出样例#1：

```
6
```

# 分析

## 简化的问题

>  如果在这个串中连续的 $X$ 个 $1$ 可以贡献 $X$ 的分数。

不要告诉我答案是多少，我们要从另一个角度入手

$f_{i,1} = f_{i-1, 1}\times (1 - p_i) + (f_{i - 1, 1} + 1)\times p_i$

合并同类项？没听说过

$1$是什么, 这里是成功连接的增加分数

显然后面这一项是成功连接上前面的一所产生的期望**总分数**

但是由于$f_i$本身的定义，导致这个并不是这一串连续$1$所产生的期望增加量

如果我们要知道在**成功连接的前提下**，这一串连续$1$所产生的期望值，我们可以将答案设为$x_{i, 1}$

$x_{i,1} = (x_{i - 1, 1} + 1)\times p_i$

这个值在接下来的过程中非常有用

## 更近一步

>  如果在这个串中连续的 $X$ 个 $1$ 可以贡献 $X^2$ 的分数。

$f_{i,2} = f_{i-1, 2}\times (1 - p_i) + (f_{i - 1, 2} + something-something)\times p_i$

$somethng-something$是什么, 这里是成功连接的增加分数

首先，我们要知道，$(\alpha + 1)^ 2=\alpha ^ 2 + 2 \alpha + 1$

所以，我们设当前的长度期望值为$l$，则有

$f_{i,2} = f_{i-1, 2}\times (1 - p_i) + (f_{i - 1, 2} + 2l + 1)\times p_i$

而这个不就是上一个问题的答案吗？

$f_{i,2} = f_{i-1, 2}\times (1 - p_i) + (f_{i - 1, 2} + 2x_{i - 1, 1} + 1)\times p_i$

同样的[^1]，我们可以将答案设为$x_{i, 2}$

$x_{i,2} = (x_{i - 1, 2} +2x_{i - 1, 1}+ 1)\times p_i$

## 最终答案

同理可得[^2]：

$f_{i,3} = f_{i-1, 3}\times (1 - p_i) + (f_{i - 1, 3} +3x_{i - 1. 2}+ 3x_{i - 1, 1} + 1)\times p_i$

代码不放了

[^1]: 由于$f_i$本身的定义，导致这个并不是这一串连续$1$所产生的期望增加量, 但是我们要知道在**成功连接的前提下**，这一串连续$1$所产生的期望值

[^2]: $(\alpha + 1)^ 3=\alpha ^ 3 +3\alpha ^ 2+ 3 \alpha + 1$

