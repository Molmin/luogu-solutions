~~/bx gyr~~

### 题意

给定 $n$ 个点，$m$ 对关系 `x op y`，其中 `op` 未知，且可能为 `>`、`=`、`<`。问有多少种可能的（逻辑正确的）关系序列。

$n \le 17,m \le \dfrac{n*(n-1)}{2}$。

### 分析

先把 `=` 丢了，它太烦了！让后发现如果按照大往小连边，那么你的序列合法当且仅当它构成一个 DAG。哇，你觉得这太酷了，因为这样你就能 `dp` 了！

你考虑对一个 DAG 分层，这样你可以按照每次剥一层叶子来 `dp`。但这样显然会重，怎么办呢？你发现你会容斥！考虑一层叶子的容斥系数为 $(-1)^{sz+1}$，$sz$ 为该层叶子数，显然你选的叶子得是一个独立集。

你发现这独立集不简单，一条 `=` 的边相当于将两个点合并，那么独立集中间这个类型的边就不好处理了。但你发现，我的天啊，这不是相当于求点集中连通块的数量！于是你预处理 $sz_S$ 表示点集 $S$ 的导出子图种的连通块数量，这样就能转移了。

显然有 $dp_S=\sum_{T\subseteq S}dp_{S\setminus T}(-1)^{sz_T+1}$，复杂度 $\mathcal O(3^n)$。

### Code

提交记录：<https://atcoder.jp/contests/abc306/submissions/43448048>。

