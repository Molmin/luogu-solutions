> [**CF1027E Inverse Coloring**](https://www.luogu.com.cn/problem/CF1027E) 解题报告。

手玩几组样例发现，确定矩阵第一行和第一列后，即可确定整个正方形。

注意到，对于第一列连续的相同元素，这些位置对应的一行也都应该是相同的。这个结论放第一行上也同理。

所以对于第一行连续相同的元素和第一列连续相同的元素一定会有交，也就构成了一个子矩阵满足全部都是相同元素。

所以我们又可以得到第二个结论：最大全 `0` 或全 `1` 子矩阵的大小为，第一行最长连续元素的长度，与第一列最长连续元素的长度之积。

这样我们只需要关注第一行和第一列，但是第一行和第一列本质是相同的，所以只需要考虑第一行。

设 $f_{i,j}$ 表示考虑了前 $i$ 个元素，最长连续元素长度不大于 $j$ 的方案数，另设 $g_i$ 表示第第一行中，最长连续元素长度恰好为 $i$ 的方案数，那么显然 $g_i=f_{n,i}-f_{n,i-1}$。

考虑对于任意 $i,j$ 满足 $i\times j<K$ 我们都可以将它们对应的 $g$ 计入答案里。

$f_{i,j}$ 的转移也就很简单了， $f_{i,j}=\sum_{k=i-j}^{i-1} f_{k,j}$。使用前缀和优化就可以做到 $O(n^2)$ 了，当然在这道题中没有什么必要。