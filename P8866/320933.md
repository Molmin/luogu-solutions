[**更好的阅读体验**](https://cjmfeitveer.github.io/2023/03/20/P8866%20%5BNOIP2022%5D%20%E5%96%B5%E4%BA%86%E4%B8%AA%E5%96%B5%20%E9%A2%98%E8%A7%A3/)

大恶心思维题。

此题解以纪念我死去的 $\text{NOIP2023}$

### 思路

考虑 $k=2n-2$ 时。

发现对于每两种元素放在同一个栈内就必然会有一个栈空出。

那么我们可以将这个栈作为辅助栈。

我们假设将 $a_i,b_i$ 放在同一个栈 $i$ 内。

那么我们此时加入 $a_i$ 这张卡牌。

1. 栈顶为 $a_i$，直接加入消去即可。
2. 栈顶为 $b_i$，且仅有一张卡牌，直接加入至栈顶，无需消去。
3. 栈顶为 $b_i$，且栈底为 $a_i$，将 $a_i$ 加入至辅助栈内，消去两张卡。

这样，可以发现每一个栈内最多就两张卡，也比较容易维护。

这就是我在考场上想了两个小时的思路~~虽然四个小时硬钢T2~~。

考虑 $k=2n-1$ 时。

讲一下我考场时候的思路。

发现对于 $k=2n-2$ 时的做法对于栈的要求：

- 要有一个空栈来作为辅助栈。
- 每一个其余的栈都最多放两张卡。

然后就可以发现可以将加入序列中的第 $k$ 号卡提出，维护一下左右的序列即可。

这是我考场的大致思路，可惜没能写出来，最后交的代码~~甚至调试代码没删CE掉了~~。

现在考虑一下其实实现也不算难。

可以发现对于一个现在处在栈顶的元素，我们就必然可以直接加入消去。

那么我们找到第一个栈底的元素 $a_i$。

假设此时栈顶为 $b_i$。

那么我们对于 $k,\cdots,a_i$ 中的 $b_i$ 的个数进行分类讨论。

1. 加入 $cnt_{b_i}$ 为偶数。

    那么我们将 $k$ 放置在 $i$ 的栈顶，考虑由于 $cnt_{b_i}$ 为偶数，那么**新出现**的 $b_i$ 都会被消去，最后将 $a_i$ 加入辅助栈，直接消去即可。

    考虑现在第 $i$ 号栈任然只有两个元素，而辅助栈还是空的，符合条件。

2. 加入 $cnt_{b_i}$ 为奇数

    那么我们将 $k$ 放置在辅助栈内，考虑由于 $cnt_{b_i}$ 为奇数，那么**所有**的 $b_i$ 都会被消去，最后将 $a_i$ 加入 $i$ 号栈，直接消去即可。

    考虑现在第 $i$ 号栈变成空栈，而辅助栈只有一个元素，那么我们将 $i$ 号栈变为辅助栈，而辅助栈变为一个普通的栈，同样符合条件。

具体实现也不算太难。

[Code](https://www.luogu.com.cn/record/105349479)