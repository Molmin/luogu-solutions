首先注意到这个题 $n,m$ 比较小，但 $k,q_i$ 比较大，所以可以想到先处理好答案然后查询的时候直接二分。

考虑现在将 $q$ 固定，设边的边权为 $v_1 \le v_2 \le \cdots \le v_t \le q \le v_{t+1} \le \cdots \le v_m$ ，则不难发现 $|v_1-q| \ge |v_2-q| \ge \cdots \ge |v_t-q|$ ， $|v_{t+1}-q| \le|v_{t+2}-q| \le \cdots \le |v_m-q|$。 

然后注意到边权转换后的同侧的差是固定的，所以对于 $q$ 遍历一遍整数域，边权的大小关系只有 $O(m^2)$ 种。

然后我们就可以开心地 $\text{Kruskal}$ 了，复杂度 $O(m^3 \log m+k)$。 

另：如果把所有询问的 $q$ 用基排排序然后扫一遍可以做到 $O(k)$ 求答案，但每次二分 $O(k \log m)$ 也可以。