实际难度只有 \*2200 左右 。

值域很大，但是段数不多，可以离散化。设 $f_i(j)$ 表示到 $i$ 为止值在第 $j$ 段的概率。

可以枚举最后相同段的长度进行转移。在 $[j,i]$ 中放入 $v_{k+1}-v_k$ 个数，要求它们递减，方案数为 $\displaystyle\binom{v_{k+1}-v_k + i - j + 1 -1}{i-j+1}$，概率则除以 $[j,i]$ 之间段长的积即可。上指标很大，但是下指标不大，可以暴力计算。转移则直接把概率乘上 $\sum_{p>k} f_{j-1}(p)$。前缀和优化，最终复杂度为 $O(n^4)$。

[代码](https://www.luogu.com.cn/paste/195q438o)。事实上，预处理每次计算组合数时与上指标相关的区间积，可以做到 $O(n^3)$。