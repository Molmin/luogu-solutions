题意：

给你一个范围 $[0,d]$ 的线段。现在有 $n$ 盏灯 $m$ 个点。

对于每一盏灯，你可以选择一个 $[0,d]$ 的照明范围。一盏在 $x$ 的灯可以照亮在 $[x-d,x+d]$ 的点。

一次合法的照明定义为所有的点都至少被一盏灯照亮。

现在你有 $q$ 次询问，每次询问会给定一个整数 $f_i$，回答一次询问，你需要：

- 添加一盏灯在 $f_i$ 处。
- 计算有多少种合法的照明方式。
- 删除这盏灯。

题解：

提供一个不同的思路。

先考虑 $q=0$ 怎么做。先将 $l,p$ 排序。

有一个 $dp$ 思路，$f_{i,j}$ 表示前 $i$ 盏灯，**连续**照亮了前 $j$ 个点的方案数。为什么是连续？可能会有照亮 $1,2,...,a,a+2,...,b$ 的情况，这时就需要一盏灯将 $a+1$ 照亮，此时延伸的范围一定比 $b$ 要远，所以是对的。

这样分类讨论就可以转移了。

如果有了询问，考虑矩阵加速。相当于前缀矩阵 $\times$ 当前矩阵 $\times$ 后缀矩阵。时间 $O(nm^3+qm^2)$。

卡常：

- 循环顺序改成 ``i,k,j``
- 每个位置只在最后取一次模。
- $16\times 998244352^2$ 要用 ``unsigned long long``

[code](https://codeforces.com/contest/1728/submission/171484948)

