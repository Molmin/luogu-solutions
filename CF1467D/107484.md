$n,k$ 都是固定的，所以我们只需要考虑第 $i$ 个位置经过了多少次即可。

我们需要枚举是第几步经过的这个位置，需要一共有多少种走法在第 $i$ 步经过它。往后需要 $k-i$ 步，由于路线是可逆的，所以往前走 $i$ 步就行。如果设 $f_{i,j}$ 代表现在在 $i$ 点，走 $j$ 步有多少条路径，这个用 dp 很容易求出。那么枚举第 $i$ 步经过 $j$ 的总方案数就是 $f_{j,i} \times f_{j,k-i}$。

每次询问只需要把求好的答案修改一个点就行，很容易。