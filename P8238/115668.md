给个傻逼在线树剖做法

考虑所有人往当前所在结点的祖先上跑，那么无论是对于操作1还是操作2，只有经过结点 $x$ 及其祖先的人数有可能受到影响。

记可以经过结点 $u$ 的人数为 $a[u]$，$fa[u]$ 为结点 $u$ 的父亲。

对于操作2，分两种情况讨论。

如果是由通畅变为拥堵，设初始在结点 $fa[x]$ 的人最远能到达结点 $y$，那么 $fa[x] \to y$ 上的所有结点 $u$，$a[u] \gets (-a[x])$。

如果是由拥堵变为通畅，$a[u] \gets a[x]$ 即可。

对于操作1，只需 $a[u] \gets val$ 即可。

也就是说如果求出了初始在结点 $fa[x]$ 的人最远能到达结点 $y$。那么这些操作都可以用树剖轻松实现。

显然求 $y$ 也可以在树剖上进行。对于每个线段树结点，记录这个结点所表示的区间 $[ l,r ]$ 里，是否存在dfs序为 $i$，$i ∈[l,r]$ 的结点 $u$，$u \to fa[u]$ 的这条边是拥堵的。往上跳的时候线段树上二分即可。

总时间复杂度 $O(n\log^2n)$，比离线做法难写的多。。