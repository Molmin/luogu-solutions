CF1731F Function Sum 题解。

枚举所有能枚举的东西，可以得到一个式子。

$$\sum_{p=1}^n\sum_{i=0}^{p-1}\sum_{j=i+1}^{n-p}\sum_{w=1}^k w{p-1\choose i}(w-1)^i(k-w+1)^{p-1-i}{n-p\choose j}(k-w)^jw^{n-p-j}$$

即选择 good 的位置 $p$，枚举左边比其小的个数 $i$ 和右边比其大的个数 $j$，分别分配位置和值。

这个式子最大的问题是枚举了 $w$。那么尝试将 $w$ 提到外面。观察发现所有的二项式系数都与 $w$ 和 $k$ 没有关系，而指数都是关于 $n$ 的。发现如果将其看成一个关于 $k$ 的函数 $f(k)$，则其次数最多为 $n+1$。

因此暴力算出前 $n+2$ 项后插值即可。