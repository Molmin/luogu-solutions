$update$：补上了打表代码

[题目链接](https://www.luogu.com.cn/problem/P1662)

### 更优美的暴力——分段打表

校内模拟赛遇到了这题，感觉难度不大但是全机房只有我一个AC......这篇题解将通过我考场上的解题思路介绍分段打表，希望能让大家有所收获qwq

题意不难理解，数据范围比暴力略大，作为数论题似乎又太小了，暂且往数论方向考虑

暴力搞出 $100$ 以内的情况，看不出明显的规律，对于 $10^8$ 以上数论题常用的矩阵乘法之类的也显然不行，折腾几分钟无果（赛后查 $\text{OEIS}$ 确实没有公式~~虽然大多数题都没有~~）

注意到参与报数的人数是固定的，也就是说每一个数字所对应的位置不会改变，简直是为打表而生（~~我觉得这太野蛮了~~，为了更好地提高自己的水平，还是建议大家在模拟赛时有更好的解法就不要想打表）

$10^9$ 不算太大，暴力跑大概 $20s$，在本机全部打出来，贴进代码，提交

![](https://cdn.luogu.com.cn/upload/image_hosting/o241flng.png)

很多 $\text{OJ}$ 的代码长度限制都是 $100k$，超过这个长度直接 $\text{CE}$，$OI$ 赛制下一定要注意打表代码是否超限，有时候只能放弃部分分以确保小数据范围能拿下，~~打表不规范，爆零两行泪~~

进一步想到，本题中每一个次报数的位置都是从上一个位置转移来的，如果知道当前位置，不需要更早的报数情况，也能推出之后的位置，所以只要记录一些关键位置，就可以在时限内跑出答案，每隔一定距离存储一个结果，大大缩短了代码长度

这就是分段打表的主要思想：**通过打表预处理某些数据，并根据已有数据得到全部所需信息**

从推导过程中不难发现，分段打表主要适用于**当前状态可由前一个或几个状态转移而来**的题目，比如斐波那契数列，通过牺牲时间换取更优的空间和代码长度 ~~话说打表的时间算什么牺牲啊喂~~

分段打表并不难，只要知道这一思想，基本可以暴切所有同类题目，但是在不了解的时候要独立搞出来也不容易，考场上我就是在知道分段打表的情况下才想到正解的

本题打表间隔使用 $10^6$ 或 $10^7$ 均可，因为时间压力不大，保险起见用了 $10^7$

打表部分：

```cpp
	freopen("ans.txt","w",stdout);
	dir=pos=1;
	printf("{0,1},");
	for(register int i=2;i<=1000000000;++i){
		pos+=dir;
		if(pos==1338) pos=1;
		else if(pos==0) pos=1337;
		if(i%7==0) dir*=-1;
		else{
			tmp=i;
			while(tmp){
				if(tmp%10==7){
					dir*=-1;
					break;
				}
				tmp/=10;
			}
		}
		if(i%10000000==0){
			printf("{%d,%d},",pos,dir);
		}
	}
```

AC代码：

(第一维是当前位置，第二维是报数方向，$1$ 表示从前往后，$-1$ 表示从后往前)

```cpp
#include<cmath>
#include<cstdio>
#include<cstring>
#include<iostream>
#include<algorithm>
using namespace std;

int n,ans,dir=1,tmp;
int arr[105][2]={{0,1},{117,-1},{522,-1},{1161,1},{887,1},{156,-1},{364,-1},{841,1},{841,-1},{1246,-1},{548,1},{274,1},{880,-1},{1088,-1},{228,1},{345,-1},{750,-1},{52,-1},{52,1},{658,-1},{866,-1},{6,1},{123,-1},{528,-1},{1167,1},{893,1},{162,-1},{370,1},{370,1},{487,-1},{892,-1},{194,1},{1257,1},{526,-1},{734,-1},{1211,1},{1328,-1},{396,1},{396,-1},{670,-1},{64,1},{1193,1},{716,-1},{599,1},{194,1},{892,-1},{1166,-1},{560,-1},{560,1},{83,-1},{1303,1},{898,1},{259,-1},{533,-1},{1264,1},{1056,1},{579,-1},{462,-1},{462,1},{1160,-1},{97,-1},{828,1},{620,1},{143,-1},{26,1},{958,1},{319,-1},{593,1},{593,-1},{801,-1},{1278,1},{1278,1},{1278,1},{1278,1},{1278,1},{1278,1},{1278,1},{1278,1},{1278,1},{1278,1},{1278,-1},{215,-1},{946,1},{738,1},{261,-1},{144,1},{1076,1},{437,1},{437,-1},{1168,1},{960,1},{483,-1},{366,1},{1298,1},{659,-1},{933,-1},{327,1},{119,-1},{119,-1},{2,1},{934,1}};

inline bool pd(int x){
	if(x%7==0) return true;
	tmp=x;
	while(tmp){
		if(tmp%10==7) return true;
		tmp/=10;
	}
	return false;
}

int main(){
	scanf("%d",&n);
	tmp=n/10000000;
	ans=arr[tmp][0],dir=arr[tmp][1];
	for(register int i=tmp*10000000+1;i<=n;++i){
		ans=(ans+dir+1337)%1337;
		if(pd(i)) dir=-dir;
	}
	printf("%d",ans ? ans : 1337);
	return 0;
}

```

欢迎来[我的blog](https://www.luogu.com.cn/blog/138812/#)看看