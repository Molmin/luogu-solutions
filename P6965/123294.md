*[P6965 [NEERC2016] Binary Code](https://www.luogu.com.cn/problem/P6965)

一个字符串至多含有一个问号，所以状态至多有两种，考虑 2-SAT，设 $x_i$ 表示第 $i$ 个字符串的问号填 $0$，$\lnot x_i$ 表示第 $i$ 个字符串的问号填 $1$。现在我们有 $2n$ 个字符串和 $2n$ 个文字，它们之间一一对应。

容易发现，若字符串 $s$ 是 $t$ 的前缀，则若 $s$ 对应文字为真，则 $t$ 对应文字为假；若 $t$ 对应文字为真，则 $s$ 对应文字为假。这说明若 $s$ 则非 $t$，若 $t$ 则非 $s$。

刻画前缀关系的结构是字典树。对于若 $s$ 则非 $t$ 的限制，我们需要从 $s$ 向它的子树内所有字符串的 **否定** 连边。对于若 $t$ 则非 $s$ 的限制，我们需要从 $t$ 向它的祖先对应的所有字符串的 **否定** 连边。因此，建出根向字典树和叶向字典树。在两棵字典树上，每个字符串对应的状态向它对应文字的否定连边。为防止出现 $s$ 和 $t$ 对应同一字符串的情况，在叶向字典树上，$s$ 对应文字只能向它对应状态的两个儿子连边，否则 $s$ 会向 $s$ 的否定连边，导致必然无解。同理，在根向字典树上，$s$ 对应文字向它对应节点的父亲（而非它本身）连边。

我们还要处理 $s = t$ 但对应不同字符串的情况。容易发现，将相等的字符串排成一行，每个字符串会向所有除了它本身的其它字符串的 **否定** 连边，可以通过前缀后缀优化建图做到。

综上，点数和边数关于 $n$ 和字典树大小 $m$ 线性。点数不超过 $4n + 2m$，而 $m \leq 2n$，所以点数不超过 $8n$。[代码](https://codeforces.com/gym/101190/submission/178906838)。