- [CF1503E 2-Coloring](https://www.luogu.com.cn/problem/CF1503E)

---

看到这种条件计数题，可以思考一下什么样的图形符合条件。

画一画图发现，不可能有 $\le 3$ 个黄色的分开部分，否则就会有一行多个蓝色块。

并且不可能黄色全连通并且蓝色也全连通。

---


假设现在统计黄色的两个部分分开的方案数。

这时候就需要多画图，找出符合条件的情况。不要被题面图限制了思维而少数了一些情况（

情况如下，这是左边黄色块在右边黄色块下面的情况。也可以在上面，只要把答案乘上 2 。

![](https://cdn.luogu.com.cn/upload/image_hosting/g0fcildn.png)

如何计算个数？

考虑枚举中间那条虚线的位置，再枚举 2 个红点的位置，计算符合条件的黄色块边界数量。

这个可以通过 4 个角到某几个点的路线方案数乘起来计算，路径方案数显然是组合数。

见下图：（注意细节，由于枚举的是右上角，左下角，所以最后一步的方向是确定的。）

![](https://cdn.luogu.com.cn/upload/image_hosting/4pzpdaa6.png)

这样枚举是 $O(n^3)$ 的，前缀和优化就是 $O(n^2)$ 了。

还要计算蓝色两块分开的方案数，直接交换 $n,m$ 算就行了。

然后就会发现算重了，蓝色、黄色都分开的重复算了。

其实很好处理，在算蓝色的时候强制让两个红点相差 $\ge 1$ 即可。

有一点点细节，画画图就会了。

[代码](https://www.luogu.com.cn/paste/7fzkp1yk)

画图不易，求赞qwq（