[更好的阅读体验（我要进来咯！！！）](https://www.cnblogs.com/dysyn1314/p/14163636.html)

# CF1458C Latin Square

[题目链接](http://codeforces.com/contest/1458/problem/C)

## 本题题解

发现 $\texttt{RLDU}$ 和 $\texttt{IC}$ 是完全不同的两类操作，将它们同时维护很困难。

本题的突破口是：初始时的每个格子，最终都会恰好对应答案里的一个格子。于是我们拆开来考虑每个格子对答案的“贡献”。

把一个格子看成三元组 $(i,j,a_{i,j})$，考虑一次操作会对这个三元组产生什么样的影响：

- $\texttt{R}$：$(x, y, z) \to (x,y + 1, z)$。注意，这里的加法是在 $\bmod n$ 意义下的，下同。
- $\texttt{L}$：$(x, y, z) \to (x, y - 1, z)$。注意，这里的减法是在 $\bmod n$ 意义下的，下同。
- $\texttt{D}$：$(x, y, z) \to (x + 1, y, z)$。
- $\texttt{U}$：$(x, y, z)\to (x - 1, y, z)$。
- $\texttt{I}$：$(x, y, z)\to (x, z, y)$。即交换 2, 3 两项。
- $\texttt{C}$：$(x, y, z)\to (z, y, x)$。即交换 1, 3, 两项。

发现转化后，这 $6$ 种对三元组进行的操作，是“可合并”的。

具体地，我们遍历要进行的 $m$ 个操作，就能预处理出：依次进行这些操作后，任意一个初始三元组会产生什么变化。

然后枚举每个格子，将预处理出的变化作用于这个格子上，就能知道这个格子最终对答案的贡献是什么。

时间复杂度 $\mathcal{O}(m + n^2)$。

## 参考代码

[小夫，我要进来咯！！！](https://www.cnblogs.com/dysyn1314/p/14163636.html)
