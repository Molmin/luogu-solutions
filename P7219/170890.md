比较直接的做法是笛卡尔树套线段树合并。但还有更简单的做法。

尝试贪心。先按行从小到大扫描。下文中的冲突均指**与下方星星**的冲突。

假设已经得出了前 $x-1$ 行的局部最优解，准备插入位于第 $x$ 行的一颗星星 $i$。

显然有两种决策。

- 不选。产生 $c_i$ 代价。
- 选。此时所有**已经选了但是会产生冲突**的星星不能选，产生若干代价。

最优决策一定在这两者之一，否则会与局部最优解的前提冲突。

考虑如何维护冲突。

对于星星 $i$，会与其产生冲突的星星 $j$（不妨设 $y_i<y_j,\ x_j<x_i$）满足
$$
\min_{k=y_i}^{y_j}h_k<x_j
$$
会**被 $j$ 影响**的 $i$ 落在一个区间内。可以用并查集维护**开区间**的左右端点。

对于冲突点点权和，需要支持区间加、单点查询，可以使用树状数组维护。

还有这应该不是反悔贪心……树状数组修改时减去一个值表示冲突点不再被选中，不是所谓的反悔。