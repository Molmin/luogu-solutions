一道很妙的题。

我们考虑肯定存在一种最优的走法是让某一条边变成连接 $1$ 和 $n$ 然后走这条边。因为如果这不是最优的，那么这条路径上必然存在另一条更短的边，那我们换成用这条更短的边走就行（用这条短边肯定好过用原来那条长边）。

于是问题就变成让一条边两个端点在图上走，可以走自己，（分别到达 $1$ 和 $n$ 的步数 $+1$）乘以边权的最小值。

设两点 $u,v$ 最短路为 $dis_{u,v}$，这里的图是原图把所有边权改成 $1$ 后得到的图。然后分类讨论一下每条边 $(x,y)$：

- 两个端点分别直接走到 $1$ 和 $n$，即 $\min(dis_{x,1}+dis_{y,n},dis_{x,n}+dis_{y,1})$。

- 枚举中间点 $k$，一个端点走到某个中间点 $k$，然后另一个端点走自己这条边使得两个点都在 $k$ 上然后分别走到 $1$ 和 $n$，即 $\min(dis_{x,k}+1+dis_{k,1}+dis_{k,n},dis_{y,k}+1+dis_{k,1}+dis_{k,n})$

我们跑一下 floyd，然后枚举每条边求一下答案即可。$O(n^3+nm)$。

[代码](https://www.luogu.com.cn/paste/m11ef56k)。