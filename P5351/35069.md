$Ruri\ Loves\ Maschera$ 题解

这是 $Owen$ 自己出的。。。虽然超级像原题，但是是原创。。。

不少于 $L$ 条且不多于 $R$ 条的话可以想到点分治。我们在点分治记录两个值，一个是深度 $dep$，一个是该点到重心的最大值 $Max$。现在考虑怎么合并两个最大值。

我们先不管路径条数的限制。有 $n$ 个价值 $a_1\leq a_2\leq ...\leq a_n$，现在求 $\sum_{i=1}^{n}\max(a_i,v)$。

先找到一个数 $k$，使得 $a_k\leq v,a_{k+1}>v$。$[1,k]$ 的贡献为 $v\times k$，$[k+1,n]$ 的贡献为 $\sum_{i=k+1}^{n}a_i$

那么我们再加一维深度，对于每个点，只有  $L-dep_a\leq dep_b\leq R-dep_a$ 的值会对其产生贡献。所以我们将其转化为二维偏序问题，一维 $sort$ 一维用树状数组维护，时间复杂度 $O(n\log^2 n)$