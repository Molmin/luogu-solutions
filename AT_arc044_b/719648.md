## 思路概述

考虑构造合法的无向无重图。对于一个合法图，对于 $1\le i \le n$，$1$ 到 $i$ 的最短距离必为 $A_i$。由于边的长度都是 $1$，这等价于“在 $1$ 到 $i$ 的最短路径上放置恰好 $A_i$ 条边”。即使我们想放多条边也没法，因为如果某两个节点之间只需要 $d$ 条边，我们至少也要标记其中的一条路径，而这时候已经只能放一条边了。

因此，从 $2$ 开始考虑每个点，它和前面的点（包括 $1$）可以连边，也可以不连。如果它和前面某个 $j$ 连了边，则距离就会减小 $|i-j|$；没有连边则距离不变。那么可以设计出状态 $f(i,j,d)$ 表示正在处理第 $i$ 个顶点，前面最后一个顶点是 $j$，当前到 $1$ 的距离为 $d$，有哪些解。最后答案就是 $\sum_d f(n,*,d)$ 的和。我们设 $T=\sum_{d=0}^{n-1}f(n,*,d)$，最终答案就是 $T^n$。这里“$*$”表示这个位置可以填任何数字。

但是这个状态有 $O(n^3)$ 个，不能直接转移。考虑优化状态。我们观察到一个特殊的实现方法：第三维只有 $<\log n$ 个取值（因为 $d\le n-1$）。因此我们将第三维二进制拆开，$d=\sum_{k=0}^{\lfloor \log_2 n \rfloor} 2^k d_k$，那么就有状态 $f(i,j,d_0,\ldots,d_{\lfloor\log_2n\rfloor})$ 表示过程同上面一样，但是保留每个 $d_k$ 的信息。

将这个状态插入算法 Floyd-Warshall 中或许能够发现出其与多次矩阵乘法的联系，然后考虑此题中的特点再予以加速。

时间复杂度 $O(n^2\log n\log T)$。

标程将状态压缩到 $10$ 位二进制，常数小很多。