吐槽：我真的很佩服自己的乱序做题技能。VP 结果如下：
![VP Standings](https://cdn.luogu.com.cn/upload/image_hosting/q6gojen4.png)

好，进入正题。

这是一道数论题。我们首先手玩几组数据。下面，我们使用 $[a_1, a_2, \ldots, a_n, (a_1)]$ 的格式表示一个环。

- $6$

	注意到 $6 = 2 \times 3$。 因此一种构造方法是 $[2, 3, 6, (2)]$。需要一次操作把它变成 $[2, \text{\color{green}6}, 3, 6, (2)]$。容易知道这是最好的方法。
    
- $18$

	构造为 $[2, 4, 6, 3, 9, 18, (2)]$。不需要任何操作。
    
- $22$

	构造为 $[2, 11, 22, (2)]$。需要一次操作变成 $[2, \text{\color{green}22}, 11, 22, (2)]$。
    
- $24$

	构造为 $[2, 4, 8, 12, 6, 3, 24, (2)]$，不需要操作。
    
…………

我们可以发现这样的规律：

**猜想：** 如果一个合数可以写成 $p_1p_2$ 的形式，其中 $p_1, p_2$ 是素数（下同），那么我们就需要一次操作。否则，我们不需要操作。

下面，我们构造地证明这个猜想：

**证明：** 

首先定义大于 $1$ 的因数为*非平凡的*，令 $n$ 的非平凡因数集为 $S$。令 $P$ 为素数集。先考虑 $n = p_1p_2$ 的情况。

此时，$n$ 恰有三个非平凡的因数，它们是 $p_1, p_2, n$。

又因为 $p_1, p_2 \in P$，因此必然有 $\gcd(p_1, p_2)=1$。

注意到无论如何排列这三个因数，$p_1,p_2$ 必定是相邻的。因此，我们必须使用恰好一次操作，在 $p_1, p_2$ 之间插入 $\operatorname{lcm}(p_1, p_2)$ 来满足题意。

猜想的第一部分得证。

再考虑另外一种情况，利用算术基本定理我们有

$$n=\prod^{k}_{i=1}p_i^{\alpha_i},\qquad\forall 1\le i \le n, p_i \le p_{i+1}$$

此时，不难得到
$$\forall x,y \in S, \gcd(x, y)=1 \Leftrightarrow x, y \in P$$

进而，我们可以按照如下方法得到一个符合要求的构造：首先，写下 $n$ 的所有的素因子 $p_{1 \ldots k}$。接着，$\forall 1 \le i \le k$，在 $p_i, p_{(i+1) \operatorname{mod} k}$ 间插入 $p_ip_{i+1}$。最后，对于其他未使用过的数 $x$，我们将其插在 $p_i$ 和 $p_ip_{(i+1) \operatorname{mod} k}$ 之间，其中 $i$ 为满足 $1 \le i \le k, p_i \mid x$ 的最小 $i$。

不难知道，这样的构造符合题目的要求，因此，此时不需要任何操作。

至此，猜想得证。证完。

利用上面的推导，不难写出[代码](https://codeforces.com/contest/1419/submission/93407171)。