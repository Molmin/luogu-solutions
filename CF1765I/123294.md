直接 BFS，复杂度高达 $8\times 10 ^ 8$，无法接受。

注意到行数很少，这样斜向攻击只会影响到半径为 $8$ 的列邻域。而对于横向攻击，我们可以把一段每行被攻击状态相同的列缩成一列，相当于离散化。注意国王可以斜向走，所以两侧还要保留 $8$ 列。

离散化后模拟得到每个格子是否被攻击，跑最短路即可。时间复杂度 $\mathcal{O}(n\log n)$。[代码](https://codeforces.com/contest/1765/submission/185486952)。