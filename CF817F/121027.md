虽然区间范围很大，但是我们观察到有效的只有 $O(n)$ 个，那么可以假设 $l,r$ 的范围只有 $2n$，然后搞一个动态开点或者离散化下就随意了。

那么维护计数器可知 $1,2$ 操作就是区间覆盖，$3$ 操作是区间 $\oplus$，打上两个标记就可以了。

询问操作就是找出 $\min\{x|c_1=\dots =c_x=1\}$，那么在线段树上二分就可以了。

复杂度是 $O(n\log n)$ 的。