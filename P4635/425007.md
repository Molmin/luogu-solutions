给个无脑线段树做法。

首先对于区间加显然可以用线段树维护。

合并区间首先需要两个子区间的答案加起来，因为合并区间时中间会有两个数相邻（左区间最右端的数和右区间最左端的数），因此我们还需要维护每个区间最左边和最右边的数，合并答案时只需要比较两个数大小关系决定区间答案是否 $+1$ 就行。

现在只剩下一个问题：如何在区间加时维护区间答案？

首先一个显然的结论：区间加 $x$ 和区间加 $x\bmod p$ 没有本质区别，因此可以限定 $x$ 的值域为 $[0,p-1]$。

考虑在区间加 $x$ 前后哪些大小关系会发生变化，易得只有在相邻两个数 $a,b (a\gt b)$ 中，$a+x\ge p$ 且 $b+x\lt p$ 时才会变化，此时修改过后的 $a'$ 一定小于 $b'$ 。

继续考虑该性质，可得出结论：区间加至多只会让区间答案变化 $1$。
![kjfkdsfds.png](https://s2.loli.net/2022/07/05/B943GTjs1SwEcZy.png)

如上图，此时红色部分区间加后 $\leq p$，蓝色部分区间加后 $\gt p$，红色部分和蓝色部分交界处会对答案有影响。由于红蓝部分是交替的，因此区间加之后对答案的贡献也是 $+1,-1,+1...$ 交替，结论成立。

因此我们只需要讨论区间答案的变化情况，容易发现这和区间两端的数在区间加后和 $p$ 的大小关系有关，而与中间的数无关。

做完了。

总时间复杂度 $O(n\log n)$。（假定 $n,m$ 同阶）



