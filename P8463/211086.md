将所有线段按纵坐标从小到大排序，用一棵线段树维护掉到每个位置对答案的贡献。初始全部为 $1$。

对于排好序的每条线段，我们先分别询问线段两个端点处的贡献值，然后把这整个线段所覆盖的区间赋值为两个端点处贡献值之和。

最后对于每个点都相当于单点查询，答案累加即可。

所用到的操作只有区间修改和单点查询，你可以用你喜欢的数据结构维护。