题意：

给定一个由 $n$ 个 `(` 与 $n$ 个 `)` 组成的括号串，求出最少翻转多少个区间可以使得整个括号串合法，并构造一组方案。

$1\le n \le 10^5$

做法：

一个做括号串很典的想法，把 `(` 记为 $+1$，把 `)` 记为 $-1$，我们可以从一个括号序列得到一张折线图。

![](https://cdn.luogu.com.cn/upload/image_hosting/0ehk78i7.png)

若要使一个括号串合法，那就需要保证，在折线图中不能出现小于 $0$ 的点。所以我们的目标便是将所有小于 $0$ 的点翻上来。翻转的方式是关于一个点中心对称。那么我们就要找到这个中心对称点。

我们可以证明，这个次数最多不会超过 $2$ 次。

设我们翻转的左端点在折线图中坐标为 $(X_L,Y_L)$，右端点在折线图中坐标为 $(X_R,Y_R)$，通过手玩不难发现，中心对称点的坐标为 $(\frac{X_L+X_R}{2},\frac{Y_L+Y_R}{2})$。

每次翻转的时候，肯定是一部分高于中心对称点的点翻下去，低于中心对称点的点翻上去。我们不希望答案更劣，所以我们要让上面翻下去的尽可能小。其中原先高度最高的反转后高度肯定最低，只需要考虑它即可。

设最高点位置 $(X_{\max},Y_{\max})$ ，中心对称后的坐标为 $(X_{\min},Y_{\min})$。

![](https://cdn.luogu.com.cn/upload/image_hosting/5wyl5dp7.png)

根据初中数学的中点式子，我们不难列出下列等式：

$\frac{Y_{\max}+Y_{\min}}{2}=\frac{Y_L+Y_R}{2}$

得到 $Y_{\max}+Y_{\min}=Y_L+Y_R$

又因为翻转后点位置不能小于 $0$，所以最劣情况为 $Y_{\min}=0$。

得到 $Y_{\max}=Y_L+Y_R$ 时，达到最劣情况，若此时$Y_{\max}$ 继续增大，翻转点将会 $<0$。

所以我们可以找到折线图中的最高点，设为 $P$，将 $[1,P]$ 和 $[P+1,2n]$ 翻转，这样就可以保证操作次数 $\le 2$。

因为题目保证给定的是一个左括号和右括号相等的字符串，所以在 $1$ 和 $2n$ 的位置一定是 $0$。根据 $Y_{\max}=Y_L+Y_R$，因为折线图最高点为 $P$，所以区间内不存在一个位置高于 $P$。

注意特判一开始没有一个点低于 $0$，和一次翻转就能解决的情况。