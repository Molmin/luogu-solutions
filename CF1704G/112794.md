这个形如 $+1,-2,+3,...$ 的操作比较复杂，我们考虑简化它。考虑下面这个变换：

- 对序列 $x=(x_1,...,x_m)$，定义 $\operatorname{M}x=(x'_1,...,x'_m)$ 为对 $x$ 进行一次 $\operatorname{M}$ 操作的结果，其中：
- - $x'_1=x_1,x'_2=x_2$。
  - $x'_i=x_{i-2}+2x_{i-1}+x_i(3\leq i\leq n)$。
  
设计这个变换的缘由是：如果我们对某个 $i\geq 3$ 执行了题目中所给的操作，那么对 $\operatorname{M}x$ 的影响只是给 $(\operatorname{M}x)_i$ 加了 $1$。读者可以自行验证。另外显然可知：序列 $a,b$ 相等当且仅当 $\operatorname{M}a,\operatorname{M}b$ 相等。

考虑去判定能否将原序列 $a$ 的某个区间 $[l,r]$ 变为 $b$（其中$r-l+1=m$）。考虑在原序列每种操作对 $\operatorname{M} a_{l...r}=(t_1,...,t_m)$ 的影响。下面用 $i$ 表示操作位置。记 $\operatorname{M}(b_1,...,b_m)=(s_1,...,s_m)$。

- $i > r$：无影响。
- $l+2\leq i\leq r$：将 $t_{i-l+1}$ 加 $1$。
- $i\leq l+1$：$t_1$ 加上 $(-1)^{l-i}\times(l+1-i)$，$t_2$ 加上 $(-1)^{l+1-i}\times (l+2-i)$。

注意到对 $i\geq 3$，我们只能通过操作 $i+l-1$ 来影响 $t_i$。这要求对每个 $i\geq 3$，$t_i=s_i$ 或 $t_i+1=s_i$。同时，在满足了这些条件之后，我们便可以不管 $t_3\sim t_m$ 了。我们着重来讨论 $t_1,t_2$。

考虑我们在 $[1,l+1]$ 内选了哪些位置。方便起见，对每次在位置 $i$ 的操作，设 $x=l+2-i$。这么做的好处是，能大大简化我们的计算和表述。现在我们考虑来选 $x$ 而不是选 $i$。$x$ 的范围也是 $[1,l+1]$，且选一个 $x$ 意味着：

- $x$ 是奇数：$t_2$ 加 $x$，$t_1$ 减 $(x-1)$。
- $x$ 是偶数：$t_2$ 减 $x$，$t_1$ 加 $(x-1)$。

则可知原问题等价于：在 $[1,l+1]$ 的全体奇数中选一个集合 $O$，全体偶数中选一个集合 $E$，使得 $|O|-|E|$ 是一个给定值，且 $O$ 的元素和减去 $E$ 的元素和是另一个给定值。

考虑这样一个问题：假如已经确定 $|O|=a,|E|=b$，构造一组 $(O,E)$ 使得 $O$ 的元素和减 $E$ 的元素和为某个给定值。注意到我们可以选择 $[1,l+1]$ 中的最大的 $a$ 个奇数和最小的 $b$ 个偶数，来得到一个最大的差；也可以反过来，得到一个最小的差。则：全部在这个最小差和最大差之间的、且和最小差同奇偶性的整数全都能表示出来。（这是因为我们可以每次挪动 $E$ 或 $O$ 中的一个元素，让其增大 $2$ / 减小 $2$。）

回到原问题。不妨设 $|O|=a$，可以解出 $a$ 的范围，判断范围里是否有奇偶性符合的即可。

------------------

最后我们来看看怎么快速处理全部区间。$t_1,t_2$ 单次的计算是 $O(\log n)$（或 $O(1)$）的，无需担心。我们只需要看看怎么快速处理 $t_3\sim t_m$ 的匹配问题。注意到对于两个整数序列 $a_1,...,a_n$ 和 $b_1,...,b_n$，以下两个条件等价：

- 对每个 $i$，$b_i=a_i$ 或 $b_i=a_i+1$。
- $\sum_{i=1}^n(b_i-a_i)(b_i-a_i-1)=0$。

将下面的式子拆开，FFT 即可。总时间复杂度 $O(n\log n)$。

**后记**

怎么感觉这题是一点一点拼出来的……