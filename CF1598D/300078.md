**标签** 补集思想，组合计数

**解法** 考虑问题的对立面，就是选出来的三组是这样的格式：选出来的 $(a_1,b_1),(a_2,b_2),(a_3,b_3)$ 恰好有一组 $a$ 相同、一组 $b$ 相同。这个怎么求？一个形象的思考方式是将每一个二元组 $(a_i,b_i)$ 看做 $n+n$ 的二分图中由左边的 $a_i$ 节点连向右边的 $b_i$ 节点的一条无向边，则所求的就是所有长度为 $3$ 的链的条数。为方便叙述，我们记这三条边为 $(e_1\Leftrightarrow  e_2\Leftrightarrow e_3)$，我们考虑枚举中间的 $e_2:u_0\leftrightarrow v_0$，由乘法原理， $(e_1\Leftrightarrow  e_2\Leftrightarrow e_3)$ 有 $(d_{u_0}-1)(d_{v_0}-1)$ 种选择，其中 $d_p$ 表示点 $p$ 的度。由加法原理，答案即为所有 $e_2$ 的答案之和。综上，答案为
$$
C_n^3-\sum_{i=1}^n (d_{a_i}-1)(d_{b_i}-1)
$$

**代码** [剪贴板](https://paste.ubuntu.com/p/sJbqWBzptp/)