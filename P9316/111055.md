妹子 OI 简单题，他一定会做。

假设每个人的连边都已经确认了，如何计算答案？

首先如果我们知道在第 $1,2,\cdots,n$ 轮之后各有 $f_1,f_2,\cdots,f_n$ 种没结束的方案，我们显然可以算出游戏在第 $i$ 轮结束对应的方案数为 $f_i2^{n-i}-f_{i+1}2^{n-i-1}$。

于是只需要尝试计算 $f_i$，考虑一棵树的贡献为点数，一棵基环树的贡献为 $2$，剩下的联通块贡献都是 $0$。

然后一次操作显然也就只能做这些事情：

- 合并两棵树。
- 合并一棵树和一棵基环树。
- 把一棵树变为一棵基环树。

那状态设计就非常简单了，将所有树的大小作为无序集合列出，再加上没选的边的数量和基环树的数量，状态一共只有 $\sum P(i)(n+1-i)$ 个，可以接受，暴力枚举转移即可。