[题目传送门](https://www.luogu.com.cn/problem/CF1462E2)

观察到极差和数组顺序是无关的，所以题目中子序列的要求其实是假的。

然后我们把 $a$ 数组排序，对每一个 $i$ 枚举当 $a_i$ 为最小值的贡献。观察到当左端点 $i$ 固定时，如果 $j$ 是一个满足条件的右端点，那么 $(i, j)$ 中的点也必定是满足条件的最大值，我们可以在 $a$ 中二分出 $a_i + k$ 的前驱，假设这个前驱的下标为 $j$，那么这个左端点 $i$ 的贡献即为 $\sum_{k=1}^{j - i - 1} \binom{k}{m - 2}$ （中间的每个数都可以和点 $i$ 匹配，所以要计算中间每个点的贡献），预处理组合数的前缀和即可做到预处理 $O(nm)$，查询 $O(n\log n)$。