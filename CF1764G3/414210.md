## 前言
合格考的时候曾经尝试搞出这道题，但是当时并没有什么思路。今天重新思考了一下会了。我果然还是只能随机思考 adhoc 题。
## 正文
先考虑 $n$ 为奇数，考虑 $k=2$ 时，按 $\lfloor \frac{a}{k} \rfloor$ 的值将 $1$ 到 $n$ 分组，则有大漂亮性质：$1$ 所在的组大小为 $1$，其它组大小皆为 $2$。

考虑判断 $1$ 的位置 $y$ 是否 $\leq \text{mid}$。对于所有大小为 $2$ 的组，设其两个元素的位置全 $\leq \text{mid}$ 的有 $x$ 对，全 $> \text{mid}$ 的有 $y$ 对，剩下的有 $z$ 对。询问 $(1,\text{mid},2)$ 和 $(\text{mid}+1,r,2)$，设结果分别为 $b,c$，有如下方程组：

$$ \begin{cases}  x+y+z=\lfloor\frac{n}{2} \rfloor+1\ \\x+z=b \\ y+z=c\end{cases}$$

方程组足以解出 $x,y,z$。

$a_1,\cdots,a_{\text{mid}}$ 中有 $2x+z$ 个不为 $1$ 的元素，如果 $2x+z=\text{mid}$，则 $1$ 的位置 $>\text{mid}$，否则 $\leq \text{mid}$。

考虑二分 $\text{mid}$，最劣询问次数为 $2\lceil\log n\rceil$。

接着考虑 $n$ 为偶数。与 $n$ 为奇数不同的是，除了 $1$ 之外，$n$ 所在的组大小为 $1$。因此在判断的时候，可能同时出现 $2x+z\neq \text{mid}$ 和 $2y+z \neq n-\text{mid}$ 的情况。此时 $1$ 与 $n$ 分别在 $\text{mid}$ 的两边。如何判断哪边是 $n$ 呢？如果 $\text{mid} >1$，我们询问 $(1,\text{mid},n)$，否则询问 $(\text{mid}+1,n,n)$。如果结果为 $2$，则说明 $n$ 在对应区域，将其排除。最劣情况下询问次数为 $3\lceil\log n\rceil$，当 $n=1024$ 时为 $30$ 次，可以通过第一个子任务。

考虑第一次遇到上述情况后，我们便知道了 $1$ 相对于 $n$ 是在左边还是在右边，记录下来，后面无需再问，最劣询问次数降低为 $2\lceil\log n \rceil +1$，当 $n=1024$ 时为 $21$ 次，可以通过第二个子任务，但是第三个子任务恰好被卡了 $1$ 次/oh

考虑二分时最后一次判断。此时 $1$ 的位置的范围 $[l,r]$ 已经被限制为 $r-l=1$。如果此时仍未能区分出 $1$ 和 $n$，我们直接用上文方法区分。
否则此时的 $a_l$ 和 $a_r$ 其中一个为 $1$，另一个所在组大小为 $2$。这次判断前我们已经询问过 $(1,l-1,2),(1,r,2),(l,n,2),(r+1,n,2)$ 四组询问，我们可以据此判断与非 $1$ 数配对数的位置是 $<l$ 还是 $>r$。设上述四组询问结果分别为 $d,e,f,g$。若 $d=e$，则其位置 $<l$，反之亦然。不妨设其位置 $<l$。我们进行一次询问 $(r,n,2)$，设结果为 $h$。若 $h>g$，则 $1$ 的位置为 $r$，否则为 $l$。最劣询问次数降低为 $2\lceil\log n \rceil$，当 $n=1024$ 时为 $20$ 次，可以通过所有子任务。