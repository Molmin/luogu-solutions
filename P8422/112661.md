## Description

给定一个 $N \times M$ 的棋盘，每个位置上有一个棋子（颜色为 $1 \sim k$，可能有特殊效果），现有 $q$ 次操作（可能是不合法的操作），每次操作交换相邻两个位置上的棋子，若为合法操作，则会触发若干轮消除并会按照特定规则加分，问 $q$ 次操作后的总得分。（$1 \le N,M \le 50,1 \le k \le 100,1 \le q \le 10^3$）

## Solution

大模拟，按照题意依次处理每个步骤：

- 判断一次操作后是否会触发消除，若无法触发，判断为不合法操作并**使得此次操作无效**，同时令终局奖分的第一项无效。
- 触发交换后的第一轮消除，记录下可能的组合奖分和牌型奖分。
- 处理带有特殊效果的棋子。
- 统计此轮被消除的棋子的颜色总和，记录对答案的贡献。
- 处理棋盘内棋子的重力下落，并开始新的一轮消除。
- 一次操作完毕后，记录连锁奖分。
- $q$ 次操作均完毕后，处理终局奖分。

一些需要注意的点：

- 一次操作若是不合法的（不触发消除），那么不应执行交换。
- 组合奖分只对交换后的消除有效，所以应在触发消除前判断（或者打上与待消除位置不同的标记）。
- 由于牌型奖分的处理中，一次合法操作可能有两种主颜色，我们需要枚举可能的组合方案来判断得分。

## [Code](https://www.luogu.com.cn/paste/bod4wweb)
