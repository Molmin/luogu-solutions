### [[ZJOI2011]看电影](https://www.luogu.org/problemnew/show/P3330)

这题模型转化很巧妙.(神仙题)

对于这种题首先肯定知道答案就是合法方案除以总方案.

总方案显然是$k^n$.

那么考虑怎么算合法方案.

当$n>k$的时候显然答案为0.

否则,我们不妨虚构出来一个从最后一个座位到第一个座位传送门,如果一个人他走到最后一个座位还没有空位置的话,他本来应该要是站着的,但是现在有了传送门,他就可以走到第一个座位,再一路走看看有没有空座位,找个位置坐下,由于这样构成了一个环,座位的个数一定是够坐的.这样每个人都有座位了.

我们现在要求的就是**没有人穿过传送门**的方案总数.考虑上面这样处理不好算.不妨再虚构一个座位,它的编号为$k+1$,现在如果有人走到n没有座位,就会先坐在$n+1$,那么一个不合法方案当且仅当$k+1$位置被人坐了,一个合法方案当且仅当$k+1$位置没有人坐.

这样的圆排列一共有$\frac{(k+1)^n}{k+1}=(k+1)^{n-1}$(n个人,每个人可以选择$k+1$个座位中的一个坐下,有人就按照规则往后坐就可以了,反正可以坐下),只有$k-n+1$个位置是空的,我们可以选择从这些位置断环成链,并把这些位置当做$k+1$号座位.

于是答案就是

$$
\frac{(k+1)^{n-1}(k-n+1)}{k^n}
$$

数据范围这么小是因为要高精...

处理gcd的时候注意$k+1$和$k$是没有公因子的,只要考虑$k-n+1$和$k^n$的gcd.

只要高精乘法,快速幂一下就可以了.


### [代码](https://www.cnblogs.com/terribleterrible/p/9912207.html)