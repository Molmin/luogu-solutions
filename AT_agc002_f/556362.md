## Update

2022.1.14：把 AC 代码融入到了每个部分中。

2022.8.8：删除了冗余的数论部分。

2022.11.9：由于 AT RMJ 的更新更改了一下文章的标题。

***
## 前置知识
[乘法逆元](https://baike.baidu.com/item/%E4%B9%98%E6%B3%95%E9%80%86%E5%85%83/5831857?fr=aladdin)是对有理数取模时使用的一种很好的方法，如果不会推荐去做[这道模板题](https://www.luogu.com.cn/problem/P3811)。

[排列组合](https://baike.baidu.com/item/%E6%8E%92%E5%88%97%E7%BB%84%E5%90%88/706498?fr=aladdin) 是一个非常重要的数学内容。
***

首先，第一维很容易想到：设 $dp_i$ 表示放 $i$ 个白球的数量，这种转移很难写，大概是 $O(n^2\times k)$。我们可以考虑再加一维：设 $dp_{i,j}$ 表示现在放了 $i$ 个白球和放满 $j$ 个非白球的答案（$j\le i$），则有两种情况：

当前球加白球，考虑从 $dp_{i-1,j}$ 转移。只有一种情况，所以这种方案的答案为 $dp_{i-1,j}$。

当前加其它颜色球，考虑从 $dp_{i,j-1}$ 转移，须在剩余的 $n-j+1$ 种非白球种选一种，即 $C_{n-j+1}^1=n-j+1$。因为它不是白球，所以它前面一定还有和它颜色相同的球，所以放它后还剩 $k-2$ 个求没放，我们就在剩下的位置中选择 $k-2$ 个放进去即可。一共的数量为 $n\times k$，现在有 $i$ 个白球，前面 $j-1$ 中非白球已经放好了，除去白球每种球放了 $k-1$ 个，再除去它自己，剩下的就是 $n\times k-i-(j-1)\times(k-1)-1$，因为同种球一样，所以没有顺序之分，应该用排列，即为 $C_{n\times k-i-(j-1)\times(k-1)-1}^{k-2}$。因为是不同的两种步骤，用乘法原理解决，所以这种方案的答案为 $dp_{i,j-1}\times(n-j+1)\times C_{n\times k-i-(j-1)\times(k-1)-1}^{k-2}$。

综上所述，$dp_{i,j}=dp_{i-1,j}+dp_{i,j-1}\times(n-j+1)\times C_{n\times k-i-(j-1)\times(k-1)-1}^{k-2}$。

答案状态为 $dp_{n,n}$，即所有球全部放完，初始状态为 $dp_{i,0}=1$ 表示只放白球，此时仅仅一种一种方案，因为白球全部相同。注意 $k=1$ 时全部放白球，只有一种方案。

时间复杂度 $O(n^2)$，空间复杂度 $O(n^2)$，可以过。

```cpp
if(!(k^1))
	putchar('1');
else{
	init(n*k);
	for(int i=0;i<=n;++i)
		dp[i][0]=1;
	for(int i=1;i<=n;++i)
		for(int j=1;j<=i;++j)
			dp[i][j]=(dp[i-1][j]+dp[i][j-1]*C(n*k-(j-1)*(k-1)-i-1,k-2)%mod*(n-j+1)%mod)%mod;
	printf("%lld\n",dp[n][n]);
}
```