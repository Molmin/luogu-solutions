给一个辣鸡柿子。

一些平凡的结论：

1. 对于编号为 $x$ 的节点，lca 为 $x$ 的数对个数为其左子树对其右子树的贡献加其右子树对其左子树的贡献加左右子树对 $x$ 的贡献，即 $2\times (\text{左子树大小}+1)\times(\text{右子树大小}+1)-1$

2. 同一层的节点 lca 为该节点的数对个数相同。

3. 同一个节点左右子树大小相同。

4. 对于深度为 $i$ 的节点，左/右子树大小均为 $2^{k-i}-1$。

5. 第 $i$ 层有 $2^{i-1}$ 个节点。

6. 第 $i$ 层第一个节点为 $2^{i-1}$。

分层讨论，第 $i$ 层的节点 $x$ 的贡献为

$$(2(2^{k-i})^2-1)x$$

那么提出公因数，第 $i$ 层的贡献为

$$(2(2^{k-i})^2-1)\sum_{j=2^{i-1}}^{2^i-1} j$$
 
等差数列求和得

$$\dfrac {(2(2^{k-i})^2-1)(2^{i-1}+2^i-1)2^{i-1}} 2$$

整个树的答案为

$$\sum_{i=1}^k \dfrac {(2(2^{k-i})^2-1)(2^{i-1}+2^i-1)2^{i-1}} 2$$

拆开得

$$\sum_{i=1}^k (2^{k-i})^2(2^{i-1}+2^i-1)2^{i-1}-\sum_{i=1}^k \dfrac {(2^{i-1}+2^i-1)2^{i-1}} 2$$

后面那坨东西可以前缀和了，看前面的柿子（分母约掉了）。

化成

$$\sum_{i=1}^k 2^{2k-i-1}(3\times 2^{i-1}-1)$$

再拆开

$$\sum_{i=1}^k 2^{2k-i-1}\times3\times 2^{i-1}-\sum_{i=1}^k 2^{2k-i-1}$$

后面那坨东西又可以前缀和了，继续化前面的柿子。

$$3\times \sum_{i=1}^k 2^{2k-2}$$

看见没有！

$$3k\times2^{2k-2}$$

做完了！