**【前言】**

其他几篇题解已经把做法和性质讲的很清楚了，因此这里大体略过，只讲几个小点的证明 /kk

**【简要做法】**

首先观察到，改变序列的顺序是不会影响它的好坏的。

抽象证明：改变序列顺序只会改变其非空子序列的顺序，而 $\min,\max$ 和子序列的和都与顺序无关，故改变顺序不影响其好坏。

因此我们自然联想到，对序列先排序，得到新的序列 $a$。

接下来有一个结论：如果这个序列的任意前缀满足要求，那么这个序列是好的。

简要证明：设 $\{a_1,a_2,...,a_m\}$ 是序列 $a$ 的一个前缀，而 $\{a_2,a_3,...,a_m\}$ 是它的子序列，则必有 $\sum\limits_{i=1}^ma_i \ge \sum\limits_{i=2}^{m}a_i,a_1 \cdot a_m \le a_2 \cdot a_m$。因此若前缀 $\{a_1,a_2,...,a_m\}$ 是好的，其任意子序列也是好的。

再由其他性质，即可得到记忆化搜索和 dp 的做法，具体可参考其他题解。

在 [第一篇题解](https://www.luogu.com.cn/blog/KAMIYA-KINA/solution-cf1603e) 里提到，本题若有解，一定满足 $a_1 \ge n -32$。可是作者并没有给出证明，因此对这里进行详细证明。

前提性质：对于数 $x$ ，它在完美的序列里出现次数一定不超过 $x$。

证明显然，如果超过了 $x$ 次，那么选出只有 $x$ 的子序列，其和必定大于积。

我们设 $n-x$ 为序列的最小最大项（有点绕口但很好理解），我们考虑构造这样的序列：$\{n-x,n-x,n-x,...,n-x+2,n-x+1,...,n,n+1\}$，其中 $n-x$ 出现了恰好 $n-x$ 次，则序列的和为 $(n-x)^2+\sum\limits_{i=1}^{x-2}n-i+2n+1$，最小值与最大值乘积为 $(n-x)(n+1)$，据此列出不等式：

$$(n-x)^2+nx+1-\dfrac{(x-1)(x-2)}{2} \le (n-x)(n+1)$$

$$2nx+2-(x-1)(x-2) \le 2(-x+n)(x+1)$$

$$2nx+2-x^2+3x+2 \le -2x^2+(2n-2)x+2n$$

$$x^2+5x-4n+4 \le 0$$

将本题数据最大点 $n = 200$ 带入，$x^2+5x-396\le0$，解约为 $-22.6 \le x \le 17.6$。

因此为了保险最小最大值开到 $n-18$ 即可。