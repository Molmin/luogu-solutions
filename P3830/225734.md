## $q=1$ 时
设 $f_i$ 为有 $i$ 个叶子时的答案

可以发现，新展开的两个叶子的期望深度为 $f_{i-1}+1$，故深度和的期望为 $2(f_{i-1}+1)+(i-1-1)f_{i-1}$，化简得

$$f_i=f_{i-1}+\frac{2}{i}$$

边界为 $f_{2}=1$，可以发现

$$f_n=2\sum_{i=2}^{n}\frac{1}{i}$$

暴力计算即可，时间复杂度 $O(n)$

## $q=2$ 时
这才是该题的重点

设 $P(x)$ 为事件 $x$ 发生的概率

答案即为

$$\sum_{i=1}^{n}i \cdot P(\textit{depth}=i)$$

发现这并不好计算，故转化为

$$\sum_{i=1}^{n}P(\textit{depth} \geq i)$$

令 $f_{i,j}$ 表示叶子数为 $i$，深度大于等于 $j$ 的概率

可以发现，叶子数为 $i$ 且深度大于等于 $j$ 等价于 根的左子树或右子树深度大于等于 $j-1$

故枚举左子树的叶子数量 $k$，并加上此时深度大于等于 $j$ 的概率乘上这种情况出现的概率。前者显然是 $f_{k,j-1}+f_{i-k,j-1}-f_{k,j-1}f_{i-k,j-1}$（注意到左右字数深度均大于等于 $j-1$ 的情况会被算两次，故减去之），那么只需求这种情况出现的概率即可

经过打表，猜测概率为 $\dfrac{1}{i-1}$（换句话说，对于每个 $k$ 概率相等）。考虑采用数学归纳法证明：

- $i=2$ 时，显然成立
- 设 $i=t-1$ 时成立，有两种情况
  - 在左子树展开，可能性 $\dfrac{k-1}{t-1}$。此时概率为 $\dfrac{k-1}{(t-2)(t-1)}$
  - 在右子树展开，可能性 $\dfrac{t-k-1}{t-1}$。此时概率为 $\dfrac{t-k-1}{(t-2)(t-1)}$
  加起来，即可得出概率为 $\dfrac{1}{t-1}$，得证

故转移方程为

$$f_{i,j}=\sum_{k=1}^{i-1}\frac{1}{i-1}(f_{k,j-1}+f_{i-k,j-1}-f_{k,j-1}f_{i-k,j-1})$$

朴素转移即可