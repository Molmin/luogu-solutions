设 $d_i$ 表示与 $i$ 相连的边权乘积。

因为每条边对 $\prod d_i$ 的贡献恒为 $(\pm 1) ^ 2 = 1$，所以，当 $n$ 为奇数时，$\prod d_i = -1$ 的要求无法被满足，不存在合法的树，答案为 $0$。

否则，我们通过经典的剥叶子套路，证明当树的形态确定时，赋边权使得合法的方案唯一。

直接枚举 $d(1, n)$ 显然不好做，我们将贡献摊至路径上的每条边。直接枚举产生贡献的边两侧的子树大小 $L, n - L$。当 $L$ 为奇数时，因为两棵子树内部 $\prod d_i$ 为 $1$，为使得除了与当前边相连的两点以外的所有点的 $d_i = -1$，则与当前边相连的两点的 $d_i = 1$，故当前边权值为 $-1$。当 $L$ 为偶数时，当前边权值为 $1$。

求方案数：两侧子树均选择一个根作为两端。因为大小为 $n$ 的有标号有根树的数量为 $n ^ {n - 1}$，再从 $2\sim n - 1$ 中选出与 $1$ 同侧的 $L - 1$ 个点，故方案数为 $L ^ {L - 1} (n - L) ^ {n - L - 1} \binom {n - 2} {L - 1}$。

时间复杂度 $\mathcal{O}(n\log n)$。[代码](https://codeforces.com/contest/1762/submission/185406946)。