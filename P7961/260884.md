- 多写题解从我做起。
- 勿做斜杠青年从我做起。
- 希望作者不要爆零。

**题意**
- [题目链接](https://www.luogu.com.cn/problem/P7961)。
- 给定 $n,m,k$，和长度为 $m+1$ 的正整数数列 $v_0,v_1,v_2\cdots v_m$。
- 定义一个合法的序列是形如长度为 $n$ 的，每个数的值都是 $0$ 和 $m$ 间的非负整数的序列（可以重复的排列） $a_1,a_2,\cdots,a_n$，且满足 $S=2^{a_0}+2^{a_1}+\cdots+2^{a_n}$ 的二进制表示中 $1$ 的个数不超过 $k$，而且定义该合法序列的权值为 $v_{a_1}\times v_{a_2}\times\cdots\times v_{a_n}$。
- 求所有合法序列的权值和对 $998244353$ 取模的结果。

**暴力实现**
- 暴力实现的作用是对拍和保证自己理解该题目的题意。
- 对笔者这样的菜鸡很有效。
- 时间复杂度 $O((m+1)^n)$ 但可以过大样例。
- [暴力实现](https://www.luogu.com.cn/paste/o4lu3epa)。

**思路**
- 首先这个数列 $a_i$ 的顺序不是费严格递增的让人感到很恶心，由于其它限制都不考虑顺序，考虑用组合数学将它转化为一个无后效性的 DP。
- 然后有一个性质：让这题的状态数转变为多项式级别。
- 看起来状态数是 $n\times 2^n$ 的，但实际上枚举到 $v_i$ 的时候，$0$ 到 $i-1$ 位都不需要在意了，可以用一个数组保存它的个数，而 $\lfloor S/2^i\rfloor\le n$ 是显然的，所以可以再用一个数组保存。
- 看起来很好。
- 接下来是一个简单的组合数学问题：有 $a$ 个黑球，$b$ 个白球，排列总共有多少种可能，显然是 $C(a+b,a)$ 种。
- 于是我们设出状态 $f(i,A,a,g)$ 表示 $a_1,a_2,\cdots a_g$ 取值在 $0$ 到 $i$ 之间，其中 $S$ 的 $0$ 到 $i-1$ 位 1 的个数为 $a$，$\lfloor S/2^i\rfloor$ 值为 $A$ 的序列权值和。
- 有初始状态：
$$f(0,j,0,j)=v_0^j$$
- 枚举数列中 $v_{i+1}$ 的个数 $j$，有转移状态：
$$f(i,A,a,g)\times C(g+j,j)\times v_{i+1}^j\rightarrow f(i+1,\lfloor A/2\rfloor+j,a+(A\bmod 2),g+j)$$
- 其实我一开始还想岔了多开了一维，~~然后就爆空间。~~
- 预处理组合数和 $v_i$ 的幂的话，时间复杂度 $\Theta(mn^4)$，空间复杂度 $\Theta(mn^3)$，实现过关的话是不会出问题的。
- [代码实现](https://www.luogu.com.cn/paste/ynql0wr7)。
- 如果怕空间问题的还可以滚动数组消掉一维，空间复杂度 $\Theta(n^3+nm)$，实测时间复杂度有提升。
- [代码实现](https://www.luogu.com.cn/paste/ljdimwz2)。

**后话**
```cpp
__builtin_popcount()
```
- 这是个好东西，$\text{CCF}$ 忽然开禁了，~~不过笔者目前不太敢用~~。
- [关于NOI系列活动中编程语言使用限制的补充说明](https://www.noi.cn/xw/2021-09-01/735729.shtml)。
- 似乎有人认为这题 $n$ 开得太小容易让人想到暴力？笔者觉得 $m$ 的大小会让人打消这个念头。