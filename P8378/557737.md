此题解为官方题解

不难发现最终一定是 2 个大小为 2 的树，或者 1 个大小为 3 的菊花，其余都没有动过。从而答案是 $\dfrac{n(n-1)(n-2)^2}{2}$。

证明：

首先容易发现任意森林都有至少 1 种方式建立：自下而上一个一个挂，不发生路径压缩。

我们尝试分析一下这个树最后是什么结构。

**Observation 1**：不能出现一个点有 3 个孩子。

**证明**：显然如果有 3 个孩子就贡献了 6 种顺序，就一定不是恰好 2 个操作序列了。

**Observation 2**：不能出现一个非根的点有 2 个孩子。

**证明**：考虑方案数最小的情况肯定是直接就是这样一个结构，以

```plain
1 2
2 3
2 4
```

为例。

首先直接自下而上的有两种。

然后我可以先把 4 挂到 3 上，再把 3 挂到 2 上，然后 merge(4,1)，此时 4 由于路径压缩会挂到 2 上，然后 2 再会挂到 1 上，这就又多出一种，对称的也还有一种。

因此这个结构会贡献 4 种操作序列，从而不能出现。

---

那么到这一步，每一个树必须要么是一条链，要么是根上挂两条链。

**Observation 3**：根分叉之后的两个子链长度必须都是 1。

**证明**：否则取长度 >1 的子链的前 2 个点，这 3 条边有 3 种顺序，从而不能出现。

到这一步，每一个树必须要么是一条链，要么是一个 3 个点的菊花。

**Observation 4**：所有大小 $\geq 2$ 的树里面，要么只能有 1 个大小 $\geq 3$ 的树，要么只能有 2 个大小 $=2$ 的树。

**证明**：如果有一个大小 $\geq 3$ 的树，那么任意一个和它不连通的树的操作都有 $\geq 3$ 个位置可以放，从而方案数爆炸；如果有 3 个大小 $=2$ 的树，那么它们的顺序有 6 种方案，爆炸。

所以我们要么选四个点然后组成两对有序对，要么选三个点然后选一个点当根。前者方案数是 $\dbinom{n}{4}\times \dfrac{\binom{4}{2}}{2}\times 2\times 2$，后者方案数是 $\dbinom{n}{3}\times 3$。整理得到答案为 $\dfrac{n(n-1)(n-2)^2}{2}$。