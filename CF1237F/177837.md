# [Balanced Domino Placements](https://codeforces.com/contest/1237/problem/F)

## 解析：

### 题目大意：

给你一个 $n\times m$ 的棋盘（$1\le n,m\le3600$），上面已经放了 $k$ （$0\le k\le2400$）个的骨牌（$1\times2$）对于一个骨牌的每个格子，不能有其他骨牌的格子和它在同一列，同一行。

你可以在剩下的格子里放骨牌，也可以不放，问这个棋盘有多少种放骨牌的方案，对 $998244353$ 取模。

--------------------------

### 思路：

可以发现，横着的骨牌占 1 行 2 列，纵骨牌占 2 行 1 列。设最后选 $a$ 个横向的骨牌，$b$ 个纵向的，那么 $2a+b\leq m,a+2b\leq n$，是一种合法方案的充要条件。

先考虑 $n\times 1$ 的情况，可以发现这种情况下横向骨牌等价于一个 $1\times 1$ 的格子，设 $f_{i,j}$ 表示前 $i$ 行放 $j$ 个纵向骨牌的方案数，那么有转移
$$
f_{i,j}=f_{i-1,j}+(f_{i-2,j-1}\times [tx_i \& tx_{i-1}])
$$
其中 $[tx_i \& tx_{i-1}]$ 表示前两行是否已经有骨牌，这个可以预处理已经存在的 $k$ 个骨牌。那么 $a$ 个横向骨牌 $(1\times 1)$ 的格子 $b$ 个纵向的方案数应该是 $f_{n,b}\times \binom{sn-2b}{a}$，$sn$ 表示去掉不能选的行之后的行数，$2b$ 是纵向骨牌占的格子个数。

$g_{i,j}$ 就是 $1\times m$ 时的方案数，转移等价于 $f_{i,j}$ 不做解释。

考虑怎么统计答案。先给出式子：$ans=\sum_{i=0}^n\sum_{j=0}^mf_{n,i}\times \binom{sn-2i}{j}\times f_{m,j}\times \binom{sm-2j}{i}\times i!\times j!$。其中 $i,j$ 是枚举横向纵向放的骨牌个数。

这里解释一下，以 $i$ 为例：我们在 $n\times 1$ 的时候不能在一列放 $i$ 个骨牌 $(f_{n,i})$，但是如果有 $i$ 列可以放，一列一个，那么就能放下 $(\binom{sm-2j}{i})$。若对于 $i$ 列的所有纵向骨牌我从上到下给一个编号，那么最后方案数等价于全排列，所以这部分方案数为 $f_{n,i}\times\binom{sm-2j}{i}\times  i!$。

读者可以自行画图结合理解。

时间复杂度 $\mathcal O(n^2)$。

