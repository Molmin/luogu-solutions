直接设在每个点爆炸的概率是不好转移的。不妨设当前在点 $i$ 没有爆炸，期望经过点 $i$ 的次数 $f_i$。

那么有：

$$
\begin{cases}
f_1=1+(1-\frac{P}{Q})\sum_{(1,v)\in E} \frac{1}{du_v}f_v
\\
f_i=(1-\frac{P}{Q})\sum_{(i,v)\in E} \frac{1}{du_v}f_v
\end{cases}
$$

知道了经过每个点 $i$ 的期望次数后，在点 $i$ 爆炸的概率即转化为期望次数 $\times$ 爆炸概率。即，对于每个点 $i$，答案为 $f_i\times \frac{P}{Q}$。

这个 $\text{DP}$ 方程具有后效性，高斯消元一波即可，时间复杂度为 $O(n^3)$。

这道题充分说明了，不仅期望可以转化为概率 $\times$ 权值，概率也可以转化为期望 $\times$ 概率（已知）。

代码太 $\text{Naive}$ 了就不放了。