从前几天开始一直阳到现在，然后几天没写题，代码能力急剧下降，一言难尽。

upd on 2022.12.20:经过 Alex_Wei 的锐评，了解了专业术语！

图的性质摸一下，大概就是每个边双内部没有割点。听专业人士说这就是所谓仙人掌，但是概念啥的我不太懂。粉兔说是圆方树板子题但是我不会圆方树。

那么对于一个边双，有一个很好的性质。对于这个边双里任意两点 $u$ 和 $v$ 和任意一条边 $i$，一定有一个简单路径满足从 $u$ 出发经过 $i$ 到达 $v$。

那么当询问的 $u$ 和 $v$ 在同一边双时，答案就是这个边双的边数。

我们考虑将这个想法扩展出去，先缩点并维护每个边双的边数 $cnt_i$。现在是一个树上问题。

一个大胆的想法是答案就是查询的两个点路径上的 $cnt$ 的和。然后倍增求个 LCA 即可。

一个问题在于，有一些边双可能经过但是不完全经过。

具体来讲，就是从一个边双 $A$ 进入边双 $B$，然后再从 $B$ 进入 $C$。我们考虑对应到原图上的边，那么相当于从 $u_A$ 走到 $v_B$，从 $v_B$ 走到 $u_B$，然后再从 $u_B$ 走到 $v_C$。那么我们发现，$cnt_B$ 是否产生贡献，取决于 $u_B$ 和 $v_B$ 是否不相等。

所以我们在倍增的基础上多维护点东西。大概就是维护一个 $sum_{u,i}$ 表示从 $u$ 点往上跳 $2^i$ 个祖先所有产生贡献的祖先的 $cnt$ 之和。为了方便，这个变量是假定跳到第 $2^i+1$ 个祖先的，这样好写很多。然后判断的话可以维护一个边双到它父亲的边连的是哪两个点。

然后查询的时候特判一下即可，总复杂度 $O((n+q)\log n)$。

https://codeforces.com/contest/1763/submission/185991387