这题思考过程很有启发性。

如果看到题直接想，询问能提供什么信息？就做死了。因为询问根本没法提供有价值的“信息”。

换种方式思考，如果要求的不是 1 的位置而是其它数的位置能不能做？询问 $n$ 的位置是可做的，因为它是唯一一个除以 $n$ 下取整是 1 的数，那一个区间 $[l,r]$ 包含 $n$ 且长度不是 1 的话，询问 $[l,r,n]$ 得到的结果就是 2，否则就是 1，据此可以二分找出答案。

那为何 $n$ 的位置如此容易寻找？是因为 $n$ 具有，“是唯一一个除以 $n$ 下取整是 1 的数”这个性质。因此，我们自然想，1 有没有什么与下取整有关的唯一性呢？

思考到这里，再经过一些尝试，就不难得出本题最重要的观察：1 是唯一一个除以 $2$ 下取整是 0 的数（称之为 1 的性质）。这意味着，无论哪个 $[2,n]$ 的子集 $S$，加入 1 后得到 $T$，$S$ 中的数除以二下取整得到  $U$，$T$ 中的数除以二下取整得到  $V$，**一定**有 $|V|=|U|+1$。

很遗憾，$n$ 是偶数时，$n$ 也具有上面这个性质。不过根据刚才的讨论，很容易区分 1 和 $n$，因此我们已经找到一个很可做的切入点，只需要据此编一个做法。

设 $Q(l,r,k)$ 为询问 $[l,r],k$ 得到的答案。设 $x$ 的位置是 $q_x$。则不难发现，上述观察等价于，$Q(1,q_1-1,2)+1=Q( 1,q_1,2),Q(q_1,n,2)=Q(q_1+1,n,2)+1$。这是因为 $\{x|q_x\in [1,q_1-1]\cup [q_1+1,n]\}=[2,n]$。

因此，设 $a_i=Q(1,i,2)-Q(1,i-1,2),b_i=Q(i,n,2)-Q(i+1,n,2)$，若 $p_i$ 没有 1 的性质，则 $a_i,b_i$ 中有一个为 1，有一个为 0。否则，$a_i,b_i$ 均为 1。而我们可以用 $O(1)$ 次询问得到 $a,b$ 的区间和。因此，容易二分出满足 1 的性质的位置了。如果事先找出 $n$ 的位置，再根据 $n$ 的位置找出另一个满足 1 的性质的位置，需要 $3\log n$ 次询问，可以通过 G1。G2,G3 的优化在此略去。

本题思考过程给我们的启发是，当看不出题目的操作有什么直接用处时，可以从所求入手，思考为什么能求出题目要求的。