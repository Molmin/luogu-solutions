- emmm，我不是有意要摆烂的，我只是想不到。

**[题意](https://www.luogu.com.cn/problem/CF434E)**
- 对于 $u$ 到 $v$ 树上路径所成字符串的一种哈希函数 $H(u,v)$，您需要研究这个函数 $G(u,v)=[H(u,v)=x]$ 。
- 为了加大难度，您需要在一棵树上统计类似于三元环的东西：$G(u,v)=G(v,w)=G(u,w)$ 的个数。

**分析**
- 我们拥有 $O(n^3)$ 的[暴力](https://www.luogu.com.cn/paste/gyxtt92j)，但是这不值得夸耀！
- 经过我们的仔细思考，我们发现三个量就像石榴籽一样紧紧抱在一起！我们希望尝试将其分开！
- 我们现在可以快速的算出所有 $G(u,v)$ 的和，也可以快速算出 $G(u,v)=G(v,w)$ 的方案数，因为我们可以利用差分在 $v$ 上将他枚举到，但是，丝毫看不出这个和 $G(u,w)$ 有什么关系，如果我们必须要枚举三元环，我们也就必须陷入 $\text{TLE}$。
- 它这个三元害人不浅呐！仔细思考一下我们会发现，我们的树上路径在一个点交会！但是那个点似乎没有什么性质！如果我们一开始来思考的话，我们或许可以枚举所有端点，或许能够得到一个类似于 $O(n^2)$ 的做法。
- 但是，三元害人不浅！不弄开它，信息学的伟大事业是不能取得发展和进步的！
- 然后我忽然发现反着想以后：我们那个算出 $G(u,v)=G(v,w)$ 的方案数的东西，在三元环的三个位置分别处理两种方向信息加起来之后，结果恰好是除了 $G(u,v)=G(v,w)=G(u,w)$ 情况的两倍！因为情况恰好是完全对称的！
![](https://cdn.luogu.com.cn/upload/image_hosting/bby3c48r.png)
- 因此，我们可以直接上点分治了，这题有点坑人：[代码](https://www.luogu.com.cn/paste/dhvr68cb)。