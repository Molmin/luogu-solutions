赛时看错题选手报道, 提供一个无脑解法。

我们记录 $pre_{i, op}$ 表示 $[1, i] $ 出现的 $op$ 个数， $suf_{i, op}$ 表示 $[i, n]$ 出现的 $op$ 个数。

特定的， 我令 $s_0 = pre_{n, 0}$

我们发现，对于前缀 $a$ , 后缀 $b$ 所表示的答案是 ：

$$\max\{{s_0 - pre_{a, 0} - suf_{b,0}, pre_{a,1} + suf_{b, 1}}\}$$

- 较为暴力的 method :

考虑对于左右两边加上 $pre_{a, 0} + suf_{b,0}$ 得到 ：

$$\max\{{s_0, pre_{a,1} + suf_{b, 1} +pre_{a, 0} + suf_{b,0}}\} - pre_{a, 0} - suf_{b,0}$$

我们分类讨论.

- 1.$s_0 \leq pre_{a,1} + suf_{b, 1} +pre_{a, 0} + suf_{b,0}$ 的情况

$pre_{a,0} + pre_{a, 1}$ 是 已知的， 考虑求 $suf_{b, 0} + suf_{b, 1} \geq s_0 - pre_{a,0} - pre_{a, 1}$ 的最小 $suf_{b,1}$ 。

- 1.$s_0 > pre_{a,1} + suf_{b, 1} +pre_{a, 0} + suf_{b,0}$ 的情况

$pre_{a,0} + pre_{a, 1}$ 是 已知的， 考虑求 $suf_{b, 0} + suf_{b, 1} < s_0 - pre_{a,0} - pre_{a, 1}$ 的最大 $suf_{b,0}$ 。

比较暴力的方法是， 考虑倒序枚举去确定 $a$ 的位置， 直接开线段树去分类讨论维护这个题。

- 较为优美的 method :

但是我们发现， 其实这个题没有这么麻烦， 拎出来这个式子 :

$$\max\{{s_0 - pre_{a, 0} - suf_{b,0}, pre_{a,1} + suf_{b, 1}}\}$$

为了方便地比较大小， 左右作移项得 ：

$$\max\{{s_0, pre_{a,1} + suf_{b, 1} + pre_{a, 0} + suf_{b,0}}\}$$

发现可以继续合并 ：

$$\max\{s_0, a + b\}$$

那么就是看左右哪个大的大小取值。

考虑到 $pre_{0/1},suf_{0/1}$ 单调不降。

考虑枚举 $a$。

如果左边大那么就是取 $s_0 - pre_{a, 0} - suf_{b,0}$ ， 那么肯定 $b$ 越大越好， 因为 $a + b \leq s_0$ 考虑令 $b = s_0 - a$ .

如果左边大那么就是取 $pre_{a,1} + suf_{b, 1}$ ， 那么肯定 $b$ 越小越好， 因为 $a + b > s_0$ 考虑令 $b = s_0 - a + 1$. 

所以我们有 $O(n)$ 做完这个题。