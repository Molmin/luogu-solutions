### $\texttt{Solution}$

考虑链的情况看起来很好做，断环为链。

$b_i,i\in[n+1,2n]$ 的限制在链上形如一个前缀和一个后缀，不好用前缀和作差简单描述，考虑二分答案得到和 $sum$，问题变成判定是否存在方案且限制因为有和可以补集转化成中间一段区间。

差分约束的限制有：

1. $s_i\leq s_{i+1}$
2. $w\leq s_i-s_{i-n}\leq v$
3. $s_{2n}-s_0=sum$

共 $O(n)$ 条边，不能直接跑 spfa，由于图的形式非常特殊，我们可以人脑找负环。

![图挂了~](https://pic1.imgdb.cn/item/6351eb0b16f2c2beb179275c.png)

具体的，将点 $n$ 和与其相连的边扔掉，剩下的部分近似一个 DAG，考虑这个部分若可能有负环，负环一定包含点 0，DP 出从 0 出发走一轮到每个点的最小距离，若 $dis_1\lt 0$ 则有负环。

去除有包括 0 的负环的情况，原图的负环只有可能包含点 $n$，DP 出剩余部分 $n$ 开始走的距离，$2n$ 开始走的距离即可判定负环。

时间复杂度 $O(n\log V)$。

[code](https://atcoder.jp/contests/arc117/submissions/34511543)