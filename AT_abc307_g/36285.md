# Abc307G - Approximate Equalization
- DP、序列变换最小操作

## 题意

给出一个长度为 $n(2\leq n\leq 5000)$ 的序列 $a(|a_i|\leq 10^9)$，需要让序列满足对于任意的 $1\leq i<j\leq n$ 有 $|a_i-a_j|<1$。

每次操作可以进行下面的操作之一：
- 令 $a_i:=a_i-1,a_{i+1}:=a_{i+1}+1$
- 令 $a_i:=a_i+1,a_{i+1}:=a_{i+1}-1$

问最小的操作次数。

## 思路
### hint 1
先考虑下面的问题：

给出两个长度均为 $n$ 的序列 $a,b$，保证 $\sum a_i = \sum b_i$，每次可以对 $a$ 进行题目所述操作，问要让 $a=b$ 的最小操作次数。

考虑对每个元素算贡献。

假设每个元素中途可以减为负数，那么可以从 $a_1$ 开始，依次处理到 $a_n$。

对于每个元素，计算它对答案的贡献。每个元素对答案的贡献是：$|a_i-\frac{sum}{n}|$。

同时，$a_i=b_i$，$a_i$ 的变化量是：$b_i-a_i$，需要将其支配给下一个元素，即 $a_{i+1}:=a_{i+1}+b_i-a_i$。

归纳一下，对于第 $a_i$ 来说，要让前面的元素都满足 $a_i=b_i$，$a_i$ 需要变成 $\sum_{j=1}^{i}|a_j-b_j|$。

因此，$a_i$ 对答案的贡献为：$\sum_{j=1}^{i}|a_j-b_j|$。将这 $n$ 个贡献相加就是答案。

### hint 2

回到本题，设所有元素加和为 $sum$。

不难发现，每种元素只可能是 $\lfloor\frac{sum}{n}\rfloor,\lfloor\frac{sum}{n}\rfloor+1$ 中的一种。

$\lfloor\frac{sum}{n}\rfloor+1$ 恰好有 $sum\mod n$ 个。

根据 hint1，用 $f_{i,j}$ 表示当前为第 $i$ 个元素，当前已经安放了 $j$ 个 $\lfloor\frac{sum}{n}\rfloor+1$，操作次数的最小值。

维护 $a$ 和 $b$ 的前缀和，转移即可。