# [NOI2015]品酒大会

[题目链接](https://www.luogu.com.cn/problem/P2178)

## 题目叙述

给你一个字符串，每个后缀有一个权值，求后缀中任意两个最长公共前缀长度为$i$的一共有多少对，权值乘积最大为多少。

## 题解

后缀树简单题，但细节繁琐。首先建立后缀树，两个后缀的公共前缀长度为那两个后缀结尾在树上```LCA```的深度。对于一个相似值$r$，求出相似值恰好为$r$的有多少个，然后迭代一下就得出答案。那么如何求相似值恰好为$r$的呢？看深度为$r$的节点子树中有多少对不在同一颗子树内的叶节点对即可（这个容易求吧，大不了就$n^2$暴力，一共顶多$26$个儿子）。然后再求出子树内的最大、次大，最小、次小，因为权值积最大一定为最大与次大的乘积或最小与次小的乘积（考虑最大次大、最小次小是否同号）。问题就解决了。

## 代码

[Link](https://www.luogu.com.cn/paste/c4wlj3sf)