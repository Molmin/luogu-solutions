发现所有边 $(i, p_i)$ 中，$i$ 两两不同，$p_i$ 两两不同，因此所有点的度数都为 $2$，所有点和边都在环上。

设 $f_{i, 0}, f_{i, 1}$ 表示 $[1, i]$ 的排列，满足其生成图有偶数个或奇数个环的数量。

容易发现，$f_{1, 0}=0$，$f_{1, 1}=1$，$f_{2, 0}=1$，$f_{2, 1}=1$。

考虑归纳。假设已经算出了 $f_{j, 0}, f_{j, 1}(1\le j \lt i)$，需要计算 $f_{i, 0}, f_{i, 1}$。

- 当 $p_i=i$ 时，显然 $f_{i, 0}=f_{i-1, 1}$，$f_{i, 1}=f_{i-1, 0}$。
- 当 $p_i\ne i$ 时，由于所有点和边都在环上，原图（指 $[1, i-1]$ 的排列的生成图）中肯定存在 $(j, p_i)$ 的边。原排列中 $p'_j=p_i$。令新排列中 $p_j=i$，那么原图和新图中环的个数不变。
	- 感性理解，加入 $(i, p_i)$ 边后，原图中 $p_i$ 所在的环多出了一条边，变成了 $\rho$ 的形状。此时 $deg_{p_i}=3, deg_{i}=1$，因此需要将一条与 $p_i$ 相连的边改为与 $i$ 相连，改后环的个数不变。

当 $p_i\ne i$ 时，$p_i$ 有 $i-1$ 种取值，因此方案数要乘 $(i-1)$。

$$
f_{i,0}=f_{i-1,1}+(i-1)f_{i-1,0}
\\
f_{i,1}=f_{i-1,0}+(i-1)f_{i-1,1}
$$

容易发现 $f_{i, 0}$ 和 $f_{i, 1}$ 是对称的，而且 $f_{2, 0}=f_{2, 1}$，因此 $f_{i, 0}=f_{i, 1}(i\ge 2)$。

由于所有边一定都在环上，因此 $f_{i, 0}+f_{i, 1}$ 就是生成图的总数，即 $i!$。

可以推出：

$$
f_{i, 0}=
\begin{cases}
	0, i=1\\
	\frac{i!}{2},i>1\\
\end{cases}
$$

