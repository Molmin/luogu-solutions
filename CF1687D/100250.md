~~对立，我的对立，呜呜呜呜呜呜 616 你还我对立~~  
~~等会我太菜了打不动 arcaea 啊，那没事了~~

根据定义，我们设 $g(x)=a^2,f(x)=(a+1)^2$，可爱数的集合为 $P$，值域为 $M=a_n$。

$$x-a^2<(a+1)^2-x$$
$$2x<2a^2+2a+1$$
$$x<a^2+a+\frac 1 2$$
$$\because a^2+a=a(a+1) \in Z,x \in Z$$
$$\therefore x\le a(a+1)$$

$$\therefore P\cap[a^2,(a+1)^2)=\{x\mid x \le a(a+1)\}$$

显然，$\forall a_i \in [1,M]$，$a'_i=a_i+M^2-1\in [M,M^2+M-1]$ 均符合条件。

因而 $k < M^2$。

我们假设 $a'_1$ 被钦定到 $[v^2,v(v+1)]$ 里面。

当它在区间左端点 $a_1+m=v^2$ 时，设此时的每一项为 $b_i=a_i+(v^2-a_1)(b_1=v^2)$。

那么必然有 $b_1=v^2 \le a'_1\le v^2+v=a_1+v$，所以令 $p=a'_i-b_i \in [0,v]$，此时 $k=p+v^2-a_1$。

- 若 $c^2 \le b_i \le c^2+c\:(v\le c)$，则 $a'_i=b_i+p\le c^2+c+p <c^2+2c+1=(c+1)^2$。
- 若 $c^2+c \le b_i \le (c+1)^2\:(v\le c)$，则 $a'_i=b_i+p\le (c+1)^2+p <(c+1)^2+c+1$。

第一条说明在挪动第一项的时候，原本已经满足的可以变得不满足，但是变不回去。我们可以找到每段 $[w^2,w(w+1)]$ 可行的 $b_i$ 中最大的，这限制了 $k$ 的上界（$b_i+p \le w(w+1)\Rightarrow a_i+k \le w(w+1)$）。

第二条则说明我们需要尽力挪动使得原本不满足的变成满足的。同理每段中最小的限制了下界。

枚举每个 $v \le M$，与处理一下就可以 $O(1)$ 搞每一段。~~总复杂度调和级数，$O(M\log M)$。~~

我们可以发现 $i$ 被统计了 $a_i-a_{i-1}$ 次，所以复杂度是线性的。感谢 @realMatrixCascade 指出错误。

出题人可爱，贴贴
