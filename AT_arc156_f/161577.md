> 有三个序列 $A_{1\sim n},B_{1\sim n},C_{1\sim n}$，找到一个最大的集合 $S$，使得它可以由如下两种方式生成：枚举 $i$，将 $A_i/B_i$ 加入 $S$；枚举 $i$，将 $A_i/C_i$ 加入 $S$。$(n\leq 5000)$

直觉告诉我们答案就是先按第一种方式生成一个集合，再按第二种方式生成一个集合，两个集合交的大小的最大值。写个暴力可以发现是对的。

假设这个结论成立，那么答案是好求的。建一个三部图，左边表示第一种方式，右边表示第二种方式，中间为每种元素（有 1 的容量），跑最大流即可。

---

下面考虑证明结论的正确性，也就是构造方案。

假设当前第一种方式生成的集合是 $S$，第二种方式生成的集合是 $T$。我们要在保持 $|S\cap T|$ 不变的情况下把对称差调整到 0。

假设存在某个 $i$，$S_i\notin T$。如果切换 $S_i$ 的状态后 $S_i^\prime \in T$ 我们直接切换（显然 $|S\cap T|$ 不变）。$T_i\notin S$ 同理。切换一次后对称差减小。

否则如果对称差依然大于 0，一定存在 $A_i,B_i\notin T$ 或 $A_i,C_i\notin S$。

不妨设 $A_i,B_i\notin T$。此时一定有 $T_i = C_i$，我们令 $S_i = T_i = A_i$。不难证明 $|S\cap T|$ 不会减小，对称差不会增大，且满足 $S_i = T_i = A_i$ 的下标数量增加。

于是总共只会调整 $O(n)$ 轮。复杂度 $O(n^2)$。

---

网上题解说由于 Dinic 的神秘性质按某些方式建图后可以不用调整。不是很懂。