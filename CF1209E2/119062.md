首先可以加强一下，变成每行随便取一个数，要求和最大。

然后有个 $f_{i,S}$ 表示前 $i$ 列，已经确定 $S$ 中选啥的答案。

这时可以过 E1

然后一个观察是，最大值前 $n$ 大的列可以是答案。因为这个与其他方式相比肯定不劣。于是只要让这几列拿去 dp。

然后复杂度变成 $\mathcal{O}(n(3^n+n^2))$。

[link](https://codeforces.com/contest/1209/submission/182351981)