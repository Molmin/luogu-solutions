把 $1$ 号点视为红色，显然只需要考虑每个红色连通块及其相邻棋子的情况。

首先必须要有至少一个棋子在 $1$ 的连通块内。如果至少有两个棋子在块内必定有解，否则考虑其它棋子运动情况。

这个棋子一定是要沿最短路走到 $1$ 的，所以先从 $1$ 跑一边道中只经过红色点的最短路。

那么我们只关心其它棋子能否凑出中间需要的 $dis-1$ 步。

若另一个棋子能走到大小 $\ge 2$ 的连通块，那么这两个棋子交替行动即可。

否则只需要统计有多少棋子能进行一次行动即可。[record](https://codeforces.com/contest/1790/submission/211248678)。