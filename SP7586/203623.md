一个简单的哈希做法

我们设 $h(x)$ 为字符串 $x$ 的哈希值。

容易得知，若 $x$ 是回文串，那么 $h(x)=h(\text{reverse}(x))$。对于 $x$ 是非回文串的情况，基本是不可能成立的。

那么正反两次维护整个序列的哈希值然后比较就行了。

```cpp
for(i=1;i<=len;i++)
	for(j=i;j<=len;j++)
		a[i][j]=a[i][j-1]*114514+x[j];
for(i=len;i>=1;i--)
	for(j=i;j>=1;j--)
		b[i][j]=b[i][j+1]*114514+x[j];
for(i=1;i<=len;i++)
	for(j=i;j<=len;j++)
		s+=a[i][j]==b[j][i];
```
（其实并不需要 $b$ 数组，直接在线就行了，我这样写是为了更漂亮一些）