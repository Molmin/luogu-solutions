## Problem

- $q$ 次询问，每次询问给出一个 $k$ 和在树上的 $k$ 个点 $p_i(1\leqslant i\leqslant k)$，问这 $k$ 个点是否在同一条链上。
- $n\leqslant 2\times 10^5$，所有 $k$ 的总和不超过 $2\times10^5$。

## Solution

我们假定 $1$ 是根。首先我们先来思考在同一条链上的情况。我们先取这些点中深度最深的节点，设它为 $x$，它显然是链的一个端点。设另一个端点为 $y$，那么 $y$ 要么是 $x$ 的祖先，要么是不为 $x$ 祖先的点中深度最大的点（这个点显然应当是唯一的）。这是因为当 $y$ 不是 $x$ 的祖先时，这条链可以分为 $y$ 到 $\rm lca$ 和 $x$ 到 $\rm lca$ 两部分，其中后者均为 $x$ 的祖先，前者均不为 $x$ 的祖先。显然 $y$ 在前者的最底端，即 $y$ 至 $\rm lca$ 的点中深度最大的点。

现在假设我们找到了这样的 $x$ 和 $y$，剩下的任务就是判断这 $k$ 个点是否在点 $x$ 和 $y$ 之间的路径上。由于 $\sum k\leqslant 2\times 10^5$，我们可以直接对 $x,y$ 之间的路径进行树上点差分，然后对于每个 $p_i$，查询该点是否被标记。由于是多次查询，故预处理出 $\rm dfs$ 序，用树状数组维护树上差分。

综上所述，我们得到如下解法：
- 对于每次询问，将点按深度排序，然后取出深度最大的点作为 $x$。
- 按深度由大至小判断，找到深度最大的一个点使该点不为 $x$ 的祖先，将该点作为 $y$。这一步可以通过树上倍增实现。
- 差分 $x,y$ 之间的链，并依次查询每一个 $p_i$，判断其是否在链上。

设 $K=\sum k$，该做法时间复杂度为 $O(K\log n)$，与 $q$ 无关，同样适用于 CF1702G1。