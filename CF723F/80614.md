首先，我们要把 $s,t$ 两个点去掉，然后会得到多个联通块，将每个联通块缩成一个点（同时将每个联通块都求出一棵生成树）。然后再恢复 $s,t$ 这两个点及其连边。

然后我们把这些原先是联通块的点分成三类：

$1$、只与 $s$ 相连。

$2$、只与 $t$ 相连。

$3$、二者都连。

首先 $s$ 和 $t$ 都要分别和第 $1,2$ 类点连边，所以一开始 $d_s$ 和 $d_t$ 都要分别减去对应类的点的个数（如果有一个不足，就说明无解）。

设第 $3$ 类有 $x$ 个。

若 $x\not=0$，则 $d_s+d_t\ge x+1$ 必须成立，因为这样才能至少有一个点使得它连接 $s,t$，使得整个图都连通（你可能会觉得，万一 $s,t$ 单独有连边可不可以连？可以，但是条件就变成了 $d_s+d_t\ge x+2,d_s>0,d_t>0$，更不优了）。

若 $x=0$，$s$ 和 $t$ 必须有连边，且 $d_s,d_t>0$。

代码可能有很多细节，反正我的代码是这样的。