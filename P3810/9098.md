## 楼下代码真是非常优美，补充一个树状数组套treap的大概思路。


- 我们要做的是查询有多少个比f(i)“小”的元素。

这时想到用treap？它可以做到查询一个节点的排名（有多少比它小的点）。

再想想发现只维护rank是不够的，因为此时有三维。


- 树状数组可以log维护前缀和，

而在我们按cmp排完序之后，保证了j = 1 ~ i中, aj < ai且bj < bi。满足条件的j只能在i的前缀中。


- 于是可以把treap套入树状数组？

每一个树状数组区间维护一个treap，查询当前区间满足条件的数量，

累加就能求得满足条件的j的数量。

最后答案维护的是满足数量为j的i有多少个……再进行转换即可。
