对于任意一点 $S$，令其为根。根据题意，$S$ 相邻两次不能往同一棵子树走，否则必会产生重合。因此两次去往同一子树至少相隔一次该子树外的标记。

设某一子树的大小为 $a$，总点数为 $n$。根据上述讨论结果，除去 $S$ 本身，若余下的 $n-1$ 个点中 $a-1>n-1-a$ 即该子树的大小减一大于了其余点的个数，则无论如何必然会有两次去往该子树，无法满足题设。从而需使 $2a\leqslant n$，即该子树的点不能超过总点数的一半。

为使路径总和最小，当使最后一次标记的点（假设为 $x$）距 $S$ 最远。这是因为根据题意，最后一次标记不需要返回，从而减少了 $\operatorname{dis}(S,x)$ 的距离。

当 $S$ 的某个子节点 $y$ 的子树点数达到 $n$ 的一半时，若第一次不走 $y$ 的子树，那么除去 $S$ 本身，其余部分就只剩下 $\frac{n}{2}-2$，此时无论如何均不能再满足题设。因此当 $S$ 的某个子节点 $y$ 的子树点数达到总点数的一半时，最后一次必然会标记该子树的点。因此需要从该子树中寻找深度最大的点。

综上所述，我们得到如下解法：
- 找到树的所有重心。
- 对于每个重心 $p$，令其为根，分类讨论：
   - 若 $p$ 有一个子树 $E$ 的节点数量达到 $n$ 的一半，则答案为 $2\big(\sum _x\operatorname{dis}(p,x)\big)-\max\limits_{y\in E}\operatorname{dis}(p,y)$。
   - 若不存在这样的子树，则答案为 $2\big(\sum _x\operatorname{dis}(p,x)\big)-\max\operatorname{dis}(p,x)$。

一棵树最多只有两个重心。而对于非重心的点，根据本题解开始时讨论出的结论，必然不可能存在一种标记点的方法使之满足题设，故均为 `-1`。

该解法时间复杂度为 $O(n)$。