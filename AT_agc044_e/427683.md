这他妈是怎么想到的？

考虑设 $f_x$ 为 $x$ 的期望，则 $f_x=\max(\frac{f_{x-1}+f_{x+1}}{2}-b_x,a_x)$。

如果 $b_x=0$ 我们就直接求一个凸壳就做完了，中间的期望可以证明是一段等差序列。

所以我们设 $g_x=f_x-c_x$，使得 $g_x=\max(\frac{g_{x-1}+g_{x+1}}{2},a_x-c_x)$。

那 $c_x$ 只需要满足 $c_{x-1}+c_{x+1}=2c_x+2b_x$ 即可，随便算。