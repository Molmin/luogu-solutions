# 题目大意

求对一个序列进行多少次双向冒泡排序可以使其有序。

# 题目分析

对 $a$ 进行编号（其实这里不应该叫做“离散化”，因为就算数据很小也需要进行所谓的“离散化”），则答案为 $\max_{i=1}^n\{\sum\limits_{j=1}^i[a[j]\gt i]\}$，其中 $[a]$ 的 $a$ 是一个逻辑语句，若 $a$ 为真则 $[a]=1$，反之则 $[a]=0$。

~~很遗憾，您上传的题解 P4375 [USACO18OPEN]Out of Sorts G 未能通过审核。原因是 应补充正确性证明；对解法的说明过少/不够清晰。~~

证明：

排序后，对于 $[1,i]$ 范围内不属于这个区间，即 $\exists j\in[1,i],a[j]\gt i$ 的所有 $a[j]$ 显然都会被移到 $[1,i]$ 外面去；相对应的，同时属于 $[1,i]$ 的也会被移一个进来。所以操作数就是 $[1,i]$ 内大于 $a[i]$ 的数的个数。

而这类似于逆序对，可使用树状数组维护值域求解。