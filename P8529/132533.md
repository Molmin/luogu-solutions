**P8529 Ynoi2003 Helesta**

经过大量的画图。画图。画图。感性理解。感性理解。感性理解。亦或是理性证明，我们发现对称差大小不超过将一条直线进行旋转平移路过的节点数。

我们在平面上上随机随机撒 $B$ 个贡献点，将每条直线挂在将该直线向上平移时第一个碰到的节点上。

将每个节点上的直线按照其**斜率**大小排序。

将贡献拆分为：

- 从一个贡献点通过平移转移到另一个贡献点；

- 对每个贡献点进行旋转扫描线，即从斜率小到大扫所有的直线；

- 在旋转扫描线扫到对应斜率的基础上，若此时扫到斜率 $k_i$，则以当前的直线（斜率加过贡献点确定的直线） $l$ 为参照物，设此时挂在该贡献点的直线且斜率为 $k_i$ 的直线为 $\{p_1,p_2,p_3,\dots,p_m\}$，从 $i \in [1 , m]$ 依次通过平移执行从 $l \rightarrow p_i,p_i \rightarrow l$ 的过程。

忽略常数。考虑第一种贡献和第二种贡献显然是不超过 $O(nB)$ 的，对于第三种贡献往返一次，因为是随机撒点那么等价于在序列上撒 $B$ 个点，期望到达最近的贡献点距离为 $\frac{n}{B}$。则得到总期望贡献 $O(\frac{nm}{B})$。

令 $B = \sqrt m$，可以得到期望贡献为 $O(n \sqrt m)$ 的。

称该种数据结构为半平面莫队。