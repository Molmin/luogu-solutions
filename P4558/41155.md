补充一下证明：

我们先分析“可以遍历所有格子”的方案长什么样。

- **性质1：** 首先，两个格子的方向不可能朝向同一个格子，这样会导致机器人不能遍历全部的格子。

由此可以导出两个推论：

- **推论1：** 矩阵的每一条“左下右上”对角线上，格子的方向相同。

- **推论2：** 如果从上到下给矩阵的每条左上右下对角线编号，则第$i$条与第$i+gcd(n,m)$条上，格子的方向相同。

为什么呢？**推论1**很好理解，因为它是通过**性质1**直接得出的。

**推论2**可以这样看：由于跨越下边界和右边界又会回到上边界和左边界，我们不难现象出，机器人实际上是在一个无穷大的平面内行走。如果从$(1,1)$出发，行走了$nm$步，每一步都不经过重复的点，意味着“可以遍历所有格子”。这个无穷大的平面由原始矩阵赋值无穷多次连接而成。而这个无穷矩阵显然也得满足**推论1**，因此，通过简单的数学推导得到了**推论2**.

由**推论2**进一步得到，机器人的运动方式是每$\gcd(n,m)$步为一个周期的。

令$d=\gcd(n,m)$，$\Delta x$为最开始的$d$步中，有几步向下走，$\Delta y$类似。那么，由于经过了$nm$步我们需要回到原点，并且中途不经过重复的点，我们可以列出下列式子：

纵坐标第一次回到$1$的时间是：$d*lcm(\Delta x,n)/\Delta(x)$，横坐标第一次回到$1$的时间是$d*lcm(\Delta y, m)/\Delta y$，因此它们同时回到$1$的时间是：
$$
d*lcm(\frac{lcm(\Delta x,n)}{\Delta x},\frac{lcm(\Delta y, m)}{\Delta y})
$$
又因为，第一次回到$1$的时间必须是$nm$，所以列出方程：
$$
lcm(\frac{lcm(\Delta x,n)}{\Delta x},\frac{lcm(\Delta y, m)}{\Delta y})=\frac{nm}{gcd(n,m)}
$$
将这个方程化简可以得到：
$$
gcd(\frac{\Delta x}{gcd(\Delta x, n)},\frac{\Delta y}{gcd(\Delta y, m)})gcd(\Delta x, n)gcd(\Delta y, m) = 1
$$
由此我们发现：

$$
gcd(\Delta x,n)=1
$$
$$
gcd(\Delta y,m)=1
$$
$$
gcd(\Delta x,\Delta y)=1
$$

我们把这个叫做**推论三**：

- **推论三：** 任何一个合法的方案都满足$gcd(\Delta x,n)=gcd(\Delta y,m)=gcd(\Delta x,\Delta y)=1$，且$\Delta x+\Delta y=gcd(n,m)$

既然得到了所有合法方案的通式，我们就可以尝试解决原问题了。