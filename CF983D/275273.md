Yet Another God Problem![](//图.tk/0)

## 思路

对于这种矩形覆盖的问题，一般考虑扫描线+线段树。

首先离散化坐标。扫描 $x$ 轴，对 $y$ 轴建线段树。离散化后设 $y$ 轴有 $tot$ 个端点，则有 $tot - 1$ 个区间，在线段树上每个叶子节点维护的实际上是每个**线段**的信息。

线段树上每个节点维护三个值：

- $mx$ 表示在当前区间内可以看到的且**还未被统计进最终答案**的最大的颜色。

- $mn$ 表示在当前区间内可以看到的且**已经被统计进最终答案**的最小的颜色。这意味着如果记 $cov_i$ 为**当前**覆盖住了第 $i$ 个区间的颜色，则 $mn_{rt}$ 为 $\min\limits_{k=l}^r cov_k$，其中 $[l,r]$ 为结点 $rt$ 管辖的区间范围。

- 再维护一个 `set` 表示覆盖住了当前区间的所有颜色 **（不一定是最大的）**。

`pushup` 时，首先先将 $mx$ 对儿子的 $mx$ 取最大值，$mn$ 对儿子的 $mn$ 取最小值。然后取出当前结点的 `set` 的最大值，记为 $col$，若 $col$ 未被统计进最终答案，则 $mx \gets \max(mx,col)$，否则 $mn \gets \max(mn,col)$。根据定义，若当前结点的 $mn > mx$，说明剩下的未被统计进答案的颜色没有能够覆盖住其他所有颜色的颜色了，$mx \gets 0$。

扫描到 $x$ 轴的每个端点时，先添加以当前端点为起始点的线段，删除以当前端点为终止点的线段。然后，若线段树上全局的 $mx$ 不为 $0$，则将 $mx$ 统计进答案，且在线段树上重新计算有关这个线段的所有信息。

时间复杂度 $O(n \log^2 n)$。

## 代码

[code](https://codeforces.com/contest/983/submission/164119093)