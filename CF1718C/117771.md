注意到给定的 $(s,k)$ 一定是沿着一个环在走，并且环长是 $\gcd(k,n)$；同时不难发现走了 $\frac{n}{\gcd(n,k)}$ 次，并且环上的点满足 $x \equiv s(\bmod \frac{n}{\gcd(n,k)})$。

因为环长必须是 $n$ 的因数，最多是 $O(\sqrt{n})$ 级别的；所以我们可以对所有不同的环长分开统计。

显然，我们可以在 $O(nd(n))$ 内求出所有可能的环对应的答案。

考虑修改，枚举每个 $n$ 的约数 $d$，修改 $x$ 所在环的数据然后更新最大值。

复杂度 $O(nd(n)\log n)$，单点修改全局最大无法做到 $O(\log n)$ 以内的复杂度，所以会被卡的很惨。

考虑优化，对于环长为 $k$ 的环，若 $p$ 是 $k$ 的因数，不难发现一定有一个长度为 $p$ 的环能完爆所有长度为 $k$ 的环。用平均值原理不难证明。

所以我们只需考虑环长为质数的环即可；$2\times 3 \times 5\times 7\times 11\times 13\times 17=510510$，所以复杂度 $O(7n\log n)$。