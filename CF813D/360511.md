好难，下面是我的全部思考过程，不会直接说结论。

考虑费用流，流量处理数的出现次数，费用处理最长长度。

每个数不能同时存在于两个子序列，那么可以对每个点拆点，流量为 $1$，费用为 $1$，表示一个数只能选一次，以及选了之后答案长度会贡献 $1$。

每个点都可以作为序列的开头，所以令源 $s$ 联向每个点的入点，流量为 $1$，费用为 $0$。同理，每个点都可作为序列的结尾，则令每个点的出点连向汇 $t$，流量为 $1$，费用为 $0$。

最多只有两个子序列，也就是说 $s$ 出发的流量最多为 $2$，则可以建立超级源 $s'$ 连向 $s$，流量为 $1$，费用为 $0$。

下面考虑相邻两项的限制，我一开始直接暴力 $n^2$ 建图，全部用 short 类型，最多只能冲到第 12 个点，需要找性质来优化。

考虑模 $7$ 同余这个条件，它是有传递性的。所以只需将 $a_i$ 与最近模 $7$ 同余的 $a_j(j>i)$ 连边。第一种方法是不选 $j$，$out_i$ 向 $out_j$ 连一条容量为 $\infty$，费用为 $0$ 的边，第二种方法是选，$out_i$ 连向 $in_j$。

之后是相差不超过 $1$ 的条件，我觉得这个是本题最难的地方，因为它不具有传递性。

如果按照模 $7$ 同余的方法建图，那么对于 $|a_i-a_j|=1$ 的两个点 $i,j(i<j)$，第一种方法不选 $a_j$，将 $out_i$ 连向 $out_j$，第二种方法选 $a_j$，$out_i$ 连向 $in_j$。

但是这样会出现什么问题，比如 $1,2,3$，如果 $2$ 不选，$1,3$ 还是会有流量的。

我们之所以会出现这种错误，是因为 $2$ 的出点连向 $3$ 的入点时，由于到 $3$ 的流量是从 $2$ 的**出点**进来的，出点就意味着 $2$ 是选的，而我们本身可能并没有选 $2$。

那么我们不妨就可以找到 $2$ 的等价形式，也就是找到之后另一个 $2$，我们把第一个 $2$ 的 $in$ 连向第二个 $2$ 的 $in$，表示如果你第一个 $2$ 不选，那么你其实可以去尝试一下第二个 $2$。

但是这个你会发现模 $7$ 同余与相差为 $1$ 会混，因为一个入点和出点只能表示一个意思。

所以你可以对每个点再拆出来两个点，分别表示模 $7$ 的点和相差为 $1$ 的点，两个点都向 $in$ 连容量为 $\infty$，费用为 $0$ 的边。

注意这里容量是 $\infty$，因为你可能是两个子序列，一个子序列选了 $i$，直接经过 $in$ 到 $out$ 的边，另一个子序列则是可能直接去找了 $a_i$ 的等价形式。