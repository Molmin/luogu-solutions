刚开始看错题了，注意一对逆序对 $(i, j)$ 的贡献是 $j - i$。
  
  那么我们要计算的就是
  
  $$
  \sum_{i = 1} ^ n \sum_{j = 1} ^ n [j < i \land a_j > a_i]i - [j > i \land a_j < a_i]i
  $$
  
  对于每一个 $i$，发现我们要计算的后面的一大串和式加起来其实是一个定值，具体来说，对于任意排列 $a_i$，$i$ 左侧大于 $a_i$ 的数的个数减去右侧小于 $a_i$ 数的个数为 $i - a_i$，通过交换左右两侧的数不难证明。
  
  也就是说，我们要求
  
  $$
  \sum_{i = 1} ^ n i(i - a_i)
  $$
  
  也就是求每个位置 $i$ 的数经过 $m$ 次变换到位置 $j$ 产生的贡献，直接做是 $\mathcal O(n ^ 3 \log m)$ 的，但是（打表）发现对于一排的系数是富有规律的，似乎是对称的（除了个别位置）。
  
  解释这个规律，对于位置为 $i$ 的数，若至少离开 $i$ 一次，那么最后到达 $j$ 的方案数一定和到达 $n + 1 - j$ 的方案数相同，只需要讨论方案的最后一步有效操作即可，假设是从 $i \to j$，那么方案数是 $\min(\min(i, n - i + 1), \min(j, n - j + 1))$，而 $i \to n + 1 - j$ 的式子也是这个式子，因此方案数是相同的，系数也自然左右对称。
  
  因此在我们计算过程中，系数相同的两部分可以合并起来一起计算，具体来说
  
$$
\sum_{x = 1} ^ n \sum_{i = 1} ^ n -E_{value\_x\_to\_i} ix
$$
$$
= \sum_{x = 1} ^ n \frac {\sum_{i = 1} ^ n -E_{value\_x\_to\_i} (n + 1) x} 2
$$
$$
= \frac {\sum_{x = 1} ^ n (n + 1) x \sum_{i = 1} ^ n -E_{value\_x\_to\_i}} 2
$$
  
  发现我们只需要对一排的系数求和，那么就是求权值 $x$ 至少移动一次的方案数，这很容易实现。
  
  前面漏掉的就是每个位置的数一步不动的贡献，这直接算就好了。
  
  最后时间复杂度 $\mathcal O(n \log m)$。