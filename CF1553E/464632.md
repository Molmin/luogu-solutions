##### E

题目大意：给定一个长度为 $n$ 数组 $p$，求可以将数组 $id = [1,2,3,...,n]$ 通过循环右移 $k(0 \le k \le n - 1)$ 次之后，交换**不小于** $m(0 \le m \le \frac{n}{3})$ 个数字，得到数组 $p$ 的 $k$ 的个数。

如果把数组中的所有元素减一，那么数组变成 $[0,1,2,..,n-1]$，右移 $k$ 位之后第 $i$ 位（从 $0$ 开始）原本是 $i$，变成 $(i-k) \operatorname{mod} n$，表示比较方便。

可以想到遍历每一个 $k$，判断 $id >> k$（即 $(id>>k)_i = (i - k) \operatorname{mod} n$ 要变成 $p$ 的最小次数是否小于等于 $m$。要如何判断呢？以下是经典模型：

$a$ 数组和 $b$ 数组都有 $n$ 个数，并且它们都是 $n$ 的排列。若每次可以交换 $a$ 中任意的两个数，求将 $a$ 变成 $b$ 的最小交换次数。

例如 $a = [4,2,3,1],b = [1,2,3,4]$，将 $a_0=4$ 与 $a_3 = 1$ 交换，得到 $b$ 数组。于是最小交换次数为 $1$。

这个基本模型的一个通用解法是：建立一张 $n$ 个点的图，对于 $0 \le i \le n - 1$，建立无向边 $a_i,b_i$。那么最小交换次数就是 $n-c$，其中 $c$ 表示这个图中连通块的个数。

![](![](https://cdn.luogu.com.cn/upload/image_hosting/wafbjgji.png))

原理：交换 $(a[i],a[j])$ 相当于断开边 $(a[i],b[i]),(a[j],b[j])$，并加边 $(a[i],b[j]),(a[j],b[i])$。 因为一个环（没有其他多余的边）删去两条边一定能够将其断成两个环，那么交换一次环内的边就可以把一个环断成两个环，即环数 $+1$。

注意到，如果超过 $2 \times m$ 个数字是不在位置上的，那么需要的交换次数超过 $m$。所以在位置上的数字数必须大于 $n - 2 \times m$。于是我们只需要判断在位置上的数字数 $cnt_k$ 大于 $n - 2 \times m$ 的 $k$。因为对于每一个 $p_i$，只有一个 $k$ 满足 $(i-k) \operatorname{mod} n = p_i$。所以在位置上的数之和为 $n$。由于 $m \le \frac{n}{3}$，所以满足 $cnt_k \ge n - 2 \times \frac{n}{3} = \frac{n}{3}$ 的 $k$ 最多有 $n \div \frac{n}{3} = 3$ 个取值。

因此对于每一个测试点，最多用以上模型检验 $3$ 次，故时间复杂度 $O(n)$。

