

注意到进行完前 $i$ 次操作之后，$s_{i+1}$ 要么在 $i$，要么在 $i+1$，取决于上一次 $s_i$ 是否在 $i$ 位置且上一次执行的是否是 `R` 操作。

因此设 $dp_{i,0/1}$ 表示进行完前 $i$ 次操作后，$s_{i+1}$ 否/是被移到了 $i$ 位置后最小的字典序，转移就分 `OUDLR` 五种情况转移即可，时间复杂度 $\mathcal O(n^2)$。

注意到每次操作影响的区间极小，可维护，时间复杂度优化至 $\mathcal O(n)$。