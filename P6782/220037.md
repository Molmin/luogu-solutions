skydogli 写的什么东西啊，看不懂太神了（（（

给一个比较垃圾地做法，虽然跑到目前 rk1（（（

首先考虑暴力做法：把每一个询问放到对应节点上面，然后用线段树合并来维护。对每一个节点求答案的时间复杂度是 $O(q_ic_i\log n)$，其中 $q_i$ 是有多少个询问，$c_i$ 是有多少个孩子，总共时间复杂度是 $O(\sum q_ic_i\log n)$ - 当数是一个菊花的形式就卡到 $O(nq\log n)$ 了。

但是会发现这样直接实现都达到 51 分的好成绩，于是考虑乱搞。

 - 优化 1：特判大小为 1 的儿子，69 分
 - 优化 2：稍微对动态开点线段树卡卡常数，75 分
 - 优化 3：当 $q_ic_i<B$ 的时候暴力跑，否则特判重儿子，然后离散化然后跑莫队，100 分。

莫队维护的东西也就是当前区间里面的 $\sum\binom{o_i}{2}$，其中 $o_i$ 是每一个“颜色”出现了多少次 - 在这里“颜色”就是每一个节点对应的子树。复杂度我一点都不会分析，lxl 说是 $O(n\sqrt{m\log n})$ 或者 $O(n\sqrt m)$ 如果 $B$ 选对了。

然后空间没刻意卡跑的离上限少几个M，代码乱的一塌糊涂（逃

由于是 Ynoi 代码也就不放了。