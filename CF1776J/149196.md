来写一波口胡过程。

可以发现，假设图只有一个点，那么我们去画这个图的 $k$ 拓展。一开始是一个点，然后是一条边，然后是一个方形的圈，再然后是一个立方体。可以观察到，一个点的 $k$ 拓展实际可以看做一个 $k$ 维超立方体。那么我们已经能对一个点求出答案了——从超立方体的“一角”（即 $00\dots0$，从二进制视角看的话）走到“另一角”（即 $11\dots1$，从二进制视角看的话），答案恰好是 $k$。

再想想，如果所有点都是同一个颜色，那么事实上对于任意两超立方体 $u,v$ 的两点 $p,q$ 的最短路，我们都可以在 $u$ 中直接从 $p$ 走到 $q$，然后再顺着原图的边从 $u$ 走到 $v$。答案就是 $k$ 加上原图的直径。

然后接下来考虑异色怎么办。手摸一下，发现走两次异色，正好能回到原点，走一次异色，正好能走到对角（事实上从二进制视角来说就是 $01$ 翻转，比如 $010$ 的对角就是 $101$）。那么我们依旧考虑对任意两超立方体 $u,v$ 的两点 $p,q$ 的最短路。如果 $u$ 到 $v$ 同时存在走奇数和偶数次的路径，那么从 $p$ 到 $q$ 就出现了两种方案：从 $p$ 走到 $q$，然后再从 $u$ 到 $v$，图中经过偶数次异色；从 $p$ 走到 $q$ 的对角 $q'$，然后再从 $u$ 到 $v$，图中经过奇数次异色。一种简单的实现方式是枚举 $p$ 和 $q$ 的二进制位存在几位不同（因为我们只需要关心这个），然后对所有方案求个 $\min$ 就行。当然，如果只存在一种类型的路径那最短路就是 $k+\text{dis}(u,v)$。