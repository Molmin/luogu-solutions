首先，注意到 $d$ 是递增的，也就是说每个城市会选择距离他最近的「区域信息中心」。

可以发现在此时，对于每个「区域信息中心」，**把他选定**的城市一定是一个**联通块**。

我们考虑将问题转化为：把树分为若干个联通块，对于每个联通块，选择一个「区域信息中心」，表示这个「联通块内的所有点」都选择了这个「区域信息中心」。每种方案的代价为：「每个点的 $d_{len}$」+「联通块个数」乘 $k$。

这个转化显然有一些问题：并不是所有情况，都对应这一种合法的「区域信息中心选择方案」。

但是可以发现，每种「区域信息中心」选择方案，都被上述问题考虑了，而那些不合法的方案，都不可能成为最优的（感性理解）。

所以，我们求出新问题的最优解，一定是原问题的最优解。

新问题的 DP 就非常简单了，我们考虑对于每个联通块，在其根部计算 $k$ 的贡献。

 $dp(i, j)$ 表示 $i$ 的子树里，$i$ 选定的「区域信息中心」为 $j$，转移很简单不说了，由于 $n$ 的范围，$O(n)$ 转移即可，但容易做到 $O(1)$。

[代码](https://codeforces.com/contest/70/submission/209955535)。



