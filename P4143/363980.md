### 来篇非线段树的单 $\log$ 做法。

### 只需后缀数组就可简单实现。

对于每一个后缀单独考虑，设这个后缀的开始位置为 $i$。

用后缀数组表示所有子串就考虑一个后缀的所有前缀，假如当前的前缀终止位置为 $i$。

那么现在的子串是 $s[i \sim j]$。

不难发现，如果再在后面加入一个字符，那么它对应的字典序排名单调下降，权值单调递增，那么这两个函数一定会有一个交点，这个交点就是我们需要的。

那么我们考虑二分这个位置，权值不难用前缀和求出，但是字典序不好搞，然后套路的就是用 $ht$ 数组建出笛卡尔树，或者叫后缀树，然后求出这棵后缀树的 $\text{dfs}$ 序，就求出了字典序。

那么我们在序列上二分就对应着在后缀树对应的终止节点上倍增二分，这样字典序也就求出来了。

要注意好实现细节，因为后缀树是一棵压缩的 $\text{trie}$ 树，所以我们在求出节点后要继续向上二分。

具体可以看代码，写的还是蛮简洁的。

[code](https://www.luogu.com.cn/paste/hl4jh0jm)
