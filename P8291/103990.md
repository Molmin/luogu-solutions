提供大致做法，目前没有代码

### 先考虑限制C的情况  
我们将每条消息拆成楼上和楼下两个点，  
那么一个消息排列就是一个楼上与楼下的匹配,  
对于一个符合实际匹配就能贡献1,  
不难建出二分图最大匹配，
但这样实现有可能出现环的情况  
题目保证了每个人至少一个学术消息，考虑用它断环成链  
不妨假设当前有环 $A->B->...->C->A$ 和链 $D->F->...->E$,  
$D$ 和 $A$ 是同一个人说的，  
$E$ 和 $A$ 是同一个人说的 的情况本质相同，不加赘述  
情况 1 若 $A->B$ 的边是 $A$ 中贡献的，那么 $C->A$ 的边就是 $C$ 贡献的，那么将$C->A$ 变为 $C->D$ 不影响答案

情况 2 若 $A->B$ 的边是 $B$ 中贡献的，那么将$A->B$ 变为 $A->F,D->B$ 不影响答案，但这要求 $D->F$ 的边是 $F$ 贡献的

那我们可以先断情况2的环，初始学术消息一定满足限制，然后再断情况1的环，即可将所有环断环成链

### 无限制条件：

不难发现就是变成了一个二分图最大权，即那两条消息相互满足贡献 2 ，  

不难发现存在 贡献为 2 的边的一定无法成环， 也即上面的断环方案一定可行

然后就是每个人建虚点即可优化边数，不确定是否能跑