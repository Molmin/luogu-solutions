1. 对于一次抽奖，如果没有抽中，一定会继续抽

如果没有抽到状态是不会变的，也就是说如果没抽到那么下一步执行的定是当前状态的最优策略，也就是说如果最优策略是抽奖那么没抽到一定继续抽。

2. 一次抽奖等效为用 $(\frac{n}{k}+1)\frac{x}{2}$ 的代价随机从没购买的商品中抽一个（$k$ 是没购买的商品个数）。注意随着 $k$ 递减（即购买的越多）此代价递增。
3. 在选择购买商品之后便不会进行抽奖操作

这是由 $c_i\ge x$ 保证的。如果不保证很容易有反例如 $x=1,c=[0,0,0,5]$，最优策略是购买三个价值为 $0$ 的商品后进行抽奖。

假设没买的商品是 $a_1\le a_2\le \cdots\le a_k$ 时，购买了 $a_i$，然后进行抽奖。现在考虑一个策略：先抽奖，如果没抽到 $a_i$ 那么下一步就购买 $a_i$，否则继续抽奖。我们可以对这两个策略的比对做出预测：两个策略的行为几乎一致，如果没抽到 $a_i$ 就会继续随机，这个随机与先随机再买 $a_i$ 是差不多的。由于现在随机比下一步随机代价少，因此某种程度上后者会更优。

令 $S=\{1,2,\cdots,k\}$，$f(S)$ 为没买的商品集合为 $S$ 时的答案，则前者的期望花费是
$$
a_i+(\frac{n}{k-1}+1)\frac{x}{2}+\sum_{j\not= i} \frac{f(S-\{i\}-\{j\})}{k-1}
$$
后者的期望花费是
$$
(\frac{n}{k}+1)\frac{x}{2}+\sum_{j\not= i} \frac{a_i+f(S-\{i\}-\{j\})}{k}+\frac{1}{k}((\frac{n}{k-1}+1)\frac{x}{2}+\sum_{j\not= i} \frac{f(S-\{i\}-\{j\})}{k-1})
$$
经过比对，后者的求和式的系数是 $\frac{1}{k}+\frac{1}{k}\frac{1}{k-1}=\frac{1}{k-1}$ 与上式抵消。因此我们要证明的是
$$
a_i+(\frac{n}{k-1}+1)\frac{x}{2}\ge (\frac{n}{k}+1)\frac{x}{2}+\frac{k-1}{k}a_i+\frac{1}{k}((\frac{n}{k-1}+1))\frac{x}{2}
$$
经过相同的比对，所有与 $x$ 有关的项化简成 $\frac{1}{k}\frac{x}{2}$，所以这个式子就化为 $a_i\ge \frac{x}{2}$ 了。在 $a_i\ge x$ 的前提下这显然是正确的。



所以我们的最优策略一定是先一直抽奖，到某个时刻忽然选择正常购买，然后以任意顺序把剩下的物品都买了。

根据 $\sum c_i\le 10000$ 我们容易想到正解复杂度与 $\sum c_i$ 有关，所以我们容易想到将 $S$ 变成某种只与 $S$ 内部 $c_i$ 的和有关的东西。可是此题可以花费 $c_i$ 在除 $S$ 内所有物品中购买，不好刻画。我们不妨做一个大胆的转化，将第一个操作 ”花费 $c_i$ 碎片购买第 $i$ 种圣物“ 变成 “随机选择一个没购买的商品，以 $c_i$ 的代价购买”！

由于我们的主动权降低了，因此新问题的最优答案一定大于等于原题的最优答案。但是如果我们得到了原题的一个策略，我们可以在新问题中一直仿照，在原问题决定从抽奖变成购买后在新问题中也从抽奖变成随机购买。所以**新问题的最优答案等于原问题的最优答案。**

由于两者都是从没购买的物品中随机，因此当我们在一个状态 $S$ 时我们只需比较 $(\frac{n}{k}+1)\frac{x}{2}$ 与 $\frac{\sum c_i}{k}$ 的大小即可确定是抽奖还是随机购买。怎么计算答案也比较简单，考虑期望线性性，由于每一步都是在没有的物品中随机，因此拥有的物品的概率分布与策略是没有任何关系的。对于一个 $S$ 它被经过的概率是 $1/\binom{n}{|S|}$，而它对答案的贡献只与 $\sum c_i$ 有关，因此对于相同的 $|S|,\sum c_i$ 可以一起计算答案。做一个 $O(n^2|S|)$ 的暴力背包即可将答案算出。由于此题是在 double 下做运算，所以 dp 数组需要带着 $\binom{n}{|S|}$ 的因子，具体来说可以写成 $f_{i,siz,sum}=f_{i-1,siz,sum}+f_{i-1,siz-1,sum-c_i}\frac{siz}{n-siz+1}$