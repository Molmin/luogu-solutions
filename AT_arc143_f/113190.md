考虑从小到大，枚举一个 $a\not=2^k$ 表示第一个非 $2^k$ 形式数。那么前面 $2^k$ 形式数构成的是长度为 $2^{k+1}$，每个数覆盖一次的 cover 。加入 $a$ 后就存在了覆盖次数为 $2$ 。

我们考虑接下来的过程，去掉首尾的长度为 $a$ 的 $1$ 段。每次相当于是先自我复制，再在中间插入一段长度为 $[a,2a]$ 的段（$1$ 段相交区域）。

注意到因为 $>n$ 的数没有限制，于是一个方案的贡献为其最后一个 $2$ 距离 $n$ 的距离（当然还要考虑选数重复的情况等）。我们考虑上述过程可以写成一棵完全二叉树，我们从左到右，枚举第 $x$ 个节点为 "恰好越过 $n$ 的点"，然后按层 DP 处理方案数即可。

复杂度：枚举 $a$ 为 $n$ ，$x$ 是 $\frac{n}{a}$，DP 则是 $O(n\log \frac{n}{a})$ 的。于是总记 $O(n^2\log^2 n)$ 。不过我写代码时好像复杂度错了，但这是容易避免的。因为跑过了所以没管了。

提交记录：[Submission #39773471 - AtCoder Regular Contest 143](https://atcoder.jp/contests/arc143/submissions/39773471) 。