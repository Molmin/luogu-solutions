这是官方题解的 $O(n^3)$ 做法。

我们考虑枚举环上最特殊的那个点，也就是连出去一条边的点，设它为 $S$。

我们考虑使用 Dijkstra 以 $O(n^2)$ 找到包含 $S$ 的最小环。

具体地，使用 Dijkstra 建出最短路树 $T$，设点 $u$ 到 $S$ 的最短路为 $f_u$。给每个点设一个 $h_u$，若 $u = S$ 则 $h_u = S$，否则 $h_u$ 为 $S$ 的一个直接儿子，使得 $u$ 在 $h_u$ 子树内。这样，对于一条边 $(u, v, d)$，若 $h_u \ne h_v$，那么经过这条边的最小环长度为 $f_u + f_v + d$。这样不仅能找出最小环长度，还能按顺序找到环上的每一个点。

设最小环长度为 $k$，$S$ 在最小环上相邻两点为 $x, y$。然后我们考虑 $S$ 连向不在这个环上的点的边 $(S, v, d)$，对答案的贡献为 $k + d$。但是这还不够，我们还需要考虑 $S$ 连出去的边 $(S, v, d)$ 在这个环上的情况。

注意到，若 $v \ne x \land v \ne y$，这条边对最优解**一定**没有贡献。因为若我们强制钦定 $v$ 不在环上出现，求出来的最小环长 $t$ 一定 $\ge k$，最终贡献到答案中的是 $t + d$。而我们显然是可以只保留环上 $S \to v$ 的点，做到对答案的贡献 $\le t + d$（可自行画图）。

因此我们只用考虑边 $(S, x, d)$ 和边 $(S, y, d)$。删除这两条边后，再做一遍最小环即可。

注意一些最小环不存在或图不连通的处理即可。

[code](https://atcoder.jp/contests/abc308/submissions/43452621)