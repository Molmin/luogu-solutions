CF223E Planar Graph 题解。

简单提一下官方题解的 tricky 做法。

首先拿到题目的第一反应肯定是平面图欧拉定理。然后考虑求出 $F$、$E$ 就可以得到 $V$。@滑大稽 搞出了一个基于 [HNOI2016] 矿区 的做法，可以膜她。这里是不是应该用感叹号。

上述做法是基于平面图对偶的。但由于此题询问的良好性质，所以并不需要对偶。

具体地，每一次询问都是一个环状结构。这使得需要被统计的点（环内点）必须经过环上点才能够到达环外。考虑利用这个性质计数。

构造一个流模型：以某个点作为汇点，为每个点赋予 $1$ 的额外流量，让所有点都向着汇点流去。每次询问，计数 流出环 和 流入环 的流数量之差，即为所求。

正确性证明，考虑环内点流出必须经过环，环外点若有流经环内，则必定会流出环。

如何统计这样的流的数量呢？首先图上统计显然是劣的，考虑构建一颗原图的生成树。若此时我们将流网络的汇点设为一个极值点（比如图的最左侧、最右侧点或新建一个极远点），并将汇点作为生成树的根，那么所有环边界上点的邻边中产生环内流向的必定会形成一段倾斜角连续的区间，可以对每个点的出边做极角排序并处理前缀和，这样每次询问就可以快速统计答案。

做法基本就这样，但有几个小的实现细节。

1. 注意到贡献有正有负，可以在生成树上将父边贡献设为负权，子边贡献设为正权，这样可以一起统计。
2. 因为需要取的是极角排序后的一段连续区间，所以环上点必须固定顺/逆时针。题给点并未保证顺逆，但可以通过叉积求面积后的正负性来判断，从而保证顺序。