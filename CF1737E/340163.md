首先模拟几个小情况，记 `L` 表示第 $i$ 只蚂蚁向左走，`R` 表示向右走。比如 `RLLRRLRRLLLRRLRRR`，最后一个 `R` 可以直接变成 `L` 不影响，那么假设当前的 `L` 位置在 $r$，左边最近的 `L` 在 $l$，这样就会形成一个向左的重量为 $r-l$ 的蚂蚁。现在就相当于若干个向左走的蚂蚁，比如上面那种情况就应该表示成 $2,1,3,3,1,1,3,3$。

据此可以得到 $O(n^3)$ 的 DP，但是这样很菜。

注意到上面这种转化的方式本质上可以被看做将一个大块切成若干个小块，首先可以发现有效的方案数只有 $2^{n-1}$ 个（最后一个是什么不影响），并且发现比较的方式类似于，“取出队头的两个数，将值小的合并到大的（有偏序关系），求出和并放回队头”，直接考虑倒推。定义 $f_i$ 表示当前队头蚂蚁重量为 $i$，这只蚂蚁获胜的方案数。可以发现有 $f_i = \sum_{j=i+1}^{2i-1} f_j$，可以后缀和优化（不乘系数的原因是，$f_i \to f_j$ 的方案只有一种，后面的没确定的在 $f_j$ 里处理）。

接下来要算的是第 $i$ 只蚂蚁要在前 $i$ 只蚂蚁中活下来的概率，注意到要获胜一定要有至少 $\lceil \frac{i}{2} \rceil$ 的重量，所以方案数是 $2^{\lfloor \frac{i}{2} \rfloor}$。两者独立，乘起来再除以总方案数即可。

[评测记录](https://codeforces.com/contest/1737/submission/180262300)。