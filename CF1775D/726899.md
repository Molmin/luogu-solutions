考虑建图跑 bfs，在每个蜘蛛之间建边的时间复杂度是 $O(n^2\log a)$ 的，直接 TLE。

注意到 $\gcd(a,b)≠1$ 的前提是 $a,b$ 有共同的质因数，于是考虑在每个质因数之间建边。

筛出在 $a_i$ 范围内的所有质因数，将每个 $a_i$ 分解质因数，这里的时间复杂度是 $O(n\times f(\sqrt a))$（$f(x)$ 表示 $≤x$ 的质数个数）。若 $a_i$ 有两个不同的质因数，就在这两个质因数之间建一条边，由于 $a_i$ 最多有 $\log a_i$ 个质因数，这里的时间复杂度是 $O(n\log^2a)$。

为了方便判断起点和重点，我们构建虚点 $x$ 与起点 $a_s$ 的所有质因数建边，虚点 $y$ 与终点 $a_t$ 的所有质因数建边。从 $x$ 向 $y$ 跑 bfs 即可求出答案，bfs 的时间复杂度是 $O(f(a))$。

**一条边的实质是一只蜘蛛**，为了统计路径，边需要记录搭这条边的蜘蛛编号。bfs 时每个到达的质因数节点需要记录路径的上一个质因数节点（即从哪个来的），和转移通过的蜘蛛。最后从终点倒序输出路径即可。