容易发现满足限制的数据保证：

$n$ 是奇数，$a_n$ 为偶数，$a_n/g$ 为奇数。

枚举最大的 $k$ 使得 $2^k|g$，那么将所有数都除以 $2^k$ 之后，即在 $\frac {max_a}{2^k}$ 中选出奇数个数，且最大的一个是奇数的方案数。

令 $f(a,p)$ 为从 $1\sim a$ 中选出若干个数且最大的一个数奇偶性为 $p$ ($1$ 是奇数)的生成函数

不包括选 $0$ 个数

那么考虑倍增求

$$f(2a,p)=f(a,p)+(f(a,0)+f(a,1)+1)(f(a,p \oplus(a\bmod 2)))$$

左边一部分表示只选 $\leq a$ 的数，右边一部分选了 $>a$ 的数，$>a$ 的就是先选 $\leq a$ 的然后整体 $+a$

然后又有

$$ f(a+1,p)=f(a,p)+[(a+1)\bmod 2=p]x(f(a,0)+f(a,1)+1) $$

因此可以在 $O(max_n\log max_n\log max_a)$ 时间计算 $f(a,p)$

要求得答案即所有 $f(\frac{max_a}{2^k},1)$ 之和，容易发现在算 $f(\frac{max_a}{2})$ 时就已经求出过所有 $f(\frac{max_a}{2^k})$ 了

故时间复杂度 $O(max_n\log max_n\log max_a)$