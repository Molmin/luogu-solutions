首先根据题目可知这是一个完全图.

如果不考虑边的方向，那任取三个点都能构成一个环.

现在题目给了这些边一个方向，所以一个环不合法，当且仅当其上有一个点出度为 $2$ .

于是我们的答案就是 $\binom{n}{3}-\sum\binom{d_i}{2}$ ，这里的 $d$ 表示出度.

记 $0$ 为初始连边状态， $1$ 为反转连边状态， $p_x$ 为 $x$ 和现在这个点**当前的**连边状态 .

于是题目的操作就可以转化成区间反转区间查询了，使用线段树即可.