[题目传送门](https://www.luogu.com.cn/problem/P7525)

神仙结论题。

发现部分分有很强的引导性。

首先全是一个字符的情况，最大 border 显然是 $n-1$（$n$ 为当前字符串长度），然后就可以设 $s_i$ 表示操作 $i$ 次的长度，递推得到 $s_i=2s_{i-1}-1$，其中 $s_0=n$。从而有 $s_k=2^ks_0-(2^k-1)$，直接快速幂即可。

然后考虑最小正周期小于 $n$ 的情况，显然这个串是循环的，不妨设这个最小正周期为 $t$。

然后这个字符串就可以看成由 $t$ 个最小循环节拼成的串，每次把 $t-1$ 个循环节接到串后面，每个循环节长度为 $\dfrac{n}{t}$，把这样的串看成一个字符，所以递推同上，有 $s_k=2^ks_0-(2^k \times \dfrac{n}{t}-\dfrac{n}{t})$
，瓶颈在找最小循环节上，显然最小循环节是 $n$ 的因数，于是枚举所有 $n$ 的因数，对于每个循环节暴力 $O(n)$ 判断即可，由于因数个数很少，并且有找到合法循环节就退出，失配就立刻退出等等剪枝，跑得飞快，可以直接过掉。

然后考虑没有小于 $n$ 的循环节怎么做。首先没有 border 答案显然是 $n$。

显然可以 KMP 预处理出当前能最长匹配的前后缀长度。

发现每次只会在后缀上加一段，所以后缀会越来越大，而前缀不变。

如果前缀是后缀的子串，那么显然加 $k$ 次前缀的长度即可，直接做。

如果后缀是前缀的子串，设后缀长度为 $m$，显然第 $i$ 次操作会在末尾加上 $2^{i-1} \times m$，直到后缀不再是前缀子串为止，然后就回到上一段的情况了，直接做剩下的部分即可。
