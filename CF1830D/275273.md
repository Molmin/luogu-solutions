考虑答案的下界。

对整棵树进行二分图染色，我们得到答案是 $n \times (n + 1) - O(n)$ 级别的。但是二分图染色不一定是最优的。

考虑计算 $O(n)$ 的损失。发现在极大同色连通块内的点对才会造成损失，并且因为损失是 $O(n)$ 的，所以极大同色连通块大小是 $O(\sqrt{n})$ 的。

考虑 dp，设 $f_{u,0/1,i}$ 为包含 $u$ 的极大颜色为 $0/1$ 的连通块大小是 $i$ 的最少损失。转移就按照直接树形背包合并就行。注意我们在 $v \to u$ 且 $u,v$ 颜色不同时计算 $v$ 的连通块的贡献。

本题卡空间，因此需要对于每个 $f_{u,0/1,i}$ 开大小为 $\min(sz_u, \sqrt{n})$ 的 vector，并且合并完立刻销毁。

[code](https://codeforces.com/contest/1830/submission/207715342)