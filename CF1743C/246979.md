考虑 DP。

设 $f_{i,0/1}$ 表示考虑到第 $i$ 个箱子为止，当前（第 $i$ 个）箱子的盖子往前传 / 留在原地时的最大保护价值。

当 $i$ 处原本有盖子时：

$$
f_{i,0}=\max(f_{i-1,1},f_{i-1,0}+a_{i-1}),\quad
f_{i,1}=\max(f_{i-1,0},f_{i-1,1})+a_i;
$$

否则 $f_{i,0}=f_{i,1}=\max(f_{i-1,0},f_{i-1,1})$。

初值设为全 $0$ 即可。