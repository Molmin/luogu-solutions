#  Bird题解

听说这题是用笛卡尔树秒的，但因本蒟蒻太菜，不会。于是用了另外的一些~~乱搞~~巧妙的做法。这里将以不同的分分段讲解。

## $10pts$
爆搜即可。注意几个细节:

一，使用各个卡牌之间相互独立，因此将各个卡牌分开选；

二，每一次飞要飞到不能再飞为止，不然一定是亏的；

[Bird 10pts代码](https://www.luogu.com.cn/paste/h4vzgkfp)

## $30pts$


加上记忆化即可得 $30pts$

[Bird 30pts代码](https://www.luogu.com.cn/paste/lowgaob1)


## $70pts$


减去无用状态！！！

可以发现，在第 $x$ 个点时，并不是飞到的每个点都是最优的。

如果飞到点 $y$, 且有另外的能飞到的一个点z使得 $a[z]>a[y]$，则可以先飞到 $z$，再由 $z$ 飞到 $y$。

设x位置左边第一个 $\geqslant x$ 的数的下标为 $L[x]$，右边为 $R[x]$。

最终得出结论：$x$ 只有飞到 $L[x]\cdots x-1$ 中的最大值们与 $x+1\cdots R[x]$ 中的最大值们时才有可能得到最大值。

**为什么要强调“们”呢？？？**

最大值不一定只有一个，各个最大值之间可能答案不同。

如何优化查询答案的时间？

将卡牌数组排好序（因为不同的顺序使用答案相同）

再将存树的高度的数组加上下标排好序。

因为 $b[i+1]\geqslant b[i]$，且 $a[i+1]\geqslant a[i]$.

用一个变量存上一个 $b[i]$ 到的节点与答案，$b[i+1]$ 时继续访问，更新最大值即可。

时间复杂度：$O(n^2+nlogn+mlogm)$

注：由于本题数据水，可以卡到 $100pts$。

[70~100pts](https://www.luogu.com.cn/paste/9u1v18e3)


## $100pts$



仔细想一想，在查找最大值们的时候可能会超时。

设 $x$ 位置左边第一个 $\geqslant x$ 的数的下标为 $L[x]$，右边为 $R[x]$。

既然查到 $y$ 时 $a[y]<a[x]$，那么根据定义，$a[L[y]+1\cdots y-1]<a[y]<a[x]$。

那么只需直接跳到 $L[y]$ 就可以了！！！

$O(n\log n+m\log m)$
且常数极小


[AC代码](https://www.luogu.com.cn/paste/z5lhjx5g)