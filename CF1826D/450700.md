**题目大意：**

从序列中选出一段区间 $[l, r]$，再在这个区间内选出三个数 $b_{i_1},b_{i_2},b_{i_3}$，定义这个区间的权值为 $b_{i_1} + b_{i_2} + b_{i_3} - (r - l)$，输出最大的权值。

**sol:**

首先可以注意到一个性质：选的三个数肯定是 $b_l, b_r$ 和区间内的最大值。

因为如果选的数不是左右端点，我们将区间的范围减小只会减小区间的长度而不会影响到 $b_{i_1} + b_{i_2} + b_{i_3}$ 的值，所以一定是更优的。

我们考虑将贡献拆出来，定义 $L(i) = b_i + i$，定义 $R(i) = b_i - i$。

可以发现一个区间的权值：

$$b_l + b_r + b_i - (r - l) = b_l + b_r + b_i - r + l = L(l) + b_i + R(r)$$

考虑枚举 $i$，对于每个 $i$ 的贡献为 $\max_{l < i}{L(l)} + \max_{r > i}{R(r)} + b_i$。

将 $L(i)$ 预处理前缀 $\max$，对 $R(i)$ 预处理后缀 $\max$，对于每个 $i$ 的统计贡献的复杂度就下降到 $O(1)$。

总体复杂度为 $O(n)$。

代码就不放了，大家应该都会写。