看到全是矩阵加速的题解，于是胡了一个奇怪做法……

令 $P=10^9+7$。此后的所有 $P$ 均代指该模数。

考虑递推关系的特征方程：$q^2-xq-y=0$。直接求解得到 
$$
q_1=\frac{x+\sqrt{x^2+4y}}{2},q_2=\frac{x-\sqrt{x^2+4y}}{2}
$$
待定系数法，设
$$
a_n=c_1q_1^{n-1}+c_2q_2^{n-1}
$$
代入 $a_1=c_1+c_2,a_2=c_1q_1+c_2q_2$，解得
$$
c_1=\frac{a_2-a_1q_2}{q_1-q_2},c_2=\frac{a_1q_1-a_2}{q_1-q_2}
$$
现在再看所求式子 $\sum\limits_{i=1}^na_n^2$，将其展开，不难发现应为
$$\sum_{i=1}^n(c_1q_1^{n-1}+c_2q_2^{n-1})^2$$
$$=\sum_{i=1}^n(c_1^2q_1^{2n-2}+c_2^2q_2^{2n-2}+2c_1c_2(q_1q_2)^{n-1})$$
$$=c_1^2\sum_{i=1}^nq_1^{2n-2}+c_2^2\sum_{i=1}^nq_2^{2n-2}+2c_1c_2\sum_{i=1}^n
(q_1q_2)^{n-1}$$
$$=c_1^2\frac{q_1^{2n}-1}{q_1^2-1}+c_2^2\frac{q_2^{2n}-1}{q_2^2-1}+2c_1c_2\frac{(q_1q_2)^n-1}{q_1q_2-1}$$
于是做完了。

真的做完了？

显然并没有。注意到两个问题：

1. 一开始的特征方程中，$\Delta=x^2+4y$ 有可能不是模 $P$ 下的二次剩余，也就是说 $\left(\frac{\Delta}{P}\right)=-1$。

2. 在最后的数列求和处，如果公比模 $P$ 余 $1$，那么原数列不构成一个等比数列，无法使用等比数列求和公式。

让我们来一一解决以上的问题：

1. 当 $\left(\frac{\Delta}{P}\right)=-1$ 时，我们可以考虑扩域。具体地，考虑集合 
	$$\left\{ a+bi\ |\ a,b\in\mathbb Z_P\right\},i=\sqrt\Delta$$
	不难发现它构成了一个域。因此可以实现在该域上的加减乘除。加减乘都较为简单，唯独除需要特别说一下。注意到在这个域下，除法公式应为
	$$\frac{a+bi}{c+di}=\frac{ac-bd\Delta}{c^2-d^2\Delta}+\frac{bc-ad}{c^2-d^2\Delta}i$$
	显然，我们需要证明任何时刻 $c^2-d^2\Delta$ 在模 $P$ 意义下都不为零。庆幸的是，这并不困难。

	命题：在上述过程中，$c^2-d^2\Delta\not\equiv0(\bmod\ P)$。

	证明：首先，如果保证公比不为 $1$，那么上述过程中不会出现 $c\equiv d\equiv0(\bmod\ P)$ 的情况（公比为 $1$ 的情况我们会稍后讨论），因此只需要考虑 $d\not\equiv0(\bmod\ P)$ 的情况。此时采取反证法。假设存在 $c,d\not\equiv 0(\bmod\ P)$ 使得 $c^2-d^2\Delta\equiv0(\bmod\ P)$，则 $\Delta\equiv(\frac{c}{d})^2(\bmod\ P)$，又 $d\not\equiv0(\bmod\ P)$，故 $\left(\frac{\Delta}{P}\right)=1$。但这与我们扩域的条件 $\left(\frac{\Delta}{P}\right)=-1$ 相矛盾，因此 $c^2-d^2\Delta\not\equiv0(\bmod\ P)$。证毕。

2. 现在来看看公比的问题。实际上也没什么好看的。注意到公比为 $1$ 时，我们正在进行求和的数列应为一常数数列，因此直接特判掉这种情况就好了。

于是终于做完了。显然复杂度和矩阵加速同为 $O(\log n)$。按道理说会比矩乘常数小一点，不过由于各种细节较多，小编也不确定。不幸的是，这个屑小编并不愿意写一个巨大多细节的超级缝合怪，因此代码消失了!