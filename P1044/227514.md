[P1044 题目传送门](https://www.luogu.com.cn/problem/P1044)

这道题是一个经典的卡特兰数问题，下面我们来推导出它为什么是卡特兰数。

------------
首先，我们要了解什么是卡特兰数。

>卡特兰数又称卡塔兰数，卡特兰数是组合数学中一个常出现在各种计数问题中的数列。以比利时的数学家欧仁·查理·卡塔兰 (1814–1894)的名字来命名。
>
>$ --Baidu$


卡特兰数$C_n$满足以下递推关系:

($C_n$代表卡特兰数的第$n$项)

$$C_{n+1}=C_0C_n+C_1C_{n-1}+\ldots+C_nC_0$$

$$(n-3)C_n=\frac{n}{2}(C_3C_{n-1}+C_4C_{n-2}+C_5C_{n-3}+\dots+C_{n-2}C_4+C_{n-1}C_3)$$

---------
### P1044
一个栈(无穷大)的进栈序列为1，2，3，…，n，有多少个不同的出栈序列? 

### 设$h_n$为$catalan$数的第$n+1$项，令$h_0=1$,$h_1=1$。

-------
------

#### 常规分析
首先，我们设$f_n$=序列个数为$n$的出栈序列种数。（我们假定，最后出栈的元素为$k$）。

显然，$k$取不同值时的情况是相互独立的，也就是求出每种k最后出栈的情况数后可用加法原则，由于$k$最后出栈，因此，在$k$入栈之前，比$k$小的值均出栈，此处情况有$f_{k-1}$种，而之后比$k$大的值入栈，且都在k之前出栈，因此有$f_{n-k}$种方式，由于比$k$小和比$k$大的值入栈出栈情况是相互独立的，此处可用乘法原则，$f_{n-k}f_{k-1}$种，求和便是$Catalan$递归式。

首次出空之前第一个出栈的序数$k$将```1~n```的序列分成两个序列，其中一个是```1~k-1```，序列个数为$k-1$，另外一个是```k+1~n```，序列个数是$n-k$。

此时，我们若把$k$视为确定一个序数，那么根据乘法原理，$f_n$的问题就等价于----序列个数为$k-1$的出栈序列种数乘以序列个数为$n-k$的出栈序列种数，即选择$k$这个序数的$f_n$=$f_{k-1}f_{n-k}$。而$k$可以选$1$到$n$，所以再根据加法原理，将$k$取不同值的序列种数相加，得到的总序列种数为：

$$f_n=f_0f_{n-1}+f_1f_{n-2}+\ldots+f_{n-1}f_0$$

看到此处，再看看卡特兰数的递推式，答案不言而喻，即为
$$ f_n=h_n= C^{2n}_n/{n+1}= c^2
_n-c^{2n}_{n-1}$$
$$(n=0,1,2,\dots)$$

最后，令$f_0=1$，$f_1=1$。
### 非常规分析
对于每一个数来说，必须进栈一次、出栈一次。我们把进栈设为状态‘$1$’，出栈设为状态‘$0$’。$n$个数的所有状态对应$n$个$1$和$n$个$0$组成的$2n$位二进制数。由于等待入栈的操作数按照$1\dots n$的顺序排列、入栈的操作数$b$大于等于出栈的操作数$a(a≤b)$，因此输出序列的总数目$=$由左而右扫描由$n$个$1$和$n$个$0$组成的$2n$位二进制数，$1$的累计数不小于$0$的累计数的方案种数。

在$2n$位二进制数中填入$n$个$1$的方案数为$c^{2n}_n$,不填$1$的其余$n$位自动填$0$。从中减去不符合要求（由左而右扫描，$0$的累计数大于$1$的累计数）的方案数即为所求。

不符合要求的数的特征是由左而右扫描时，必然在某一奇数位$2m+1$位上首先出现$m+1$个$0$的累计数和$m$个$1$的累计数，此后的$2(n-m)-1$位上有$n-m$个$1$和$n-m-1$个$0$。如若把后面这$2(n-m)-1$位上的$0$和$1$互换，使之成为$n-m$个$0$和$n-m-1$个$1$，结果得$1$个由$n+1$个$0$和$n-1$个$1$组成的$2n$位数，即一个不合要求的数对应于一个由$n+1$个$0$和$n-1$个$1$组成的排列。

反过来，任何一个由$n+1$个$0$和$n-1$个$1$组成的$2n$位二进制数，由于$0$的个数多于$2$个，$2n$为偶数，故必在某一个奇数位上出现$0$的累计数超过$1$的累计数。同样在后面部分$0$和$1$互换，使之成为由$n$个$0$和$n$个$1$组成的$2n$位数，即$n+1$个$0$和$n-1$个$1$组成的$2n$位数必对应一个不符合要求的数。
因而不合要求的$2n$位数与$n+1$个$0$，$n－1$个$1$组成的排列一一对应。
显然，不符合要求的方案数为$c^{2n}_{n+1}$。由此得出输出序列的总数目=$c^{2n}_n-c^{2n}_{n-1}=c^{2n}_n/(n+1)=h(n)$。

------
------
公式推导完了，该写代码了：

这里用了公式:

$$C_n=\frac{(4n-2)C_{n-1}}{n+1}$$

$Code$:
```cpp
#include<iostream>
using namespace std;
unsigned long long ctl[34]={0,1};
void calc()
{
    int i;
    for(i=2;i<34;i++)
        ctl[i]=ctl[i-1]*(4*i-2)/(i+1);
}
int main()
{
	int p;
	cin>>p;
	calc();
	cout<<ctl[p];
	return 0;
}
```