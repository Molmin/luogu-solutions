考虑期望转概率，我们设 $E$ 表示原问题的期望，$P_i$ 表示抽出 $i$ 张不同牌后仍然没有 $k$ 张连续卡的概率，则有： $E=\sum\limits_{i=1}^{m-1}P_i\dfrac{m}{m-i}$，解释一下就是在抽了 $i$ 张牌后仍然没有出的概率乘上从 $i \to i+1$ 所需要的的次数就是总的期望。

现在问题转为 $P_i$ 如何求，考虑一个有 $i$ 张不同牌的状态，他有 $\dfrac{1}{C_m^i}$ 的概率出现，我们现在的问题就转为了计数有 $i$ 张不同牌但没有连续 $k$ 张卡的方案数了。

最直接的想法就是设 $f_{i,j,l}$  表示前 $i$ 张牌中选了 $j$ 张，最后一个连续段的长度为 $l$ 且没有长度 $\geqslant k$ 的连续段的方案数，复杂度 $O(n^3)$，期望 50pts。

我们考虑对每一段先分开考虑，最后再卷积起来。

现在问题变成了一个长度为 $n$ 的连续段，对每个 $i$ 求出选出 $i$ 张牌且没有 $k$ 张连续牌的方案数，不难列出这个方案数为：$\sum\limits_{p=1}^{+\inf}[x^{i+1-p}](\sum\limits_{j=0}^{k-1}x^j)^p$，组合意义就是暴力枚举段数为 $p$，每一段里选长度为 $0$~$k-1$ 的值然后乘起来。

但是对于每个不同的 $p$ 我们取出不同的项的这个行为是很尴尬的，导致我们完全无法优化这个算法。

于是我们考虑给每个 $(\sum\limits_{j=0}^{k-1}x^j)^p$ 都乘上一个 $x^p$，这样我们需要的答案就变成了 $\sum\limits_{p=1}^{+\inf}[x^{i+1}](\sum\limits_{j=1}^{k}x^j)^p$，但是与此同时我们又产生了一个新的问题：这个和我们要求的东西不一样啊，我们求出来的 $x^{i+1}$ 项并不是我们所需要的原来的选出 $i$ 张牌且没有 $k$ 张连续牌的方案数了，而是他们某些值的和，而我们如果只有 $x$ 一个元的话是不足以区分的，所以我们设一个辅助元 $y$，考虑给每个 $(\sum\limits_{j=0}^{k-1}x^j)^p$ 都乘上一个 $(xy)^p$，这样的话原式就变成了 $[x^{n+1}]\dfrac{1}{1-yF(x)}$，其中 $F(x)=\sum\limits_{i=1}^{k}x^i$，其中 $y^i$ 就对应了选 $i$ 张牌的方案数，因为 $y$ 的意义就是。

直接上扩展拉格朗日反演可以得到：
$$[x^{n+1}]\dfrac{1}{1-yF(x)}=\dfrac{1}{n+1}[x^n]\dfrac{y}{(1-yx)^2}(\dfrac{x}{F^{-1}(x)})^{n+1}$$
$$F(x)=\sum\limits_{i=1}^{k}x^i=x \dfrac{1-x^k}{1-x}$$
所以 $F^{-1}(x)$ 满足 
$$\dfrac{F^{-1}(x)-F^{-1}(x)^{k+1}}{1-F^{-1}(x)}=x\Leftrightarrow (1+x)F^{-1}(x)-F^{-1}(x)^{k+1}-x=0$$
牛顿迭代即可，$O(n\log n)$，但应该是个超大常数的 $O(n\log n)$。

然后我们求出 $(\dfrac{x}{F^{-1}(x)})^{n+1}$ 之后，再与前面的 $\dfrac{y}{(1-yx)^2}$ 卷起来算每个 $[x^ny^i]$ 的答案即可，$O(n)$。

现在我们就求出了每一段的答案，再用一次分治 $FFT$ 就行了，复杂度 $O(n\log^2 n)$，总复杂度 $O(n\log^2 n)$，目测要卡亿点点常。



目测代码有点长，先咕了。