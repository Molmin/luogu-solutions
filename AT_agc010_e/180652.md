找到图论模型是一个很好的方法，因为不少图论东西有很直观的~~可以大胆猜想不用证明~~。

首先容易发现对于不互质的两个数，一旦在先手定下顺序后，两者先后顺序必然不会改变。利用这点可以想到 DAG 的拓扑序，于是乎我们在不互质的两个数建边，可以得到 $O(n^2)$ 条边。于是这就是一个先手给边定向，然后后手找到一个最大拓扑序的问题。

找最大拓扑序是一个简单的问题，即每次找到最大的零度点。先手的问题是希望最大拓扑序最小。贪心地去设置边：在 DFS 的时候每次贪心找到最小的点去连。这样就可以使得较大的点的深度会尽可能地比较小地点的大，意味着拓扑序会较靠后。关于连边，连到一个生成树即可，因为对于祖先->孩子的连边必然是没有必要的（后手在朝那里走的时候祖先早已走过了）。

复杂度 $O(n^2\log V)$。

https://atcoder.jp/contests/agc010/submissions/28770166