翻转一个点会把它相邻的点全部翻转，因此先从叶子开始自下而上考虑。不难发现，如果这个叶子是白色，那么它一定比它的父亲先翻转（否则它就翻不了了）；而对于黑色的叶子，它一定比它的父亲后翻转。经过一波操作，我们得到了所有叶子的父亲的颜色。此时就可以把它们当作叶子处理，因为那些还没被删的叶子暂时影响不了它们。

经过模拟我们得到了树根的颜色。显然如果此时树根是黑点就无解，否则就自上而下操作。

这样我们发现父子之间的操作顺序可以确定，并且它们是充要的。建出 DAG 后跑拓扑排序即可求出字典序最小的解。

[code](https://atcoder.jp/contests/arc143/submissions/37237209)