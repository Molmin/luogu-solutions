很强的博弈 + 性质题。下文令 A 为 Takahashi，B 为 Aoki。

发现单独考虑一个序列 $a_1,a_2,...,a_n$：

- 若 $n \bmod 2 = 0$：
	- 若 A 为先手，答案为 $\max(a_{\frac{n}{2}}, a_{\frac{n}{2} + 1})$；
    - 若 B 为先手，答案为 $\min(a_{\frac{n}{2}}, a_{\frac{n}{2} + 1})$（由于 $\min$ 和 $\max$ 的对称性）。
    - 双方都是成为先手比成为后手优。
- 若 $n \bmod 2 = 1$：
	- 若 A 为先手，答案为 $\min(a_{\frac{n+1}{2}}, \max(a_{\frac{n+1}{2} - 1}, a_{\frac{n+1}{2} + 1}))$；
    - 若 B 为先手，答案为 $\max(a_{\frac{n+1}{2}}, \min(a_{\frac{n+1}{2} - 1}, a_{\frac{n+1}{2} + 1}))$；
    - 双方都是成为后手比成为先手优。

相同的结论在 [CF794E](https://www.luogu.com.cn/problem/CF794E) 也出现过。这是容易归纳证明的，故证明略。

考虑如果全部序列长度都为奇数，容易发现若先手取了其中一个序列的一个数，后手肯定再把这个序列的长度取回奇数。这是因为如果出现了长度为偶数的序列，那它肯定会成为先后手争夺的对象（双方都是成为先手比成为后手优）。所以全部序列的答案可以独立计算再加起来。

现在有一些序列长度为偶数，根据前面的讨论，它们会成为双方争夺的对象。取完偶数的序列后，就回到了上面的情况，并且先后手可能会交换顺序。设 $x,y$ 为对于一个偶长序列，取头部和取尾部得到的剩下的序列的答案，设 $mx = \max(x,y), mn = \min(x,y)$，发现肯定是按 $mx - mn$ 从大到小先手交替地取。因为如果是 A 取了它，它会比 B 取它多了 $mx - mn$ 的得分，反之如果 B 取了它，它会比 A 取它少 $mx - mn$ 的得分。

这样最后的答案由两部分组成，一部分是奇长序列的答案，由于可以单独考虑，所以可以提前确定；另一部分是偶长序列的答案，需要先后手交替取完后转化为奇长序列再记入答案。

时间复杂度线性对数，瓶颈在于排序。

[code](https://atcoder.jp/contests/arc116/submissions/41002932)