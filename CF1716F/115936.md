这种题好像挺常见的，但是谁能想到这是我第一次赛时做出这种题呢。

为了方便，首先设 $l=\lceil\frac{m}{2}\rceil$。

考虑放到原式子考虑这个问题，相当于 n 个 0/1 加起来的 k 次方。

考虑相当于有 k 个式子，要求从每个式子选一个 1，考虑怎么求这个的方案数。

假设这 k 个 1 来自 i 个盒子，那么这部分的方案数为 $\sum \frac{k!}{\prod p_j!}$，这里满足 $\sum_{j=1}^i p_j=k$。

然后直接设 $f_{i,k}$ 为上面的方案数，那么答案为

$$ans=\sum_{i=1}^{\min(n,k)}\binom{n}{i}m^{n-i}l^if_{i,k}$$

考虑怎么求 $f_{i,k}$，可以先令 $g_{i,k}=\frac{f_{i,k}}{k!}$，那么有 $g_{i,j}\times \frac{1}{k!}\to g_{i+1,j+k}$，发现这是个卷积的形式，$O(k^2\log k)$ 预处理即可。

对于 $\binom{n}{i}$ 和后面两个幂，直接在枚举 i 的过程中算就好，所以总的复杂度为 $O(k^2\log k+Tk)$。

C++14 过不去，C++20 跑得还可以。

https://codeforces.com/contest/1716/submission/166973566

考虑优化这个 $f_{i,k}$ 的预处理过程，从组合意义考虑，相当于把 k 个有标号小球分到 i 个有标号箱子，而第二类斯特林数的意义与其唯一的差别就是箱子无标号，所以有 $f_{i,k}=i!S_{k,i}$。

第二类斯特林数的求解是 $O(k^2)$ 的，所以总的复杂度为 $O(k^2+Tk)$。

https://codeforces.com/contest/1716/submission/166996254