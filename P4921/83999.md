### [题目传送门](https://www.luogu.com.cn/problem/P4921)

~~七夕打卡圣地~~

## 题意

- 对于每个给定 $n$ 求对于所有 $k\in [0,n]\cap N$，求恰好 $k$ 对情侣坐一排的情况数。

## Sol

> 组合意义天地灭，代数推导保平安。

~~尛神虎~~

考虑直接表示答案。

$ans_{n,k}=\dbinom{n}{k}\times P^k_n \times 2^k \times g_{n-k}$

其中 $\dbinom{n}{k}$ 表示选取 $k$ 对座位的组合，$P^k_n$ 表示选取 $k$ 对情侣的排列，$2^k$ 表示情侣的左右位置。

那么显然，这里 $g_{n-k}$ 可以看出表示共 $n-k$ 对情侣**都错开**的情况数。

我们考虑递推这个柿子。

首先 $g_0=1$，$g_1=0$。

考虑现在推 $g_i$。

分两种情况讨论。

考虑分别设两对情侣 $(a,b)$ $(c,d)$。

不妨让 $a$ 和 $c$ 坐一排。

#### $b$ 和 $d$ 坐一排

即为 $g_{i-2}$ 递推过来。

有贡献为 $8n(n-1)^2g_{i-2}$。

#### $b$ 和 $d$ 不坐一排

那么因为考虑 $g$ 为错排，不妨**假设 $b$ 和 $d$ 为情侣**，

即可以由 $g_{i-1}$ 转移过来。

有贡献为 $4n(n-1)g_{i-1}$。

那么可得 $g_i=4n(n-1)g_{i-1}+8n(n-1)^2g_{i-2}$。

预处理 $g$ 阶乘 逆元 即可。

预处理复杂度 $O(N)$。

询问复杂度 $O(TN)$。