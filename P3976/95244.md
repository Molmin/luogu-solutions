### 题意

给定一棵树，有 $Q$ 个询问，每次给出两个点 $a,b$，求满足 $\mathrm{dis}(a,c)<\mathrm{dis}(a,d)$ 的 $\max(val_d-val_c)$，其中 $val_x$ 为 $x$ 点的点权。支持路径加。

### 分析

毫无疑问树链剖分题。先用 $\mathrm{dfs}$ 序剖出每条链。然后我们现在先来考虑一条链的情况，可以直接使用线段树维护 $i>j,\max(v_i-v_j)$ 和 $i<j,\max(v_i-v_j)$，区间最大值，区间最小值。

再来考虑剖分时几条链之间的合并。只会存在两种情况：

- 答案在同一条链上。这种情况线段树已经维护了。
- 答案在不同链上。这种情况线段树没有维护，跳 $\text{LCA}$ 的时候根据 $a,b$ 分类讨论一下，试图更新答案。

时间复杂度 $O(n \log^2 n)$，很好想，代码就不贴了。

