题面说的有点不太清楚，大体来说就是求树上一条链上两个数，后面-前面最大能是多少，询问之后还要把这条链的数都加上一个数。

因为是链上的问题，我们直接考虑树链剖分。

对于重链上连续的一段，我们用线段树维护这样几个值：

* 段内的最大答案 $ans$。

* 段内最大值 $mx$ ，最小值 $mn$。

* 整体下传的标记 $tag$。

把这些信息记录在一个 $\text{struct}$ 里，在信息合并的时候直接上传合并之后的新信息即可。

合并部分的代码（大体意思，不要在意 $\text{CE}$）：

```cpp
node merge(node r1,node r2){
	node new;
	new.mx=max(r1.mx,r2.mx);
 	new.mn=min(r1.mn,r2.mn);
	new.ans=max(max(r1.ans,r2.ans),r2.mx-r1.mn);	
}
```

重点在于 $\text{new.ans}$ 的计算，等号后面三个值代表两个数都在 $\text{mid}$ 左侧/右侧，两个数 $\text{mid}$ 两侧各一个的情况。

然后就可以套在树剖的板子里愉快的 $\text{AC}$ 掉这个题了。

（其实把要维护的信息封装起来在不同重链之间查询的时候也会写起来更方便不少。

因为树剖的板子写法有差异，完整代码就不贴了，$\text{merge}$ 函数已经具有足够的参考价值了。