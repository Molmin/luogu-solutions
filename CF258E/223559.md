### $\text{Difficulty : 2400}$
---
### 解题思路：

一眼扫描线。

操作是对于一整个子树进行的，先将编号转化成 $\text{dfn}$ 序，得到一个连续的编号。

接着考虑具体操作，由于每一次操作加入的数是不一样的，发现操作和操作之间不会干扰。更进一步地，每一次操作都是将两个区间内的点之间相互关联，关联多次的点不会产生额外贡献。

由此想到这其实是一个矩形的面积并，令 $(i,j)$ 点表示第 $i$ 个点和第 $j$ 个点是否关联，若关联区间 $[l_1,r_1]$ 和 $[l_2,r_2]$，也就相当于对于左下角为 $(l_1,l_1)$ 右上角为 $(r_1,r_1)$，左下角为 $(l_1,l_2)$ 右上角为 $(r_1,r_2)$，左下角为 $(l_2,l_1)$ 右上角为 $(r_2,r_1)$，左下角为 $(l_2,l_2)$ 右上角为 $(r_2,r_2)$ 四个矩形进行覆盖。

特殊地，为了方便最后操作，对于每一个位置 $(i,i)$ 单独覆盖。

最终每一个位置 $i$ 的答案即为横坐标（或者使用对称地纵坐标）为 $i$ 的点被染色的数量。

复杂度 $O((n+m)\log n)$。

---
### 代码：