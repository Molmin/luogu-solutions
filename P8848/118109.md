~~[钛金手机](https://www.bilibili.com/video/BV14W411T7WJ?p=4)题。~~

&nbsp;

记 $c_0$ 为序列中 $1$ 的个数，$c_1$ 为序列中 $-1$ 的个数，最大子段和为 $s$，最小化的最大子段和为 $m$。

$c_0 = 0$ 的情况是平凡的，只讨论 $c_0 > 0$ 的情况。

首先，$m = \max(1, c_0 - c_1)$。这是因为

- $c_0 \le c_1$ 时：

  - 不管怎么排都可以选一个单独的 $1$ 作为选出的子段，故 $s \ge 1$；
  
  - 又因为只需要按一个 $1$ 一个 $-1$ 的方式排列这些数直到 $1$ 用完即可使得最大子段和为 $1$，所以 $m \le 1$。
  
  - 从而 $m = 1$。

- $c_0 > c_1$ 时：

  - 不管怎么排都可以选整个序列作为选出的子段，故 $s \ge c_0 - c_1$；
  
  - 又因为只需要按一个 $1$ 一个 $-1$ 的方式排列这些数直到 $-1$ 用完并将剩余的 $1$ 放完即可使得最大子段和为 $c_0 - c_1$，所以 $m \le c_0 - c_1$。
  
  - 从而 $m = c_0 - c_1$。

现在考虑方案数计数。

- $c_0 \le c_1$ 时：

  - 要 $s = m = 1$，只需任意两个 $1$ 均不相邻。
  
  - 问题即在 $-1$ 构成的 $c_1 + 1$ 个位置中选出 $c_0$ 个位置放下 $1$，答案为 $\binom{c_1 + 1}{c_0}$。

- $c_0 > c_1$ 时：

  - 要 $s = m = c_0 - c_1$，只需任意一个前缀的和均在 $[0, c_0 - c_1]$ 范围内。
  
  - 这是因为：记 $p_i$ 表示排出序列的到 $i$ 位置的前缀和。考察 $s > m = c_0 - c_1$ 的情况，排出的序列存在一段子段 $[l, r]$ 满足 $p_r - p_{l-1} > c_0 - c_1$。此时若 $p_r \le c_0 - c_1$ 则 $p_{l - 1} < 0$，即存在至少一个位置的前缀和不在 $[0, c_0 - c_1]$ 范围内。
  
  - $O(n^2)$ DP 即可。