我来一篇带图的

遥远的行星？ 神奇的国度？

NO，遥远的国度.

这题真皮OVO

考虑换根之后只有两种情况答案会变

一是根与询问点重合 答案整棵树

二是在询问点的子树内，这时候需要……枚举子树树根！

然后用dfs序来判断，这玩意是连续的（嗯……？），而且在每个子树内也是连续的（！）

锁定在哪颗子树内！

```cpp
if (dfn[child]<=dfn[croot] && dfn[child]+tsize[child]-1>=dfn[croot])
```

然后你抓着这个子树的根节点把它拎起来，这整棵树其余的部分就耷拉到下面了

然后你就会发现这时候实际是询问这个红色的部分

然后就行了。
![](https://cdn.luogu.com.cn/upload/pic/16702.png)

画风奇怪？？

[查看完整代码](https://fancydreams.ink/2018/04/03/bzoj3083-%E9%81%A5%E8%BF%9C%E7%9A%84%E5%9B%BD%E5%BA%A6/)