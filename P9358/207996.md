## 声明

博客编辑页和管理员题解审核页使用的 $\KaTeX$ 版本较低．根据目前使用发现，该版本暂不支持以下语法：

- `\def` 指令．
- 结合使用 `\textt` 指令和 `\textit` 指令实现等宽斜体．

此原因可能会导致本题解中的部分公式渲染异常．而在题目对应的题解展示页面和个人博客渲染页面使用的 $\KaTeX$ 为高版本，则无此问题．


## 题目大意

给出一个 $n$ 横行 $m+1$ 竖列的格点图，第 $i$ 横行第 $j$ 竖列的点可以用二元组 $(i,j)$ 表示．初始时，对于所有 $1 \le i \le n$，$1 \le j \le m$，存在 $(i,j)$ 到 $(i,j+1)$ 且权值为 $1$ 的单向边．

维护 $q$（$1 \le q \le 10^5$）次操作：

- $\texttt{1 \textit a \textit b}$（$1 \le a < n$，$1 \le b\le m$）：在 $(a, b)$ 和 $(a + 1, b)$ 之间添加一条权值为 $2$ 的双向边．**保证每个结点最多和一条双向边相连**．
- $\texttt{2 \textit a}$（$1 \le a \le n$）：假设从 $(a, 1)$ 开始，每次会从当前沿着一条未走过的且权值最大的边走向下一个结点，直到以所在结点出发不存在未走过的边为止．求出结束时所在点对应的二元组的首项．

## 简要做法

考虑在 $(a,b)$ 和 $(a+1,b)$ 之间新建一条双向边相当于断开 $(a,b) \to (a,b+1)$ 和 $(a+1,b) \to (a+1,b+1)$，并添加 $(a,b) \to (a+1,b+1)$ 和 $(a+1,b) \to (a,b+1)$ 两条新边．经过这个转换，我们发现在进行若干次操作后，图依旧是 $n$ 个长度为 $m+1$ 的链．

我们将初始时位于第 $i$ 条链上的结点的颜色定义为 $i$，维护每条链上点的颜色．则 $1$ 操作转换为首先找到两个指定颜色的结点对应的链，然后交换两个链的指定长度的后缀．$2$ 操作转换为制定一条链，求它的最后一个结点的颜色．

这个问题可以通过平衡树解决，但是存在更为简便的方法．观察到每条链的形态自始至终均相同，我们可以直接用动态开点线段树代替平衡树，我们让 $n$ 棵动态开点线段树公用一个内存池，就可以实现结点的交换．而对于「给定颜色找对应的链」，我们发现交换是不会改变颜色与结点编号的关系的，则可以通过一个全局的 map 记录每种颜色结点对应的编号．然后通过给每个结点记录一个 father，这样不断跳 father 就可以找到链对应线段树的根结点了．

该做法时间复杂度为 $O(n \log n)$，可以通过本题．

## 代码参考

见 [原始 OJ 提交](https://qoj.ac/submission/108513)．
