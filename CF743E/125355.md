# 题目

[传送门](https://www.luogu.com.cn/problem/CF743E)

# 题解

因为所有数字的选择必须连续，也就是说，同一数字的选择越少，其要求越容易达成，并且题目要求任意两个数字的出现次数 $c(i),c(j)$ 都必须保证 $\mid c(i)-c(j)\mid \le 1$，我们不妨二分数字出现的最小次数 $k$（有少部分数字出现次数为 $k+1$）然后对这个 $k$  进行合法性检查，显然，$k$ 越大，答案序列越大。

现在问题在于如何进行合法性检查，我们定义 $f[i][j]$ 为到第 $i$ 位，数字出现的集合为 $j$ 时的最大序列长度？

其实有更好的定义方法，定义 $f[i][j]$ 为到第 $i$ 位，数字出现的集合为 $j$ 时，出现次数为 $k+1$ 的数字最多的出现次数，因为我们已经固定每个数字**至少**出现 $k$ 次，那么出现 $k+1$ 次的数字越多，序列长度必然越大。

考虑如何进行转移：

我们可以将每个数字的出现位置单独储存起来，并用类似于指针的数组记录第 $i$ 位时，数字 $num$ 应该从哪个位置开始，因为有些位置在 $i$ 之前，已经不能选择了，为了快速得到起始位置，我们才这样做，我们记这个数组为 $cur$

对于一个数字 $t$，假设我们已经要选择它，那么显然我们要选择它的连续的 $k$ 个位置，即起始位置为 $pos_{cur_{t,i}}$，终止位置为 $pos_{cur_{t,i}+k-1}$，然后我们检验第 $i$ 位之后是否还存在 $k$ 个 $t$ 即可

然后，便可得到状转
$$
f[pos_{cur_{t,i}+k-1}][j']=\max\{f[pos_{cur_{t,i}}][j]\}
$$
其中，$j'$ 是 $j$ 多出 $t$ 这个数字的集合

但是这只是一种情况，数字 $t$ 显然有可能出现 $k+1$ 次，我们只需再检验第 $i$ 位之后是否还存在 $k+1$ 个 $t$ 之后，再用状转
$$
f[pos_{cur_{t,i}+k}][j']=\max\{f[pos_{cur_{t,i}}][j]+1\}
$$
注意两个式子中的细微差别，还要些细节可直接见代码

# 代码

```cpp
https://www.cnblogs.com/Arextre/p/13442790.html
```

