考虑边 $i\rightarrow a_i$ 组成的有向图，它一定是一个基环树森林。

我们注意到，若一个基环树满足存在一个点，有至少两个非环上的点连向它，答案就为 $0$。

两个长度为 $n$ 的环还可以合并，合并的方案有 $n$ 种。一个基环树上的方案是容易计算的。然后随便乘法原理计数一下即可。

注意一个细节：长度为大于 $1$ 的奇数的一个单环有两种方案：一步一跳和两步一跳。

时间复杂度 $O(n)$。