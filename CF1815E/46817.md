若一个字符串可以表示为另一个字符串重复若干次，显然可以将它替换为后者。这可以通过 kmp 实现。

对 $i=1...n$，考虑 $n'=1$，且唯一的串 $s'_1=s_i$ 时的问题。可以模拟得出，这个新问题的一个周期中，$0\sim1$ 被走了几次（注意 $0\rightarrow 1$ 和 $1\rightarrow 0$ 次数相同）， $1\sim 2$ 被走了几次，分别设为 $a_i,b_i$。

回到原问题，设一个周期内 $t\sim t+1$ 被走了 $f_t$ 次。那么必然有 $\frac{f_{t-1}}{f_t}=\frac{a_t}{b_t}$。这是必要条件，也是充要条件。即对满足条件的最小非负整数解 $(f_0...f_n)$ 有 $ans=2(f_0+...+f_n)$，其中 $ans$ 是原问题的答案。

将 $f_0$ 设为主元，则 $f_i = \frac{b_1...b_i}{a_1...a_i}f_0$。由于需要满足每个 $f_i$ 都是整数，因此对于每个质因子 $p$，$V_p(f_0)=\max\limits_{i=1}^n( -V_p(\frac{b_1...b_i}{a_1...a_i}))$。于是我们可以动态维护 $\frac{b_1...b_i}{a_1...a_i}$ 的质因数分解形式，求出 $f_0$。