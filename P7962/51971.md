记 $S = \sum_{i=1}^{n}a_i$，先把答案式子化开：

$$
\begin{aligned}
& n\sum_{i=1}^{n}(a_i - \frac{1}{n} S)^2 \\
= & n (\sum_{i=1}^{n} (a_i^2 + \frac{1}{n^2}S^2 - \frac{2}{n}a_iS)) \\
= & n\sum_{i=1}^{n}a_i^2 +S^2 - 2S \sum_{i=1}^{n}a_i \\
= & n\sum_{i=1}^{n}a_i^2 - (\sum_{i=1}^{n} a_i)^2
\end{aligned}
$$

接下来试图理解一次操作的本质，不难发现，对于一次操作，原来相邻两个数的差为 $a_{i} - a_{i - 1}, a_{i + 1} - a_{i}$，现在变为了 $a_{i + 1} - a_{i}, a_{i} - a_{i - 1}$。

也就是说，一次操作是在**交换差分数组的相邻两项**，而我们可以任意交换差分数组得到一个新的差分排列。

注意到给定的 $a$ 单调递增，所以差分数组里面的项都是 $\ge 0$ 的。

一个至关重要的结论是，最有情况下，这个新的差分排列必然是一个**单谷序列**。

感性上这很容易理解，因为我们要让数列趋向于平均值。严谨证明考虑邻值调整法并不难。

于是，我们将差分数组 $b$ 从小到大排序，然后依次考虑每一项，要么插在当前最左边，要么插在当前最右边。

钦定 $a_0 = 0$，设 $f(i, s)$ 表示考虑了前 $i$ 个数，当前 $\sum a_i = s$ 的情况下，最小的 $\sum a_i^2$ 是多少。

如果放在最右边，那么有 $f(i-1,s) + (\sum_{j=1}^{i}b_j)^2 \to f(i, s + (\sum_{j=1}^{i}b_j))$。

如果放在最左边，那么有 $f(i-1,s) + i\times b_i^2 + 2b_i\times s \to f(i, b_i \times i + s)$。

因为 $s$ 是 $O(na)$ 的，所以直接暴力这样 dp 可以做到 $O(n^2a)$ 的复杂度。

注意到差分数组中非 $0$ 项至多 $O(a)$ 个，而对于 $b_i = 0$ 毕竟排在最前面，无论放左放右都是一样的，所以直接铺开就行了，于是时间复杂度就能做到 $O(na^2)$。