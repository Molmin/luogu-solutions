首先直接考虑能使每一个$a_i$异或后$<=k$的$x$值，$f_i$表示$x=i$的时候的答案。

将每一个$a_i$做二进制展开，得到$n$个$01$串。

枚举$i$，假设我们固定了一个$x$的前几位等于$a_i$的前面这些位，剩下$m$位随便变动，那么无论后面$m$位怎么变动，异或出来的值也不会超过$2^m-1$

所以可以找到一个最大的$m$，使得$2^m-1<=k$，假设$a_i$的从后往前第$m$位之前的数为$b_i$，所以$[b_i,b_i+2^m-1]$这个区间里的数都是符合的。

将$f[b_i,b_i+2^m-1]+1$，可以用差分解决。

所以问题就变成了异或值在$[2^m,k]$的问题，然后不断递归下去，$k-=(2^m-1),a_i$第$m+1$位取反再次执行此操作直至$k=0$。

每次枚举之后将$k$复原。

取$f$最大值输出。