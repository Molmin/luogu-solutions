给个不动脑子的做法，数据结构也不用写。

$f_i = \min\{f_j + s_i \leq s_j \} [i-j+1\leq k]$

考虑和回滚莫队一样，$k \leq B$ 的时候暴力转移复杂度 $nB$。

如果 $k > B$，那么拆成若干段，然后右指针一定是单调增的，左边 $B$ 暴力即可，而且跑不满的样子，因为可以对之前的操作回退，后面部分可以用一个块状的东西，直接整块更新，查询的时候直接查一整块，所以复杂度就是 $\frac{n}{B} \times n + nB$。


补一个单调队列的做法吧，看懂了。

考虑把 $f_i$ 小的放在队首，因为每次的贡献只有 $1$，然后每次 $s_i$ 小的是第二关键字，搞搞就做完了。