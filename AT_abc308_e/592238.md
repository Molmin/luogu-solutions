[传送门](https://www.luogu.com.cn/problem/AT_abc308_e)     
比较麻烦的题目。      
## 题意
给你一个字符串 $s$ 和序列 $a$，它们长度相等。       
$s$ 仅由 `M`、`E`、`X` 组成，$a$ 仅由 $0,1,2$ 组成。      
我们定义，$\operatorname{mex}(a,b,c)$ 指第一个不等于 $a,b,c$ 的自然数。      
那么，对于每一组三元组 $(i,j,k)(1\le i<j<k\le n)$，如果 $s_i$ 为 `M`，$s_j$ 为 `E`，$s_k$ 为 `X`，它的贡献我们就定义为 $\operatorname{mex}(a_i,a_j,a_k)$。求所有三元组的贡献之和。           
## 解法
首先，我们发现 $a$ 仅由 $0,1,2$ 组成，那么 $\operatorname{mex}$ 实际上要考虑的情况很少，我们可以进行预处理。这里我们可以使 $0$ 产生 $2$ 的贡献，$1$ 产生 $3$ 的贡献，$2$ 产生 $5$ 的贡献。枚举的时候将其乘起来即可（根据唯一分解定理可知不会重复）。      
那么现在的问题转化到求每种三元组的个数。     
我们设 $qe_{i,j}$ 为当前在 $i$ 的位置，在这个字符和这个字符之后的 `X` 且对应 $a$ 的值为 $j$ 的数量（就是一个后缀和）。      
这一部分我们很好进行递推，我们倒着枚举 $i$，那么对于任何一种 $j$：     
$qe_{i,j}=qe_{i+1,j}+[a_i=j\land s_i=\text{X}]$。      
我们还需要预处理出 `E`。      
我们设 $qx_{i,j,k}$ 为当前在 $i$ 的位置，在这个字符和这个字符之后的 `EX` 子序列数量且 `E` 对应数值为 $j$，`X` 对应数值为 $k$ 的数量。      
我们还是倒序枚举 $i$，对于每个 $j$ 和 $k$：     
$qx_{i,j,k}=qx_{i+1,j,k}+[s_i=\text{E}\land a_i=j]qe_{i,k}$。   
这个式子有点复杂，我们慢慢解释。   
前半部分我们是把上一次的值继承过来。后半部分的判断条件是对这一个为 `E` 的条件判断（因为只有这一位为 `E` 才对答案有贡献），后面是对 `X` 的累加。     
那么我们最后再扫一遍字符串，把每个为 `M` 的地方搜一遍所有的状态即可。          
总体时间复杂度 $O(n)$，可以通过。   
[CODE](https://www.luogu.com.cn/paste/l91fv5b4)