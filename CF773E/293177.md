假设 $\forall i,A_i>0$ ，保证 $A$ 排序，且初始时 $F=0$ ，我们如何计算最后的 $F$ 。

设 $F_i$ 表示通过 $i$ 这段区间的 $F$ ，$cnt_i$ 表示 $A$ 序列中有多少个 $i$ 。

则 $F_i=\min\{F_{i-1}+cnt_i,i\}$。 等价于 $F_i=\min\{F_{i-1},i-cnt_i\}+cnt_i$ 。

推导可得 $F_n=\sum_{i=0}^n cnt_i+\min_i\{i-\sum_{j=0}^i cnt_j\}$ 。

考虑一开始 $F_0$ 如果是负数，那么答案可以写成 $F_n=\sum_{i=0}^n cnt_i+\min\{\min_i\{i-\sum_{j=0}^i cnt_j\},F_0\}$ 。

这个算法为啥要保证 $A_i>0$ ，其实我们只要保证 $F\leq A_1$ 即可，即无 $3$ 操作的情况。

考虑有 $3$ 操作，即为 $\exists i,A_i<0$ 的情况，那么我们肯定能找到一个阀值使得后面均无 $3$ 操作。

最后一个 $3$ 操作出现的地方一定是满足单调性的，即找到 $A_i\geq -i$ ，然后二分即可。然后套用上述做法即可。

时间复杂度 $O(n\log^2 n)$ 。