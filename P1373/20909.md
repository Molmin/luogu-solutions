这道题是一个DP，具体的DP方法底下已经说了，这里不多说，主要讲几个题目的坑点。

1.用int就足够了，用long long有可能爆空间（当然你可以用循环数组）。

2.因为k+1时才会被清空成零，所以模数为k+1。

3.魔液量大于k+1无意义，一开始直接去模（有20分包含这种情况）。

下面是代码，看不懂可以私信我。

```cpp
#include<cstdio>
int a,b,c,d,e,f,i,m,n,x[850][850]={0},w[850][850][20][2]={0},y=1000000007; 
int main()
{
scanf("%d%d%d",&a,&b,&c);
c++;
for(i=1;i<=a;i++)
{
    for(m=1;m<=b;m++)
    {
        scanf("%d",&x[i][m]);
        x[i][m]%=c;
        w[i][m][x[i][m]][1]++;
    }
}
d=0;
for(i=a;i>=1;i--)
{
    for(m=b;m>=1;m--)
    {
        for(n=0;n<c;n++)
        {
            e=(n-x[i][m]+c)%c;
            w[i][m][n][1]+=w[i+1][m][e][0];
            w[i][m][n][1]%=y;
            w[i][m][n][1]+=w[i][m+1][e][0];
            w[i][m][n][1]%=y;
            e=(n+x[i][m])%c;
            w[i][m][n][0]+=w[i+1][m][e][1];
            w[i][m][n][0]%=y;
            w[i][m][n][0]+=w[i][m+1][e][1];
            w[i][m][n][0]%=y;
        }
        d+=w[i][m][0][0];
        d%=y;
    }
}
printf("%d\n",d);
}
```