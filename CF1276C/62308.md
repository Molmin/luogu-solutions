我们设构造的矩阵长，宽分别为 $R, C (R<C)$。

考虑如下事实：若存在一种数，出现的次数大于 $R$，则由抽屉原理，它们是不可能放进这个矩阵且每行都互不相同的。

而当所有数都不大于 $R$ 时，我们考虑将相同的数放在一块，并按如下顺序将它们这样放进矩阵：（按 1,2,... 分别放入）

![](https://cdn.luogu.com.cn/upload/image_hosting/gpt5bxpc.png)

比如对样例，将相同的数放在一块后是 ``5 5 5 3 3 1 1 9 8 6 4``，按上述方法放入：

```
5 3 1 6
4 5 3 9
8 2 5 1
```

就能有合法的构造方案。

这是因为每次我们总将相同的数按斜行放入，由于出现次数不大于 $R$，因此必然不会重合。

所以我们只需要知道 $R,C$ 的具体取值就好了。显然我们让 $R,C$ 尽量靠近，所以我们预处理 $R_x$ 表示大小为 $x$ 的矩阵的 $R$。然后我们倒序枚举 $x$，每次将次数最大的数删一个，再看能不能放进大小为 $x$ 的矩阵即可。可以考虑使用 ``std::map`` 或 ``std::set`` 支持这种贪心策略。

时间复杂度 $O(n\log n)$，预处理 $R_x$ 和贪心都是这个复杂度。

代码就不贴了，写得太丑。。