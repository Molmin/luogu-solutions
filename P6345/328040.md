个人认为是思维难度比较高的一道题…不是很懂这个评分是哪个高手给的。

考虑直接求雨滴量并不好求，因为要去考虑左右两边的柱子高度。考虑对于一个排布 $4,2,5$ ，那么中间 $=2$ 或者 $=1$ 时要分开考虑；但是我们发现无论怎样，中间在接完雨滴之后高度都会变成 $4$ ，所以考虑求**所有可能的雨滴+柱子**的体积和。由于每个柱子都要摆，所以最后只需要去 check 那些 $\sum h_i\sim max$ 的答案。

考虑定义 $f_{i,v}$ 表示用了 $i$ 个柱子之后能否凑出体积 $v$ 来。考虑一个比较常用的 trick，将所有 $h_i$ 从小到大排序之后，按顺序转移。这样就能保证每次加进来的柱子都是当前最高的(无中生有了一个很有用的性质)。考虑一个状态 $f_{i,v}$ ，他的转移应该为：

$$f_{i,v}=\bigcup_{p_j\leq v} f_{i-1,v-p_j}$$

其中 $p_j$ 是每个柱子的高度，需要从小到大转移，且转移时需要严格按照先枚举 $p_j$ 再枚举 $1\sim i$ 的顺序。

考虑这个式子的意义。对于任何一个大小为  $i\in[1,n-1]\cap\mathbb{Z_+} $ 的柱子集合 $o$，按秩转移时每次加入一个 $\geq \max_{t\in o}p_t$ 的新柱子 $p'$，放在最左边（或者最右边），同时再加入一个按高度从小到大排序后，恰好排名比 $p'$ 大 $1$ 的柱子 $p''$  放在 $p'$ 的同侧（即，如果 $p'$ 放在了整个序列的左边，$p''$ 应该被放在 $p'$ 的左边）。那么此时考虑，每当加进来一个元素 $p_0$，集合大小从 $i-1$ 变成 $i$ ，$p'$ 就向右交换一个，这样新加进来的这个柱子上方水位高度一定会是 $p'$ 的高度（因为最左边有 $p''$）， 所以体积的变化量是 $\Delta v=(p'-p_0)+p_0$，前一半是水，后一半是新的柱子，所以可以从 $i-1,v-p'$ 转移过来。

需要注意的是，这样转移一定是不包含最高那个柱子的，因为当最高的柱子为 $p'$ 不存在一个更高的 $p''$ 。

于是最后复杂度 $O(n^2\sum h)$ ，当然可以用 bitset 优化成 $O(\frac{n^2\sum h}{w})$ 。但其实在注意到本题只关注可达性判断之后，就可以发现等高的柱子不用重复转移，就可以优化成 $O((\sum h)\cdot n\cdot \max\{h\})$ 。

代码十分十分简单。留给大家作为思考。