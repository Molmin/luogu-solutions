### 题意

给定一张 $n$ 个点 $m$ 条边（边有边权）的无向联通图，定义一条路径的长度为 $\operatorname{mex}\{w_1, w_1 \& w_2, \cdots, w_1 \& w_2 \&\cdots \&w_k\}$，其中 $k$ 为这条路径的长度，$w_1, w_2, \cdots, w_k$ 表示这条路径上依次经过的边的边权。现在有 $q$ 次询问，每次询问给出 $u, v$，要你求出 $u \to v$ 的最小路径长度。

数据范围：$2 \le n \leq 10^5$，$n - 1 \leq m \leq \min\left(\dfrac{n (n - 1)}{2}, 10^5\right)$，$0 \leq w \leq 2 ^ {30}$，$1 \leq q \leq 10^5$。

### 做法

定理 1. $1$ 和 $2$ 不会同时出现在一条路径的 $\operatorname{mex}$ 中。

证明如下：使用反证法证明，假设 $1$ 先出现在该路径的 $\operatorname{mex}$ 中，考虑到 $1$ 的二进制下的第二位是 $0$，且进行的是 $\&$ 运算，于是后面的值中第二位不可能 $1$，也就证明了 $2$ 不可能出现在该路径的 $\operatorname{mex}$ 中；对于 $2$ 先出现在该路径的 $\operatorname{mex}$ 中的情况同理。

由定理 1. 可知：任何一个路径其长度不可能大于 $2$。

那么只需要判断是否存在长度为 $0 / 1$ 的路径，若不存在则答案为 $2$。

1. 判断是否存在长度为 $0$ 的路径，即存在某一位 $k$，使得路径上每一条边的边权在第 $k$ 位上均为 $1$。考虑枚举 $k \in [0, 29]$，将边权在第 $k$ 位为 $1$ 的边保留下来，这样会形成 $30$ 个新图，对每个新图都使用并查集维护连通性即可。对于询问 $(u, v)$，我们只需判断是否有新图满足 $u, v$ 在同一个的连通块，若有则代表存在长度为 $0$ 的路径。
2. 判断是否存在长度为 $1$ 的路径，考虑这条路径如何实现，一定是先经过若干位奇数边权（当前长度 $>1$），然后经过一个偶数边权，最后随便经过某些路径，最后到达终点。考虑还是先枚举 $k \in [1, 29]$，使得每一条边都只经过边权在第 $0 / k$  位为 $1$ 的边，照样用并查集维护这些新图，然后对于边权为偶数的边 $(u, v)$，我们在所有新图上 $u, v$ 所在的连通块打上标记。对于询问 $(u, v)$，我们只需判断是否有新图满足 $u$ 的连通块上有标记，若有标记则代表存在长度为 $1$ 的路径。

时间复杂度 $\mathcal O(n \log w + (m + q) \cdot \alpha(n)\log w)$。

[评测链接](https://codeforces.com/contest/1659/submission/154053555)。