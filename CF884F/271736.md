#### 解法一：费用流

> 若 $s_i$ 在 $i$ 上则增加 $b_i$ 的贡献。

考虑分配字符，从 $s$ 向代表 $a\sim z$ 的 $26$ 个点连以字符个数为流量，费用为 $0$ 的边。

再从代表字符的点向下标连。如何满足 $s_i\ne s_{n-i+1}$ 的限制？将下标折半，建 $\frac{n}{2}$ 个点，以一个点表示 $s_i$ 和 $s_{n-i+1}$。

字符 $c$ 向 $i$ 点连边满足：

- 若 $c=s_{i}$ 且 $c=s_{n-i+1}$，则费用为 $\max(b_i,b_{n-i+1})$，流量为 $1$；
- 若 $c=s_{i}$ 或 $c=s_{n-i+1}$，则费用为 $b_i$ 或 $b_{n-i+1}$，流量为 $1$；
- 若 $c\ne s_i$ 且 $c\ne s_{n-i+1}$，则费用为 $0$，流量为 $1$。

对于 $\frac{n}{2}$ 个点，向 $t$ 连费用为 $0$，流量为 $2$ 的边。

跑最大费用最大流即可，[My Submission](https://codeforces.com/contest/884/submission/196755810)。

#### 解法二：贪心

对于所有回文数对，按字符分组，若所有组内个数不超过总数的一半，可以内部消化，每一对共享为值取 $\max$。

否则比较麻烦，显然内部需要消耗掉共享为 $\min$ 的。

考虑最多个数的字符，只有一个，从剩余中选出一些可交换的排序，从小往大取即可。

假设最多个数的字符为 $c$，则需要满足 $s_i\ne s_{n-i+1},s_i\ne c,s_{n-i+1}\ne c$ 或 $s_i=s_{n-i+1},s_i\ne c$。

代码：[My Submission](https://codeforces.com/contest/884/submission/196759486)。

