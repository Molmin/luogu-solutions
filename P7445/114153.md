技不如人甘拜下风。化式子的感觉还是太菜了。

___

贡献拆开至每一个节点，从而不难将问题转化为两个部分：

- 对所有 $k\in [0,m]$，求 $P_k$ 表示 「长为 $k$ 的数列，每一项在 $[-1,V]$ 内，和为 $0$ 的数量」。

- 对所有线段树上区间 $[l,r]$，记随机一个区间包含它的概率为 $P_{[l,r]} = \dfrac{l(n-r+1)}{\frac{n(n+1)}{2}}$，求和 $\sum_{[l,r]\in \text{SGT}}\sum_{k=0}^m\binom{m}{k}(1-\dfrac{P_k}{(V+2)^k})P_{[l,r]}^k(1-P_{[l,r]})^{m-k}$。

___

先做第一个。显然 $P^k = [x^0](\dfrac{1+x+\cdots x^{V+1}}{x})^k$。求系数，考虑拉格朗日反演。
- 注意到求的是 $[x^0]$，因此只能上另类拉格朗日反演。

若设 $F = \sum_{i=0}^{V+1} x^i = \dfrac{1-x^{V+2}}{1-x},G = \dfrac{F}{x}$，直接上拉反，导出的是我们不想看到的负指数系数。

考虑如何规避。只需**取倒**将 $G$ 的定义更改为 $G = \dfrac{x}{F}$，此时 $P_k = [x^0]G^{-k}$，从而拉反导出的成为正指数 $[x^k](G^{(-1)})'\dfrac{x}{G^{(-1)}}$。

于是问题转化成求 $G^{(-1)}$。套路地，在 $G$ 的定义式中替换 $x$ 为 $G^{(-1)}$ ，即可导出一个函数方程 $\dfrac{G^{(-1)}(1-G^{(-1)})}{1-(G^{(-1)})^{V+2}} = x$。

牛迭解它即可。$O(n\log n)$。注意多项式快速幂需要 P5273 那个 general 的版本。

___

考虑第二个。将式子整理，**合并同次的项**，$\sum_{[l,r]\in \text{SGT}}(1-P_{[l,r]})^{m}\left(\sum_{k=0}^m\binom{m}{k}(1-\dfrac{P_k}{(V+2)^k})(\dfrac{P_{[l,r]}}{1-P_{[l,r]}})^k\right)$。

不难想到将后面的看做一个 $m$ 次多项式，多点求值即可。$O(n\log^2n)$。
___

值得注意的点：

- 牛迭解 $G^{(-1)}$ 时，需要解到 $m+1$ 次项而非 $m$，因为后面的 $(G^{(-1)})'$  需要往后用一项。（感谢 yjt 的指出）

- $n=1$ 时会导致空多项式的出现，记得判掉。

Code：放剪贴板。因为自己的多项式板子太难看了。[Link](https://www.luogu.com.cn/paste/yla4rpda)。