二分答案 $k$ 后求二分图是否存在完美匹配，显然 $Hall$ 定理。

但是问题在于一个点连的不为连续区间，会存在连一段前缀与一段后缀的情况（即为环的贡献）

一个很简单的想法是断环为链，由于我们仅需要考虑连续段的影响，那么我们考虑将 $a$ 复制一份进行考虑，跑序列上的做法。

正确性我们可以考虑如果在当前 $[l,r]$ 中对应的 $Y$ 有两个相同的（但位置不同），那么 $X$ 已经可以把所有的 $Y$ 均取到了，所以我们不需要考虑这种情况，那么我们仅需要求出在 $l$ 有限制的情况下的答案，这需要个单调队列维护，去保证 $Y$ 不交。

事实上在代码实现中我们不需要求一段区间的最小值，因为上述情况必然 $|X|\leq |Y|$ ，因为当前 $k\leq \frac{L}{2}$ ，那么对于两个相同的 $x$ 所覆盖的区间是无交的，那么我们就直接对应即可，显然此时 $|X|\leq |Y|$ 。

时间复杂度 $\mathcal O(n\log n)$ 。