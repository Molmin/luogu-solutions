这个做法不用爆推组合数。

考虑那个权值究竟是什么，因为可以任选子序列我们可以只选有用的部分，也就是 $x$ 个左括号和 $x$ 个右括号，然后最大化 $x$。

记 $S_i$ 为 $i$ 之前的左括号个数，即最大化 $\min(S_i, n - S_n - (i - S_i))$，右边意义是后面的右括号个数。

注意到左边随 $i$ 单调不降，右边不增，且每次最多变化 $1$，为了取最值不妨让它们取等，即 $S_i = n - Sn - i + S_i$。

这时候魔法发生了，$S_i$ 消没了，也就是我们发现答案是 $i = n - S_n$ 之前的左括号个数。

那么就很好做了，我们枚举 $S_n$（左括号总数），计算得  $i = n - S_n$，然后求解所有方案中 $i$ 左边的左括号个数之和。

设已经确定的左括号个数为 $C$，问号个数为 $E$，考虑 $i$ 左边每一个左括号，它会被统计 $\binom{E}{S_n - C}$  次，而每一个问号会作为左括号被统计 $\binom{E - 1}{S_n - C - 1}$ 次，求出前面左括号和问号的个数乘以对应系数求和即可。