正面做的话应该比较困难。考虑转化一下：对每个 $1\leq v < n$，边权 $x$ 最大是多少，能使得可以在图上加一条边权为 $x$ 的边，满足加边后 $1$ 到任意节点距离都 $\leq v$。

首先可以发现，加的边一定有一个端点为 $1$。这一点留待读者自证。

对于原来到 $1$ 的距离就 $\leq v$ 的节点，加边后距离一定仍然 $\leq v$，我们可以不管。假设我们在 $1$ 和 $u$ 之间加了边，对于每个原来距离 $1$ 超过 $v$ 的点 $k$，显然新图最短路径一定是从 $1$ 到 $u$ 再到 $k$，这就要求

$$
x+\operatorname{dis}(u,k)\leq v
$$

记所有距离 $1$ 超过 $v$ 的节点集合为 $K_v$，我们需要挑出一个 $u$，使得 $u$ 距离 $K_v$ 中节点距离的最大值尽可能小，从而使得 $x$ 尽可能大。而这个 $u$ 明显应取在 $K_v$ 直径的中点（如果中点在边上，那么应当取在该边两端点的任意一端），这个最大值最小即为直径的一半向上取整。此时计算 $x$ 的取值范围即可，注意我们只研究 $x\in [1,n]$ 的情形。

从大到小枚举 $v$，每次朴素地加入所有深度为 $v+1$ 的点，并维护直径的长度以及端点，可以做到 $O(n\log n)$（需要调用 $O(n)$ 次计算树上两点间距离的算法，该算法一般采用 $O(n\log n)-O(\log n)$ 或 $O(n\log n)-O(1)$ 的实现），足够通过本题。官方题解给出的是一种树形 DP 做法，可以做到 $O(n)$。