哎，听了导师的一番讲解才恍然大悟![](https://xn--9zr.tk/zk)，我还是too young too naïve了啊

可以观察到，最小化~~人道主义~~合并次数，就是最大化最后剩下的神犇个数。

首先我们需要明确一点：

- 要想要得到局部最优策略，就必须要让最后一只神犇尽可能的蒻。

为什么呢？首先设 $dp_i$ 表示前 $i$ 个神犇可以保留几个，$s_i$ 表示前 $i$ 个神犇的实力值总和。合并后的所有神犇，每个神犇的能力值都是原来的连续一段的神犇合成得到的，假如这一个神犇是由原来的第 $i+1$ 到第 $j$ 个神犇合成的，则它的实力值是 $s_j-s_i$。

再设 $d_i$ 表示第 $1$ 到第 $i$ 只神犇里，**在满足条件**、最后一只合成神犇最小的情况下，起始位置减去 $1$ 是多少。那么这只神犇的实力值就是 $s_i-s_{d_i}$。由于可以证明，最后一只合成神犇越大，能保留的神犇数量就越少，故它以 $d_i+1$ 开头为最佳方案。

于是，$dp$ 方程也就迎刃而解！假设 $c_i$ 表示前 $i$ 个神犇中，在满足条件的情况下，最后一只合成神犇的能力值。

那么

$$d_i=\min\limits_{0\le j<i,c_j+s_j\le s_i}j$$

$$c_i=s_i-s_{d_i}$$

$$dp_i=dp_{d_i}+1$$

最终的最小合并次数即为 $n-dp_n$。进行 $dp$ 的过程中使用单调队列优化，每次选择队列中 $c_j+s_j\le s_i$ 的最小的 $j$ 赋值给 $d_i$，得到 $c_i$ 和 $dp_i$，处理完 $dp_i$ 后往里面扔进 $i$。时间复杂度 $O(n)$。

**后记：本来想补发一波单调队列详解的，因为时间原因就先到这里吧。改天必补！**