
考虑到所有合法的分配方案都满足一个简单的性质：$2 \times p+q \equiv 1 \pmod 3$（其中 $p$ 为 `-` 的个数，$q$ 为 `+` 的个数）和至少存在一对相邻且符号相同的数。数学归纳易证。

由此，设 $f_{i,j,0/1,0/1}$ 表示考虑了前 $i$ 个数，$2 \times p+q\equiv j \pmod 3$，第 $i$ 个数的符号为 `-` 或 `+`，否/是存在至少一对相邻且符号相同的数，的答案。

边界 $f_{1,2,0,0}=-a_1$，$f_{1,1,1,0}=a_1$。

转移方程：
$$
f_{i+1,(j+2)\pmod 3,0,t|(k==0)} \leftarrow f_{i,j,k,t}-a_{i+1}\\
f_{i+1,(j+2)\pmod 3,1,t|(k==1)} \leftarrow f_{i,j,k,t}+a_{i+1}
$$
时间复杂度 $\mathcal O(n)$。