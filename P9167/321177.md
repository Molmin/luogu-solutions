# D1T2 城市建造 cities

一个连通块中只能有一个点被选中。

由于连通块大小是 $\left\lfloor n/cnt\right\rfloor$ 和 $\left\lceil n/cnt\right\rceil$，只有 $O(\sqrt{n})$ 种，可以枚举连通块大小。

考虑树上怎么做，假设当前枚举的连通块大小 $siz$，可能的连通块个数 $cnt$，那么有 $cnt$ 个节点被选中，且断边后断成了 $cnt$ 个连通块，也就是 $cnt$ 个节点有 $cnt-1$ 条边，因此合法方案实际上是一棵树（这个性质在考场上认为是菊花或是链之类的，没拿到部分分）。

考虑一个树形 DP，设 $f_v$ 为 $v$ 与父亲的连边被断开，即 $v$ 子树内部划分成大小为 $siz$ 或 $siz+1$ 的连通块的方案数。

一棵树的性质同样揭示了另一个事实：如果 $v$ 与父亲的连边不断开，那么 $v$ 一定是整体并入其父亲所在连通块的，也就只和子树大小 $siz_v$ 有关了。

这样对于 $u$ 的儿子 $v$，不同的 $siz_v$ 直接对应不同的处理方式：

- $siz_v>siz$，不可能与 $u$ 在同一连通块，$(u,v)$ 必须断开。

- $siz_v=siz$，既可能与 $u$ 在同一连通块，也可能单独成连通块。

- $siz_v<siz$，一定与 $u$ 在同一连通块。

这样我们只需要统计第一种情况是否内部划分都合法，第三种情况之和与 $u$ 拼在一起是否合法，同时将的第一种情况的方案数累成即为答案。还有一同时情况为：不存在小于 $siz$ 的，此时若 $siz=1$ 或存在等于 $siz$ 的子树 $v$ 才合法，且方案数乘上满足条件的 $v$ 的个数（如果 $u$ 单独成块也合法也要计入）。

这样在每个节点统计答案，默认其父亲及其他子树都不断开。

---

放到图上，由于删去选中节点的全部连边后不连通，容易想到点双连通分量，这样一个点双内如果选取超过一个且有没有选取的，无法达到不连通的条件。因此一个点双要么全不选，要么全选，要么选一个。反映到圆方树上就是选取点击构成的树，叶子节点一定全是圆点。

根据这个性质同样可以讨论圆点方点后 DP，$f_u$ 定义相同。

对于圆点，和上面树的情况讨论是一致的；对于方点，如果断开了其与父亲的连边，那么意味着其与儿子连边要么不断开要么全部断开，因此在对方点 DP 时，只需要考虑全部断开是否合法即可。

要注意的是，图上和树上不同之处在于即便 $siz_v=siz$，断开 $(u,v)$ 后不一点合法，因为这代表着 $v$ 对应所有圆点连边都将断开，而不是像树上作为一个整体。

这样大致就是全部算法流程，还存在的问题是枚举到 $\left\lfloor n/cnt\right\rfloor$ 时有可能存在方案至划分成了大小为 $\left\lceil n/cnt\right\rceil$ 的连通块，这样会算重。可以容斥，减去 $\left\lceil n/cnt\right\rceil$ 对应 $k=0$ 的情况。

--- 

由于复杂度一定拉满，需要大面积卡常：

- 只在重心位置统计答案，重心一定会被选中，否则被选中的部分是其一个子树，大小不超过一半，也就和其余部分大小相差 $1$ 以上。

- DFS 时按照 DFS 序重标号，$O(\sqrt{n})$ 次 DFS 使用非递归 DFS。

- 使用邻接表而不是 `vector`。

- 如果存在大小大于 $siz$ 的子树内部不合法或是大小小于 $siz$ 的子树大小之和超过了 $siz$，一定没有合法方案，可以不再枚举子树。

- 如果 $siz_u<siz$，一定没有合法方案，这一处能带来极大的优化。