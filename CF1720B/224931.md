可能是生涯最后一场 cf 了，$+47$。

## 大意

给定长度为 $n$ 的数列 $a$，要求出

$$
\max\limits_{1\le l\le r\le n}\left\{\max_{l\le i\le r}\{a_i\}-\min_{l\le i\le r}\{a_i\}+\max_{1\le i<l\lor r<i\le n}\{a_i\}-\min_{1\le i<l\lor r<i\le n}\{a_i\}\right\}
$$

$4\le n\le 10^6$，$1\le a_i\le 10^9$。

## 题解

记 $s,t$ 分别表示最小值与次小值，$\mathscr{A,S}$（分别是「最大值」与「次大值」日语罗马音的第二个字符）分别表示最大值与次大值。

大可以观察样例，发现答案都形如 $\mathscr A+\mathscr S-s-t$（可以结合「样例解释」判断）。

不用观察样例也能发现，不考虑**区间**的限制，我们能得到的最大值，当且仅当两部分的最大值为 $\mathscr{A,S}$，最小值为 $s,t$。因为这样得到的两个「差值」是最大的。

注意：这里我们用「差值」刻画了 $[l,r],[1,l)\cup(r,n]$ 两个集合内的最大值与最小值的差。容易发现，题目所求即为两个「差值」和的最大值。

没错，这也就是考虑了区间后的结论，下面我们证明它。

**【结论】** 答案必定为 $\mathscr A+\mathscr S-s-t$，下面记作 $ans$。

**【证明】** 分两种情况讨论：

**$\textbf{1. }$ $\mathscr{A,S}$ 均在 $s,t$ 的一侧，这里以左侧为例。**

考虑以 $M$ 代替 $\mathscr{A,S}$，$m$ 代替 $s,t$。这样的话，只要我们两个「差值」都形如 $M-m$，那么将能得到 $ans$。留作习题。

那么序列将形如：

$$
M\ \ldots\ \underline{M\ \ldots\ m}\ \ldots\ m
$$

显然地，这里我们以下划线部分作为 $[l,r]$，可以使得两个「差值」均形如 $M-m$（因为最小值不可能比 $m$ 小而最大值不可能比 $M$ 大）。

括号里的文字阐述了抽象的原因，留作习题。

**$\textbf{2. }$ $\mathscr{A,S}$ 分布在 $s,t$ 的两侧。**

序列将形如：

$$
\underline{M\ \ldots\ m}\ \ldots\ m\ \ldots\ M
$$

以下划线部分作为 $[l,r]$。

**$\textbf{3. }$ $\mathscr{A,S},s,t$ 中的 $M,m$ 交替排列。**

序列将形如：

$$
\underline{M\ \ldots\ m}\ \ldots\ M\ \ldots\ m
$$

以下划线部分作为 $[l,r]$。

___

以上的所有便是证明的全部过程，我们上面疏漏的情况均可以将上面的 $M,m$ 交换得到。

容易发现这样得到的 $\textbf1',\textbf2',\textbf3'$ 与 $\textbf1,\textbf2,\textbf3$ 正确性一致，留作习题。

___

于是我们证明了答案就是 $ans$。

计算 $ans$ 的过程极为显然，从小到大排序后，输出 $a_n+a_{n-1}-a_1-a_2$ 即可。

## 代码

[**168817835**](https://codeforces.com/contest/1720/submission/168817835)

## 习题

如上所述，我们有如下习题留给读者：

1. 求证：当两个「差值」均形如 $M-m$ 时所得答案最大。（提示：考虑枚举所有情况。）
2. 试说明为什么按照 $\textbf1,\textbf2,\textbf3$ 的下划线分配区间可以取得 $ans$，并且说明括号里文字能够解释前一问的原因。
3. 求证：交换命题 $\bm{T}$ 中的 $M,m$ 后得到的命题 $\bm{T'}$ 与 $\bm{T}$ 正确性一致。