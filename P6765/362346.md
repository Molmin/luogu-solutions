其实这题很简单啊，不像一些题解说的要启发式合并。

按照边权从小到大加边，然后有一个结论：点 $u$ 和 $v$ 能够互相通车，当且仅当 $u$ 和 $v$ 联通，且 $u$ 与 $v$ 所在的连通块不是一条链。结论自证不难。

问题是如何用 kruskal 重构树维护这个信息。

考虑加入一条边：

当 $u$ 和 $v$ 不联通时，我们首先合并 $u$ 与 $v$ 所在的联通块，然后分类讨论：

+ 如果 $u$ 和 $v$ 所在的联通块有一个不是链，那么新联通块一定不是链。
+ 否则，记录联通块对应链的左右端点，如果能接起来就是链，否则就不是。

当 $u$ 和 $v$ 联通时，如果 $u$ 和 $v$ 所在的联通块是链，那么加一条边后一定不是链。我们将 $u$ 和 $v$ 所在联通块对应的点接到新点上，将新点设为不是链。

因为一个联通块至多有一次从是链转变成不是链，所以最终节点总数不超过 $3n$。

查询的时候，我们首先找到 $u$ 和 $v$ 在 	kruskal	 重构树上的 lca，如果对应的联通块不是链，直接返回对应边权即可；否则从 lca 开始倍增，找到第一个不是链的点即可。

时间复杂度 $O((n+q)\log n)$，空间复杂度 $O(n\log n)$。

[代码](https://loj.ac/s/1677370)