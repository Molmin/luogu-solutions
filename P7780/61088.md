~~idea 来自校内讨论奇怪问题~~

显然序列保持不降，所以搞一个 set 维护所有同色连续段，每一次分裂连续段的时候减去原长度的 $k$ 次方再加上两个新长度的 $k$ 次方之和就可以了。

复杂度 $O(q\log k)$。