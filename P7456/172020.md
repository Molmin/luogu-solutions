### P7456 [CERC2018] The ABCD Murderer

> 给定一个文本串 $S$ 和一些串 $a_i$，你需要用一些 $a_i$ 拼成文本串 $S$，每个 $a_i$ 可以使用多次。相邻两个串可以重合，前提是它们重合部分相等。求最少需要多少个串，同一个串使用多次按照次数计算。

我们考虑 DP 状态 $f(i)$ 表示铺满前 $i$ 个字符最少需要用到多少个串。有两种转移：$f(i)\rightarrow f(i-1)$，和当 $S[i+1\cdots j]$ 是某个模式串时，$f(i)\rightarrow f(j)$。这时我们只需要求出 $S$ 中哪些区间是模式串然后建图跑最短路即可。但是图的大小是 $O(n^2)$ 级别的，考虑优化建图。

首先，我们注意到，若从 $i$ 点开始可以匹配多个不同的模式串，则匹配最长的那个一定是更优的。从 $i$ 点开始不太好做，我们可以将整个串反转然后用 AC 自动机跑多模匹配。

为什么这样做是正确的呢？我们有如下引理：

**引理：当一个结尾字符有多个可能匹配的模式串时，AC 自动机会匹配最长的一个。**

这样我们就把图转化成了 $O(n)$ 级别的，使用 01BFS 求解最短路即可。

时间复杂度 $O(n)$。