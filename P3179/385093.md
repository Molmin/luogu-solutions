### 题解

首先有一个式子：

$$
\text{sg}(x) = \text{mex}\{0,\text{sg}(2x),\text{sg}(2x)\oplus \text{sg}(3x),...,\text{sg}(2x) \oplus \text{sg}(3x) \oplus... \oplus \text{sg}(\lfloor\dfrac{n}{x}\rfloor \times x)\} 
$$

和 $\rm Multi-Nim$ 是一个道理，一个游戏的 $\rm sg$ 值是它后继游戏 $\text{sg}$ 值的异或和。

自然，要进行一个表的打。

发现对于 $\lfloor\dfrac{n}{x}\rfloor$ 相等的 $x$，$\text{sg}(x)$ 也相等。这点可以感性理解，因为 $\lfloor\dfrac{n}{x}\rfloor$ 相等的 $x$ 倍数 $\text{sg}$ 值的情况也差不多。看到 $\text{sg}$ 式子里有约数倍数这类东西可以往这方面想一想。

知道这个性质，我们就可以每一块只算一次答案了。但是仍然不能直接枚举倍数，因为哪怕直接枚举 $1$ 的倍数都会爆炸。我们可以将整除分块的性质利用得更加充分一些。考虑 $x$ 的倍数 $2x,3x,...,kx$，我们似乎可以用 $O(\sqrt{k})$ 的时间求得每一个 $x$ 的倍数属于哪一块。具体来说，假如现在正考虑 $ax$，那么和 $ax$ 在同一块且最靠右的 $x$ 的倍数就是 $\lfloor\dfrac{r}{x}\rfloor \times x$，其中 $r$ 表示 $ax$ 所在块的右端点。那么这一段 $x$ 的倍数均在同一块里，把 $a$ 更新为 $\lfloor\dfrac{r}{x}\rfloor + 1$ 继续往后做即可。知道这件事如何计算呢？假如当前块是第 $q$ 块，$\rm ans$ 里保存的是位于 $1 \sim q - 1$ 块里 $x$ 的倍数的 $\rm sg$ 值异或和。用上面的方法求出位于第 $q$ 块的 $x$ 的倍数，令为 $\{ax, (a+1)x,..., bx\}$。由于这一段的 $\text{sg}$ 值全都是相同的，所以能给最开始的式子贡献的只有 $\text{ans} \oplus \text{sg}(ax)$ 一个值而已。最后，如果 $a$ 和 $b$ 奇偶性相同，即这一段的长度是奇数，将 $\rm ans$ 异或上一个 $\text{sg}(ax)$。

回答询问时将白格子的 $\rm sg$ 值异或起来，若为 $0$ 则先手必败；反之先手必胜。

本题块的左端点，块的右端点，$\rm sg$ 值都是针对某个块开的。如果直接用 $\rm STL$ 的哈希表会超时。可以先手写一个哈希表将块重映射到连续的编号区间上，然后再对编号开上面说的三个数组。