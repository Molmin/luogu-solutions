填一个很久之前的坑。

首先先转化一下式子：$\dfrac{\textrm{lcm}(a,b)}{\gcd(a,b)}=\dfrac{ab}{\gcd(a,b)^2}$。考虑到关于 $x$ 的因子个数 $d(x)$ 在 $5\times 10^4$ 的范围内最大值为 $100$，即对于一个常量 $a$，$\gcd(a,b)$ 的取值最多有 $100$ 种。所以我们考虑从 $\gcd(a,b)$ 这里下手。

因为我们不修改 $b$ 的值，所以我们考虑相同分子分母小数小的比较方法，做一个关于 $b$ 的因子的桶，$t_x$ 记录最小的因子含 $x$ 的 $b_i$。然后我们再考虑分块，设块长为 $B$。每次修改时散块暴力改，整块直接对 $x$ 分解因数，然后在 $t$ 里面找，取 $\min$ 就行。

修改就基本一样。

设 $d = \max d(V)$，时间复杂度为 $\mathcal{O}(q(\frac{nd}{B}+nB\log V))$。解方程 $\frac{nd}{B}=nB\log V$，时间复杂度 $\mathcal{O}(q\sqrt{nd\log V})$，whk 时乱取了个 $B=580$。