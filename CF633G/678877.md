[题目传送门](https://www.luogu.com.cn/problem/CF633G)

简单题。

先看到子树加和子树质数个数和，果断转换为 ```dfs``` 序进行处理。

既然有区间求和，考虑线段树。

若对于每一个节点维护一个 $cnt$ 数组，用二进制数 $x$ 来表示，即当 $cnt_i = 1$ 时第 $i$ 位为 $1$。设当前节点为 $u$，左右子节点分别为 $ls$ 和 $rs$。发现 $x_u = x_{ls} | x_{rs}$。统计时，就是区间的所有 $x$ 的按位或值 $res$ 与质数数组所表示的二进制数 $pr$ 的按位与后 $1$ 的个数。然后考虑更改，令 $v$ 为加的数，易得 ```x_u = (x_u << v & full) | (x_u >> (m - v))```，其中 $full = 2^m - 1$，是防止溢出用的。

都到这一步了，不会还有人不知道怎么优化吧。

既然是二进制的数，显然用 ```bitset``` 进行优化。就让 $cnt$ 数组变成 ```bitset``` 就行了。

时间复杂度：$\mathcal{O}(\dfrac{nm\log n}{w})$

[评测记录](https://codeforc.es/contest/633/submission/208601688)