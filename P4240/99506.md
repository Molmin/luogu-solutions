### 另一种做法：莫反+莫队

也很套路，我们使用二维莫队，问题变成了如何快速计算 $\sum_{i=1}^n\varphi(ix)$。

一种想法是直接上莫反，最后变成了 $\varphi(x)\sum_{d|x}f(d)\sum_{d|i}^n\varphi(i)$。

其中 $f(n)=\sum_{d|n}\frac{\mu(n/d)d}{\varphi(d)}$，可以通过简单的莫比乌斯反演计算得出。

但我们发现这样做会凉凉……毕竟 $10^5$ 级别内约数最大为 $128$，怎么办呢？

一种神奇的方法：找到一对 $(a,b)$ 满足 $a\times b=x$，则原式可以改写成 $\sum_{i=1}^{n\times a}\varphi(ib)[a|i]=\varphi(b)\sum_{d|b}f(d)\sum_{d|i,a|i}^n\varphi(i)$。

而 $d|i,a|i$ 等价于 $\text{lcm}(d,a)|i$，对于不同的 $a$，我们可以提前预处理这些。

所以说我们如果能找到约数尽量少 $b$，为了减少预处理量，我们还希望不同的 $a$ 也尽量的少。

一种做法是令 $B=2^2\times 3\times 5$，然后我们令 $a=\gcd(x,B),b=x/\gcd(x,B)$，这样不难发现 $b$ 的约数个数最大为 $16$（当然还有少量的几个为 $32$，如 $2^3\times3^2\times7\times11\times13$，但这样的数还是非常少的），其实也可以调整 $B$ 的质因数组合（不过我懒得搞了），不过整体上来说还是不错的。

预处理复杂度为 $O(n\ln n\times d(B))$，询问复杂度约为 $O(16\times n\sqrt T)$。