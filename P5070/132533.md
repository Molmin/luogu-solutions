考虑扫描线。              

我们考虑新加入一个在末尾的点，只会影响区间 $[i,r],i \in [lst_{a_i} + 1 , r]$ 的状态，并且只会合并 $0 \sim 2$ 条值域段。             

所以我们直接开 $10$ 个树状数组维护大小为 $[1,10]$ 的值域段数量，每加入一个点依次对于值域区间在 $[a_i - 10 , a_i + 10]$ 之内相同的的序列区间左端点进行维护。

实现时我们可以考虑从中间向左右两边扩展，依次找到每种形成值域段情况是在序列中的哪端，如果有合并线段还要把两边的线段删了然后再加新合成的线段长度。           

时间复杂度 $O(20 n \log n)$，还是挺离谱的时间复杂度。

个人认为这道题有点臭。

本题重点在于正确实现，有以下实现细节：               

1. 特判当前向两边扩展时是否已经在 $lst_{a_i}$ 之外；

2. 注意向左/右两边扩展长度不能超过 $10$；

3. 注意向左/右两边扩展时，一次要尽量向左/右两边扩展而不是扩展一次就结束了；

4. 如果写成 while 的形式你还要最后加一次。            

~~其实我自己最后也没调出来，最后做扫描线的那段一段就照着 dX 的打了~~

顺便求助一下下面这份代码为什么会过不了，一直调不出来：          

[链接](https://www.luogu.com.cn/record/62141542)