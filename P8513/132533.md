CTS 2022 袜子/Ynoi T136。

提供一种不需要根号分治的做法。

**旋转扫描线**

lxl ppt 里讲的太怪了。

我们认为对于 $n$ 个点，关于它们的有效半平面中**有效斜率的**数量级不超 $O(n ^ 2)$，这是一个结论。

几何角度理解：将 $k$ 从 $-\infty$ 到 $\infty$ 单增，此时每个点确定一条斜率为 $k$ 的直线。此时截距的增长和且仅和一个点的横坐标有关，则对每个点确定的直线，存在一个临界 $k$ 满足当斜率超过 $k$ 时一个点确定直线的截距恒大于另一个点确定直线的截距。故有效斜率数量不超 $O(n ^ 2)$。

序列角度：在 $k$ 单增的过程中维护每个点确定直线按照截距从小到大排序的位置关系，每个点对贡献 $O(1)$ 次交换，则需要的临界斜率数量级不超 $O(n ^ 2)$。

在解决了[此题](https://uoj.ac/problem/553)之后。我们还是同样套路地使用旋转扫描线，将点按照颜色排序后，每个块维护块内第一种颜色出现次数/块内颜色出现次数平方/块内最后一种颜色出现次数，即可维护半群信息的合并进而求出答案。

我们求出任意两点的临界斜率，根据其排序；$k$ 相同时需注意按照 $x,y$ 作为一二关键字排序。我之前写的不按关键字排序然后一路 swap 过去会迷之 WA 掉，由于任意两点只会被交换一次所以肯定不会 T，个人思考了一下也不是很理解，发个贴问问。

按照大小 $B$ 分块，对于 $B ^ 2$ 个 swap 的斜率，由于当前的 swap 已经被拆分成了交换相邻项，直接维护上述的前后缀半群信息就行了。

这样就做到了 $O(\frac{n}{B} (B ^ 2 + m \log n))$，取 $B = \sqrt {m \log m}$ 即可做到 $O(n \sqrt {m \log n})$，视常数产生的影响个人取时块长还是开的根号。

需要代码直接私我。虽然要退役了。