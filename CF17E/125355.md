# 题目

[传送门](https://www.luogu.com.cn/problem/CF17E)

给定一个长度为 $n$ 的小写字母串.问你有多少对相交的回文子 串(包含也算相交)。.

**输入格式**

第一行是字符串长度 $n(1\le n\le 2*10^6)$，第二行字符串.

**输出格式**

相交的回文子串个数 $\bmod 51123987$.

# 题解

首先，如果我们正向求解有多少个回文串相交有些困难，因为相交的长度不固定，甚至还有可能是包含关系，考虑正~~男(♂)~~难则反——反向求解有多少回文串没有交，这样我们只需要枚举分界点，计算在左边和在右边的回文串数量即可.

那么，这个题的问题就是在对于位置 $i$，我们如何求出在它 左/右 边的回文串数量，这里主要介绍使用 $\tt PAM$ 的解决方案.

我们考虑在加入一个字符 $\tt s[i]$ 之后，结尾**刚好在** $i$ 的回文串的数量，这里给出性质:

> 以一个点结尾的回文串个数就是它所代表的点在 $fail$ 树上的深度.

证明：$\mathcal Obviously$.

对于在其右边的，我们倒着做一遍就可以了.

```cpp
https://www.cnblogs.com/Arextre/p/14269229.html
```

# 本题关键

1. 考虑问题，正难则反；
2. 回文自动机特性：以一个点结尾的回文串个数就是它所代表的点在 $fail$ 树上的深度；

另外，这个题卡空间，建议使用邻接表构建自动机 ~~坑死我了~~.