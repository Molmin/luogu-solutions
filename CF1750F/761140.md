称“最终态”为不能再操作的、两端为 1 的 01 序列。

找最终态的充要条件：两端为 1 且每一段连续的 0 的个数大于两边连续 1 的个数和。（$\Delta$）

设 $g_n$ 表示长度为 $n$ 全为 1 的最终态对应的初始方案数，即我们最终的答案。

设一个最终态有 $k$ 段连续的 1，且长度分别为 $c_1,\dots,c_k$，则这个最终态对应的初始方案数为
$$
\prod_{i=1}^kg_{c_i}
$$
若 $k=1$，则这个式子恒等，所以我们无法通过知道 $g_1,\dots,g_{n-1}$ 用这个式子求出 $g_n$。

那咋办捏，我们发现长度为 $n$，两边为 1 的共 $2^{n-2}$ 个初始 01 序列，每一个都有最终态（可能是废话）。

所以我们只要求出长度为 $n$ 两边为 1 的 01 序列有多少最终态不为全 1，就得到了多少为全 1。

然而除了全 1 最终态有 $2^{n-2}-1$ 个，有点多。

考虑用 $\Delta$ 式来 DP。

设 $f_{n,m}$ 表示 长度为 $n$、左端必须为 1、右端极长连续 1 有 $m(\in[1,n])$ 个的 01 序列 为最终态的初始态方案数之和。

所以其实有 $g_n=f_{n,n}$。

有一个 $O(n^4)$ 的转移（定义域外不妨设为 $0$）
$$
\begin{cases}
f_{n,m}=1 & n=m=1
\\
f_{n,m}=g_m\sum_{i=1}^{n-m-1}\sum_{j=1}^{n-m-i}[i>j+m]f_{n-m-i,j}&n>1,1\le m< n
\\
f_{n,n}=g_n=2^{n-2}-\sum_{i=1}^{n-1}f_{n,i} & n>1
\end{cases}
$$
$i$ 是枚举上一段 0 的长度，$j$ 是上一段 1 的长度。

由于定义域外的都是 $0$ 了，中间那式子 $i,j$ 的上下界其实就无意义了，改写
$$
\begin{aligned}
f_{n,m}&=g_m\sum_{i>j+m}f_{n-m-i,j}
\\&=g_m\sum_{i+j\le n-2m-1}f_{i,j}
\end{aligned}
$$
发现后面求和其实是变形的二维前缀和形式。

前缀和优化 DP 就做完了，$O(n^2)$。