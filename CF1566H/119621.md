**约定：本文所有 $\sum$ 都是异或和。**

首先显然只需要询问所有 $\mu(x)\neq 0$ 的 $x$，刚好能卡进询问次数限制。

令 $w(x)=\prod\limits_{p\in P,p|x}p$，即 $x$ 所有质因子的乘积，$S(y)=\{x|w(x)=y\}$。

这样划分之后，我们可以先解决外部问题，再解决每个 $S(*)$ 内部的问题。

令 $f(x)$ 为询问 $x$ 得到的值，$g(x)=\sum\limits_{i\in A,x|i}i$。

可以得到 $f(x)=\sum\limits_{i|x}g(i)$。

实际上就是莫比乌斯反演，只不过运算变为了异或。

令 $h(x)=\sum\limits_{i\in A\cap S(x)}i$，即 $S(x)$ 中所有被选出的数的异或和。

那么可以得到 $g(x)=\sum\limits_{x|i}h(i)$。

同样使用莫比乌斯反演可以得到 $h(x)=\sum\limits_{x|i}g(i)$。

**注意这里 $f(x),g(x),h(x)$ 的定义域都是 $D=\{x|\mu(x)\neq 0\}$。**

此时我们就解决了外部问题，现在问题转化为了：

- 给定很多集合 $S(x)$，从每个集合中选出一些数，要求 $S(x)$ 中选出的数的异或和为 $h(x)$。同时还要满足所有集合中选出的数总共恰好 $n$ 个。

这个问题是非常困难的，但我们可以发现题目中有一个重要性质还没有利用：**数据随机**。

先对于每个 $S(x)$ 建出线性基，我们相当于是要确定每个 $S(x)$ 中**基外**的数的选取情况。

可以发现 $|S(x)|$ 较大时从中选出的数的个数自由度也较大。此时我们可以分别处理：

- 如果一个 $S(x)$ 不是前 $500$ 大的，那么我们钦定这个集合中所有基外的数全部不选。

- 否则我们对于这个集合随机 $100$ 次，每次在基外选出不超过 $80$ 个数，然后在基内求出合法的选取方案。

此时每个集合有 $100$ 个合法的选取方案，我们需要在每个集合中选出一个方案，使得所有集合的方案一共选出恰好 $n$ 个数。这一部分可以使用背包 dp 完成，并用 bitset 优化。

这样做就能通过了。

复杂度没法写，写出来全是常数，不过算一下就知道明显在合理范围内。

这个做法的正确率我不大会算，但是肯定很高（