我们首先考虑对于 $(x,y)$ 它们合法的条件是什么

设 $t$ 为连续数的开头，那么我们就可以写出 $x=\frac{y(y-1)}{2}+ty$ 

移项，得到 $\frac{2x-y^2}{y}=2t-1$ ，即我们要求 $\frac{2x}{y}-y$ 为 **奇数** 

考虑将每个数内的 2 的次幂分离出来，设 $v(x)$ 表示 $x$ 中 2的指数，$p(x)$ 为 $x$ 中最大的奇数因子，即每个 $x$ 都可以被写成 $2^{v(x)}\cdot p(x)$ 

那么我们就可以将原式写成 $2^{v(x)-v(y)+1}\cdot \frac{p(x)}{p(y)} -2^{v(y)}\cdot p(y)$   ，不难发现我们首先要满足的条件就是 $p(y)|p(x)$  ，剩下的限制分类讨论：

1. $y$ 为奇数，即 $v(y)=0$ ，那么我们要求前面一项为偶数，所以 $v(x)-v(y)+1\geq 0$ ，得到 $v(x)\geq -1$ ，即 $v(x)$ 任取
2. $y$ 为偶数，那么要求前面一项为奇数，所以 $v(x)-v(y)+1=0$ ，得到 $v(y)=v(x)+1$ 

综上所述， $(x,y)$ 合法当且仅当 $p(y)|p(x)$ 并且 $v(y)=0$ 与 $v(y)=v(x)+1$ 中有一个条件被满足

那么我们设 $f(i)$ 表示以 $i$ 为结尾且 $[1,i]$ 中的数都变好的最小修改次数，每次转移枚举一个 $j$ ，我们就需要 $\text{check}$ 一下 $[j,i]$ 中，能否不修改 $a_j,a_i$ 且修改 $[j+1,i-1]$ 中全部的数得到合法序列，我们根据前面得到的性质可以推出该区间首先满足 $p(a_i)|p(a_j)$，
其次还需要满足 $v(a_i)\leq j-i+1$ 或 $v(a_i)-v(a_j)=i-j$ ，这个推导就很容易了。

