越做题智商越低了属于是（

可以考虑答案的上界。

对于 $n^2$ 个数来说，每个数所输出的贡献和输入的贡献之和等于 $n^2-n$（所有的除了和它同一组的数），则总贡献是 $\frac{n^2(n^2-1)}2$。

根据抽屉原理（大概是吧，反正是那个意思），答案的上界为

$$\left\lfloor\frac{n^2(n^2-1)}{2\times n(n-1)}\right\rfloor=\left\lfloor\frac{n^2}{2}\right\rfloor$$

然后只要能够构造出答案等于这个上界的方案，则该方案一定是最优的。

对于 $n$ 为偶数的情况，答案等于 $\frac {n^2}2$。

那么，对于每一组，选择当前未被归类的数中最小的 $\frac n2$ 个和最大的 $\frac n2$ 个。可以证明这样答案为 $\frac {n^2} 2$

对于 $n$ 为奇数的情况，答案为 $\frac {n^2} 2 - \frac 12$。

可以删去最大的 $n$ 个数，按照偶数的方法构造每一组的前 $n-1$ 个数，再用这 $n$ 个数充填到末尾即可。

这样的话，只考虑前 $n-1$ 个数的答案是 $\frac 12(n-1)^2$，展开得到 $\frac 12 n^2 - n + \frac 12$。

对于两组 $G_i,G_j$，若 $G_i$ 末尾的数大于 $G_j$，则

$$f\left(G_i,G_j\right)=\frac 12 n^2 - n + \frac 12 + n=\frac 12 n^2 + \frac 12$$

否则

$$f\left(G_i,G_j\right)=\frac 12 n^2 - n + \frac 12 + n - 1=\frac 12 n^2 - \frac 12$$

答案便是 $\frac 12 n^2 - \frac 12$。