感觉其他题解都没说清楚怎么转化为斯特林数的 这里放一下我场上思路。

首先，要保证每行每列都能被攻击到，必须每行或者每列都有一辆车，假设每行都有一辆车，然后最终答案乘二。（$k = n$ 的时候每行和每列都有一辆车，特判一下）

证明：

假设第 $i$ 列没有车，因为每一个格子都要被攻击到，所以第 $i$ 列上的每一个格子都要被攻击到，因为第 $i$ 列上没有车，所以应该被同行的车攻击到，所以此时每一行都有车。

好所以我们钦定这个是行，就是说每一行都有车，然后求答案。

设 $cnt_i$ 为第 $i$ 列上车的数量。

总共有 $n$ 辆车，所以有 $\sum_{i = 1}^n cnt_i = n$。

因为每行都有一辆车，而且总共有 $n$ 辆车，所以每行有且仅有一辆车。

那么互相攻击的车对，一定是在同一列的。

这个就是植树问题了，第 $i$ 列上互相攻击的车有 $\max(cnt_i - 1, 0)$ 对。

所以 $k = \sum_{i = 1}^n \max(cnt_i - 1, 0)$。

我们发现 $n$ 和 $k$ 就差了一个 $\max$！

所以简单推导一下：

$$k + n = \sum_{i = 1}^n \max(cnt_i - 1, 0) + \sum_{i = 1}^n 1$$

$$= \sum_{i = 1}^n \max(cnt_i, 1)$$

然后再减去 $n$ ，得到

$$k + n - n = \sum_{i = 1}^n \max(cnt_i, 1) - \sum_{i = 1}^n cnt_i$$

$$ = \sum_{i = 1}^n [cnt_i = 0]$$

然后就发现 $k$ 就是 $cnt$ 中等于 $0$ 的个数。

所以 $n - k$ 就是 $cnt$ 中不为 $0$ 的个数，问题转化为在 $n - k$ 个有标号的盒子放 $n$ 个球球且每个盒子都要有球球的方案数，就是第二类斯特林数了。