考虑 $1$ 操作 $\text{1 x y}$，由于在非升序列上操作，改变的值一定构成了一段 $[1,x]$ 的后缀区间 $[L,x]$。所以可以维护区间 $\min$ 在线段树上二分找到后缀区间的左端点。

考虑 $2$ 操作 $\text{2 x y}$，答案必然是一些连续段之和，并且这些连续段的个数不超过 $\log n$ 个，证明显然。所以可以考虑直接在区间上暴力查询，时间复杂度是 $O(\log^2 n)$ 的。但是这个部分有一个左边界的限制，考虑让 $[1,x)$ 一定被计入答案，最后再减去即可。

代码就不贴了，线段树二分入门题。