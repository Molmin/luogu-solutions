这题的复杂度可以不依赖于 $\sum v$，复杂度为 $O(n\log^2n)$ 或 $O(n\log n)$。

仍然考虑模拟费用流。令 $a_i=x_i-y_i$，相当于要拿正的去抵消负的。因为负的强制满流，所以随便选一个顺序给每个负的 $a_i$ 满流可以得到最优解。不难发现按照 dfs 序转移比较方便。具体来说，用数据结构维护边权（剩余流量）以及当前 dfs 到的点到每个点的距离。从一个点走到一个相邻点，对距离的影响可以转化为区间加。修改一条边的费用，也是区间加。维护一条边的费用，只需要判断反向边剩余流量是否为 0。

根据势能分析，显然每条边的反向边（从 0 变成 非 0）以及（从 非 0 变成 0）这两件事情只会发生常数次。因为每条边在 dfs 的过程中，分为三部分，第一部分和第三部分只会从外面走到里面，第二部分只会从里面走到外面。相当于先加一段再减一段再加一段。这样根据每条边（是否为 0）可以暴力维护出边的费用从而维护出距离。

以上过程都可以用树剖实现，比较复杂。~~换成 LCT 就 1log 了。~~

[代码](https://loj.ac/s/1484558)