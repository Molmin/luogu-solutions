用树解决。  
题目中的 $p_i$ 是 $i$ 的祖先可以抽象成为：$p_i$ 到 $i$ 有一条有向边，然后我们再对于每个点，判断其是否被遍历到了，如果没有的话进行树的 dfs，权值就是最大的 $y_i$，每次向下遍历时权值减一，然后对于每个点的 $y_i$ 取 $\max$。

此外，此题的 $y_i$ 需要加一，因为他自己也能受益，而且 $x_i$ 会重复，选取最大的 $y_i$ 便可。

[代码](https://atcoder.jp/contests/abc309/submissions/43385521)