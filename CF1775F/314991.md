哈哈，讲一下场上的弱智做法！

直接快进到 $u=2$。注意到最终形态一定是凸的！正常人这个时候就会想到扣角下来 dp！但是我属于纸张！

记网格大小为 $x\times y$，第 $i$ 列格子数量为 $a_i$，那么有 $a$ 先不减后不增，且中间连续的一段 $a_i=x$。分析可知对于一种序列 $a$，共有 $\prod_{i=1}^{y-1}(|{a_{i+1}-a_i}|+1)$ 种放置的方法。

先不减后不增比较难处理，可以枚举中间极长的 $a_i=x$ 连续段，这样两侧就都可以被看成是不减的了。记 $f_{i,j}$ 为长为 $i$ 的和为 $j$ 的不减序列对应的放置方法之和，有转移 $f_{i,j}=\sum_{k=1,ik\le j}(k+1)f_{i-1,j-ik}$。又有于枚举的是极长连续段，所以序列的第一个不能是 $0$，故 $g_{i,j}=f_{i,j}-f_{i-1,j}$ 是真正的方法数。还没完，由于需要将两侧的合起来，所以对于 $h_{i,j}=h_{i-1,j}+g_{i,j}$，我们需要计算出 $h$ 和 $g$ 的二维卷积即可。不难想到将二维拍到序列上，即取 $B>2\max j$，让 $(i,j)\to iB+j$，之后 MTT 计算。

复杂度 $O(n\log n+T\sqrt n)$，代码没有写。