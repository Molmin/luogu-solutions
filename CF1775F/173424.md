只讲询问 $2$，询问 $1$ 直接枚举就行。

我们设长方形的一条边长为 $a$，另一条为 $b$，且 $a < b$。

那么 $a,b$ 就要满足条件 $a\times b-n \le a$。

然后还要周长最小，发现这样的长方形数大概在根号级别，且 $a$ 也在 $\sqrt{n}$ 附近，我们就可以枚举这个长方形。

然后考虑知道长方形的之后怎么做。

从答案入手，发现长方形一定是只抠 $4$ 个角中的任意几个角，而且抠出来的形状要是阶梯形，要不然会影响周长。

设 $f_i$ 表示在一个角抠掉 $i$ 个块的方案数。

如果我们知道了这个，那么 $4$ 个角的答案是可以合并的，即不会相互影响，因为我们有 $a\times b-n < a$。

至于 $f_i$，而且抠掉的是个阶梯型，就想到了[P1025](https://www.luogu.com.cn/problem/P1025)。

只要保证分出来的组数小于 $a$ 即可。

就有 $f_i = \sum_{j=1}^i dp_{i,j}$。

这里的 $dp$ 就是上面那道题的 $dp$ 数组。

合并的话是一个卷积的形式。

由于要抠掉的格子数是根号级别，可以暴力卷，卷 $3$ 次就行了。

然后你发现这样还是过不了，要先预处理 $f_i$ 才能过。