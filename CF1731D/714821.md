前置知识：单调队列，建议先学习后完成。另外二维 ST 表和朴素 dp 应该也能过。

不难发现答案具有显然的单调性，因为如果区间扩大原来不符合条件的区间现在一定仍然不符合条件。

于是考虑二分答案 $ l $，每次判断每个 $ l \times l $ 的区间内最小值是否都 $ \geq l $ 即可。

问题转化为：给定 $ n \times m $ 的矩阵，求所有 $ l \times l $ 的矩阵内的最小值。这就是一个经典问题了，用单调队列实现，具体见 [P2216](https://www.luogu.com.cn/problem/P2216)。

总时间复杂度 $ \mathcal{O}(nm\log{\min(n,m)}) $，可以通过。代码就不贴了。