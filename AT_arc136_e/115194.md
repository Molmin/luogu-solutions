首先把 $1$ 排除在外，最后答案直接加上 $a_1$ 即可。

考虑怎样的两点 $x,y$ 可以到达。类似于 CF870F Paths，可以得到如下结论：

- 如果 $x,y$ 均为偶数，那么必然可达。
- 如果 $x$ 偶数，$y$ 奇数，那么可达的充要条件是 $x\le y-m(y)$
- 如果 $x$ 奇数，$y$ 偶数，那么可达的充要条件是 $x+m(x)\le y$。
- 如果 $x,y$ 都是奇数，那么可达的充要条件是 $x+m(x)\le y-m(y)$。

其中 $m(x)$ 表示 $x$ 的最小质因子。

考虑将这个结论换一种形式表达使其能够应用于本题的结论中。对于一个点 $x$ 而言，定义其所表示的区间 $[l(x),r(x)]$ 为：

- 如果 $x$ 是偶数，那么 $l(x)=x$，$r(x)=x$。
- 否则 $l(x)=x-m(x)+1,r(x)=x+m(x)-1$。

那么一个集合 $S$ 合法的充要条件是对于所有 $x\in S$ 而言，$[l(x),r(x)]$ 的交非空。

这样我们维护一个数组 $b$，然后对于每个 $x$，对 $b$ 中 $[l(x),r(x)]$ 区间加 $a_x$，然后输出 $b$ 数组的最大值即可。