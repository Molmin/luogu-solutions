~~第一次独立做出 EDU G，感动。~~

交集与并集的关系的基础练习。

设 $S=\{s_1,s_2,……,s_n\},T\subseteq S$，那么我们其实就是要求所有的 $f(T)$。

$f(T)$ 代表 $T$ 中每个串的子序列之并的数量。

求之前不妨先考虑每个串的子序列数量，由于每个串升序排序，所以答案为 $(cnt_a+1)(cnt_b+1)……(cnt_z+1)$。

由此可得：$f(\{s_i\})=(cnt_{i,a}+1)(cnt_{i,b}+1)……(cnt_{i,z}+1)$

但是只知道这个并没有任何用，因为我们求的是并集，而非交集。

但并集和交集又有直接关系，所以不妨我们先把交集求出来。

设 $g(T)$ 为 $T$ 中每个串的子序列之交的数量，$minn_x=\min\{cnt_{T_1,x},cnt_{T_2,x},……,cnt_{T_\text{size(T),x}}\}+1$，则 $g(T)=(minn_a+1)(minn_b+1)……(minn_z+1)$。

易得 $f(T)=\sum\limits_{P\subseteq T}(-1)^{\text{size(P)}+1}g(P)$。

于是我们可以先枚举 $T$ 后枚举 $P$，得到一个时间复杂度 $O(3^n)$ 的优秀做法。

但这并不是我们想要的，我们需要把其优化到 $2^n$ 级别。

一开始令 $f(P)=g(P)$

不妨我们先枚举 $P$，然后枚举比 $\text{size(P)}$ 大 $1$ 的超集 $P'$，将 $f(P)$ 加到 $f(P')$ 中，这样的话，当 $f(P)$ 转移到 $f(T)$ 时，一共会加 $(\text{size(T)-size(P)})!$ 次（相当 $P$ 在 $T$ 中的补集这块随便选）。所以当真正计算的 $f(T)$ 的时候，我们要将与 $f(P)$ 相关的增量除以 $(\text{size(T)-size(P)})!$。

虽然转移的时间复杂度已经是 $O(2^nn)$，但是计算的时候还是 $O(3^n)$，但是我们发现一个重要的性质就是转移次数（也就是 $(\text{size(T)-size(P)})!$）只会随着 $P$ 的大小而变化，所以我们并不需要关系 $P$ 是什么，只需要关系 $P$ 的 $\text{size}$ 是什么即可。

所以我们只需要开一个数组 $sum_{T,x}$ 代表 $\text{size(P}\subseteq T)=x$ 时的转移之和，每次只需要将这个东西转移到超集中即可。这样一来计算的时间复杂度也是 $O(2^nn)$ 了，所以总时间复杂度就是 $O(2^nn)$。

注意转移和计算的时候必须写成**递归**形式，递归的好处是不需要真正的去将 $sum_{P,x}$ 转移到 $sum_{P',x}$，而是每次只需要将 $sum_{P',\text{size(P')}}$ 加上 $f(P')$ 然后往下递归即可，不然你每次都需要 memmove 一下，时间复杂度退化成 $O(2^nn^2)$，空间复杂度又变成了 $O(2^nn)$，不用一些奇淫技巧根本过不去。而使用递归却可以完美地解决这些问题，而且空间极其的小，$2^n$ 级别的根本不需要开。