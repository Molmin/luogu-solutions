给 EI 的题解的翻译再做一次翻译

首先考虑一个简单的转化，我们可以把整数上的偏序关系丢到实数上，具体的

$\frac{\left\langle\begin{matrix}n\\k\end{matrix}\right\rangle}{n!}$ 表示 $(0,1)$ 中均匀随机 $n$ 个实数 $\{a_i\}$ ，有 $k$ 个升高即 $\displaystyle \sum_{i=1}^{n-1} [a_{i+1}>a_i]=k$ 的概率

依然不好求，考虑差分,注意到这样会出负数然后接下来是精妙的一步，令 $b_i=a_i-a_{i-1}\mod 1=a_i-a_{i-1}+[a_i<a_{i-1}]$ ，则有 $\forall i,b_i\in(0,1)$ (注意到这样表示的好处很大，首先是值域统一了，然后也能够唯一还原回真正的差分数组从而还原回原数组了，根据前缀和可以快速判出到底有没有$+1$) 

对 $b_i$ 我们考察其性质，易有 $\displaystyle \sum_{i=1}^n b_i=\displaystyle \sum_{i=1}^n a_i-a_{i-1}+\sum_{i=1}^{n}[a_i<a_{i-1}]=a_n+n-1-k$

因此有 $\displaystyle \sum_{i=1}^n b_i\in(n-k-1,n-k)$

现在问题被完全转化为以下形式

> $(0,1)$ 中均匀随机 $n$ 个实数 $\{b_i\}$，$\sum b_i<x$ 的概率

不妨设问题的答案为 $F(x)$ 

接下来是更精妙的一步，注意到 $b_i$ 之间连接不紧密，限制只对其整体作用，因此考虑对 $\displaystyle c_i=\sum_{j=1}^i b_j$ 进一步研究

问题好像可以转为

> $(0,x)$ 中均匀随机 $n$ 个实数 $\{c_i\}$，$\forall i\in[1,n),c_{i+1}-c_i\in(0,1)$的概率。吗?

但是这是错的，正确的说法是

> $(0,x)$ 中均匀随机 $n$ 个实数 $\{c_i\}$，$\forall i\in[1,n),c_{i+1}-c_i\in(0,1)$的测度

关于这个玄妙的事实我们可以有一个感性的理解

那就是我们原来求的是 $(0,1)^n$ 这个 $n$ 维空间中间的合法的点集所占整个空间测度的比例，而现在概率空间的测度扩大，合法的点集的测度没有膨胀(意思就是求概率用的分子没变分母变,具体的原因是有一些点维度间不单调无法表示对原概率空间中的一个点施加前缀和变换的结果，这些点本来不存在于原问题概率空间中)，因此我们不能数比例(概率)而应该直接数测度相当于把分母从 $x^n$ 改回 $1^n$

具体来说，在 $(0,x)$ 均匀随机 $n$ 个实数满足某种特定的序关系的测度为 $\frac{x^n}{n!}$

下面是 $n=2$ 的一个解释

![](https://pic.imgdb.cn/item/618728af2ab3f51d91fcfed9.png)

关于上界钦定有几个相邻元素的差 $>1$ ，做个容斥,们有 $F(x)=\displaystyle \sum_{i=0}^{x}\binom{n}{i}(-1)^i \frac{(x-i)^n}{n!}$

答案为 $F(n-k)-F(n-k-1)$