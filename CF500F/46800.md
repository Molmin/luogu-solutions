给个不要脑子的做法。

因为这道题是物品会存在一段时间，对每个时间点求出 $0/1$ 背包的值。然后 $n$ 和背包大小都是 $4000$ 级别，于是考虑线段树分治。

也就是将所有物品丢到线段树上去，dfs 一遍整棵树，将覆盖当前区间的所有物品全部加到 $0/1$ 背包里面去，这样就可以在任意时间点得到 $0/1$ 背包的 dp 数组，回溯的时候撤销当前操作即可。

时间复杂度 $\mathcal O(n^2 \log p)$。

代码见我的 [$\texttt{blog}$](https://www.cnblogs.com/cj-xxz/p/12763336.html)