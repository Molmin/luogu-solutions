b. **[[AGC004F] Namori](https://atcoder.jp/contests/agc004/tasks/agc004_f)（7）**

题目中所给的操作很经典。如果原图是二分图的话，我们把左部点的颜色全部取反，那么一次操作就会变成对一条边交换两端点的颜色。

- 对于树：交换树边两端点的颜色，使其变成另一种形态。这是经典题。假设 $v_i$ 为 $i$ 子树内当前黑点数和目标黑点数的差。那么：
  - 对 $v_i\not = 0$ 无解。
  - 反之，答案是 $|v_1|+|v_2|+|v_3|+\dots+|v_n|$。
- 对于偶环的基环树：我们还是可以按上面染色，只是这次我们在原来的树上两点之间开了一个“便捷通道”。根据上面的经验，我们猜测这个便捷通道也是单向的（也就是只会执行 $\text{swap}(0,1),\text{swap}(1,0)$ 两种操作之一）。假设进行了 $x$ 次 $\text{swap}(0,1)$（如果进行 $\text{swap}(1,0)$ 那么 $x$ 是负的）。那么上面式子当中的 $v_i$ 都可以写成 $x$ 的线性表示，于是我们就变成了关于 $x$ 的多个线性函数绝对值和的最小值问题。取权值中位数即可。
- 对于奇环的基环树：那么我们先拆出来其中的一条边，对剩下的树先进行上述变换。那么拆出来的一条边的作用就是：$(1,1)\to (0,0),(0,0)\to (1,1)$。我们还是猜这玩意单向。那么这次它的使用次数是固定的了（$\dfrac{原来1个数-目标1个数}{2}$）。那么我们把它所带来的 $0$（或者 $1$）丢到它两个端电上在跑 $\sum |v_i|$ 即可。

[submission](https://atcoder.jp/contests/agc004/submissions/42203843)