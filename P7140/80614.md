其实这题空间完全不需要给这么大，甚至 $10\text{MB}$ 完全可以接受。

先讲正解吧，首先一眼看出要先枚举 $j$，然后对于 $k$，这其实就是一个前缀和问题，对于 $i$，是同余前缀和，但是光枚举 $j$ 的复杂度就已经上天了，该怎么办呢？

仔细读题，发现数据范围里给出了一个重要条件，那就是你询问的那个值的每个 $a$ 中下标都是合法的，这也就提示我们 $d$ 是 $O(\sqrt n)$ 级别的。

那么 $j$ 完全可以枚举，只要 $i$ 和 $k$ 的部分能 $O(1)$ 做出来就行。

显然这两个都是需要预处理的，这样时空复杂度就都是 $O(n\sqrt n)$，在大范围的空间限制下是能过的。

但如果空间限制很小怎么办。

其实我们可以将询问离线，只有当两次询问的 $d$ 不相同的时候才会更新对于 $i$ 的预处理，这样空间复杂度就是线性的，但又多了个排序。

时间复杂度：$O(n\sqrt n+m\log m)$。