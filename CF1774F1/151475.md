
想想 Repeat 在干什么。假设现在是第 $i$ 次，目前总共伤害是 $x$（这个 $x$ 很好计算，每次 Repeat 伤害会乘 $2$）。那么经过 Repeat 后，每只目前生命为 $w$ 猪会克隆一个生命为 $w-x$ 的猪。（原因：Repeat 会重新做一遍之前的东西，那么原有的每只猪肯定还会再生成一份且和它保持一致，而它会遭到 $x$ 的攻击，所以可以认为克隆了 $w-x$ 的猪）

那么考虑每一只创造的猪，每个正常的 Attack 操作都有效，而 Repeat 会克隆。这就表示可以先把猪的生命减掉它后面的所有 Attack，再考虑所有克隆。而克隆也就是每次 Repeat 选择减掉 $x$ 或者不剪掉 $x$，合起来一个 $2$ 的若干次方的集合。

假设第一个操作是 Attack。那么每次 Repeat 伤害会乘 $2$，因此在 $\log$ 次后的 Repeat 伤害足以干掉任何一只猪。所以 $\log$ 次后的 Repeat 必须选择不剪掉 $x$。那么枚举 $\log$ 次前的 Repeat 操作的子集就行了，倒着做。可以用前缀和算出对于一只血量 $x$ 的猪，最后会剩几只。也可以暴力枚举一下子集。

但是第一个操作不一定是 Attack！那我们找到第一个 Attack 再做，前面的部分肯定是猪在不停克隆，只要乘上一个系数就行了。

时间复杂度是 $O((n+x)\log x)$。后来验题的时候大多数人写的是 $O((n+x)\log^2 x)$，用 map 或者线段树等维护猪的血量，这样不用倒过来做。原本时限是 1s，验题的时候 @[JohnVictor](https://www.luogu.com.cn/user/254752) 好像跑了 900ms+，我当时还在犹豫要不要卡掉 2log。后来有 F2 之后我就觉得肯定是不卡了，时限放了 2s。

~~有人说可持久化平衡树？我没仔细想~~。

------------

花絮（1）

出这个题是初三的校三模前一天（4.12）懒得复习语文数学了，于是开始画猪。画着画着想把猪给 attack 了，然后就有了这道题（大雾）。

当时晚自习的时候自己做这个题大概胡了 15min？后来想想感觉这题还可以，于是就交给了 @[1kri](https://www.luogu.com.cn/user/235926) 帮我看。我当时给难度是 E，然后 @[1kri](https://www.luogu.com.cn/user/235926) 改成了 E/F，再到 anton 手里就变成 F 了。