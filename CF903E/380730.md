这题一看到 $kn \le 5000$ 的条件，就知道肯定是一个 $O(kn^2)$ 的算法了。于是一些带 $\log$ 的，比如哈希，就用不了了。

于是考虑枚举第一个串交换哪两个下标。

考虑两个字符串（第一个字符串已交换过），能够达成的要求肯定是以下两个条件均满足：

- 两个字符串排序后是一样的。（即他们每个字母出现次数都一样）
- 两个字符串的相同位置不同字符的个数为 $2$ 或 $0$，其中后者还要求第二个字符串至少有一个字母出现次数超过一次。

第一个要求不用证明了吧……第二个要求，如果差 $2$，则交换那两个字符，根据第一个条件，现在差必须为 $0$。如果差 $0$，可以交换相同的两个字母。

于是对于每个串都这么操作，复杂度 $\Theta(kn^3)$。

但是我们可以不在到这个串时枚举这个串，而是在预处理时枚举，而因为交换的时候只涉及到两个下标，所以可以把复杂度降到 $\Theta(kn^2)$。

代码：[178678408](https://codeforces.com/contest/903/submission/178678408)

