~~/bx H6_6Q~~

### 题意

求有多少长度为 $a+b+c$ 的只包含 `A`、`B`、`C` 的字符串，满足：

- 恰好有 $a$ 个 `A`，$b$ 个 `B`，$c$ 个 `C`。
- 不包含形如 `ABC`、`BCA`、`CAB` 的子串。

### 分析

> 不包含是困难的，但是包含看上去就是容易的，所以考虑容斥。—— H6_6Q

发现这种连续字串是循环的，也就是说，它可以一直往下固定的延展。那么只需要知道起始字母、起点和长度就能确定这样一个不合法的子串，于是我们容斥起点。

设 $p$ 是一个非法子串的起点，$s$ 是这个字符串。那么我们容斥的子串显然要极大，所以会满足 $s_{p-1}\not =s_p$。且且长度大于等于 $3$，于是我们将 `ABC` 绑定，令长度等于 $3$，于是就不用关心它的后继。

若枚举当前有 $i$ 个起点，那么可以先将剩下的 $a+b+c-3i$ 个字符先排序，方案数 $\dbinom{a+b+c-3i}{a-i,b-i,c-i}$；接下来考虑将这 $i$ 个绑定的子串扔进去，因为前驱已经固定，所以 $s_p$ 显然有 $2$ 种取值（注意字符串开头有 $3$ 种，要分类讨论），方案数 $2^i$；容斥系数显然是 $(-1)^i$。

那就做完了！

### Code

提交记录：<https://atcoder.jp/contests/agc058/submissions/43331554>。