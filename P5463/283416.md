[题目传送门](https://www.luogu.com.cn/problem/P5463)

## 题目大意
- 给定一个长度为 $n$ 的序列，求所有区间逆序对数量的总和。
- $n\leq 10^6$


------------


直接暴力是 $O(n^4)$ 的，只能获得 $30$pts，于是我们考虑贡献法，考虑  $a_i,a_j(i<j,a_i>a_j)$ 这对逆序对对答案产生的贡献。

对于每个包含 $a_i$ 与 $a_j$ 的区间，这对逆序对都能带来 $1$ 的贡献，所以我们只需要求出有多少个区间包含 $a_i$ 与 $a_j$。
![](https://cdn.luogu.com.cn/upload/image_hosting/gzzkbhhd.png)
满足条件的区间的左端点可以取 $1\sim i$，共有 $i$ 种取值，右端点可以取 $j\sim n$，共有 $n-j+1$ 种取值，根据乘法原理可得，有 $i\times (n-j+1)$ 个包含 $a_i$ 与 $a_j$ 的区间。

枚举每对逆序对，将答案加上 $i\times (n-j+1)$，这种 $O( n^2 )$ 做法可以获得 $60$pts。

使用归并排序可以 $O( n \log n )$ 通过本题。此处我重点讲解树状数组的做法。

在讲解之前，我默认你们已经会使用树状数组通过 [P1428](https://www.luogu.com.cn/problem/P1428)  ~~（ 谁会用树状数组做红题呢~~

开一个值域的树状数组，从 $n\sim 1$ 遍历，每次将 $a_i$ 的位置加上 $n-i+1$，即 `add(a[i],n-i+1)`，并将答案加上 `i*query(a[i-1])`，因为是从后往前遍历，树状数组已经统计完 $i$ 以后的数，`query(a[i-1])` 即所有比 $a_i$ 小的数对应贡献的和，把和再乘 $i$，根据乘法分配律，即可得到结果是 $a_i$ 与后面的数构成逆序对的带来的总贡献， 把从 $1\sim n$ 的 $i$ 带来的贡献加起来，就是最终的答案。该方法的复杂度也是 $O( n \log n )$ 的，可以通过本题，且不用担心常数，因为本题时限为 $2$s。
## 注意事项
1. 本题 $n\leq 10^6$，但 $a_i\leq 10^9$，所以数据需要离散化，[P1908](https://www.luogu.com.cn/problem/P1908) 与 [P1774](https://www.luogu.com.cn/problem/P1774)  是练习离散化不错的题目，若你通过本题，同时您可以获得三倍经验。
2. 本题答案是 $n^4$ 数量级的，超过 `long long` 类型的范围，你可以开 `long long` 类型的树状数组，并用高精度加法累加答案，也可以开  `__int128`，使用快读与快写，~~用 Python~~ 。


------------


 代码就不展示了，若你熟练掌握提到的数据结构与算法，你一定能独自通过本题。