对另一篇题解做一些补充。想了想还是写了，虽然这对于除了我以外的选手可能是显然的。

另一篇题解不加证明地给出了 DP 的方程，但该 DP 的正确性实际上依赖于如下命题：定义一颗析合树是合法的，当且仅当该析合树的所有节点都满足除了第一个儿子可能不是叶子节点，其他儿子节点均为叶子。我们将满足该性质的节点称为合法节点。我们要证明的命题是，对于任意一颗不合法的析合树，都存在一颗合法的析合树使得它们的连续段数相同。

考虑每个节点对连续段数的贡献，另一题解中已经指出，这只与其儿子的数量有关。我们尝试对所有不合法的析合树建立其到与其连续段数相同的合法析合树的映射，也就是说，我们现在的目标是，通过若干次操作使得一颗不合法的析合树变为一颗合法的析合树，并且在此过程中保持每个节点的儿子数量不变。

这就很简单了。每次操作我们找到最深的不合法节点（其儿子中至少具有一个非叶节点），如果其第一个儿子是叶子，那么就将第一个儿子和之后的非叶节点及其子树交换。然后我们进行如下操作若干次直到该节点合法：选择除了第一个叶子以外的一个非叶节点及其子树，将该子树和第一个儿子中最左端的叶子节点交换位置。重复此操作直到整棵树合法即可。

操作的过程显然不会改变每个节点的儿子数量。至于为什么一定能够构造出这样的析合树，在另一题解中已经给出了方法，这里就不再赘述了。