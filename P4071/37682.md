[~~更好地阅读效果~~](https://www.cnblogs.com/CJYBlog/p/permutation.html)

### 由于Latex以及Markdown莫名出锅，请各位参考上面的cnBlog进行阅读。

[SDOI2016-排列计数](https://www.luogu.com.cn/problem/P4071)

发现很多题解都没有讲清楚这道题为什么要用逆元、递推公式怎么来的。 ~~我，风雨兼程三十载，只为写出一篇好题解。~~ 还是我来造福大家一下吧。

> ## 题目大意：

一个长度为 n 且 1~n 各出现一次的序列，希望在“序列中有且只有 m个数的值 等于 它的位置”条件下求出序列个数。答案对1000000007取模。

> ## 题目分析：

这道题也许是加强版的“装错了的信封”，在“装错了的信封”上搞搞比利就好。我们不妨设：
__值等于位置的数字__ 称 __稳定的__
__值不等于位置数字__ 称 __不稳定的__

稳定的数字由于要保证 值等于位置，故 __稳定的数字从序列左到右的值是递增的__

首先我们根据组合数的思想可以知道： 

__答案 = 稳定的挑选方法数 乘上 不稳定的挑选方法数__ 。

所以现在我们的目的改成了求出 __稳定的挑选方法数__ 和 __不稳定的挑选方法数__ 。

> ### 稳定的挑选方法数：

我们已经知道了 __稳定的数字从序列左到右的值是递增的__，那么我们只需要模拟是哪几个数是稳定的即可。

不难想到，数量其实就是 __在 $n$ 个数中 挑选 $m$ 个数的方案数__ 。

这不就是组合数里面的 $C_n^m$ 吗？有 $C_n^m$ = $\frac{n!}{m!(n-m)!}$

搞定

> ### 不稳定挑选方法数（错排）：

我们假设已经知道了哪 $m$ 个数是稳定的，那么我们可以在数组中暂时只看不稳定的数。

也就是 __错排__

我们令数组 $F_x$ 为 __有 $x$ 个数字，每个数字均为不稳定的方法数__。

由于这些数是不稳定的，那么就没有值的大小递增关系，所以我们对于每一个 $F_x$ ，都要进行分类讨论。

$$假设一个数字 k ,并令 n 位于第 k 位
\begin{cases}
当 k 位于第n位& \text{此时的错排数为 $F_{n-2}$（因 k 的位置已知，即求余的 n-2 个数的错排数）}\\
当 k 不位于第n位& \text{此时的错排数为 $F_{n-1}$}
\end{cases}$$

于是对于每个 $F_i$ ，有 $F_i$ = $(i - 1)\times(F_{x-1} + F_{x-2})$

#### 所以最终答案为：($C_n^m \times$$F_{n-m}$)%MOD

> ## 具体操作思路：
我们先要初始化，对于 $C_x^y$ 要初始化阶乘，对于 $F_i$ 要递推。

然后对于每一组数据，套 ($C_n^m \times$$F_{n-m}$)%MOD 即可。

> __但是（还没完）：__

由题意得，最终方案数可能很大（所以才要取模），我们在进行 答案累乘时，($C_n^m \times$$F_{n-m}$)%MOD 可能会爆精度，我们于是要用到：

__逆元（inv）__

> 何为逆元（ $inv$ ）？

比如当有 $(a \div b) \% MOD$ 时，防止 $b$ 过大而爆精度，将 $a \div b$ 转化为某种简单的乘法。

若 $c$ 为 $b$ 的逆元，则有 $(b \times c) \equiv 1 (mod 模数)$

那么 $(a \div b) \% MOD$ = $(a \div b) \times 1 \% MOD$ = $(a \div b) \times b \times c \% MOD$ = $(a \times c) \% MOD$

即 （一个数 除以 另一个数）%模数 = （一个数 乘上 另一个数的逆元）%模数

> ### 如何将逆元应用到该题中

我们初始化逆元数组 $inv$ ， $inv$ 为 阶乘的逆元

那对于固定的值于模数，那个值的逆元怎么求呢？

~~请你参考费马小定理~~

直接给出答案：对于 $a \% 1000000007$ 的逆元，为 $a^{1000000007-2}$

__搞个快速幂就好了__

## 代码请在[这里](https://www.cnblogs.com/CJYBlog/p/permutation.html)进行查看