代码和和动态规划的式子想必大家都已经很清楚了，但是为什么是 $O(n^2)$ 呢？

求证： $O(\sum\limits_{i=1}^n \sum\limits_{j\in son(i)} siz(j)\times (1+\sum\limits_{k\in visited\_son(i)} siz(k)))=O(n^2)$。

考虑一个这样的事实，对于 $i$ 从左到右扫描儿子 $j$，但是已经遍历过的儿子不会再对当前 $i$ 的答案造成贡献。

考虑 $siz(used)\times siz(j)$ 的时间复杂度意义，可以说是对于 $j$ 子树之中的每个节点，枚举其左边遍历过的儿子并且贡献答案。

而这个 DP 顺序使得左边遍历过的儿子不会重复遍历，所以对于每个节点，其左边已经遍历过的所有节点个数不会超过 $O(n)$ 级别，所以时间复杂度就是 $O(n^2)$ 级别的。