- 惭愧，惭愧。

**[题意](https://www.luogu.com.cn/problem/AT2070)**
- 有三堆牌，先取第一堆堆顶的牌，接下来牌上写几就抽第几堆堆顶。
- 问牌堆 $1$ 先被抽空的方案数。

**分析**
- 考虑什么样的操作序列可以导致 $1$ 被率先抽空，这个操作序列必须满足：有 $n_1$ 个 $1$，结尾是 $1$，$2$ 的个数不超过 $n_2$，$3$ 的个数不超过 $n_3$。
- 每个操作序列可能对应多个排堆，具体地，一个长度为 $n$ 的操作序列对应 $3^{n_1+n_2+n_3-n}$ 个牌堆。
- 现在我们的任务变成了考虑计算对于每个 $n$，长度为 $n$ 的合法操作序列个数，不论如何，我们都有简单的 $O(n^2)$ 做法是显然的，[代码](https://www.luogu.com.cn/paste/ngvcrxeg)。
- 我们考虑把问题具体化，我们需要求解（由于结尾是 $1$，所以数目要减一）：
$$f(n)=\sum_{i=0}^{n_2}[n_1+i+n_3\ge n]\frac{(n-1)!}{(n_1-1)!i!(n-n_1-i)!}$$
- ~~我们发现这可以表示成卷积的形式，所以直接 MTT~~，别想了作者不会多项式，你发现：
$$f(n)=C(n-1,n_1-1)\sum_{i=\max(n-n_1-n_3,0)}^{n_2}C(n-n_1,i)$$
- 设：
$$g(n,m)=\sum_{i=0}^mC(n,i)$$
- 由于 $C(n,m)=C(n-1,m)+C(n-1,m-1)$，裂项可得：
$$g(n,m)=\sum_{i=0}^mC(n,i)=\sum_{i=0}^{m-1}C(n-1,i)+\sum_{i=0}^{m}C(n-1,i)=2\sum_{i=0}^{m-1}C(n-1,i)+C(n-1,m)$$
$$g(n,m)=2g(n-1,m-1)+C(n-1,m)$$
- 同理：
$$g(n,m)=2g(n-1,m)-C(n-1,m)$$
- 利用这两个简单的递推关系，我们最终可以线性求解 $f(n)$ 的所有取值。
- 对于一类较为复杂的计数问题，也许可以尝试这种思路：即找到一类映射，它比较好计数，对于每个特定的映射对应的组合对象，也比较好计数，如此就有可能对复杂的问题化繁为简，[代码](https://www.luogu.com.cn/paste/8wpf05sw)。