$Update$ $at$ $8.19:$ 更改时间复杂度分析，更改 code。
# 背景

暑假训练刚回到家，热度未退，并且想刷个橙 100A。

# 思路

看了一眼标签，是数论，因为暑假训练学了挺多数论，所以开始找规律。

在这个过程中，我发现，**错位会成多个环**。

以样例来分析：

| 排序位 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 |
| :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: |
| 数值 | 8 | 23 | 4 | 16 | 77 | -5 | 53 | 100 |

排序后：

| 原排序位 | 6 | 3 | 1 | 4 | 2 | 7 | 5 | 8 |
| :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: |
| 数值 | -5 | 4 | 8 | 16 | 23 | 53 | 77 | 100 |

而如果对这个表格进行扫描，**下一个状态转移至该位的原排列位**，就会发现以原排列位成环：

环 1：6 7 5 2 3 1

环 2：4

环 3：8

为什么会形成多个环？

举个简单的例子：2 1

这是一个最简单的环（这里不把一个数看成环），这两个数构成了整个数列。

而一个数列中**每个数都会有自己的原位，抽象为递归**，即每个数都在找原位，当错位的数被找原位的数指示了，他要开始找自己的位置，然后重复，直到最后一个数发现了自己的位置已经空了出来，结束递归。

以上面的简单例子来说，就是 2 去找原位，发现 1 占着原位，赶走 1，1 要去找原位，发现自己的位置已经被 2 空了出来，停止递归。

所以，我使用了并查集合并环内的所有元素，每个环的操作次数为环内元素数减一。

只用把每个元素扫描一遍，时间复杂度 $O(n\alpha(n))$。

### tip

原来的 code 是借用了 bool 数组辅助判断是否已扫描，后来蒟蒻的作者认为这样可以写 bfs 达到最优复杂度 $O(n)$，为了保证并查集写法的独立性，运用了其他写法代替掉了 bool 数组记录。

### code
```cpp
#include<iostream>
#include<cstdio>
#include<queue>
#include<algorithm>
using namespace std;
int n,f[100003],si[100003],ans;
struct point
{
	int id,num;
}pt[100003];
bool cmp(point a,point b)
{
	return a.num<b.num;
}
int Find(int x)
{
	if (f[x]==x) return x;
	return f[x]=Find(f[x]);
}
void Union(int u,int c)
{
	u=Find(u),c=Find(c);
	if (si[u]<si[c]) swap(u,c);
	si[u]+=si[c];
	f[c]=u;
}
int main()
{
	scanf("%d",&n);
	for (register int i=1;i<=n;++i){
		scanf("%d",&pt[i].num);
		pt[i].id=i;
		si[i]=1,f[i]=i;
	}
	sort(pt+1,pt+1+n,cmp);
	for (register int i=1;i<=n;++i)
	{
		if (f[i]==i)//tip中修改点
		{
			queue<int>w;
			w.push(i);
			while (!w.empty())
			{
				int wd=w.front();
				w.pop();
				if (Find(wd)!=Find(pt[wd].id))
				{
					Union(wd,pt[wd].id);
					w.push(pt[wd].id);
				}
				else
				{
					ans+=si[pt[wd].id]-1;
					break;
				}
			}
		}
	}
	printf("%d",ans);
	return 0;
}
```

# 小结

一个优秀的解法并不在于他的 code 量是否小，而在于他是否思路清晰，便于理解并码出，这在考场上十分重要。