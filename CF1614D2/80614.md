~~一道有趣的卡常题（bushi~~

首先我们来考虑 D1 做法：

其实就是个 dp，如果我们倒序填整个序列，那么设 $f_i$ 为当前 $\gcd$ 为 $i$ 时的最大值，$num_i$ 为 $a$ 序列中 $i$ 的倍数的个数。

那么很显然有转移方程：

$$f_{ij}=\max\{f_{ij},f_i+num_{ij}(ij-i)\}$$

求 $num$ 数组和 $f$ 数组都需要 $1\log$ 的时间，所以可以通过 D1。

其实 D2 的思路跟 D1 一样，只不过我们需要优化。

先考虑关于 $f$ 的转移方程，这个很显然可以只枚举 $j$ 是质数的情况，因为如果 $j$ 是合数（先假设 $j$ 能分解成两个质因子 $p_1,p_2$，其余同理），那么 $num_{ij}$ 的系数之和就是 $ip_1-i+ip_1p_2-ip_1=ij-i$。

这样求 $f$ 数组就可以在 $\log\log$ 的时间内求出。

但 $num$ 数组有些特殊，因为它没有 $f$ 数组这么好的性质。

先来介绍几种能过的非正解方法：

$1$、直接交。

因为 $f$ 已经优化到 $\log\log$ 了，其实相当于减小了一半常数，况且 $5\times 10^6$ 和 $2\times 10^7$ 之间只是 $4$ 倍关系，运气好的话应该能过（但其实能过主要是因为这次重测了 D2，因为在 system test 时由于评测机波动导致很多人挂了 pretest 的点（其实理论上来讲是不应该重测的）。

$2$、使用莫比乌斯函数优化。

我们容易发现 $num_i=cnt_i-\sum\limits_{j=2}^{\left\lfloor\frac{2\times 10^7}{i}\right\rfloor}\mu(j)num_{ij}$（其中 $cnt_i$ 为 $a$ 序列中 $i$ 的个数）。

跳过 $\mu_i=0$ 的，虽然复杂度还是 $1\log$，但可以优化 $\dfrac{3}{8}$ 的常数。

我考场上就写的这个 pretest $3.8\text s-$，即使是评测机地震的 system test 也只需要 $3.95\text s-$。

$3$、只考虑 $a$ 序列中的所有因子。

同省神仙写了这个做法，虽然 FST 了，但重测过了。

发现 $2\times 10^7$ 肯定有很多无用之数，不妨只枚举有用的数然后转移即可。

~~虽然说预处理这些因子还得需要 $a_i\log a_i$ 的时间。~~

同校学长说 $n\text d(2\times10^7)$ 差不多是 $2.7\times 10^7$，但实际上远达不到这个数。

现在来讲正解：

通过第 $2$ 种方法得知，我们无法将其优化到 $\log\log$ 的原因是会算重。

我们其实只需要改变一下 $num$ 数组的统计方式即可。

首先每次枚举一个质数 $j$，然后倒序枚举 $i$ 即可。

这样就能保证每次给 $num_i$ 统计的都是 $i$ 乘上一个新的质因子的倍数，且之前没有统计过。

时间复杂度：$O(n+a_i\log\log a_i)$