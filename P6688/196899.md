只讲思路。代码我还没卡完常。不过这个思路正确性复杂度都是对的。

这个东西很复杂，直接维护是肯定不行的。[大母神这题](https://www.luogu.com.cn/problem/P3792)和这个差不多，那题用的哈希，所以可以考虑哈希判断。

常见的方法是维护区间最大最小，区间和区间平方和。但是这种方法被出题人卡死了。

我们可以维护 $sin$ 和 $cos$。这个东西很难卡。当答案为`YES`时，$k$ 都一样，那么随便维护一个最大值的差就是 $k$.再维护一个 $sin$ 一个 $cos$ 就行了，单点修改不需要考虑懒标记。

那么怎么算出来加 $k$ 后的 $sin$ 和 $cos$ 值呢，这个可以用和差角公式

$$\sin(x+y)=\sin(x)\cos(y)+\cos(x)\sin(y)$$

$$\cos(x+y)=\cos(x)\cos(y)-\sin(x)\sin(y)$$

直接算一下再判相等就可以了。

这题好像线段树会被卡常，需要重口味线段树。