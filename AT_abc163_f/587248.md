很像 CF1681F。我们考虑对于一个颜色 $k$ 怎么计算答案，我们把带有 $k$ 的边全部断掉，然后剩下每个连通块的点数为 $sz_i$，我们用容斥就可以得到最终的答案为 $\frac{n(n - 1)}{2} - \sum\frac{sz_i(sz_i - 1)}{2}$，再算上形如 $(u, u)$ 的路径条数即可，对于这种断边的问题，我们可以用线段树分治解决。时间复杂度 $O(n\log^2n)$。[Code](https://atcoder.jp/contests/abc163/submissions/42791125)