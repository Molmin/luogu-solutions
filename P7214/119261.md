有删减，原文见[**我的博客**](https://www.cnblogs.com/SharpnessV/p/14882600.html)。

最关键的一步，转化为最短路。

对于每个方案我们看成一个点，对于两个方案 $i,j$ ，当且仅当 $R_i-L_j+1\ge|T_i-T_j|$ 时，从点 $i$ 向点 $j$ 连边。

形象化的，我们将时间作为纵轴，房屋作为横轴，发现一次治疗就是一条平行于横轴的路径，而两次治疗之间的衔接恰好是一条斜率为 $1$ 或 $-1$ 的直线。所以最短路就是答案。

直接建图跑最短路是 $\mathcal{O}(N^2)$ 的，考虑优化建图。

我们对所有点按 $T_i$ 排序，那么当 $T_i\ge T_j$ 时，有 $R_i-T_i+1\ge L_j-T_j$ ，否则是 $R_i+T_i+1\ge L_j+T_j$ 。

式子一边只与 $i,j$ 中的一个有关，可以看作点的属性，那么我们只需要再满足 $T_i$ 和 $T_j$ 的大小关系。

直接线段树优化建图。线段树优化的最短路有一个优美的性质就是线段树上的边只会转移一次，所以时间复杂度是 $\mathcal{O}(N\log N)$ 。

关于这个性质可以参考这道[**经典题**](https://www.luogu.com.cn/problem/P5471)，也是线段树优化最短路。