现有的那篇题解看起来有点费劲，这里给出一个更直接的做法。

如果不需要没有洞，那我们从小到大加点并用并查集维护连通块大小即可。因此，只需要考虑如何判断洞是否存在。

我们注意到洞的判定是八连通的。考虑以每个格子为点，连边，变成平面图。则洞就是一个在图形内部的区域。  
那么我们根据欧拉公式 $V-E+F=2$，可得 $F = E - V + 2$。而这样得到的 $F$ 实际上包括外围的一个区域和所有四个已访问点构成的正方形。额外维护之即可。

时间复杂度 $O(N^2 \alpha(N^2))$。