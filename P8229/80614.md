首先我们设 $f_i$ 为抛了 $i$ 次硬币期望吃到多少颗草莓，则显然有转移方程式：

$$f_i=\sum_{j=0}^{i-1}\left(f_j+(1-p)\times p^{i-j-1}\times k^{i-j-1}\right)$$

化简得：

$$f_i=(1-p)\times \left(\sum_{j=0}^{i-1} f_jp^{i-j-1}+\sum_{j=0}^{i-1}(kp)^j\right)$$

这个式子还是不好看出规律，且暴力算复杂度是 $O(n^2)$ 级别的。

难道真的就束手无策了吗？

不是的，我们发现对答案产生贡献的是右边的式子，如果我们能知道每个右式的贡献系数，再找出规律来，那这道题就做完了。

设 $w_i=\sum\limits_{j=0}^{i-1}(kp)^j$。

那么 $f_i$ 的转移系数就是 $1-p$，$f_{i+1}$ 是 $(1-p)(1-p)=(1-p)^2$，$f_{i+2}=(1-p)((1-p)^2+(1-p)p)=(1-p)^2$……

以此类推，我们可以得到除 $f_{i}$ 的转移系数是 $1-p$ 之外，其余的转移系数都是 $(1-p)^2$，证明也很好证。

那么我们就可以得出 $f_n$ 的通项公式了：

$$f_n=(1-p)^2\sum_{j=1}^{i-1}\sum_{l=0}^{j-1}(kp)^l+(1-p)\sum_{j=0}^{i-1}(kp)^j$$

在小学奥数里，我们有这样一个公式：

$$\sum_{i=0}^nx^i=\dfrac{x^{n+1}-1}{x-1}\quad(x\ne1)$$

对于 $kp=1$ 的情况，可以直接算。

而对于 $kp\ne 1$ 的情况，直接套用这个公式只能解决右式，对于左式，我们稍微变一下形就可以得到另一个类型的式子：

$$\sum_{i=0}^n x^i(n-i)$$

这个也可以通过小学奥数的方法解决。

设 $ans=\sum\limits_{i=0}^nx^i(n-i),x\times ans=\sum\limits_{i=1}^{n+1}x^i(n-i+1)$。

两式相减，可得：

$$(x-1)ans=\sum_{i=1}^{n+1}x^i-n+1=\sum_{i=0}^{n+1}x^i-n$$

$$ans=\dfrac{\sum\limits_{i=0}^{n+1}x^i-n}{x-1}$$

照葫芦画瓢，我们可得全新的 $f_n$ 的通项公式：

$$f_n=(1-p)^2\dfrac{\sum\limits_{i=0}^{n-1}(kp)^i-n}{kp-1}+(1-p)\sum_{i=0}^{n-1}(kp)^i$$

然后这道题就做完了。

时间复杂度：$O(T(\log n+\log\bmod))$