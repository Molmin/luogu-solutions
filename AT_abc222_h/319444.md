考虑每个 $a_i=1$ 的位置，都要进行一次 $v=i$ 的操作。所以根节点一定为 $1$ ，且 $n-1$ 次操作只会在初始 $a_i=1$ 的点进行。

如果存在两个相邻的点都是 $0$ ，显然就得多跳一次，不合法了。所以题目条件等同于：二叉树，根节点为 $1$ ，一共 $n$ 个 $1$ ，叶子都是 $1$ ，不存在相邻的 $0$ ，求方案数。

考虑 $f_{i,0/1}$ ，分别表示根为 $0/1$ 的答案。把它写成生成函数的形式:$F_0,F_1$ ，则有 $F_0=(F_1+1)^2-1$ (-1是因为叶子节点必须是 $1$)，$F_1=x(F_0+F_1+1)^2$ 。

则 $x=\frac{F_1(x)}{(1+3F_1(x)+F_1(x)^2)^2}$ 。令 $G(x)=\frac{x}{x^2+3x+1}$ ，题目等同于求满足 $G(F(x))=x$ 的 $F$ 。

根据拉格朗日反演，有 $n[x^n]F(x)=[x^{-1}]G(x)^{-n}$ 。代入得 $n[x^n]F(x)=[x^{n-1}](x^2+3x+1)^{2n}$ 。

接下来有两种求法：第一种是，考虑转化成 $\sum \tbinom{2n}{i}[x^{n-1-2i}](3x+1)^{2n-i}=\sum \tbinom{2n}{i}3^{n-1-2i}\tbinom{2n-i}{n-1-2i}$ ,$O(n)$ 计算。

第二种是，考虑对 $F(x)=(x^2+3x+1)^{2n}$ 求导得到 $F'(x)=2n(x^2+3x+1)^{2n-1}(2x+3)=2n(2x+3)\frac{F(x)}{x^2+3x+1}$

即 $(x^2+3x+1)F'(x)=2n(2x+3)F(x)$ 。提取两边的 $x^k$ 项系数，得到

$(k+1)f_{k+1}+3kf_{k}+(k-1)f_{k-1}=6nf_k+4nf_{k-1}$ 。

即 $kf_k=(6n-3k+3)f_{k-1}+(4n-k+2)f_{k-2}$ ，递推即可，复杂度 $O(n)$ 。
