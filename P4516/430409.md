[更好的阅读体验](https://www.cnblogs.com/Coros-Trusds/p/16138220.html)

毒瘤树形 $dp$ 啊。。

# 题目大意

给定一棵树，如果在一个节点 $u$ 放一个监听设备，那么与 $u$ 相邻的节点 $v$ 都能被监听，但是 $u$ 不会被监听。现在有 $m$ 个监听设备，问能够监听整棵树且恰好使用了 $m$ 个监听设备的方案数。

一个节点至多放一个监听设备。

# 题目分析

借用大佬 @GKxx 的图：

![](https://cdn.luogu.com.cn/upload/pic/41854.png)

$$\tiny{\texttt{图 1,上图 x 即 i}}$$

令 $dp[i,j,0/1,0/1]$ 表示以 $i$ 为根的子树中一共放了 $j$ 装置，$i$ 点是否放了装置，$i$ 点有没有被覆盖到的方案数。

来推一推状态转移方程：

+ 当 $i$ 没被监听且没放监听装置时，$v(v\in son\{i\})$ 一定没有装监听设备，有 $dp[i,j+k,0,0]=\sum (dp[i,j,0,0]\times dp[v,k,0,1])$。

+ 当 $i$ 没被监听但放了监听装置时，$v$（$v$ 的定义如上）是否被监听不重要但是一定没有放装置，否则这里就可以被监听了，有 $dp[i,j+k,1,0]=\sum(dp[i,j,1,0]\times(dp[v,k,0,0]+dp[v,k,0,1]))$。

+ 当 $i$ 没放装置但被监听了时，分两种情况：

$i$ 侧的状态为 $dp[i,j,0,1]$：$dp[i,j+k,0,1]=\sum(dp[i,j,0,1]\times(dp[v,k,0,1]+dp[v,k,1,1]))$。

$i$ 侧的状态为 $dp[i,j,0,0]$：$dp[i,j+k,0,1]=\sum(dp[i,j,0,0]\times dp[v,k,1,1])$。注意这里没有 $dp[v,k,1,0]$，因为一定要让 $v$ 被覆盖，但是 $i$ 没放装置。

+ 当 $i$ 没放放了装置也被窃听了时：

$i$ 侧是状态 $dp[i,j,1,0]$：$dp[i,j+k,1,1]=\sum(dp[i,j,1,0]\times(dp[v,k,1,0]+dp[v,k,1,1]))$。

$i$ 侧是状态 $dp[i,j,1,1]$：$dp[i,j+k,1,1]=\sum(dp[i,j,1,1]\times(dp[v,k,0,0]+dp[v,k,0,1]+dp[v,k,1,0]+dp[v,k,1,1]))$。

# 代码

代码太难调了，调代码时间比思考时间还长。。

来张图了解下：

![屏幕截图 2022-04-12 231645.png](https://s2.loli.net/2022/04/12/sZyDM9kmXc3eHF2.png)

**上面这张图的写法太难调了，所以换了一种写法过了。**

注意全开 `long long` 会 $\verb!MLE!$，只能在过程中用 `long long`。

洛谷的蠢关键字制度使得代码传不上来，请到顶上链接内查看~