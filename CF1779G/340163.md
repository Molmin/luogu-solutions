显然有一个结论是如果外层所有点总是可以走入和走出，内层边其实怎么样不重要！也就是说，如果外层边不存在一个点出度或入度为 $0$ 就是合法的。

于是猜测只需要改最外边的一层边。如果最外一层边构成环答案是 $0$，不然是类似于三元有向环其中一条边被翻转，仅需处理这种情况。

首先答案有上界 $n$，暴力翻转不正确的那一整条边。注意到在原始的情况中没有出度或者入度的点只有三角形的两个端点，考虑在这上面做文章。

然后放一张图就了然了。分讨取最小值。

![](https://cdn.luogu.com.cn/upload/image_hosting/wv60ba5x.png)

证明很简单，翻转一条边会使之前没有出度/入度的点变得有出度/入度，但是另一个点的出度/入度相应减 $1$，如果没有里面的边就不合法了。可以人脑搜索只有这四种本质不同的情况。同时可以发现我们只标注第一条和外层边方向不一样的边的理由，如果翻转到第二条方向不同的边显然不优。

[评测记录](https://codeforces.com/contest/1779/submission/189157159)。