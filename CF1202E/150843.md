首先记 $f_i$ 为以 $i$ 开头的字符串个数，$g_i$ 为以 $i$ 结尾的字符串个数，那么答案为 $\sum_{i=1}^{|t|}g_if_{i+1}$。，考虑如何计算 $f_i$ 和 $g_i$。

根号分治。记一个阈值 $B$，长度大于 $B$ 的串不超过 $\dfrac{\sum|s|}{B}$ 个，直接暴力跑匹配，将匹配上的字符串开头的 $f_i$ 和结尾的 $g_i$ 加一。

然后枚举 $t$ 中长度为 $1\sim B$ 的子串，对每个子串统计出所有长度不大于 $B$ 的串中与其相同的个数，将该子串开头的 $f_i$ 和结尾的 $g_i$ 加上个数。

可以用一些字符串算法优化匹配和找相同字符串的过程，复杂度为 $O(\dfrac{\sum|s|}{B}|t|+B|t|)$，当 $B=\sqrt{\sum|s|}$ 时最优。

这里用的是哈希。不过这题把单哈希几个常见的模数卡掉了，所以用了双哈希。

[Code](https://www.luogu.com.cn/paste/7mn3mza5)