正解前面都说过了.这里**给出一个正确性的证明**


首先我们注意到这里路径是**有向**的,即正向反向走不一定同时合法,如果合法,两种方式得到的权值相等.  

$$w_1=1,w_2=11,e(1,2)=10$$

这样就出现了.然后我们注意到这个性质**如果在某处出现了正向反向不同时合法,必定在这里断开为两部分,取原路径的一部分更优秀**.

考虑枚举路径LCA为x,是不是能存在一个子树中的点$v_0$直接从$v_0$的最长链无法走到根而从其他子树中的点$v_x$走到$x$后再进入$v_0$是合法的.但是考虑一下这里的贡献.

我们沿用上一个题解的符号.$dp_v$为$v$结束的子树内最长链.

$w_v$表示$v->x$的边权.

$$dp_{(v_0)}\lt w_{v_0}$$

$$dp_{(v_x)}\geq w_{(v_x)}\quad dp_{(v_x)}-w_{(v_x)}\geq w_{v_0}$$

走到根停止与走到$v_0$中与最长链拼接的答案是

$$dp_{(v_x)}-w_{(v_x)}+c_x$$
$$dp_{(v_x)}-w_{(v_x)}+c_x-w_{v_0}+dp_{(v_0)}$$

显然前者更优秀...不然$v_0$就能走到根了.



---


跨过$x$的路径必然是两端都可以走上$x$的,这个我们选取最长次长最优秀.一条不"分叉"的链我们用$dp_x$,所以这种方法考虑了所有合法且可能是最优解的路径.故是正确的.

