CF1545D AquaMoon and Wrong Coordinate *3000

这题他妈的就不是人能想出来的。

注意以下题解默认初始位置是 $1$ 时刻。

首先我们确定哪一行出了问题是平凡的。


在 $t$ 时刻时，这些点的坐标和应该是 $\sum_{i=1}^n x_i+t\times v_i$。

在 $t+1$ 时刻时，这些点的坐标和应该是 $\sum_{i=1}^n x_i+(t+1)\times v_i$。

然后把这两个式子相减发现是 $\sum{i=1}^n v_i$，至于这个 $v_i$ 是多少并不重要，因为 $v_i$ 不会变，所以我们把每个时刻的坐标和相减，我们找到 **第一个** $x$ 使得第 $x$ 行减去第 $x-1$ 行的值与其他的值不同，那么问题出在第 $x$ 行上。

确定哪一行，如何确定具体该改多少呢。这里就要用到人类智慧了。

我们考虑记函数 $f(t)=\sum_{i=1}^m(x_i+t\times v_i)^2$ 即每一行位移的平方和。

我们展开一下 $f(t+1)$ 与 $f(t-1)$，发现一个式子。

$f(t+1)+f(t-1)-2*f(t)=\sum_{i=1}^m 2v_i$。

所以可以得到，任意连续三个时刻的坐标的平方和同样是固定的。

而我们又知道哪一时刻出了问题，所以我们枚举这一时刻的每一个坐标把他改成 $k$ ，如果哪一次改了之后上式的值与正常的值相等，那么这个位置就要改成 $k$ ，这题就做完了。

还有几个细节，第一个是应该改成什么。

我们假设两个时刻时间应该差 $x$ 但实际上差了 $y$，那么因为我们假设了其他位置没错，所以一定是这个位置的问题，所以说当前坐标应该 $-y+x$ 。

然后还有因为我们连续最后一步要连续取三个时刻当作标准值，所以如果问题出在前三个，那么标准值就取 $t=5,6,7$ 时刻的 $f(t)$，否则就取前三个。

具体看代码。

```cpp
	for(int i=2;i<=k;i++){
		if(mp[s[i]-s[i-1]]==1){
			flag=i;
			if(i<=3) flag2=5;
			else flag2=2;
			break;
		}
	}
	cout<<flag-1<<" ";//这里要减一是因为题目默认初始时刻是0，而我是按照1处理的
	int tmp=s[flag2+1]-s[flag2];int tmp2=v[flag2+1]+v[flag2-1]-2*v[flag2];
	for(int i=1;i<=n;i++){
		int ans=pos[flag][i]-(s[flag]-s[flag-1])+tmp;
		// cout<<ans<<" "<<tmp<<" "<<" "<<s[flag]-s[flag-1]<<endl;
		if(v[flag+1]+v[flag-1]-2*(v[flag]+ans*ans-pos[flag][i]*pos[flag][i])==tmp2){
			cout<<ans<<"\n";
			cout.flush();
			return 0;
		}	
	}
```