## 闲话

我真的服了，第一篇题解 $O(qn\log n)$ 过了，我一个跑不满的 $O(n)$ 被卡了/dk

大常数选手的悲哀。

## 思路

$q \leq 50,n \leq 10^6$，应该是考虑 $O(qn)$ 做法了。

显然考虑断环为链，然后预处理每个点 $i$ 向后最远走的距离 $d_i$。由 $a_i>0$ 得 $d_{i-1}<d_i$，所以直接记录前缀和以及一个右端点的 $r$ 指针扫一遍就行了。

然后考虑怎么统计答案。

最暴力的想法是枚举 $1 \leq i \leq n$，对每个 $i$ 假设它是起点，暴力做一下统计答案。复杂度是 $O(n^2)$ 不能接受。考虑进行优化。

不妨令对于每个 $i$，它的块是 $[i,d_i]$。我们发现，每次变更起点，只对包含这个起点的那些块内有影响。那么我们可以选长度最小的那个块进行枚举，复杂度就是 $O(n)$ 的了。

证明：

假设最后我们从起点 $i$ 跳 $k$ 次就能跳到终点。显然我们可以分成 $k$ 段。而由抽屉原理可得，长度为 $n$ 的线段分成 $k$ 段，最小值最大为 $\left\lfloor\dfrac{n}{k}\right\rfloor$。所以我们每次枚举复杂度是 $O\left(\left\lfloor\dfrac{n}{k}\right\rfloor\right)$，暴力统计是 $O(k)$，总复杂度就是 $O(n)$。

有 $q$ 次询问，每次我们都这样处理，总复杂度为 $O(qn)$。

## 代码

由于我卡常之后的代码太丑了，就不放出来了。

需要的可以来这里：[Link](https://www.luogu.com.cn/paste/sa8ndv4c)

卡完之后跑的还是挺快的qwq