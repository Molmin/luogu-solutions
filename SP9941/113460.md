## 【题解】GREWords(AC自动机)

[SP9941 GRE - GRE Words](https://www.luogu.org/problem/SP9941)

> 题目大意：
>
> 给定一个由字符串构成的序列，不同位置的字符串有自己权值。现在让你选出一个子序列，使得在这个子序列中，前面的串是后面的串的子串。请你求满足条件的子序列的权值的最大值。一个子序列权值是所有元素权值的和。

考虑一个朴素的DP做法，设$dp(i)$表示选择了字符串$i$的最大权值子序列，转移直接枚举前面的字符串，通过$kmp$判断是否为子串，然后转移，复杂度$O(n^3)$

考虑优化一下上面的做法，众所周知，ac自动机$fail$树上任意节点到根一条链是一段后缀。那么，一个字符串的所有子串就是它在ac自动机上的**所有节点**的所有到根链。(子串=自己某段前缀的后缀)

要优化上面那个$dp$，就是要求我们维护一个数据结构，使得可以根据一个字符串快速查询已有的他所有的子串的权值的最大值。考虑这样一种做法，把$fail$树单独拿出来，现在假设我有个$dp$值更新就只会对他的子树有影响，考虑到子树的一段连续的$dfs$序列，所以直接线段树维护一个区间取$max$单点求$max$即可。

可以直接先把fail建出来再依次更新$dp$，使得fail树的形态确定。

总复杂度$O(n\log n)$

[代码](https://www.cnblogs.com/winlere/p/11512810.html)