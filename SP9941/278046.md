$s_i$ 是 $s_j$ 的子串，那么存在一个 $s_j$ 的前缀 $p_j$ 使得 $s_i$ 是 $p_j$ 的后缀。

后缀的话可以想到 AC 自动机的 Fail Tree，于是 $s_i$ 的所有子串就是 $s_i$ 在 AC 自动机上的所有节点在 Fail Tree 上到根路径上所有点对应的字符串。

记 $f_i$ 表示前 $i$ 个字符串且 $i$ 必选的最大价值和。

$$f_i = \max f_j + v_i$$

我们每求出一个 $f_i$，就用它对 $s_i$ 在 AC 自动机对应节点在 Fail Tree 子树内的所有节点取 $\max$，这个可以 DFS 序 + 线段树实现。

求 $f_i$ 时，将 $s_i$ 所有节点的权值取个 $\max$。

这样子树修改单点查询是能过的，但是单点修改路径查询就不一定了？