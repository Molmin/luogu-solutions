**AGC013D sol**

读完题，发现过程中球的数量守恒为 $n$，不妨设白球数量为 $a$，则黑球数量为 $n - a$。

记白黑为一次操作先拿出来白球加入黑白球一对后再拿出来一个黑球。白白，黑白，黑黑同理。

发现对于 $a \geq 1$ 时，我们可以进行白白，白黑操作；对于 $a < n$ 时可以进行黑白，黑黑两种操作。

那么如果知道初始的黑球和白球数量就好做了！设 $dp_{i,j}$ 表示进行完了前 $i$ 次操作并且当前剩余 $j$ 个白球的颜色序列种数，每次用上述条件判断转移显然是不会算重的，因为你的枚举了每步操作，每步操作是**确定的**。时间复杂度 $O(n ^ 2)$。

然后你发现直接改改初始化来写这道题就连样例都过不了。

不难发现如果不确定最开始的黑白球数量，那么完全有可能有多种初始情况转移了同一种颜色序列，而按照题意我们只应统计一次。

考虑如果初始的黑白球数量不一样，那么同一颜色序列操作后最后的黑白球数量肯定不一样，但我们发现把这个维度加入考虑也很难去重。

我们考虑形象化这个过程，发现就是许多个全等的折线段，但只会有一条折现段**在这个过程中会造成 $a = 0$ 的局面**，所以一个想法是统计这类颜色段即可。

设 $dp_{i,j,0/1}$ 表示前 $i$ 种操作后剩余 $j$ 个白球，且没接触过/接触过 $a = 0$ 局面的颜色序列数。

转移的还是讨论 $a \geq 1,a<n$，需注意的是在 $a \geq 1$ 时如果 $a = 1$ 那么当前的 $dp_{i,j,0}$ 状态就要通过白白，白黑操作向第三维为 $1$ 的状态转移。

还是抄一下状态转移：

$\begin{cases}dp_{i + 1,j-1,[j == 1]} \leftarrow dp_{i + 1,j-1,[j == 1]} + dp_{i,j,0},dp_{i+1,j,[j==1]} \leftarrow dp_{i+1,j,[j==1]} + dp_{i,j,0},j \geq 1\\dp_{i + 1,j-1,1} \leftarrow dp_{i + 1,j-1,1} + dp_{i,j,1},dp_{i+1,j,1} \leftarrow dp_{i+1,j,1} + dp_{i,j,1},j \geq 1\\dp_{i + 1,j + 1,k} \leftarrow dp_{i + 1,j + 1,k} + dp_{i,j,k},dp_{i + 1,j,k} \leftarrow dp_{i + 1,j,k} + dp_{i,j,k},k \in [0,1],j < n\end{cases}$

时间复杂度 $O(n ^ 2)$。