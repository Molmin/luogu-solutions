对 $n$ 的奇偶性进行讨论。

### Part 1 $n$ 为奇数

考虑每个点作为链头或链尾的次数奇偶性，则左侧的点均为偶，右侧的点均为奇。猜想存在一种构造方案使得所有链均从右侧 $1$ 号点出发，到右侧的其它每个点结束。

先删去右侧的 $1$ 号点，变为所有链从左侧的每个点出发，到右边的每个点结束。

容易构造出以下方案：

```
5 5 3 3 1
4 5 5 3 3
4 4 5 5 3
2 4 4 5 5
2 3 4 4 5
```

再考虑右侧 $1$ 号点的连接方式，显然奇数颜色连链尾，偶数颜色连链首即可：

```
5 5 3 3 1 1
4 5 5 3 3 4
4 4 5 5 3 3
2 4 4 5 5 2
2 3 4 4 5 5
```

于是 $n$ 为奇数的情况得到解决。

### Part 2 $n$ 为偶数

由样例可知 $n$ 为 $2$ 时无解，但是事实上 $n$ 为大于 $2$ 的偶数时都有解，可以手玩出 $n=4$ 的解：

```
4 4 3 2 3
1 4 4 2 2
3 3 4 4 2
1 3 3 4 4
```

仿照它来拓展，将最多的颜色放在中间，右上角每隔两个放一种颜色，这样会留出来一些空：

```
6 6 ? 4 ? 2 ?
? 6 6 4 4 2 2
? ? 6 6 4 4 2
? ? ? 6 6 4 4
? ? ? ? 6 6 4
? ? ? ? ? 6 6
```

左下角也每隔两个放一种颜色，并将链尾插到右上角的空里：

```
6 6 3 4 5 2 ?
5 6 6 4 4 2 2
5 5 6 6 4 4 2
3 5 5 6 6 4 4
3 3 5 5 6 6 4
? 3 3 5 5 6 6
```

最后两个未填的位置分别在左下角和右上角。将次多的颜色的链首移到链尾，再填上颜色 $1$ 即可：

```
6 6 3 4 5 2 5
1 6 6 4 4 2 2
5 5 6 6 4 4 2
3 5 5 6 6 4 4
3 3 5 5 6 6 4
1 3 3 5 5 6 6
```

这样 $n \geq 4$ 的情况都构造出了解，于是 $n$ 为偶数的情况得到解决。

总时间复杂度 $O(Tn^2)$。

[**Code**](https://atcoder.jp/contests/agc061/submissions/38846774)