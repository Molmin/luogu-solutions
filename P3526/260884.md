- 本文将沿用[该文](https://www.luogu.com.cn/blog/luo1gu1zui1bang1/post-zi-fu-chuan-lun)的知识点进行讲解。
- 如果读者想要在本文讲解的基础上进行更严谨的证明，欢迎阅读[此文](https://www.luogu.com.cn/blog/luo1gu1zui1bang1/post-zi-fu-chuan-border)。
- 作者希望各位能够真正在正式比赛的时候迸发思维，因此作者刻意减少了高级的结论。

**题意**
- [链接](https://www.luogu.com.cn/problem/P3526)。
- 给定一个字符串，构造一个与原串长度相同且字典序最小的 $01$ 串，满足它的所有周期恰好是原字符串的所有周期。
- 测试组数不大于 $20$，字符串长度不大于 $2\times 10^5$。

**分析**
- 众所周知，所有的 $\text{border}$ 对应着字符串所有的周期，而所有的 $\text{border}$ 可以通过暴力跳 $\text{kmp}$ 的 $\text{fail}$ 指针构造出来，所以我们可以尝试这样一种递归的做法（假设我们已经通过 $\text{kmp}$ 求出了所有 $\text{fail}$ 指针）。
- 设 $f(x)$ 为对于 $s(1,x)$ 的答案，我们希望能够通过 $f(\text{fail}(x))$ 计算出 $f(x)$，现在问题就在于寻找这个关系。
- 我们会发现，如果我们 $f(x)$ 的前缀是 $f(\text{fail}(x))$ 的话，那么它的后缀也已经确定，现在我们的问题是：
- 若 $2\text{fail}(x)\ge x$，该串已经完全确定，它一定存在（不会有 $0$ 匹配上 $1$）？它一定合法吗？
- 若 $2\text{fail}(x)<x$，该串并未完全确定，我们需要如何才能使得该串合法（比如说样例的情况）？
- 对于第一个问题，由于 $01$ 串与原串的所有周期都是相同的，利用反证法容易说明：假设 $01$ 串没有我们想要的性质，那么就可以进一步说明它与原字符串的周期是不同的，所以，字符串一定存在，且合法。
- 接下来是第二步，我们需要找到一种字典序最小的方案使得不存在新的 $\text{border}$，注意到字符串的规模是减半的，我们可以寻找一种扫描整个串来确定的方法。
- 思考一下什么时候会发生匹配多一个 $\text{border}$，我们会发现是在一定是在填充的过程中又凑出了原字符串的第 $1$ 到 $\text{fail}(x)$ 个字符。
![](https://cdn.luogu.com.cn/upload/image_hosting/wtgmm69l.png)
- 直觉上这种情况很不容易满足（想想吧，依次排列 $4$ 个相同的字符串，而且它们的间距还有严格要求，而且题意保证有解耶），我们不妨依照字典序从小达到枚举中间所有可能的字符串，暴力 $O(n)$ 验证 $\text{fail}$ 有没有改变。
- 直觉上讲，枚举的次数不可能太大，所以它实际上一定跑得很快，[代码实现](https://www.luogu.com.cn/paste/1z2wc854)（不过作者由于错误的实现复杂度差点错了）。
- 我们回过头来，觉得这样的接近乱搞的做法还是令人不放心，所以作者将用一些简单的知识给出证明。

**证明**
- 事实上，填充只需要枚举全 $0$ 和末尾仅有 $1$ 的两种情况。
- 显然我们要求我们的串中不能出现四个连续的相同 $\text{border}$，且长度为 $\text{fail}(x)$，按顺序分别记作 $1$ 号，$2$ 号，$3$ 号，$4$ 号，则 $1,2$ 号和 $3,4$ 号的间隔大小相同。
- 下面分两种情况，如果 $1,3$ 串没有交，那么整个串就可以唯一确定：
![](https://cdn.luogu.com.cn/upload/image_hosting/2dd45wc4.png)
- 所以我们可以得出结论，除了 $f(\text{fail}(x))$ 是 $0^x$（全零串）和 $f(\text{fail}(x))$ 是 $0^x1$（末尾有一个 $1$） 的串（这种答案显然可以直接确定），其它的都不会在填充 $0^x,0^x1$ 的任何一个产生 $1,3$ 没有交的 $\text{border}$。
![](https://cdn.luogu.com.cn/upload/image_hosting/x56vlcrk.png)
- 接下来是 $1,3$ 彼此之间有交的情况：容易发现 $f(\text{fail}(x))$ 的最小周期也是 $1,2,3,4$ 的并（其实就是整个串的最小周期）所以这样的串至多只有一种可能。
- 所以填充只需要枚举 $0^x$ 和 $0^x1$ 两种情况。