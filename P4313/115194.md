安利个人 blog：https://www.cnblogs.com/ET2006/

碰到这种非 A 即 B 的类型的题目，当然用最小割咯！

考虑这样建图：

1. 从 $S$ 向每个点连容量为 $art_{i,j}$ 的边，若割掉这条边表示 $i$ 行 $j$ 列的人选择理科。
2. 从每个点连 $T$ 容量为 $science_{i,j}$ 的边，若割掉这条边表示 $i$ 行 $j$ 列的人选择文科。
3. 对于每个 $(i,j)$，新建一个点 $u1_{i,j}$，连一条从 $S$ 到 $u1_{i,j}$，容量为 $sameart_{i,j}$ 的边，并从 $u1_{i,j}$ 向 $(i,j),(i-1,j),(i,j-1),(i+1,j),(i,j+1)$ 连容量为 INF 的边。若割掉 $S$ 与 $u1_{i,j}$ 之间的边表示没有 $sameart_{i,j}$ 的贡献。
4. 对于每个 $(i,j)$，再新建一个点 $u2_{i,j}$，连一条从 $u2_{i,j}$ 到 $T$，容量为 $samescinece_{i,j}$ 的边，并从 $(i,j),(i-1,j),(i,j-1),(i+1,j),(i,j+1)$ 向 $u2_{i,j}$ 连容量为 INF 的边。若割掉 $u2_{i,j}$ 与 $T$ 之间的边表示没有 $samescience_{i,j}$ 的贡献。

然后拿所有 $art_{i,j},science_{i,j},sameart_{i,j},samescience_{i,j}$ 的和减去最小割就是答案。

为什么？其实就是我在网络流的 blog 中“网络流建图技巧”中第 4 点提到的情况的扩展。我们考虑最最最最理想的情况，那就是 $art_{i,j},science_{i,j},sameart_{i,j},samescience_{i,j}$ 的贡献全都被累加进答案中。

但这样显然是不合法的。考虑我们最小割是怎样把这些不合法的情况排除在外的。首先一个人 $(i,j)$ 不能既选文科又选理科——否则就存在 $S\to(i,j)\to T$ 的路径了。故 $S\to (i,j)$ 以及 $(i,j)\to T$ 的边必须恰好一条被割掉。其次，也不可能出现 $sameart_{i,j}$ 的贡献被累加进答案，却在 $(i,j)$ 周围存在某个人 $(x,y)$ 选理科的情况——否则，由于 $sameart_{i,j}$ 的贡献被累加进答案，故 $S$ 与 $u1_{i,j}$ 之间的边没有被割掉；由于 $(x,y)$ 选理科，故 $(x,y)$ 与 $T$ 之间的边没有被割掉。而 $(x,y)$ 在 $(i,j)$ 周围，故 $u1_{i,j}$ 与 $(x,y)$ 之间有边，故存在 $S\to u1_{i,j}\to(x,y)\to T$ 的路径，不符合最小割的定义。

故这样跑最小割后跑出来的方案是合法的。

---

到这里，我一直有个疑问，想必也有不少人和我有一样的疑问。那就是出现某个 $(i,j)$，它与 $S,T$ 之间的边全都割掉了怎么办，那不就等价于 $(i,j)$ 既不选文科也不选理科了吗？

这里给出解答：

重新回顾一下割的定义，我们对于割的最原始的定义是将 $V$ 划分成两个不相交的集合 $A,B$，使得 $S\in A,T\in B$。并在此基础上定义了割的权值为 $\sum\limits_{u\in A,v\in B}c(u,v)$。而不是所谓的割掉一些边，使得 $S$ 与 $T$ 不连通。如果按照后者的定义来看可能会出现某个 $(i,j)$，它与 $S,T$ 之间的边全都割掉；不过按照前者的定义来看是不会出现这种情况了。因为如果存在某个 $(i,j)$，它与 $S,T$ 之间的边全都割掉了，我们考虑 $(i,j)$ 究竟是属于集合 $A$ 还是集合 $B$，如果 $(i,j)\in A$，那么它与 $S$ 的边的权值就不会被累加到答案中；同理如果 $(i,j)\in B$，那么它与 $T$ 的边的权值就不会被累加到答案中。故这种情况是不会出现的。

那么为什么很多人（包括我）会把割的定义误解成后者呢？因为如果按照后者的定义来理解，那最大流等于最小割的定理也是成立的；也就是说如果你割掉了一个集合 $E'\subseteq E$ 中的边使得 $S$ 与 $T$ 不连通，那么 $E'$ 中所有边容量之和的最小值就等于最大流。

证明：设 $A$ 为割掉 $E'$ 后 $S$ 能到达的点集，$B$ 为割掉 $E'$ 后能到达 $T$ 的点集。如果割掉 $E'$ 后存在某个点 $u$ 既不属于 $A$ 也不属于 $B$，那么把 $u$ 归约到 $A$ 或 $B$ 中割的权值肯定会更小。否则，设 $W$ 为割 $A,B$ 的权值，显然 $A,B$ 之间的边肯定都属于 $E'$，否则 $S$ 与 $T$ 就连通了。而 $E'$ 中可能还含有故 $E'\text{的权值和}\leq W$。也就是说每个 $E'$ 都能映射到一个割 $A,B$ 上并且 $E'$ 的权值和不小于割 $A,B$ 的权值。故原命题成立。

代码就不贴了。