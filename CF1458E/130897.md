看题解的做法好像都比较麻烦，就来提供一个不太一样的思路吧.

对于给定的 $a$，满足 $(a,b)$ 是先手必败态(以下简称必败态)的 $b$ **大致至多只有一个**.

为什么说大致呢？这里有一个例外：如果 $a$ 出现在了 shortcut 集合里面，那么必败态可能会有很多；比如说如果 shortcut 集合是 $\{(0,0),(1,1),(1,3),(1,5)\}$，那么 $a=1$ 就对应 $3$ 个 $b$；除此以外，如果 $a$ 存在两个 $b$，比如说 $b_0<b_1$，那么面对 $(a,b_1)$，可以一步取成 $(a,b_0)$，于是说明了 $(a,b_1)$ 一定是必胜态，这样就矛盾了.

考虑如何去求这个东西，比如说，我们假设 $1$，从未作为 $a_i$ 出现在 shortcut 集合里面(以下简称 $1$ 是**一般的**，与此对应地，曾经作为 $a_i$ 出现在 shortcut 集合里面，即称为**特别的**，$0$ 显然是特别的)，考虑如何求出 $f(1)$，也就是 $a=1$ 时对应的必败态的 $b$.

$(1,b)$ 是必败态，当且仅当，以下两个条件同时满足：

- $(0,b)$ 是必胜态.

- 不存在 $\beta<b$，使得 $(1,\beta)$ 是必败态.

显然，我们只需要将所有满足 $(0,b)$ 是必败态的 $b$ 拉出来构成一个集合 $S$，那么 $(1,\operatorname{mex}(S))$ 就是一个必败态，也就是说，$f(1)=\operatorname{mex}(S)$.

同样地，对于任意一个一般的 $a$，我们只需要对所有 $\alpha<a$，然后再将所有满足 $(\alpha,b)$ 是必败态的 $b$ 拉出来构成一个集合 $S$，那么 $f(a)=\operatorname{mex}(S)$，这样顺便也就证明了 $f(a)$ 的存在性.

那对于特殊的 $a$ 呢？照样求出 $\operatorname{mex}(S)$，然后如果集合里存在一个必败态 $(a,b)$，满足 $b<\operatorname{mex}(S)$，那么 $(a,\operatorname{mex}(S))$ 就是必胜态，否则 $(a,\operatorname{mex}(S))$ 仍是必败态.

好了现在我们将所有的 shortcut 和所有的询问一起按照 $x$ 轴排序，一批次处理所有 $x$ 坐标相同的修改和询问就可以了.

具体地，如果上一次的 $x$ 坐标是 $x_0$，这一次的 $x$ 坐标是 $x_1$，那么我们需要先给中间的所有 $x$ 求一下 $f(x)$，并把这些 $f(x)$ 都加入 $S$ 中，然后再求一个 $f(x_1)$，然后判断一下是否存在一个必败态 $(a,b)$，满足 $b<f(x_1)$，如果不存在的话，就将 $f(x_1)$ 也加入 $S$ 中，否则就直接忽略掉；处理完之后，由于不在 shortcut 集合内的必败态数量至多就是一个，直接就地回答所有 $(x_1,b)$ 的询问即可.

于是，我们只需要维护一个集合 $S$，支持插入总共 $\mathcal{O}(n)$ 个元素、以及作 $\mathcal{O}(n+q)$ 回连续跳若干次 $\operatorname{mex}$ 即可，显然，我们直接用 $\texttt{STL Set}$ 维护 $S$，再维护一个变量 $\mathcal{M}$ 表示目前的 $\operatorname{mex}$ 值就行了.

需要分三类讨论，比较繁琐，需要注意实现的细节，[这是我的代码](https://www.luogu.com.cn/paste/mgam5k1z)，供对拍/参考.