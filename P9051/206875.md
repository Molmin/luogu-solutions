### [PA2021] Wystawa

#### Description

给定两个长度为 $n$ 的序列 $a,b$，要求构造一个序列 $c$，$c_i$ 等于 $a_i$ 或者 $b_i$，并且恰好有 $k$ 个位置等于 $a_i$，其余位置等于 $b_i$。最小化 $c$ 的最大子段和。

$n\leq 2\times 10^5,-10^9 \leq V\leq 10^9$。

#### Analysis

为了方便处理，我们希望让选数的过程变得具有单调性，即答案随 $k$ 的变大而变大。

因此，我们先让 $a_i\leq b_i$ 的位置选 A，其它选 B，设此时选 A 的个数为 $k'$。对于 $k'<k$ 的情况，我们让 AB 反转即可。可以证明，如果我们让选 B 的位置对应的 $a_i \gets b_i$，答案不变。此时 $a_i\leq b_i$。

考虑二分答案 $x$。

设 $f_{i,j}$ 表示前 $i$ 个位置选 $j$ 个 B，任意子段和 $\leq x$ 时最小化最大后缀和。
转移形如 $f_{i,j}\gets f_{i-1,j}+a_i$ 和 $f_{i,j}\gets f_{i-1, j-1}+b_i$，同时对 $0$ 取 $\max$，删去末尾 $>x$ 的位置，合法等价于 $f_{n,n-k}$ 存在。

考虑优化 DP 转移。
画出 $(j,f_{i,j})$ 的图像，可以发现转移相当于先向上平移 $a_i$，然后从后往前依次尝试将斜率替换为 $b_i-a_i$ 然后将后面的斜率加上一个当前斜率的减少量，然后删去后面一段并将一段前缀变为 $0$。
可以发现，$f$ 是凸的，因此可以直接看成将斜率 $b_i-a_i$ 插入凸包。
对于前缀变为 $0$ 操作，相当于前缀斜率变为 $0$ 并改变交界处的斜率。

这些操作可以用一个 `set` 维护。
复杂度 $\mathcal O(n\log n\log V)$。