直接处理这个 3 有些奇怪，先把 3 去掉不管。

统计一个加入的数 $x$ 的减小过程不好弄，我们算出 $x$ 加入之前总共减掉的数 $cnt$，把加入 $x$ 看成在一开始加入 $x+cnt$。

这样就可以轻松 $O(n)$ 解决。

把 3 操作放回来，我们还是依照刚才的思路，把所有加数都等效成在一开始加数。

这时候考虑后面的 3 操作对加的数的影响，假设后面 3 操作一共有 $m$ 个，进行之前 2 操作减掉的数是 $x_i$，$x_i$ 可以很轻松求出。

显然，对于每个 3 操作，操作前和操作后两种情况，所以等效于加上 $x+0/1x_1+0/1x_2+\cdots+0/1x_k$ 这 $2^k$ 个数。

现在的难点是求出有多少个数能挺到最后。注意到 $2x_i\le x_{i+1}$，因为在 $i+1$ 次 3 操作之前，$i$ 3 操作之前的部分已经重复了两次。

所以我们一个一个求，类似于二进制的方法就可以求出有多少个能挺到最后。

但这样还不够，注意到 $x\le 10^9$，而 $x_i \ge 2^{i-1}$，所以 $x$ 在位数很大的时候是起不到作用的，我们只需要从 $\log 10^9$ 位开始考虑 $x$ 的贡献即可。

复杂度 $O(n \log V)$。