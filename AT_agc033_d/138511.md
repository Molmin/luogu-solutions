## [AGC033D] Complexity 题解

给定一个 $N$ 行 $M$ 列的字符矩阵。我们定义一个字符矩阵的凌乱度为：
- 若这个字符矩阵中所有字符都相同，则凌乱度为 0。
- 否则，则考虑所有的沿水平或者竖直方向的直线，将字符矩阵分成两个不为空的部分，设两个部分的凌乱度分别为 $a$ 和 $b$，则整个字符矩阵的凌乱度为 $\max(a,b)+1$的最小值。

请你求出，给出的字符矩阵的凌乱度是多少。

[题面](https://www.luogu.com.cn/problem/AT4927) [代码](https://atcoder.jp/contests/agc033/submissions/12933109)

$1 \leq N, M \leq 185$。

$5s +512MB$

---

首先，我们有一个非常naive的$O(N^5) \text{DP}$:设$dp_{(a,b),(c,d)}$表示处理完某个区间矩形的代价和，转移是$O(N)$的暴力。

其次，我们有一个比较naive的$O(N^4) - O(n^4 \log N)\text{DP}$，我们发现转移具有单调性，可以用二分 or 双指针优化。

看似没有办法了？

这个时候我们需要用到$DP$优化的一个小技巧，**改变状态的设定**。我们把原先dp的值压入状态，状态变为dp的值。这种做法适用于最优化类的DP，而且发现答案不大的情况。

注意到答案的范围大约是$O(logN)$的，考虑如下的构造，会使答案最大化。

```
.#.#.#.#
#.#.#.#.
.#.#.#.#
#.#.#.#.
.#.#.#.#
#.#.#.#.
.#.#.#.#
#.#.#.#.
```

同样大小的$N,M$,答案一定不会劣于上述情况，所以$ans\le \lceil  logN +logM\rceil$。


我们设$down_{ans,h,l,r}$表示如果答案是$ans$,矩形的上端在$(h,l),(h,r)$处，下端可以延伸的最大位置。

我们设$right_{ans,h,l,r}$表示如果答案是$ans$,矩形的左端在$(l,h),(r,h)$，右端可以延伸的最大位置。


所以结合说结合双指针or二分，我们可以做到$O(N^3\log N)-O(N^3 \log^2 N)$的时间复杂度。

DP数组的第一维是可以滚动数组优化，空间复杂度$O(N^3)$，可以通过。
