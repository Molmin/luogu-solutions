# **题目解析**

本题要求计算给定节点数量的有标号单图的数量。
- 首先需要理解什么是单图。

- 单图是指不存在其他简单有向图与其本质相同的图。
- 两个图本质相同，当且仅当对于**任意**点对 $(u, v)$，在图 $G$ 中从 $u$ 出发能走到 $v$ 的情况下，在图    $H$ 中从 $u$ 出发也能走到 $v$，反之亦然。


___
# **思路**
考虑一个 $n$ 个节点的图，我们从节点数量为 $0$ 的情况开始递推。首先，对于只有 $1$ 个节点的情况，显然只有一个单图，即这个节点本身。接下来，我们逐个节点地将单图扩展为 $n$ 个节点的单图。

当我们添加一个新的节点 $i$ 到图中时，我们可以选择在已有的节点集合中**添加一些边**以满足单图的条件。

假设我们添加了 $k$ 个边，那么我们可以得出如下关系：

$$
ans_i = \sum_{j = 0}^{i - 1} {C_{i}^{j} \times (2^{i - j} - 1)^j}
$$

**其中 $ans_i$ 表示 $i$ 个节点的单图数量。**


**分析以上式子：**


考虑从一个有 $i-1$ 个节点的单图 $G$ 扩展到一个有 $i$ 个节点的单图 $H$，我们可以考虑在 $G$ 中添加节点 $i$，然后在 $i$ 与 $G$ 中的节点之间添加若干条边，使得 $H$ 仍然是一个单图。

我们假设在节点 $i$ 与 $G$ 中的节点之间添加了 $j$ 条边，那么 $H$ 中的边数就是 $side_{i-1}+j$，其中      $side$ 表示 $i-1$ 个节点时边的个数。


其中，$i$ 是 $H$ 中新添加的结点，$j$ 是 $i$ 与 $G$ 中的节点之间的边数。由于 $G$ 是 $H$ 的子图，因此 $G$ 中的结点和边在 $H$ 中也存在。我们需要在 $H$ 中添加若干条边，使得 $i$ 与 $G$ 中的节点之间恰好有 $j$ 条边，且添加的边不会破坏 $H$ 的单图性质。


### 我们需要满足以下条件：

$H$ 中的边数不能超过 $\sum_{k=1}^{i-1}k = \frac{i(i-1)}{2}$，否则 $H$ 不是一个简单图。$H$ 中不能包含 $G$ 中任意一条边，否则 $H$ 与 $G$ 本质相同。

**证明**：假设 $H$ 中有 $i-1$ 个结点不在 $G$ 中，我们需要在这 $i-1$个结点和 $i$ 之间添加若干条边，来满足上述要求。由于我们需要保证 $H$ 仍然是一个单图，因此在 $i-1$ 个节点和 $i$ 之间最多只能添加 $i-2$ 条边。因此，我们需要考虑添加 $0, 1, 2, \cdots, i-2$ 条边的所有可能性。

**对于每种添加边的数量的情况**，我们可以使用二进制数的方式来表示。例如，假设我们要在 $H$ 中添加 $k$ 条边，其中 $k < i-1$，我们可以用一个 $i-1$ 位的二进制数来表示，其中第 $j$ 位为 $1$ 表示第 $j$ 个节点与 $i$ 之间添加了一条边，为 $0$ 则表示没有添加。由于 $i$ 与 $G$ 中的节点之间需要恰好有 $j$ 条边，因此我们需要在这个二进制数中选择 $j$ 个位置，将它们的值改为 $1$。因此，我们需要在 $i-1$ 个位置中选择 $j$ 个位置，来添加边。这个选择的过程可以用组合数 $\binom{i-1}{j}$ 来表示。因此，对于给定的 $i$ 和 $j$，满足要求的连通性的数量为 $\binom{i-1}{j}(2^{i-j}-1)^j$。

**其中**，$\binom{i-1}{j}$ 表示选择 $j$ 个位置的方案数，$2^{i-j}-1$ 表示 $i$ 与 $H$ 中的 $i-1$ 个节点之间可以选择的边的方案数，$j$ 表示在这些边中选择 $j$ 条边的方案数。

**因此**，$(2^{i-j}-1)^j$ 表示在 $i$ 与 $H$ 中的 $i-1$ 个节点之间添加边的情况下，其中 $i$ 与 $G$ 中的节点之间需要恰好有 $j$ 条边。这个式子反映了在给定的限制条件下，我们可以通过选择不同的添加边的数量和位置，来得到不同的满足要求的连通性的方案数。


**最后**，我们需要从 $i-1$ 个节点的单图中选取 $j$ 个节点与 $i$ 连边，因此方案数为 $C_{i-1}^{j}$。因此，得到了上述的递推式：

$$
ans_i = \sum_{j = 0}^{i - 1} {C_{i}^{j} \times (2^{i - j} - 1)^j}
$$

**优化**：我们可以预处理所有组合数 $C_{i}^{j}$ 和 $ans_i$ 的值。
___

# **处理答案**

对于一个给定的 $n$，**又因为每个点有标号**，我们可以通过以下方式计算单图的数量：

1. 初始化结果 $res$ 为 $ans_n$。
2. 对于所有的偶数 $i$（$2$ $\leq$ $i$ $\leq$ $n$)，将 $res$ 更新为：
    $$
    res = (res + C_{n}^i \times fact_{i-1} \times ans_{n-i}) \bmod mod 
    $$

最后输出结果 $res$ 即可。

___
# **复杂度分析**

**时间复杂度**：预处理的时间复杂度为 $O(N^2)$，每次查询的时间复杂度为 $O(N)$，共有 $T$ 次查询，总时间复杂度为 $O(N^2 + TN)$。

**空间复杂度**：预处理所需的空间复杂度为 $O(N^2)$，所以总空间复杂度为 $O(N^2)$。

