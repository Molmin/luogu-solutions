首先第一个人的时候的答案为$1$

可以考虑设$f_i$表示第$i$个人的礼物，那么有：

$$f_i=\sum_{j=1}^{i-1}f_j+i^k$$

可以考虑对于询问的$n$某一个$i^k$被计算了多少次

$f_i$中被计算了一次，$f_{i+1}$中是一次，$f_{i+2}$中则是二次，$f_{i+3}$中是$4$次，往后是$8$次，$16$次...

于是可以发现对于一个$i^k< n$它会被计算：

$$2^{n-i-1}$$

次

于是我们可以得到答案就是：

$$n^{k}+\sum_{i=1}^{n-1}i^k*2^{n-1-k}$$

设$x=n-1$

那么答案就是：

$$n^k+\sum_{i=1}^{x}i^k*2^{x-i}$$

~~这是一个卷积（雾~~

仔细思考后会发现一个令人倍感优美的性质

上面这个式子居然是可以通过矩阵递推的

设

$$ h(x)=\sum_{i=1}^xi^k*2^{x-i}$$

$$h(x)=h(x-1)*2+x^k$$

貌似对于每个$x$这个东西是独立的啊喂...

然而有趣的是$x^k$可以由$x^{k-1}$递推得到，假设$k=t$，那么就需要一个大小为$t$的矩阵递推得到

如何递推？

二项式定理暴力展开即可，复杂度$O(k^3\log n)$