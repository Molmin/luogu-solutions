
首先一个串相邻相同的可以缩成一个字符，不影响答案，假设缩完有 $n$ 段。每次操作会使一些相邻段字符变得相同，可以看做段减少了。发现每次操作最多减少两个段，能不能达到这个上界？

考虑到有个题 [[Kubic] ABC](https://www.luogu.com.cn/problem/P7919)，那题的结论是每次都可以增加两个段，于是我就思考是不是每次都可以减少两个段。

经过一通手玩（也可以打表），发现 $n\ge 5$ 的时候都可以找到一种方式减少两个段，也就是 $n\to n-2$。

$n=4$ 的时候，发现每种情况 `ABAC` `ABAB` `ABCA` 都需要恰好两步。于是 $n$ 是偶数的情况解决。

$n=3$ 的时候，有 `ABA` `ABC` 两种，答案只和首尾是否相同有关，而中间的每一步都不会改变首尾。首尾相同为 1 步，不相同为两步。于是判断一下就好了。于是 $n$ 是奇数的情况解决。

[code](https://atcoder.jp/contests/agc059/submissions/37021156)