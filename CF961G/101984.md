这里介绍一个从 EI 大爷那里学来的做法，似乎未被其余题解提及，过来宣传一下：

首先有一个显然的式子：

$$
\sum_{i=1}^{n} w_i \sum_{j=1}^{n} j \binom{n-1}{j-1} S(n-j,k-1)
$$

就是枚举每个物品所属集合大小。其中 $S$ 表示第二类斯特林数。

困难在于求解

$$
\sum_{i=1}^{n} i \binom{n-1}{i-1} S(n-i,k-1)
$$

这个式子长得一脸卷积的样子。看不出来？这样可能更为明显：

$$
\frac{1}{n} \sum_{i=1}^{n} i^2 \binom{n}{i}S(n-i,k-1)
$$

$\dbinom{n}{i}$ 可以由 EGF 的卷积产生，$S(,k-1)$ 的 EGF 为 $\dfrac{(e^x-1)^{k-1}}{(k-1)!}$。

考虑 $i^2$ 的 EGF：$i^2 = i(i-1)+i$，$i(i-1)$ 的 EGF 是 $x^2e^x$ ，$i$ 的 EGF 是 $xe^x$ 。那么 $i^2$ 的 EGF 就是 $(x+x^2)e^x$。

于是所求为

$$
\frac{1}{n}[\frac{x^n}{n!}][(x+x^2)(e^x-1+1) \cdot \frac{(e^x-1)^{k-1}}{(k-1)!}]
$$

推一下：

$$
\frac{1}{n}[\frac{x^n}{n!}][(x+x^2)(k\frac{(e^x-1)^{k}}{k!}+\frac{(e^x-1)^{k-1}}{(k-1)!})]
$$

芜湖，起飞：

$$
\frac{1}{n}[knS(n-1,k)+kn(n-1)S(n-2,k)+nS(n-1,k-1)+n(n-1)S(n-2,k-1)]
$$

$$
=kS(n-1,k)+S(n-1,k-1)+(n-1)[kS(n-2,k)+S(n-2,k-1)]
$$

$$
=S(n,k)+(n-1)S(n-1,k)
$$

最后按通项公式整一下第二类斯特林数就好了。






