[题传](https://www.luogu.com.cn/problem/UVA1362)

似乎是一个经典的问题。

>问多少颗树的 $\operatorname{Euler}$ 序（欧拉环游序）是给定的字符串 $s$。

$\operatorname{Euler}$ 序本身的性质是跟 $\operatorname{dfs}$ 序差不多的（但两者不能混为一谈）。若记 $st_i$ $ed_i$ 分别为第 $i$ 个节点上的字符（也就是说，不同节点的字符可能一样）最早出现和最晚出现位置，那么由定义可知，$[st_i, ed_i]$ 中的节点都是 $i$ 的子树节点，子树对应区间，不难想到区间 DP。

设 $f_{l, r}$ 为处理 $[l, r]$ 这段字符能形成以 $l=st,r=ed$ 的不同的“子树”个数，为了不出现 [P7914](https://www.luogu.com.cn/problem/P7914) 那样的算重惨案，我们枚举第一颗被遍历完的**次根子树**（就是根的父亲为 $l$ 的子树）的 $ed$ 的后一位 $k$（因为要第一个遍历完，所以 $st=l+1$），显然 $s_l=s_k$，因为遍历完了要回到根，根据乘法原理，就有：

$$f_{l, r}=\sum_{k=l+2}^{r} f_{l+1, k-1} \times f_{k, r} [s_l=s_r=s_k]$$

复杂度 $O(Tn^3)$。

这么简单的题还要代码？