### 算法分析
注意到  $n \leqslant 10^{18}$，所以  $n$ 在二进制表示下至多有 $60$ 位。

由于  $f(x)=3$，那么只需在 $60$ 位中任选 $3$ 位置为 $1$，有  $\left(\begin{array}{c}60 \\ 3\end{array}\right)=34220$  个合法数，比较少。

我们可以二分出**不超过**  $n$  的最大合法数即可！