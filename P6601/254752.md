~~考虑吊打std。~~

前置芝士：逆元，快速幂，简单数学，二项式定理。

首先条件分成两部分：

（1）两个球在同一个位置。

（2）在（1）的条件下，恰好选择了 $i$ 是那一个位置。这部分的概率显然是 $\dfrac{1}{2n}$。

考虑求 （1） 的概率，假设选的二元组时间维为 $j$。

结论：这等价于两个球在 $2j+2$ 个可能瞬移的时间内恰好选择了偶数个。

证明：由于一次瞬移多走了半圈，并且正常走的话走的路程是一样的。所以两个球瞬移次数差是偶数就是多走了整数圈，也就是在同一个点。而差是偶数和和是偶数等价，得证。

简单的计算可以得到答案是 $\dfrac{1}{2}(1+(2p-1)^{2j+2})$。这一部分很经典，具体计算放到最后。

由于 $j$ 一维上是等概率的，枚举所有的和，求个平均数即可。这正好是等比数列求和的形式，可以快速计算：

$$\frac{1}{t+1}\sum_{i=0}^{t}\frac{1}{2}(1+(2p-1)^{2i+2})=\frac{1}{2}(1+\frac{(2p-1)^2}{(t+1)(4p^2-4p)}((2p-1)^{2t+2}-1))$$

注意这里的时间是从 $0$ 开始的所以是 $t+1$。

前面提到留在最后的部分：

也就是一个长度为 $t$ 的 $01$ 序列，是 $0$ 的概率是 $p$，是 $1$ 的概率是 $1-p$，求偶数个 $0$ 的概率。（同时也有偶数个 $1$，上面 $t$ 是偶数）

有 $x$ 个 $0$ 的概率是 $C_t^xp^x(1-p)^{t-x}$。（选择 $x$ 个位置 $C_t^x$，每一位都是相应的 $01$ 是后者）

对于 $x$ 求和：

$$\sum_{i = 0}^{[t/2]}\binom{t}{2i}p^{2i}(1-p)^{t-2i}=\frac{1}{2}(p+(1-p))^{t}+\frac{1}{2}(p-(1-p))^t=\frac{1}{2}(1+(2p-1)^t)$$

这里，$[x]$ 表示不大于 $x$ 的最大整数，$=$ 右边的式子经过二项式定理展开恰好是左式。