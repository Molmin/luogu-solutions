[题目传送门·](https://www.luogu.com.cn/problem/P8270)

主要思路：预处理出任意两个字符是否矛盾，查询时枚举所有字符判断即可。

矛盾：有两个字符 $i,j$ .如果第 $x$ 个 $i$ 在 $s$ 串是在第 $y$ 个 $j$ 的右边，而在 $t$串是在 第 $y$ 个 $j$ 左边，则是矛盾。$i$ 在 $s$ 串是在第 $y$ 个 $j$ 的左边时同理。

用一个二维数组记录任意两个字符矛盾情况。

查询复杂度 $O(m \times |s|^2)$

预处理复杂度：

枚举两个字符 $i,j$  再乘上检验复杂度,即 $i$  字符在 $ s $ 串出现次数 $|i|$ 乘上 $j$  字符在 $s $ 串出现次数 $|j|$ ,总复杂度为 $ O(18^2 \times \sum |i| \times |j| )$ ，很卡.

**如何优化？**

其实，当枚举 $j$ 时，只需枚举最近左边的 $i$ 和最近右边的 $i$

如果矛盾，直接判否。 如果不矛盾，如何证明其他也不矛盾？

设最近左边的 $i$ 为 第 $x$ 个。

因为此时不矛盾，所以 $t$ 串第 $x$ 个 $i$ 位置小于 $j$ 在 $t$ 串位置。

此时有第 $y(y<x)$ 个 $i$ 在第 $x$ 个前 ,那么因为 $y<x$，所以 $t$ 串第 $y$ 个 $i$ 位置小于 第 $x$ 个 $i$ 位置，即小于 $j$ 在 $t$ 串位置，可得出并不矛盾,证毕。

因为枚举 $j$ 有单调性，所以可以搞一个指针，每次枚举新的 $y$ 时往后找第一个位置大于 $j$ 的 $i$ 即可。

证明了正确性，预处理时间复杂度为 $O(18^2 n)$

总时间复杂度为：$O(18^2 n + m \times |s|^2)$

**贴上代码**

**code**

[代码](https://www.luogu.com.cn/paste/magz7o5i)