~~YnMO 正式上线。~~

如果您点进来是因为您有切 Ynoi 毒瘤 ds 题的潜质的话，那么本题的数据结构部分对您一定很简单。如果不会的可以去在 【模板】方差 中找到详细的如何用两颗线段树维护区间平方和以及区间和。~~（所以我的代码就可以咕咕咕了）~~

----

数据结构部分到此结束，数学推导开始：

我们转化问题为：给定区间长度 $L$，他的区间方差之和一定是 
$$x_L \sum_{i=1}^{L}{a_i^2}-\frac{x_L}{L} (\sum_{i=1}^{L}a_i)^2$$

为什么这两个系数只差 $L$ 倍呢？我们采用 **赋值法** 证明。让所有的 $a_i$ 都相等，那么所有方差都是 $0$，求和之后也是 $0$，那么上面的式子代入后也是 $0$，由此可以得出两个系数恰好差 $L$ 倍。这就省去了推两遍式子，写两遍代码的麻烦。

然而这个形式不太好计算 $x_L$ 的值，所以我们继续打开，写成 

$$ A \sum_{i=1}^{L}a_i^2-B \sum_{i,j}a_ia_j$$ 

的形式，$A$ 与 $B$ 的倍数关系的推导类似。

接下来求这个值，枚举我们选的子集的长度，设它为 $k$，那么一共有 $C_L^k$ 个这样的子集，每个子集对于 $A$ 的贡献为 $\frac{k-1}{k}$。

这样就写出了和式

$$\sum_{i=0}^{L}\frac{i-1}{i}C_L^i=2^L-\sum_{i=0}^{L}\frac{1}{i}C_L^i$$

右边那个东西好像看不出什么，没啥办法化简，打了表规律也没啥，所以我们使用看不出规律就差分的大法，根据 $i$ 整理，发现里面的 $C_L^i$ 和 $C_{L-1}^{i-1}$ 可以抵消，只剩下 $C_L^{i-1}$。


现在只用求出 **所有的** 

$$\sum_{i=0}^{L} \frac{1}{i}C_L^{i-1}$$

~~打表找规律后补证明所以~~化简，变成

$$L!\sum_{i=0}^{L}\frac{1}{(i-1)!(L-i+1)!i}=L!\sum_{i=0}^{L}\frac{1}{(i)!(L-i+1)}$$

$$=\frac{1}{L+1}\sum_{i=0}^{L}\frac{(L+1)!}{(i)!(L-i+1)}=\frac{1}{L+1}\sum_{i=0}^{L}C_{l+1}^i=\frac{2^{L+1}-1}{L+1}$$

线性预处理逆元以及 $2$ 的次幂就可以了，这些技巧都比较基本，~~并且都可以出门左转拉板子~~。

所以代码名正言顺的咕咕咕了。