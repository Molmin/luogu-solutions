被薄纱了。

乘法的期望想必不好搞，拆贡献。可以把贡献写成一个 $(1+m)\times n$ 的表格的形式，第 $1$ 行是 $a_1,...,a_n$，往后第 $i$ 行是第 $i$ 次操作加的数，如果加到了就是 $v$ 否则是 $0$，那么贡献就是每一列选一个数乘起来的和。

拆开以后单独考虑一项怎么计算。我们会发现如果这一项中有两个来自同一行的变量，那么它们是不独立的；其他来自不同行的是独立的。但是考虑来自同一行的变量 $x_1,x_2$，我们发现 $E(x_1x_2)=E(x_1)v$，因为如果 $x_1=0$ 那么无所谓，如果 $x_1=v$ 那么一定有 $x_2=v$。所以这样就拆成了许多互相独立的变量，我们可以把每个变量的期望乘起来。

对上述过程 DP，我们注意到只需要注意到当前做到第几个数，还有目前已经有几行的变量已经被选过了。每次转移的时候考虑：选 $a_i$，选了一个选过的行的变量（此时期望是 $v$），选了一个没选过的行的变量（此时期望是容易算的）。

复杂度是 $O(n^2)$。