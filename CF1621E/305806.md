先考虑学生不会跑的情况。一开始可能会想贪心地匹配，但是感觉不太方便快速修改（其实也能做，就是官方题解方法）。但可以把问题转化：把老师拍到数轴上，每组学生的平均值也拍到数轴上，那么当前状态合法当且仅当对于数轴上的任意整数位置，老师的后缀和不小于学生的后缀和。

转化后显然是对的，那么就考虑修改。

容易发现一次修改相当于把一组学生从一个点移到了另一个点，这两个点间的后缀和会 $+1$ 或 $-1$ （注意边界） 。

如果某个位置老师的后缀和与学生的后缀和的差比 $-1$ 还小 ，那无论怎么改都不行。

如果差存在 $-1$  ，那么当前状态要合法就必须把所有差是 $-1$ 的地方都 $+1$ ；如果是差存在 $0$ ，那么要保证 $-1$ （这里 $-1$ 指修改）的地方不经过这样的地方。前者直接先算出一下至少需要覆盖的区间，判断是否包含，后者就查找一下离左端点最近的 $0$ 和右端点的位置关系即可。