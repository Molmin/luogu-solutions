## 题目大意

> 你有一个矩阵 $A$, 第 $i$ 行第 $j$ 列的数为 $A_{i,j}$。首先，你要把 $A$ 中数值为 $0$ 的数替换为一个任意正整数。然后，有如下操作：
>
> - 选定 $1\le i\le j \le H$，交换第 $i$ 行和第 $j$ 行。
> - 选定 $1\le i\le j \le W$，交换第 $i$ 列和第 $j$ 列。
>
> 你想要通过若干种这种操作，使得对于每一对 $(i,j)$ 和 $(i',j')$，
>
> - 若 $i<i'$，$A_{i,j}\le A_{i',j'}$。
> - 若 $i=i'$ 且 $j<j'$，$A_{i,j}\le A_{i',j'}$。

## 分析

### 1. 如何处理  $0$

如果我们转换一下题意，让我们可以先操作，后替换 $0$。那么，当我们操作完以后，一定会有解。因此，我们可以忽略 $0$.

证明：我们把操作后的矩阵用一个集合来表示。若去掉数值为 $0$ 的部分，则此集合 $S=\{s_1,s_2,s_3,\cdots, s_k\}$ 满足 $s_1\le s_2\le s_3\le\cdots \le s_k$。假设原始集合中，$s_i$ 与 $s_j$ 之间有若干个 $0$，则把这些 $0$ 均变为 $s_i$ 即可。比如 $S=\{1,0,0,2,0,0,3\}$，就可以替换为 $S'=\{1,1,1,2,2,2,3\}$。

### 2. 如何处理操作

首先，把需要满足的条件转化为

> 对于 $1\le i \le H$，令 $mn_i=\min\{A_{i,1},A_{i,2},\cdots,A_{i,W}\}$，$mx_i=\max\{A_{i,1},A_{i,2},\cdots,A_{i,W}\}$。则，
>
> - $mn_1\le mx_1\le mn_2\le mx_2\le \cdots \le mn_H\le mx_H$。
>
> - $A_{i,1}\le A_{i,2} \le \cdots \le A_{i,W}$。

这样转换的好处是

- 若行与行换，则条件 $2$ 不会变。
- 若列与列换，则条件 $1$ 不会变。

因为行与列的交换互相独立，所以，我们只需要找到一种方法，使得

- 若干次行与行交换后，满足条件 $1$。
- 若干次列与列交换后，满足条件 $2$。

#### 行与行交换

可以贪心，按照 $mn_i$ 从小到大排序，当有 $(i,j)$ 使得 $mn_i=mn_j$ 时，按照 $mx_i$ 从大到小排序。

可以证明，如果有解，这样排完序后，满足条件 $1$.

#### 列与列交换

因为要满足每一行条件 $2$ 都满足，所以不能贪心。

我们先考虑列 $j$ 可以在 $j'$ 前面要满足的条件：

- 对于 $1\le i \le H$，$A_{i,j}\le A_{i,j'}$。

通过这个条件可以发现若有 $(j,j')$ 使

- 存在 $1\le i \le H$，$A_{i,j}\le A_{i,j'}$。
- 存在 $1\le i \le H$，$A_{i,j} > A_{i,j'}$。

那么 $j$ 既不能在 $j'$ 前面也不能在 $j'$ 后面，无解。

所以这启发我们构图：对于所有的 $i$，枚举 $(j,k)$（$1\le j,k \le W$），若 $A_{i,j}\le A_{i,k}$，从 $A_{i,j}$ 到 $A_{i,k}$ 连一条边。若这图中无环，也就是有拓扑序，则有解。

但是，这种方法最多会建 $HW^2$ 条边，所以要考虑优化。

**优化**

你想要把 $N$ 个点和 $M$ 个点一一连边。若连 $NM$ 条边，变数会太大。因此，我们可以增加一个点 $u$，把那 $N$ 个点和 $u$ 连接，再把 $u$ 和那 $M$ 个点连接。

在这个题中，我们也可以这样操作，把一行中同样值的点视为一个点。这样，就只会有 $HW$ 条边。

代码略。