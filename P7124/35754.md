[P7124 [Ynoi2008] stcm](https://www.luogu.com.cn/problem/P7124)解题报告：

[更好的阅读体验](https://zybuluo.com/xiaoziyao/note/1806092)

## 题意

给定一棵 $n$ 个点的树，你需要通过至多 $4.5\times 10^6$ 次加点操作，以及同样数量的撤回上一次加点操作，你要声明出每一个节点的子树补信息。

$1\leqslant n\leqslant 10^5$ ，至多 $3$ 组数据。

## 分析

nb题。

一眼看操作数量就知道是单 $\log$ 级别的，做多了这类树上的交互/构造题就知道树剖没跑了。

直接重剖然后在树上遍历，对于每一条重链我们都暴力加入上面所有的轻子树，根据重链剖分经典结论可知所有轻子树大小之和为 $O(n\log n)$ 级别，那么操作数就是 $O(n\log n)$ 级别。

但是每个轻子树并不好处理，考虑设所有轻子树大小之和为 $a_1+a_2+\cdots +a_k=sum$ ，我们要用 $O(sum\log sum)$ 次操作得到重链上所有轻子树的子树补信息并递归进入轻子树。

我们不妨先想一想轻子树大小相同时如何处理，此时我们可以建立一棵完全二叉树，叶子节点代表每一个轻子树，在二叉树上遍历，走哪颗子树就加另一颗子树，这样的操作次数是所有子树大小之和，也就是 $O(sum\log sum)$ 级别的。

考虑扩展这一方法，不难发现完全二叉树是哈夫曼树的一种特殊情况，我们对 $a_{1\cdots k}$ 建立哈夫曼树，然后按照上面的方法做，根据经典结论可知哈夫曼树子树大小之和也是 $O(sum\log sum)$ 级别的。

然后就没了，复杂度应该是 $O(n\log^2 n)$ 的，不太清楚可不可以单 $\log$ 。

## 代码

只写了 2k ，想要可以私信我。