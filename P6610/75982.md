先看题目要求$a^2+b^2\equiv x\  mod \ p$的解数,明显跟二次剩余有关,而二次剩余一般考虑的是奇素数,所以先考虑 $p$ 为奇素数的情况

当$x=0$时,要求的是$a^2\equiv -b^2$即$-b^2$在模$p$意义下时二次剩余,所以是$(-b^2)^{\frac{p-1}2}$不难发现当$ p\ \ mod\ \  4=1$ 时显然等于$1$,当$p\ \ mod \ \ 4=3$时显然为$-1$,
那么这一部分的答案就是 $2p$ 和 $0$ ,但其实有一点考虑错了,那就是$b=0$的情况,所以答案分别是$2p-1$和$0$

当$x!=0$时,考虑换元令$y=a^2,z=b^2$那么显然答案就是$\sum_{y+z \equiv x} (f(y)+1)(f(z)+1)$ ,其中$f(x)=x^{\frac{p-1}2}$
,
即当$x$为二次剩余时为$1$,否则为$-1$,特殊的当$x=0$时为 $0$ ,把原式展开可以得到

$$
\begin{aligned}
&\quad~ \sum f(y)f(z)+f(y)+f(z)+1 \\
&= \sum f(yz)+p\\
&= \sum f(y(x-y))+p \\
&=\sum f(\frac {x-y}y)+p\\
&=\sum f(\frac xy-1)+p
\end{aligned}
$$

这里用到了三个$f$ 的性质一个是$f(x)f(y)=f(xy)$ 第二个是$f(x)=f(\frac 1 x)$最后一个是$\sum f(x)=0$,第一二个显然,第三个是因为二次剩余只有 $\frac{p-1}2$个,不难发现$\frac xy-1$唯一取不到的值是$p-1$同样得到$p\ mod\ 4=1$和$p\ mod\ 4=3$,那么就解决了奇素数的情况

对于原题因为 $p$ 是若干奇素数的积,可以直接拆分成奇素数解决后乘起来,这可以用中国剩余定理证明
