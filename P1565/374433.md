Upd：修改了下公式

[题目传送门](/problem/P1565)

无需单调栈的 $\Theta(n^3)$ 做法。

首先问题通过枚举行转化为序列上选择尽可能长的区间，使得区间和大于 $0$。

我们来 $\Theta(n)$ 解决这个问题：

从左向右枚举右端点。记当前枚举到 $i$，且到此答案为 $p$。显然，要使答案更大，必须存在符合题意的、以 $i$ 为右端点的、长度大于 $p$ 的区间才行，否则我们可以跳过 $i$。这个判定问题等价于命题 $sum_i-(\min_{j=0}^{i-p} sum_j)\geq0$（$sum$ 为前缀和），这可以通过预处理 $\Theta(1)$ 求解。若该命题为真，我们令 $p\to p+1$，并重复这个过程，否则跳出 $i$ 的枚举。

因为 $p$ 单调，复杂度 $\Theta(n)$，总复杂度 $\Theta(n^3)$。