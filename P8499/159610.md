没进队选手有感而发，来写一篇题解。

关于有根树的同构，不难想到树哈希的做法，这样我们就可以以 $\mathcal{O}(\sum n_1)$ 的复杂度解决 $k=0$ 的数据点。

考虑继续拓展，当 $k>0$ 时，$G$ 树的点数可能多于 $H$ 树，由于两棵树的根固定，我们制定以下的模拟过程：从 $G$ 树的根和 $H$ 树的根节点开始，将所有儿子为根的子树拿出来，我们的目标就是找到一种匹配方案（可不关心删点的方案），删掉 $k$ 个点后配对所有子树，如果没有任何一种方案满足答案就是 ```No```，然后递归整个过程，直到找到满足要求的方案。

看起来不太容易实现，但是我们可以推一个性质来简化配对的过程和实现。

请思考一件事情：如果此时 $G$ 的两颗子树记为 $G_A$ 和 $G_B$ ，$H$ 的两棵子树记为 $H_A$ 和 $H_B$，那么在 $G_B$ 和 $H_B$ 同构的情况下，$G_A\rightarrow H_A$ 配对方案是否与 $G_A\rightarrow H_B,G_B\rightarrow H_A$ 配对方案等价？（在向下看之前，请先思考证明以上性质对模拟复杂度和实现造成了什么简化）

在删除的次数上看，$G_A\rightarrow H_A$ 删除的节点数为 $|G_A|-|H_A|$，$G_A\rightarrow H_B,G_B\rightarrow H_A$ 删除的节点数为 $|G_A|-|H_B|+|G_B|-|H_A|=|G_A|-|H_A|$，两种决策等价。

在可行性上看，如果 $G_A\rightarrow H_B,G_B\rightarrow H_A$ 有合法方案，那么 $G_A\rightarrow H_A$ 也一定有合法方案。（包含关系有传递性）

那么结论就是，两种决策等价。

最终在实现上，由上述的性质我们可以把已经匹配的子树扔掉，只看未匹配成功的子树，如果最终有解，那么必须保证当前层未匹配的子树数量不超过当前层可支持删除最多的节点数 $lim$，我们暴力枚举所有方案并继续递归检查，每一层的可删除节点数会越来越少，最终理论复杂度上界为 $\mathcal{O}(\sum n_1\cdot \prod\limits_{i=1}^k i!)$，经过合理的剪枝后可以通过。

但由于不排除 CCF 数据较弱把错解放过去的可能性，有错误的地方请大家及时指出。

