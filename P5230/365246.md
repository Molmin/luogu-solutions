主要记一下思路的来源，做法楼上 dalao 已经说的很清楚了。

问题可以是一个二维平面上有多少对不相交的矩形。

首先考虑简化版的一维问题，给定一些线段，问一个数轴上有多少对不相交的线段，有两种可行的做法。

* 做法1：枚举每个线段，假设这个线段的区间是 $[l,r]$ , 那么就要统计所有右端点在 $l$ 左边的线段和所有左端点在 $r$ 右边的线段。
	
    这样每对线段会被统计两次，除以二就行了。
    
    考虑把这个做法扩展到本题，枚举每一个矩形，用二维前缀和统计与他不相交的矩形的个数，这个在一般的题给出矩形个数限制是可以做的，但是这个题的特殊性，矩形上限可达 $n^4$ , 所以考虑另一种做法。
    
* 做法2：枚举一个端点，统计右端点为它的线段的个数*左端点在它右边的个数。
	
    这样每个线段只会被统计一次，再次考虑扩展到本题，（感谢同机房 dalao happyguy 讲解）

	枚举一个二维平面的点 $(x,y)$ ，统计以 $(x,y)$ 为右下角的所有矩形*左上角不在在 $(x,y)$ 左上方的矩形。
    
    注意我们统计的是不相交的矩形的个数，矩形相交有两种情况，一种是行不相交，一种是列不相交，一种是行列都不相交。
    
  >  ![](https://cdn.luogu.com.cn/upload/image_hosting/gu2n80j1.png)
    
    如图，紫色部分统计的是与黑色矩形 “列不相交“ 的矩形，蓝色部分统计的是与黑色矩形 “行不相交” 的矩形，红色是 “行列都不相交” 的矩形
    
    可以先枚举两行，两列计算出“列不相交“ 的矩形，“行不相交” 的矩形，然后在分两次枚举点（左上右下，左下右上）减去行列不相交的矩形。