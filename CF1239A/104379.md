来一种奇怪的找规律做法。

先写一份暴力：

```cpp
while (cin >> n >> m) {
	Ans = 0;
	ll Max = (1 << (n * m)) - 1;
	For ( S, 0, Max ) {
		For ( i, 1, n ) For ( j, 1, m ) 
			mp[i][j] = (S & (1 << (id(i, j) - 1))) > 0;
		Ans += Check();
	} wln(Ans);
} return 0;
```

然后打出一份表：

$$
(1, 1) \to 2,\ (1, 2) \to 4,\ (1, 3) \to 6,\ (1, 4) \to 10
$$
$$
(2, 1) \to 4,\ (2, 2) \to 6,\ (2, 3) \to 8,\ (2, 4) \to 12
$$
$$
(3, 1) \to 6,\ (3, 2) \to 8,\ (3, 3) \to 10,\ (3, 4) \to 14
$$

然后发现第一行是一个广义斐波那契数列，第二、三行差分一次之后就也是这个斐波那契数列了。
设 $f[1] = 2, f[2] = 4$ ，后面初始 $g[i][1] = f[i], g[i][2] = f[i] + 2$

然后有

$$
g[i][j] = g[i][j - 1] + f[j - 2] (j >= 3)
$$

把最后一行的结果搞出来即可。