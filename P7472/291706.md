# P7472 题解

考场上差点就做出来了，两个小小的 bug 能差不多让我 $100 \text{pts}$ 挂到差不多 $30 \sim 40\text{pts}$。

菜的真实

****

$\texttt{Update:}$ 修改了 $s1,s2$ 与文字定义与图片内容相反的错误。

## Description
给定一个 $n \times n$ 的二维格点图，$(i,j)$ 的格点图有 $a_{ij}$ 个豆子，一个吃豆人会以 $45\degree$ 斜角度不停地吃所经过的所有格子里的所有豆子。碰到边缘后吃豆人会 $90\degree$ 反弹到另一放向继续吃，以此类推。吃完豆子后格子里将不再有豆子。

有两个吃豆人，起点不定，问最多能吃到多少豆子。

## Solution
$n \leq 3$ 的数据肯定是送给暴搜的。  

$n \leq 100$ 的数据应该是送给优化过的暴搜的。

****

直接说正解。

因为只会碰到边缘后反弹，所以只要四边形的端点固定了整个路径就固定了。

因此我们可以想到利用这一性质快速求出一条路径的豆子和。

考虑维护 $↘$ 方向与 $↙$ 方向的豆子和，记为 $s2,s1$。

规定如下标号：

![](https://cdn.luogu.com.cn/upload/image_hosting/vgl2ouq1.png)

则以 $(x,y)$ 为端点（规定 $x>y$ 且 $y=1$）的路径权值和为 $s1[x]+s1[2 n-x]+s2[n-x+1]+s2[n+x-1]-(a[x][y]+a[y][x]+a[n-x+1][n-y+1]+a[n-y+1][n-x+1])$

~~手推一下即可~~

还有一个要注意的是如果路径是一条线的话要特判一下。

然后后面就没什么好说的了，直接暴力枚举两个端点开头，依次计算两个吃豆人的得分总和，并减去重复部分的格点内豆子数量即可。

复杂度 $\mathcal O(n^2)$。

因为这题数据 $1 \le n \leq 1000$，所以 $n^2$ 稳过。

但是这题细节很多：
1. $s1,s2$ 要开 $2n-1$ 的空间
2. 判断重复部分的时候要将线形路经和四边形路径特判一下

