~~热知识：`islower` 和 `isupper` 返回值原来不是 `bool`~~

### 题意

定义形如 `DDoS` 的字符串为由两个相同的大写字母、一个小写字母和一个大写字母组成的字符串。给定有英文字母和 `?` 组成的字符串，求有多少种填 `?` 的方式使得所得字符串种没有形如 `DDoS` 的子序列。

$n \le 3 \times 10^5$。

### 分析

“两个相同的大写字母”这个限制条件较强，但“一个大写字母”这个限制较弱，所以不妨将字符串翻转一下，让后做没有 `SoDD` 子序列的字符串数。

合法串大致上有 $3$ 类：

1. 只有大写字母；
2. 小写字母全在大写字母后面；
3. 第一个 `So` 后面不存在相同的两个大写字母。

前两种是好解决的，直接设 $dp_{i,0/1}$ 表示前 $i$ 位，有没有出现小写字母，转移是 trivial 的。第三种可以从后往前算，显然只用考虑 `?` 的计数，且如果出现两个确定的相同大写字母就寄了。

我们设当前在第 $i$ 位，$[i+1,n]$ 中 `?` 的数量为 $q$，大写字母出现的集合为 $S$；我们不妨枚举有 $v$ 个 `?` 填大写字母，显然 $v \le 26 - |S|$，那剩下 $q - v$ 个就随便填小写字母，方案数 $26^{q - v}\dbinom{q}{v}(26 - |S|)^{\underline{v}}$。

复杂度 $\mathcal O(kn)$，其中 $k=\max(n,26)$。

### Code

提交记录：<https://atcoder.jp/contests/abc301/submissions/43498631>。