[$\tt Link$](/problem/P6779)

## 前言

期中考非常的摆烂，但是我又来写题了！

题意：区间编号跳父亲，区间最小带权深度询问。

以下称 $i$ 为一个 **位置**，$a_i$ 为一个 **点**，块长为 $B$，块数为 $C$。

## 思路

可以联想到另一道题 [$\tt rfplca$](/problem/P7446)。虽然这俩题几乎不像，但是我们依然可以想到两点：

+ **对位置序列分块**
+ **从全局的角度去考虑复杂度**

我们把位置序列分块，维护每个块的答案，把修改和询问都分成整块和散块两种来考虑。

注意到一个重要性质：**因为边权非负，所以儿子的权值一定比祖先的权值大，此时这个儿子就对于查询没用了。**

## 修改

对于一个块，我们可以维护出里面所有有用的位置，然后在整块修改时动态删除。**注意**，因为所有位置总共指向的点的总数是 $n$ 个（因为如果有两个位置指向同一个点，那么其中一个会变没用），所以总复杂度是 $O(C\times n)=O(n\sqrt n)$。

但是对于散块修改，可能让一些没用的点重新有用。于是你仍然在维护位置的数据结构上插入回去就好了，这部分可以考虑用一个队列维护。

那跳父亲呢？可以考虑对当前队列里的位置直接跳，但有些位置没用了，不必跳，却会被散块修改/散块查询用到，怎么办？考虑维护 `S` 代表一个块要跳几次，`V[]` 代表每个位置已经跳了多少次，这样如果在散块修改里你就直接变成了一个跳 `S-V[i]` 级祖先，然后跳完更新 `V[]` 就行了。

跳可以用重剖，原因是分析一条重链对复杂度产生的影响。

## 询问

我们要记录每个块的答案，如果是整块直接用答案取 $\min$。

散块就暴力，给每个点跳 `S-V[i]` 级祖先，然后取 $\min$

## 实现

因为这题卡根号空间，所以你需要离线做到线性空间。

[$\tt code$](https://www.luogu.com.cn/paste/1jr5621i)