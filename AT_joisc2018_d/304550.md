upd: 之前求极限的地方写错了所以重写了一下。

问题可以转化为，恰好有 $k$ 个整数 $i$ 满足 $1\le i < n$ 使得 $p_i > p_{i + 1}$。

因为你每分一个段就是出现一个 $p_i > p_{i + 1}$，这个很好理解。

然后恰好是不好算的，我们转成至多，然后差分一下就行。

这个可以映射为 $n$ 个取值为 $[0, 1]$ 之间的实数的离散型随机变量。

因为我们知道，这 $n$ 个随机变量取值相等的概率是 $0$，而排列中元素取值相等的概率也是 $0$，所以这是一一对应的。

把这 $n$ 个随机变量丢到一个长度为 $1$ 的环上。

然后从 $0$ 走到 $p_1$，再从 $p_1$ 走到 $p_2$，一直走到 $p_n$。

我们记第 $i$ 次的步长为 $a_i$。

于是问题可以转化为求 $\sum a_i \le k + 1$ 的概率（这个上界取极端情况就能卡出来）。

但是这里是实数，或者说是连续的啊，我们不会算（~~其实我们可以积分~~），怎么办呢！

注意到实数的取值是无限的，所以如果我们令随机变量的取值变为 $[0, +\infty)\cap\mathbb{N}$ 也是没有问题的。

那么我们就只需要考虑整数域，也就是离散的情况，这是我们熟悉的。

我们先考虑一个 $[0, V]\cap \mathbb{N}$ 的情况，之后取个极限就行。

问题转化为求 $\sum a_i \le V(k + 1), a_i \in [0, V]\cap \mathbb{N}$ 的概率。

这是经典容斥，钦定有 $i$ 个不满足 $a_i \in [0, V]$，其它不管。

然后这里要算的就是恰好，这部分就是选 $i$ 个出来，然后插板法。

相当于是，你强制有 $i$ 个段已经有 $V$，然后这 $n$ 个段至少都要有一个，问和不大于 $V(k + 1)$ 的方案数。

正常插板法是等于，这里是不大于，所以我们新增一个段然后不够的放在里面就行了！

那么答案是：

$$
\begin{aligned}
&= \dfrac{1}{(V + 1)^n} \sum\limits_{i = 0}^{n} (-1)^i \dbinom{n}{i}\dbinom{V(k + 1) - iV - 1}{n} \\
&= \dfrac{1}{(V + 1)^n} \sum\limits_{i = 0}^{n} (-1)^i \dbinom{n}{i}\dbinom{V(k + 1 - i) - 1}{n} \\
&= \dfrac{1}{(V + 1)^n} \sum\limits_{i = 0}^{n} (-1)^i \dbinom{n}{i}\dfrac{(V(k + 1 - i) - 1)^{\underline{n}}}{n!}
\end{aligned}
$$

然后求个极限：

$$
\begin{aligned}
ans &= \lim\limits_{V \to +\infty} \dfrac{1}{(V + 1)^n} \sum\limits_{i = 0}^{n} (-1)^i \dbinom{n}{i}\dfrac{(V(k + 1 - i) - 1)^{\underline{n}}}{n!} \\
&= \dfrac{1}{n!}\sum\limits_{i = 0}^n(-1)^i\dbinom{n}{i}(k + 1 - i)^n
\end{aligned}
$$

具体细节大概是，我们知道 $\lim\limits_{V\to \infty}\dfrac{V^{\underline{n}}}{V^n} = 1$，然后我们把前面的 $\dfrac{1}{(V+1)^n}$ 扔进 $\sum$ 里，把后面那坨下降幂拆一个 $(V+1)^{\underline{n}}$ 出来凑出 $1$ 就行。

不过你注意到，第一步里面最后一个组合数的部分，上面的部分如果按照 $i \in [0, n]$ 枚举是有可能无意义的，为了优美一点，把 $n$ 偷换成 $k$，然后就得到了式子：

$$
\begin{aligned}
ans &= \dfrac{1}{n!}\sum\limits_{i = 0}^k(-1)^i\dbinom{n}{i}(k + 1 - i)^n
\end{aligned}
$$

然后就做完了，很趣味！
