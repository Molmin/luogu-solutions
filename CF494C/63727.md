考虑区间不交错的用处，一个区间向ta完全包含的区间连边，可以构成一棵树。

然后区间又只有5000个，搞一个$n^2$的树形dp多好

考虑求出每个最大值的概率。

令$dp_{i,j}$代表区间$i$最大值不大于$j+\max_{l\le i\le r}a_i$的概率，这样等于的概率只需要$dp_{i,j}-dp_{i,j-1}$就可以得到了

转移
$$dp_{i,j}=p_i\prod_sdp_{s,j+\max_i-\max_v-1}+(1-p_i)\prod_sdp_{s,j+\max_i-\max_v}$$
注意上下边界。