~~半年前被这道题卡到自闭……~~

感谢草稿纸的大力支援

------------

# [P5249[LnOI2019]加特林轮盘赌](https://www.luogu.org/problem/P5249) 题解

这篇题解主要是详细说明一下楼顶[诗乃的题解](https://www.luogu.org/blog/shoko/solution-p5249)

## 方程并非一定列为和为1，其实也可以用代入法

再讲一遍思路，顺便演示一下手动消元

题目让我们求n个 长脖子鹿 中第m个 长脖子鹿 唯一存活的概率，于是我们想到了dp

设现在开枪的这个 长脖子鹿 是第1个长脖子鹿 ，接下来是第2个，以此类推

设dp(i,j)为还有i个人时第j个 长脖子鹿 最终唯一存活的概率（满足i>=j)

那么dp(1,1)一定为1

我们要求的是答案是dp(n,m)

对于每一个dp(i,j)有两种情况：

### 第一种：j=1

现在“自杀”的是我们“关注”的长脖子鹿

ta不能死！~~蜜汁感性~~ 即ta必须不中枪，不中枪的概率为（ 1-P0 )

那么不中枪后ta变成了第i个人，一共有i个人，我们要求的是dp(i,i)

### 所以dp(i,1)=( 1-P0 )*dp(i,i)

---

### 第二种：2<=j<=i

现在“自杀”的长脖子鹿死不死都没什么关系了

不管那个自杀的死没死，我们关注的ta都会从**第j个**变成**第j-1个**

如果死了，人数为i-1，我们要求的是dp(i-1,j-1)

反之，人数仍为i，我们要求的是dp(i,j-1)

由于中枪概率是P0，不中枪概率是( 1-P0 )

### 所以dp(i,j)=P0 * dp(i-1,j-1) + ( 1-P0 ) * dp(i,j-1)

---

总结一下

### 当j==1

### dp(i,1)=( 1-P0 ) * dp(i,i)

### 否则

### dp(i,j)=P0 * dp(i-1,j-1) + ( 1-P0 ) * dp(i,j-1)

于是

```
 dp(i,1)
 
=(1-P0)*dp(i,i)

=(1-P0)*(P0*dp(i-1,i-1)+(1-P0)*dp(i,i-1))

=(1-P0)*(P0*dp(i-1,i-1)+(1-P0)*(P0*dp(i-1,i-2)+(1-P0)*dp(i,i-2)))

=(1-P0)*(P0*dp(i-1,j-1)+(1-P0)*……*（P0*dp(i-1,1)+(1-P0)*dp(i,1)

```

拆项得：

```
 dp(i,1）

=P0*[
	dp(i-1,i-1)*(1-P0)^1
	+dp(i-1,i-1)*(1-P0)^2
	+……
	+dp(i-1,1)*(1-P0)^(i-1)
    ]
+dp(i,1)*(1-P0)^i

（"^"指幂运算）

```

当n很大时，每次算（1-P0)^x 不可能用快速幂

所以我们在计算之前要预处理（1-P0)的1~n 次方

于是dp(i,1)=P0*(中间那一大坨）/（1-（1-P0)^i)

求出dp(i,1),dp(i,2)~dp(i,n)也很容易算出来了

注意求第i行的时候，第i-1行已经求出来了，所以中间那一大坨不要再拆开了！

记得P0=0时要特判，而且要用滚动数组存

贴代码：

```cpp
#include<bits/stdc++.h>
using namespace std;
double mi[10010];
double dp[2][10010];//滚动数组
int main(){
	int n,m;
	double k;
	cin>>k>>n>>m;//k是P0
	if(k==0){//特判
		if(n==1)cout<<1<<endl;
		else cout<<0<<endl;
		return 0;
	}
	mi[0]=1;
	for(int i=1;i<=n;i++){
		mi[i]=mi[i-1]*(1.0-k);
	}
	dp[0][1]=1;
	for(int i=2;i<=n;i++){
		double sum=0;
		for(int j=2;j<=i;j++){
			sum+=(dp[0][j-1]*mi[i-j+1]);//如刚才描述
		}
		dp[1][1]=k*sum/(1.0-mi[i]);//求dp(i,1)
		for(int j=2;j<=i;j++){
			dp[1][j]=dp[1][j-1]*(1.0-k)+dp[0][j-1]*k;
		}
		for(int j=1;j<=i;j++){
			dp[0][j]=dp[1][j];
		}
	}
	printf("%0.8lf\n",dp[0][m]);
	return 0;
}
```

安利一下blog

# [点这里！](https://www.luogu.org/blog/xiaduowenboke/)