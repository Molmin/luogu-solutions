**这篇题解用的确实都是已有的解法，但是它对已有的两种解法进行了梳理，帮助读者比较两者在两方面上的优劣**

---

简单梳理一下这道题可以用的两种方法  

首先基础是：**dfs序+区间数据结构(线段树，树状数组)**

## 1. 树链剖分（对于每个节点考虑“从哪里来”）
对于每个点，查询从这个节点到根节点经过了多少个有奶牛的点，作为其 $ans$  
可以处理一个点就输出这个点的 $ans$  
因此需要 **树链剖分**   
时间复杂度：$n$ 个节点 $\times$ 树链剖分的 $\log n$ 段链 $\times$ 区间查询(区间加)的 $\log n$，总时间复杂度 $O(n \log^2 n)$  

优点是可以**在线查询**  
缺点是**时间复杂度较大，常数相对较大**，不过足已通过本题  

代码: [传送门](https://gitee.com/hkxa/mycode/blob/master/luogu/P2982.cpp)

## 2. dfs 序（对于每个节点考虑“到哪里去”）
对于每个点，使其所有子树的 $ans = ans + 1$  
最后处理完每个点后再输出每个点的 $ans$  
不需要 **树链剖分**，仅需要 **dfs序**  
时间复杂度：$n$ 个节点 $\times$ 区间查询(区间加)的 $\log n$，总时间复杂度 $O(n \log n)$  

优点是**时间复杂度较小，常数相对较小**，可以应对时间卡的比较严格的题目   
缺点是不可以**在线查询** 

这种代码就不贴了，大部分题解都是这种