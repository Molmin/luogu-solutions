左移，右移，一些位置上增量，这些信息难以直接维护，这启发我们把操作序列更加形式化，也就是把这些操作附加在一个更容易维护的对象上，形式幂级数 / hash 在本题中是很好的选择。

令 $F = \sum_i A_i x^i$，$F_i$ 为执行操作 $1∼i$ 后 $F$ 的值。

现在考虑求执行操作 $l∼r$ 后的 $F$，这需要 $p_i$ 表示执行操作 $1∼i$ 后指针的位置。

此时 $F$ 的值等于$\frac{F_R - F_{l-1}}{x^{p_{l-1}}}$，给 $x$ 赋一个任意值，枚举 $l$，利用 $\text{map}$ 求出满足条件的 $r$ 即可。