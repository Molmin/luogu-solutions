这里提供一种比较好理解的证明方法  
令$f[i]$表示$v$=i的时候有多少组方案  
将$i$用二进制表示  
如果i是奇数，那应该是XXXXXX1的形式,而前面那一串为$\lfloor \frac{i}{2}\rfloor$,设其为k,即$i=2k+1$  
可以发现，对于任意符合$a+b=2k+1$,$a \ xor \ b=v$  
1.a为奇，b为偶  
$$
\frac{a}{2}+\frac{b}{2}=k 
$$
$$
\frac{a}{2} \ xor \ \frac{b}{2}=\frac{v}{2}
$$
2.a为偶，b为奇  
$$
\frac{a}{2}+\frac{b}{2}=k 
$$
$$
\frac{a}{2} \ xor \ \frac{b}{2}=\frac{v}{2}
$$  
可以发现两种情况是一样的，也就是对于任意的$k$所对应的$v_k$,将其乘2加1之后都可以于$2k+1$组成合法方案  
所以$f[2k+1]=f[k]$  
第二种情况,$i=2k$  
1.a为偶，b为偶  
$$
\frac{a}{2}+\frac{b}{2}=k 
$$
$$
\frac{a}{2} \ xor \ \frac{b}{2}=\frac{v}{2}
$$  

2.a为奇，b为奇
$$
\frac{a}{2}+\frac{b}{2}=k-1 
$$
$$
\frac{a}{2} \ xor \ \frac{b}{2}=\frac{v}{2}
$$  
所以$f[2k]=f[k]+f[k-1]$  
这个时候已经可以做到$O(n)$求出答案了  
接下来是推柿子time  
$$
sum[2k]=sum[2(k-1)]+f[k]+2f[k-1]=...\\ 
=f[k]+3f[k-1]+..+3f[2]+3f[1]+3f[0]=sum[k]+2sum[k-1]
$$  
然后奇数的情况  
$$
sum[2k+1]=sum[2k]+f[2k+1]=sum[2k]+f[k]=2sum[k]+sum[k-1]
$$  
所以只要递归下去做就可以了  
但是要加上记忆化，否则复杂度是错的  
至于复杂度的证明，可以发现每次递归会产生一个$sum[k],sum[k+1]$  
然而$k$和$k+1$除以二的整数部分都是一样的,所以对于$k$和$k+1$递归要求的东西都是一样的(如果没看懂可以自己随便用一个数字推一下)  
复杂度$O(2logn)$