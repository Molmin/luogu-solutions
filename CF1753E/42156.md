注意有意义的 \* 操作至多 30 个，而且只要移动 \* 操作就一定移到末尾，移动 + 操作一定移到开头。考虑枚举哪些 \* 操作移动，注意到若两个 \* 操作 $i,j$ 满足 $i<j$ 且 $x_i>x_j$，那移动 $j$ 一定不如移动 $i$。可以发现，加上这个剪枝后只剩下不到 $10000$ 种情况，设情况数为 $m$。

枚举移动 \* 操作后，移动第 $i$ 个 + 操作的收益是 $(allprod-sufprod_i)\times a_i$，$allprod$ 是所有 \* 操作的乘积，$sufprod$ 是后缀积。若还可以移动 $K$ 个 + 操作，肯定选取收益最大的 $K$ 个来移动。因此我们就是要求上式前 $K$ 大的和。可以二分第 $K$ 大的值，并在每个全是 + 的段里 lower_bound 检验。

时间复杂度 $O(n\log n+m\log^2 V\log n)$，代码：https://codeforces.com/contest/1753/submission/178754863