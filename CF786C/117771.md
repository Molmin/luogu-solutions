首先有一个很明显 $O(n)$ 对一个 $k$ 求答案的方法：

> 贪心的，我们依次将这些数加入当前组，如果加入后不同数的个数 $>k$，那就新开一组并把这个数加进去。

如果这样一个一个求，那么复杂度是 $O(n^2)$ 的。

很明显，答案不超过 $\left\lceil \frac{n}{k} \right\rceil$ ，所以我们根号分治。

* 对于 $k \in [1,\sqrt{n \log n})$，一个一个求。

* 对于 $k \in [\sqrt{n \log n},n]$，答案不超过 $\sqrt{\frac{n}{\log n}}$ ，枚举答案，二分取到这个答案的范围。

（因为答案明显满足单调性，所以可以二分。

总复杂度 $O(n \sqrt{n \log n})$。