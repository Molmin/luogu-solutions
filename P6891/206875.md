## [JOISC2020] ビルの飾り付け 4

### Description

给定长度为 $2n$ 的序列 $A,B$，要求构造序列 $C$ 使得：

+ $C_i$ 从 $A_i,B_i$ 中选取。
+ 恰好有 $n$ 个位置是从 $A$ 中选取的。

### Analysis

为啥题解都说打表，没什么人证这个结论……感觉挺自然的啊。

显然的 DP 是 $f_{i,j,0/1}$ 表示前 $i$ 个中选出 $j$ 个 A，最后一位为 A/B 是否合法。复杂度 $\mathcal O(n^2)$。

考虑 DP 优化常用技巧：调换定义域和值域，用 $f_{i,0/1,0/1}$ 表示 $\{j\mid f_{i,j,0/1}=0/1\}$。由于互为补集，所以只需考虑 $f_{i,0/1,1}$ 即可。

转移可以表示成 $f_{i,*}\gets f_{i-1, 0} \cup f_{i-1, 1}$ 的形式，可能会整体加上 $1$。
考察 $f_{i, 0}$ 和 $f_{i, 1}$ 的关系，可以发现，$f_{i,0}$ 和 $\{j\mid j+1\in f_{i,1}\}$ 是包含关系。这是因为 $A_i, B_i$ 中较大数能转移的状态一定包含了较小的数能转移到的状态。

注意到此时如果 $f_{i-1,0/1}$ 都为连续区间，那么由于上述结论，显然它们的并也是连续区间，而初始区间为 $\{0\}$ 和 $\{1\}$，因此归纳可证 $f_{i,0/1}$ 是一段连续区间，所以可以做到 $\mathcal O(n)$。