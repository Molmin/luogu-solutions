为了方便，以下讨论均认为矩形是由方格 cell 构成的，而非原题中的 points。（How can a cell mean a point?）

由于需要求出长、宽，直接询问一次所有点就能得出面积。有了面积和长就能求出宽。考虑三次询问确定长。

接下来就有很奇怪的做法。假设面积是 $h\times w$。注意到假如询问所有横坐标是 $d$ 的倍数的点，当且仅当 $d|h$ 时返回值恰好是 $hw/d$，其它情况下一定不是（返回值设为 $f(d)$）。考虑 generalize 这种情况：考虑询问 **2 的幂次**，假设已知 $d=2^k$ 是 $h$ 最大的 2 的幂次（$2^k|h,2^{k+1}\nmid h$），则 $f(2^k)=hw/2^k$，$f(2^{k+1})=[floor/ceil](h/2^{k+1})w=(h\pm 2^k)/(2^{k+1})w$。由此可以消去 $h$ 解出 $w$（求出差的绝对值），即得答案。

为什么就要询问 2 的幂次？这并不是凭空创造，而是基于 **模 2 意义下只要不整除，余数就是确定的（i.e. =1）**。这直接导致上面的 floor 函数返回值几乎是确定的，从而使我们能直接算出其中的量。

考虑二分查找求出 $k$，注意到 $k\in [1,7]$，需要 $\log_2 k=3$ 次询问，还要一次问 $k+1$，似乎超限了。但考虑二分查找的过程：

- 询问 $4$。得到 $f(4)$。
  - 如果可以：询问 $6$，得到 $f(6)$。
    - 如果可以：询问 $7$，得到 $f(7)$。
    - 否则：询问 $5$，得到 $f(5)$。
  - 否则：询问 $2$，得到 $f(2)$。
    - 如果可以：询问 $3$，得到 $f(3)$。
    - 否则：询问 $1$，得到 $f(1)$。

考察问出答案 $k$ 时手上有的东西：

0. $1,2,4$
1. $1,2,4$
2. $2,3,4$
3. $2,3,4$
4. $4,5,6$
5. $4,5,6$
6. $4,6,7$
7. $4,6,7$

发现除了 $7$ 之外，其它情况下我们都已经问过 $k+1$ 了。而 $k=7$ 时，$f(2^8)$ 又必定是 0。因此确实只需要 3 次询问。

---

另解：考虑先问出面积。可以发现，面积 -> 周长至多有 $26$ 种可能。

设 $f(x,y)$ 表示询问所有 $x$ 的倍数作为横坐标、$y$ 的倍数作为纵坐标的点得到的答案。考虑每次询问使得候选集合减小最小值最大的 $(x,y)$。

由于各种原因，这样是可以通过的。