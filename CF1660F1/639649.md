为了方便下面令减号为 $0$，加号为 $1$。

考虑如何判断一个区间合法。

发现操作一次之后 $0$ 的个数会减少 $2$，$1$ 的个数会增加 $1$，变化量为 $3$。

同时还要有足够的操作次数使得 $0$ 和 $1$ 的个数相等。

因此一个区间合法有如下条件：

- $0$ 的数量不少于 $1$ 的数量。

- $0$ 与 $1$ 的数量之差是 $3$ 的倍数。

- $0$ 与 $1$ 的数量之差除以 $3$ 不多于不交的 $00$ 数量。

可以 $O(n)$ 预处理出前缀 $0/1$ 数量，前缀不交的 $00$ 数量。

因为 $n \leq 3000$ 所以可以 $O(n^2)$ 枚举所有区间然后 $O(1)$ 判断。

[Code](https://www.luogu.com.cn/paste/ajyo01az)