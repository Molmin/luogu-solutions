
## 题目描述

有一个 $3 \times m$ 的田野，一开始你在 $(2, 1)$ 位置。

如果你在 $(i,j)$ 位置，在不出界的前提下，可以走到 $(i+1,j),(i+1,j\pm 1)$。

有 $n$ 段障碍，障碍不能走。每段障碍都有 $3$ 个参数 $a_i,l_i,r_i$，表示这段障碍在第 $a_i$ 行，且左右端点分别为 $l_i$ 和 $r_i$。具体地，对于所有的 $l_i \le j \le r_i$，田野的 $(a_i, j)$ 上有障碍。

询问从 $(2, 1)$ 到达 $(2, m)$ 的方案数，答案对 $10^9 + 7$ 取模。

$1 \le n \le 10^4,\ 3 \le m \le 10^{18}$

## 分析

首先考虑没有障碍的情况。易得递推式：$f_{1, i} = f_{1, i - 1} + f_{2, i - 1},\ f_{2, i} = f_{1, i - 1} + f_{2, i - 1} + f_{3, i - 1},\ f_{3, i} = f_{2, i - 1} + f_{3, i - 1}$。

由于 $m$ 过大，所以可以矩阵加速。两个矩阵分别是这个样子：
$$
A = \begin{bmatrix} f_{1, i} & f_{2, i} & f_{3, i}\end{bmatrix},\ B = \begin{bmatrix} 1 & 1 & 0\\ 1 & 1 & 1\\ 0 & 1 & 1\end{bmatrix}
$$
所以没有障碍的答案应该为 $\begin{bmatrix} 0 & 1 & 0\end{bmatrix} \times \begin{bmatrix} 1 & 1 & 0\\ 1 & 1 & 1\\ 0 & 1 & 1\end{bmatrix} ^ {m - 1}$ 这个矩阵的 $(1, 2)$ 项。

但是有了障碍题目就变得复杂了。由于数据范围过大，所以首先将障碍物的位置离散化。 然后统计出差分数组。

接下来对于每一段连续的障碍物状态相同的列分别计算。如果在这些连续的列中的第 $x$ 行上有障碍物，那么就把 $B$ 矩阵的第 $x$ 行全部变成 $0$。这样处理完后再进行矩阵快速幂就没有问题了。

剩下的是一些代码细节：离散化的过程为 `sort` + `unique` + `lower_bound`，差分后需要统计一个前缀和数组，矩阵乘法和快速幂可以写成函数方便代码。

[$\text{Code}$](https://codeforces.com/contest/954/submission/207296442)