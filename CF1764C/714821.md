一个显然的观察是选两个相同的点肯定是不优的。因为如果加入这条边则这两个点无法连接别的任何点。

于是对于每个点，要么大于其全部邻居的点权，要么小于其全部邻居的点权。

然后将点按照大于或小于邻居分为两类，则显然每条边连接的是不同类型的点，否则两个点互相大于或小于，矛盾。

所以对于一个合法的方案，一定存在一个值，使得一部分点按照是否大于这个值分类之后将两类之间连边即可。

因为如果一个点 $ u $ 属于第一类，一个点 $ v $ 属于第二类，则 $ a_u \geq a_v $，否则交换这两个点答案不会更劣。

于是枚举这个分界点，然后将小于等于这个点的点个数乘大于这个点的点个数取最大值即可。

注意一种特殊情况：所有的点点权相同，每个点最多连接一条边，答案显然为 $ \lfloor \frac{n}{2} \rfloor $。