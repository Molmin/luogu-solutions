首先，可以把对答案没有影响的立方因子全部筛掉。

剩下的数可以被表示成 $a^2\times b$ 的形式。这里，$b$ 不含平方因子。

显然的，这里的 $\min\{a,b\}\leq a_i^{\frac{1}{3}}$。其中，记 $a_i$ 为 $s_i$ 筛掉立方因子后的结果。

在代码中，我们可以枚举 $j=1\sim a_i^{\frac{1}{3}}$ ，对于 $j$ 作为 $a$ 或 $b$ 分开讨论，其中，若 $a_i\not = 1$，最后只要满足求出的 $a$ 最大，就可以保证 $b$ 中不含平方因子，因为若 $b$ 中含平方因子，都可以有一种方案，使得 $a$ 比原来的更大。

对于每一个 $a_i$ 所代表的数对 $(a,b)$，只有数对 $(b,a)$ 会与之冲突。

所以我们可以用 map 统计每个数对出现的次数，最后答案累加上 $\max\{cnt_{(a,b)},cnt_{(b,a)}\}$ 即可。

记得 $a=b=1$ 的情况要分开讨论。

[Code](https://atcoder.jp/contests/agc003/submissions/37924814)