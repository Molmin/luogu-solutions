It's all MAGIC![](//图.tk/7)

这种题目一般先考虑局面要满足什么条件能必胜，然后根据这个性质来计数。

如果把黑板上的数写成一个集合 $S$，那么：

- $\varnothing$ 为必胜态，$\{1\}, \{2\}$ 显然为必败态，打表发现其他单元素集合都为必胜态；
- 如果 $\exists x \in S, x \bmod 2 = 1$，$S$ 为必胜态，因为可以选择模 $2$ 使 $S$ 变为 $\{1\}$；
- 如果 $\forall x \in S, 2 \mid x$，且 $\exists x \in S, x \bmod 4 = 2$，$S$ 为必胜态，因为可以选择模 $4$ 使 $S$ 变为 $\{2\}$；
- 如果 $\forall x \in S, 4 \mid x$，考虑选择模 $3$：
	- 如果 $S$ 变为 $\{1\}$ 或 $\{2\}$，那么 $S$ 为必胜态。
    - 否则 $S$ 在模 $12$ 意义下为 $\{4, 8\}$，打表发现 $\{4, 8\}$ 为必败态。如果 $S$ 不为 $\{4, 8\}$，考虑选择模 $12$，那么 $S$ 为必胜态。

以上我们讨论了 $\exists x \in S, 12 \nmid x$ 的情况。还剩下 $\forall x \in S, 12 \mid x$ 的情况。这时候我们发现讨论起来有些复杂了。

接下来就是这题真正 MAGIC 的地方了！**发现 $a_i \le 200$，意味着若 $\forall x \in S, 12 \mid x$，那么 $|S| \le \left\lfloor\frac{200}{12}\right\rfloor = 16$。考虑暴力状压，暴力转移，这样能求出每一个 $S$ 是必胜态还是必败态。这部分时间复杂度 $O(2^{16} \times 200 \times 16)$，可以接受。**

接下来就是计数了。

- 对于 $\exists x \in S, 12 \nmid x$ 的情况，只有 $\{1\}, \{2\}, \{4, 8\}$ 为必败态。容斥，总方案数减去必败态方案数即可。
- 对于 $\forall x \in S, 12 \mid x$ 的情况，也是暴力状压，枚举每位填什么数。

总时间复杂度 $O(2^{16} \times 200 \times 16)$。

[code](https://atcoder.jp/contests/arc134/submissions/41214903)