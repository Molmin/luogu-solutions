PS：这个题解只是翻译一下官方题解给出的结论的证明，关于容斥的部分略去。

如果存在 $k_i=j-1,l_j=i$ ，那么把它换成 $k_i=j,l_j=i-1$ 显然方格里的数不变。

我们记不存在 $k_i=j-1,l_j=i$ 的方案为 $\text{regular~expression}$，可以证明两种不同的 $\text{regular~expression}$ 对应的网格不同构，证明如下：

假设两个 $\text{regular~expression}$ 分别为 $k_1,k_2,...,k_N,l_1,l_2,...,l_M$ 和 $k'_1,k'_2,...,k'_N,l'_1,l'_2,...,l'_M$，它们对应的网格同构，尝试推出矛盾：
- 找到最小的 $j$，使得 $l_j\neq l_j'$，不妨令 $l_j<l'_j$，并记 $r=l'_j$
- 因为两个网格同构，必然有 $k_r\ge j,~k'_r<j$，这样这个位置才能同时为 1
- 如果 $j=1$，那么 $k'_r=0$，这与它是 $\text{regular~expression}$ 矛盾。
- 如果 $j>1$，那么 $k'_r<j-1$，而 $k_r\ge j,l_{j-1}=l'_{j-1}$，推出两个网格$(r,j-1)$的位置不相等，矛盾。

所以就只需要统计不存在 $k_i=j-1,l_j=i$ 的方案了。