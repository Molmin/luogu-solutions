采菜别踩菜 $\to$ [`George1123`](https://www.cnblogs.com/George1123/p/14242261.html#cf375e-red-and-black-tree)

---

> [luogu](https://www.luogu.com.cn/problem/CF375E)

多好的问题啊，感觉最近还是要多自己思考，别打完比赛就盲目贺题。

听说有个什么单纯形的线性规划，我永远不会学它的！

设 $f(u,i,t)$ 表示在节点 $u$ 的子树中有 $i$ 个点必须是黑点（其他点也可以是黑点的），然后用 $t$ 这个节点解决 $u$ 需要满足的条件的最小代价（相当于转化问题：从交换颜色，变成固定每个颜色数量，然后求出最少交换代价）。

然后考虑怎么转移，如果子树状态是 $f(v,j,a)$ 要合并上来：

1. 如果 $a=t$，那么 $f(u,i+j,t)\leftarrow\min  f(u,i,t)+f(v,j,t)$（为什么不是 $i+j-1$ 啊？可能是您没理解这个 `dp`）：
      1. 如果 $t$ 在 $v$ 和 $u$ 的子树外，那么它们都不需要统计这个黑点。
      2. 如果 $t$ 在之前 $u$ 的子树内，那么这个黑点算在 $i$ 中不算在 $j$ 中。
      3. 如果 $t$ 在 $v$ 的子树内，这个黑点算在 $j$ 中不算在 $i$ 中。

2. 如果 $a\neq t$，易证：只有 $a$ 在 $v$ 子树中且 $t$ 在 $v$ 子树外是优化的：

      1. 如果 $a$ 在 $v$ 子树外，那么 $u$ 比 $v$ 离 $a$ 更近，所以应该 $t=a$。
      2. 如果 $t$ 在 $v$ 子树内，那么 $v$ 比 $u$ 离 $t$ 更近，所以应该 $a=t$。

- 然后合并完后是 $f(u,i+j,t)$（要求 $t$ 在 $v$ 子树外），直接找到对于每个 $v$ 子树内的 $a$ 最小的 $f(v,j,a)$ 即可转移。

然后再想想该怎么初始化：

1. 首先先把所有 `dp` 值赋为 $+\infty$。

2. 对于节点 $u$，初始化 $f(u,1,u)=1-col_u$。

3. 对于节点 $u$ 和满足 $dis(u,v)\le x$ 的 $v(v\neq u)$，初始化 $f(u,0,v)=0$。

然后答案就是所有 $i\le $ 原来黑点数量的 $f({\rm root},i,t)$ 最小值。

[aclink](https://codeforces.com/contest/375/submission/103522153)，要用 `short` 卡空间。