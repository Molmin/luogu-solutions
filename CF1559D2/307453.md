> 给定两个森林 $G_1=(V,E_1)$ 和 $G_2=(V,E_2)$，点数均为 $n$，边数分别为 $m_1,m_2$。
>
> 每次可以选择两个点 $u,v\in V$，如果：
>
> -  $(u,v)\not\in E_1$ 且 $(u,v)\not\in E_2$
> - 连上边 $(u,v)$ 后， $G_1,G_2$ 均仍为森林
>
> 那么就可以把它们连上，求能连上的边数的最大值。要求输出方案。
>
> Easy version: $m_1,m_2\le n\le 1000$
>
> Hard version: $m_1,m_2\le n\le 2\times10^5$

很有趣的题。

首先我们注意到如果此时能连上一条边 $(u,v)$ ，那么把它们连上必然不会使答案变差。

因此对于 Easy version 我们就只需要暴力 $O(n^2)$ 枚举 $u$ 和 $v$，不断加边加边加边，然后加边的时候并查集查询就可以了。

这个复杂度是 $O(n^2\log n)$ 的，$\log $ 来自并查集。

对于 Hard version，我们考虑先令 $u=1$，然后连上尽可能多的边。不过这样连完之后还会剩下一些边。

这样连完之后两个图内就都会有一个 $1$ 附近的很大的连通块，和一些其他的不和 $1$ 连通的点。

我们考虑 $G_1$ 中的一个不和 $1$ 联通的点 $x$ 与 $G_2$ 中不和 $1$ 联通的点 $y$，那么我们注意到一个重要的性质：

> 如果 $G_2$ 中的 $x$ 也不和 $1$ 联通，那么我们就可以连一条边 $(1,x)$，但是这条边在之前的过程中已经连过了。
>
> 所以对于点 $x$，必然是它在 $G_1$ 中和 $1$ 不连通，在 $G_2$ 中和 $1$ 连通。

对于 $y$ 也同理。

接下来我们考虑连一条边 $(x,y)$。

我们发现，由于 $G_1$ 中 $y$ 必然在 $1$ 附近的连通块内，而 $x$ 不在，因此连上 $(x,y)$ 后，$G_1$ 中不会出现环，所以仍然是森林。

对于 $G_2$ 也同理。由此，连接 $(x,y)$ 是一个可行解，由 Easy version 它也一定是最优解。

那么我们在做完第一步之后，只需要处理出 $G_1,G_2$ 中不和 $1$ 联通的两个点集，然后取较小的那个与较大的那个随便连边就行了。

代码很丑，就贴个 Link 吧。

复杂度大概是 $O(n\log n)$，如果使用了按秩合并的优化可以做到 $O(n\alpha(n))$。

[Easy ver.](https://codeforces.com/contest/1559/submission/125981501)

[Hard  ver.](https://codeforces.com/contest/1559/submission/126012244)

