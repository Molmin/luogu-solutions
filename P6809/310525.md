[更好的阅读体验](https://www.cnblogs.com/LaoMang-no-blog/p/16777418.html)

---

[**你谷 link**](https://www.luogu.com.cn/problem/P6809)

[**loj link**](https://loj.ac/p/2681)

提供一种时间复杂度正确的高妙做法。

首先题目有一条隐藏条件是保证 $n\not\equiv2\pmod3$ 或 $m\not\equiv2\pmod3$，需要通过观察数据得到。

我们钦定 $n\not\equiv2\pmod3$，如果不满足则沿主对角线翻转使其满足。

接下来我们令 $a_{i,j}$ 表示原给定数字表格上第 $i$ 行第 $j$ 列的值，$(i,j)$ 表示第 $i$ 行第 $j$ 列是否有雷。

首先考虑一种特殊情况，$a_{x,y}+a_{x+1,y+1}-a_{x,y+1}-a_{x+1,y}=(x-1,y-1)+(x+2,y+2)-(x-1,y+2)-(x+2,y-1)$，即对于一个 $2\times2$ 的方格，若我们已知其三个角，我们可以直接求得另外一个角。

思路非常巧妙，首先确定第 $3$ 行。

利用前面的特殊情况可以递推求出所有 $(3,3k)$，接下来求别的，需要对 $m$ 分类讨论。

若 $m\not\equiv2\pmod3$，我们将整个图水平翻转，再做一遍，则第三行任意三个相邻的位置只有一个未知，可以直接求。

若 $m\equiv2\pmod3$，此时我们将第三行中所有未知的位置取出来排成一列，任意两个相邻位置的和都是已知的，若有 $2$ 或 $0$，两个就都确定了，若全都是 $1$，则我们发现任意两个相邻的位置里只要有一个雷就好了，所以直接任意确定一组没有关系。

以此类推，当第 $3$ 行已知后，将第 $3$ 行对全图的影响消去，第 $6$ 行的情况就等价于原来的第三行，以此类推求得所有第 $3k$ 行。

因为保证了 $n\not\equiv2\pmod3$，竖直翻转后重新求一遍则所有未知行两两之间隔了两行，不会互相影响，即可以独立求。

求一个 $1\times m$ 的矩阵非常简单，直接和上面求第 $3$ 行类似做就好了。

最佳实现时间复杂度是 $\mathcal O\left(nm\right)$。

实现上因为全图翻转是 $\mathcal O\left(nm\right)$ 的，所以上面讲到做第 $3$ 行时翻转，实际上不能做一次翻一次，时间复杂度会退化，因为上面讲到特殊情况中有影响的实际上只有四个顶点，那么只要全部一起做就可以只反翻转一次。

细节较多，一个比较好的实现是每确定一个雷就将它在图中的影响消去，写起来会相对简单。

[c++代码](https://www.cnblogs.com/LaoMang-no-blog/p/16777418.html)