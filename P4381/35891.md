题意：

给定一个由 $n$ 个点组成的森林，每个点都分别有一条通往其他点的边（其实是无向边），现在你需要求出每个连通块的直径之和。

$n \leq 10^6$

---
简单分析一下，其实就是在一个基环树森林上的每棵基环树上寻找直径长度。

现在考虑某一棵基环树怎么寻找直径。和树不同的一点是有一个环，貌似不太好搞。

这里不妨从环上入手，考虑一条经过两颗环连接的树和一段环上边的路径。那么假设目前选择的两颗树所在环的点为 $x,y$ ，定义 $dis_a$ 为 $a$ 点所在树的最长链，$len_{a,b}$ 为 $a,b$ 在环上的最长路径长度。那么这条路径长度就是 $dis_x+dis_y+len_{x,y}$ 。

这个形式很优美，我们就从这个式子下手。首先考虑把 $len$ 拆掉，因为涉及到一个最大值。那么我们先把链复制一遍再断开，设 $L_x$ 为点 $x$ 到断开点的长度，这样就可以直接令 $len_{x,y} = L_y-L_x$ 。

再把式子分成两块： $(dis_x-L_x)+(dis_y+L_y)$ ，于是只需要对每个点记录它的 $dis_x - L_x$ ，取最大值，然后对每个点记录答案即可。

那么这样做复杂度是 $O(n)$ 的，十分优秀。

回顾一下，破题点在于把复杂的计算 ($\max$) 分成简单的 (四则运算)，再把难以直接处理的式子尽量分成几块互不干扰的容易处理的小块，分别计算答案时就很简单了。