特殊考虑最后一张卡一定是在只有一个坑的时候填进来，是特殊的，先忽视它。

假设已经知道了保留的另外 $k-1$ 张卡的集合 $S$，没放入的卡集合为 $T$，那么它们为了吃到最多的 $b_i$ 的加成肯定最先放入，并且它们内部的顺序一定是按照 $b$ 从小到大加入的，这样大的能给更多留下来的卡加成，再考虑最后一张的额外贡献只有一个 $a$，那么贪心选择最大的即可，则答案为：
$$
\sum_{i\in S}a_i+\sum_{i\in S}b_i\times (i-1)+(k-1)\sum_{j\in T}b_j+\max_{j\in T}\{a_j\}
$$
其中 $S$ 中按照 $b$ 从小到大的顺序排列。

唯一影响 dp 顺序的点在于 $b_i$ 的系数是 $i-1$，其中 $i$ 是它在 $S$ 中的排名，那么我们初始就把所有 $(a_i,b_i)$ 按照 $b$ 从小到大排序，第 $j$ 个加入 $S$ 的贡献就是 $a_i+b_i\times (j-1)$，不加入的贡献是 $(k-1)b_i$，另外再把不加入的最大的 $a$ 的下标 $k$ 压入状态，即状态为 $f_{i,j,k}$ 表示前 $i$ 个数中选了 $j$ 个放入 $S$，当前 $T$ 中最大的是 $a_k$，直接 dp 并记录前驱即可，复杂度 $O(Tn^2k)$。

虽然能过，但是 $k$ 一维可以从记录下标改为 $0/1$ 表示是否确定了放在最后一个位置的 $a_j$，这样对于同样的 $T$，选择 $T$ 中的最大值的方案会在转移中替代掉更劣的选择非最大值的方案，可以证明也是对的，这样复杂度就是 $O(Tnk)$。

代码没写。