题目链接：[P1822 魔法指纹](https://www.luogu.org/problemnew/show/P1822)  
  
这里来介绍一些间隔打表的方法和技巧。 
### 1，答案可递推，才适合间隔打表  
什么叫可递推呢？  
假设$\text{F}_n$为区间$[1,n]$的答案，那么$\text{F}_{n+1}$应该可以由很短的时间从$\text{F}_n$推出来。满足这个条件，就可以愉快地间隔打表辣！   
像这一题就是可递推的，递推式可以写成这样：  
```cpp
f[n] = f[n-1] + IsLucky(n);
```
### 2，间隔打表用法  
个人对于区间统计问题的用法是这样的：  
在这题中，记录$[1,10^6],[1,2*10^6]....[1,1000*10^6]$区间的答案，容易看出这是一个前缀和的形式。  
当我们要计算区间$[l,r]$的答案时，只需要计算$[1,r]-[1,l-1]$即可  
对于$[1,a]$的答案，可以拆成两部分计算，一部分是已经搞好的前缀和，一部分暴力计算。  
### 3，打表的间隔  
根据上面一段，可以发现打表的间隔越小，运行速度就越快。  
但是代码过长的话，是没办法提交的。这题单次递推的时间复杂度是$\Theta(\log n)$的，所以打表间隔用$10^6$就行了。  

这题表的生成器也非常好写，按照题意模拟就完了。  
大概就是这么多，我们把代码放上来吧qwq：    
```cpp
#include<cstdio>
#include<iostream>
#include<cstring>
#include<algorithm>
#include<cmath>
#define N 100003
#define p 998244353
#define reg register
using namespace std;

int a[15];
int table[1003] = {0,2045,3089,3839,4196,4512,4828,5186,5935,6979,8453,9319,10363,10666,10886,11040,11155,11239,11364,11710,12637,13015,13573,14323,14544,14748,14902,15020,15154,15300,15682,15792,16062,16365,16722,16898,17102,17270,17398,17487,17562,17647,17773,18071,18292,18608,18784,19004,19172,19260,19329,19398,19486,19654,19874,20050,20366,20587,20885,21011,21096,21171,21260,21388,21556,21760,21936,22293,22596,22866,22977,23359,23504,23638,23756,23910,24114,24336,25085,25643,26021,26948,27295,27419,27503,27618,27772,27992,28295,29339,30205,32227,32981,33205,33276,33362,33477,33645,33943,34501,35975,36601,37159,37277,37358,37409,37442,37461,37491,37807,39268,40134,41178,41481,41701,41855,41970,42054,42179,42525,43452,43562,44120,44214,44435,44531,44608,44656,44688,44714,44774,44848,45118,45234,45300,45395,45599,45717,45800,45855,45884,45934,46060,46178,46255,46305,46381,46494,46662,46719,46762,46806,46894,47002,47081,47121,47162,47206,47297,47395,47480,47521,47610,47679,47760,47794,47817,47847,47868,47948,48015,48151,48296,48370,48434,48485,48506,48528,48552,48587,48640,49129,49476,49551,49612,49663,49687,49700,49728,49900,49979,51122,51876,51923,51968,52019,52055,52070,52090,52319,53243,53483,53723,54021,54139,54208,54259,54287,54330,54393,54978,55844,56172,56475,56588,56665,56716,56751,56776,56838,57213,57591,58149,58899,59120,59324,59478,59596,59730,59876,60258,60325,60519,60822,60906,61082,61178,61259,61308,61340,61365,61412,61510,61808,61934,62003,62098,62318,62426,62478,62516,62559,62616,62784,62897,62973,63023,63100,63218,63344,63394,63442,63511,63639,63757,63817,63857,63891,63920,64016,64090,64246,64343,64477,64553,64630,64664,64691,64714,64740,64795,64957,65150,65274,65328,65397,65448,65471,65494,65529,65566,65877,66192,66416,66451,66509,66560,66582,66610,66682,66959,66984,67062,67180,67348,67413,67471,67506,67533,67547,67561,67943,68035,68151,68371,68472,68541,68594,68627,68666,68698,68808,69366,69460,69681,69777,69854,69902,69934,69960,70020,70130,70400,70703,71060,71236,71440,71608,71736,71825,71900,71934,72017,72135,72356,72420,72596,72709,72818,72860,72887,72925,72977,73085,73305,73400,73469,73595,73893,73991,74038,74073,74127,74196,74364,74460,74536,74595,74660,74854,74964,75015,75081,75155,75273,75374,75434,75478,75508,75555,75693,75725,75785,75860,75944,76009,76086,76138,76159,76184,76217,76241,76282,76329,76400,76452,76521,76577,76611,76646,76662,76685,76732,76823,76941,77056,77108,77153,77188,77204,77219,77389,77453,77518,77631,77785,77850,77911,77943,77975,77995,78373,78613,78692,78818,79022,79123,79187,79233,79260,79314,79381,79575,79878,79962,80138,80234,80315,80364,80396,80421,80506,80632,80930,81151,81467,81643,81863,82031,82119,82188,82215,82257,82366,82479,82655,82719,82940,83058,83141,83175,83204,83259,83342,83460,83664,83759,83825,83941,84211,84285,84326,84375,84453,84529,84683,84779,84856,84889,84967,85077,85100,85146,85195,85249,85364,85465,85544,85573,85596,85648,85663,85685,85738,85773,85859,85924,86005,86057,86083,86095,86107,86133,86185,86266,86331,86417,86452,86505,86527,86542,86594,86617,86646,86725,86826,86941,86995,87044,87090,87113,87223,87301,87334,87411,87507,87661,87737,87815,87864,87905,87979,88249,88365,88431,88526,88730,88848,88931,88986,89015,89049,89132,89250,89471,89535,89711,89824,89933,89975,90002,90071,90159,90327,90547,90723,91039,91260,91558,91684,91769,91794,91826,91875,91956,92052,92228,92312,92615,92809,92876,92930,92957,93003,93067,93168,93372,93498,93577,93817,94195,94215,94247,94279,94340,94405,94559,94672,94737,94801,94971,94986,95002,95037,95082,95134,95249,95367,95458,95505,95528,95544,95579,95613,95669,95738,95790,95861,95908,95949,95973,96006,96031,96052,96104,96181,96246,96330,96405,96465,96497,96635,96682,96712,96756,96816,96917,97035,97109,97175,97226,97336,97530,97595,97654,97730,97826,97994,98063,98117,98152,98199,98297,98595,98721,98790,98885,99105,99213,99265,99303,99330,99372,99481,99594,99770,99834,100055,100173,100256,100290,100365,100454,100582,100750,100954,101130,101487,101790,102060,102170,102230,102256,102288,102336,102413,102509,102730,102824,103382,103492,103524,103563,103596,103649,103718,103819,104039,104155,104247,104629,104643,104657,104684,104719,104777,104842,105010,105128,105206,105232,105508,105580,105608,105630,105681,105739,105775,105999,106314,106624,106661,106696,106719,106742,106793,106862,106916,107041,107234,107395,107450,107476,107499,107526,107560,107637,107713,107847,107945,108100,108174,108270,108299,108333,108373,108433,108551,108679,108748,108796,108846,108972,109090,109167,109217,109293,109406,109574,109631,109674,109712,109764,109872,110092,110187,110256,110382,110680,110778,110825,110850,110882,110931,111012,111108,111284,111368,111671,111865,111933,112315,112460,112594,112712,112866,113070,113292,114041,114599,114978,115352,115414,115439,115474,115525,115602,115715,116019,116346,117213,117797,117860,117903,117931,117982,118051,118169,118467,118708,118947,119871,120100,120120,120135,120171,120222,120267,120314,121068,122211,122290,122462,122490,122503,122527,122578,122639,122715,123061,123550,123603,123638,123662,123684,123705,123756,123820,123894,124039,124175,124242,124322,124343,124373,124396,124430,124511,124580,124669,124710,124795,124893,124984,125028,125069,125109,125188,125296,125384,125428,125471,125528,125696,125809,125885,125935,126012,126130,126256,126306,126335,126390,126473,126591,126795,126890,126956,127072,127342,127416,127476,127502,127534,127582,127659,127755,127976,128070,128628,128738,129665,130012,130136,130220,130335,130489,130709,131012,132056,132922,134383,134699,134729,134748,134781,134832,134913,135031,135589,136215,139782,142039,142127,142133,142153,142186,142221,142275,142589,144611,144982,145988,146122,146131,146140,146176,146229,146279,146471,147398,147455,147527,147611,147625,147636,147660,147708,147786,147884,148266,148312,148353,148376,148394,148403,148424,148480,148563,148632,148707,148757,148840,148892,148919,148940,148963,149015,149124,149181,149250,149294,149382,149490,149569,149609,149650,149694,149785,149883,149968,150003,150057,150126,150294,150390,150466,150525,150590,150784,150894,150948,150975,151021,151085,151186,151390,151516,151595,151835,152214,152588,152650,152675,152710,152761,152838,152951,153255,153582,154448,156470,157224,157448,157519,157605,157720,157888,158186,158744,160218};

inline int abs(int x);
inline int magic(int n);
inline bool check(int n);
void print(int x);
int calc(int n);

int main(){
    int a,b,l,r;
    scanf("%d%d",&l,&r);
    print(calc(r)-calc(l-1));
    return 0;
}

int calc(int n){
    int m = n%1000000;
    n /= 1000000;
    int res = table[n];
    n *= 1000000;
    m += n;
    for(int i=n+1;i<=m;++i)
        if(check(i)) ++res;
    return res;	
}

inline int abs(int x){
    return x<0?-x:x;
}

inline bool check(int n){
    while(n>9) n = magic(n);
    return n==7;
}

inline int magic(int n){
    int x = 0,i = 1;
    for(;n>0;++i){
        a[i] = n%10;
        n /= 10;
    }
    for(reg int j=i-1;j>1;--j)
        x = (x<<3)+(x<<1)+abs(a[j]-a[j-1]);
    return x;
}

void print(int x){
    if(x>9) print(x/10);
    putchar(x%10+'0');
}
```  
### 4、例题1：  

给你两个正整数$l,r$，你需要求出区间$[l,r]$中有多少整数，它的二进制表示中有奇数个$1$。  
$1\le l\le r \le10^9$  
此题虽然用搜索+各种玄学剪枝优化也能过，但是这很明显可以间隔打表。  
暴力统计前缀和，然后按我们上面的做法就好。  
由于这题并不难，所以就不放代码了。  

### 5、例题2：  
[P1662 数7](https://www.luogu.org/problemnew/show/P1662)  这题就不是区间的问题了，但是我们依然可以用间隔打表来搞。  
这题的打表难度稍微高了一些，因为我们不仅要记录数到谁了，还要记下来下一次数的方向。  
这题的做法和前面也是大同小异。仍然是把询问拆成两块，一部分是算好的，一部分暴力即可。  
$\text{Code:}$
```cpp
#include<cstdio>
#include<iostream>
#include<cstring>
#include<algorithm>
#include<cmath>
using namespace std;

bool cnt(int a){
	if(a%7 == 0) return true;
	while(a>0){
		if(a%10 == 7) return true;
		a /= 10;
    }
	return false;
}

int main(){
    int n,c,i,turn;
    int a[52] = {0,522,887,364,841,548,880,228,750,52,866,123,1167,162,370,892,1257,734,1328,396,64,716,194,1166,560,1303,259,1264,579,462,97,620,26,319,593,1278,1278,1278,1278,1278,1278,946,261,1076,437,960,366,659,327,119,934};
    int turns[52] = {0,1,0,1,1,0,1,0,1,0,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,0,1,0,1,0,1,0,0,1,1,0,0,0,0,0,1,0,1,0,1,0,0,1,0,1,0};
    scanf("%d",&n);
    c = n/20000000 + 1;
    i = a[c-1];
    turn = turns[c-1];
    c = (n/20000000)*20000000 + 1;
    while(c<=n){
        if(turn == 0) i++;
        else i--;
        i %= 1337;
        if(i == 0) i = 1337;
        if(cnt(c)) turn = 1-turn;
        c++;
    }
    printf("%d",i);
}
```
### 6，总结  
间隔打表是个常用的技巧，尤其是在数位dp等问题中，也可以骗不少分。如果常数比较优秀，甚至可以AC。  
所以：  
~~打表大法好，入教保平安~~