我刚刚写了一篇超长的[博客](http://www.cnblogs.com/cellular-automaton/p/8241128.html "博客")qwq

不过还是把内容复制一下比较好

我们从最基本的题意开始，一步步往下推


首先题面给出的公式是∑i=1n∑j=1nijgcd(i,j)


枚举gcd(i,j)=w，得到


∑w=1nw∑i=1n∑j=1nij[w=gcd(i,j)]


这时候我们设一个f(x)=∑i=1n∑j=1nij[x=gcd(i,j)]


一个F(x)=∑i=1n∑j=1nij[x|gcd(i,j)]


容易发现（其实就是为了凑莫比乌斯公式才搞的这两个函数，在构造函数之前就“容易发现”了）



　　F(x)=∑x|df(d)

怎么样……像莫比乌斯反演公式吧



　　f(d)=∑d|xμ(xd)F(x)

然后原式就变成了


∑w=1nw∑w|tμ(tw)F(t)


据说莫比乌斯反演构造的F(x)一定要简单易求


然后……自己找几组规律可以发现F(x)=(x+2x+3x+......+nxx)2


然后……继续找规律发现一个问题，就是你可以把x提出来。qwq。


于是F(x)成功的变成了x2(1+2+3+......+nx)2


然后我们回头去找扔掉的原式qwq


原式=∑w=1nw∑w|tμ(tw)F(t)


=∑w=1nw3∑w|tμ(tw)tw2(1+.......+nt)2


emm我们似乎发现了什么……


于是就设d=tw


然后把原式就整理成了


∑w=1nw3∑d=1nwμ(d)d2(1+.......+nwd)2


到此为止就有60分啦。不需要杜教筛狄利克雷卷积什么乱七八糟的玩意。


（然后剩下40分花掉了我一天+22个半小时）


然后我自己差不多就想到这里为止了。剩下的是rqy的脑补。


看到这里面一大堆下取整的玩意我们rqy非常不爽。


然后他先把公式颠倒了一下


∑d=1nμ(d)d2∑w=1ndw3(1+......+nwd)2


又令k=wd


然后改成枚举k


式子就变成了∑k=1n∑d|kμ(kd)(kd)2d3(1+....+nk)2


=∑k=1n∑d|kμ(kd)k2d(1+....+nk)2


发现有两项k2


,(1+....+nk)2

跟d没什么卵关系


提出来提出来


∑k=1nk2(1+....+nk)2∑d|kμ(kd)d


好，恭喜你∑d|kμ(kd)d=ϕ(k)


为什么呢？因为根据狄利克雷卷积公式μ∗1=e


ϕ∗1=n


所以n∗μ=ϕ∗1∗μ=ϕ∗e=ϕ


然后你列一列这个卷积公式。


惊不惊喜？意不意外？


然后原式变成了∑k=1nk2(1+....+nk)2ϕ(k)


然后一看到nk


有根号n种，非常激动，


然后现在的问题就变成了怎么快速求k2ϕ(k)


的前缀和


然后发现这个玩意用杜教筛好像很可做的样子


码了码了
