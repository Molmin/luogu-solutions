[相似题目](https://www.luogu.com.cn/problem/P7877)。

注意到一个位置可以空出来当且仅当对应的若干位置之一可以空出来，这种 **具有依赖关系** 的题目一看就是图论。

如果 $s_{i, j} = \texttt L$，那么从 $(i - 1, j + 1)$ 和 $(i + 1, j + 1)$ 向 $(i, j)$ 连边，权值为 $p$，表示如果 $(i, j)$ 要空出来，那么这两个位置需要有一个空出来，且花费 $p$ 的代价旋转这张床。同理，$(i, j + 2)$ 向 $(i, j)$ 连边，权值为 $q$。

对于 $s_{i, j}$ 为其它方向字符的情况同理。

我们发现连边只在 $i + j$ 奇偶性相同的位置之间进行，所以两张图互不影响。如果一张床的两个位置都要求被移动，我们可以先将对应目标位置变成空地，那么这张床周围与它四连通的位置有两个都是空地。此时可以只进行一次移动，然后就有 $1\times 2$ 的空地给我们摆放床了。

从 $s_{i, j} = \texttt .$ 的位置开始跑最短路，因为每条路径代表一个移动床的路径，所以 $f_{i, j}$ 表示为使得 $(i, j)$ 空出来的最小代价。我们发现连边枚举所有相邻位置 $(i, j), (i', j')(|i - i'| + |j - j'| = 1)$，则 $\min f_{i, j} + f_{i', j'}$ 即为所求。

时间复杂度 $\mathcal{O}(nm\log (nm))$。[代码](https://codeforces.com/contest/1753/submission/177583117)。