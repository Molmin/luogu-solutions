$n\le 1000$，考虑用 $n^2$ 算法。

枚举最左边和最右边的括号分别在哪个位置，那么中间的部分已经被确定了。

我们只需要知道端点取在哪里。

![](https://cdn.luogu.com.cn/upload/image_hosting/4826zj41.png)

如上图左右端点有三种取法。

我们再考虑合法的括号序列的条件：

1. 左右括号数量相等；
2. 任何位置左边的左括号数量不小于右括号数量。

我们固定左端点，每次向右扩展，同时算出最左边端点至少选多少个才能满足条件 $2$。

再维护一个左右括号的数量差。

这样就能算出能选多少个了。

代码见 [link](https://codeforces.com/contest/1556/submission/127356816)。