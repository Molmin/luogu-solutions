对于前三个子任务，随便暴力做一做，判断一下无解的情况，总能过的。这里不多展开。

对于第四个子任务，显然每个点的点权都没有限制，所以答案就是 $(r-l+1)^n$。

接下来讲解正解的做法。

首先，由于没有边权的边无限制，就不去管它。把没有边权的边删除后可以得到一个森林。我们只需要对森林中的每一棵树进行求解，然后把每一棵树的答案乘起来即可。

考虑每一棵树的解法。我们发现，一棵树中，只要确定一个点的权值，其他所有点的权值都是可以计算的。如果设最初那个点的权值是 $x$，那么其他点的权值只能是 $x+k$ 或 $-x+k$，其中 $k$ 是常数。如何计算每个点的 $k$ 呢？我们考虑从最初的点开始对这棵树进行深度优先遍历。通过上一个点的 $k$ 和这条边的权值可以计算出这个点的 $k$，用数学公式表示就是 $k_v=val_e-k_u$。同时，每条边连接的两个点 $x$ 的符号相反。我们只需要在遍历的同时记录当前点 $x$ 的符号与 $k$，即可进行计算。

遍历完这一棵树之后，我们就可以找到点权形如 $x+k$ 的点的点权最大值和最小值，以及点权形如 $-x+k$ 的点的点权最大值和最小值。这其实就是它们各自 $k$ 的最大值和最小值。我们设这四个值分别为 $\text{maxp,minp,maxn,minn}$。只要它们四个点的权值满足在取值范围之内，就一定成立。我们可以列出以下不等式组：
$$\begin{cases}
x+maxp\le r \\
x+minp\ge l \\
-x+maxn\le r \\
-x+minn\ge l
\end{cases}$$

解出这个不等式组，我们就得到了 $x$ 的取值范围。如果这个不等式组无解，那么答案就是 $0$。否则，我们设解出来 $L\le x\le R$，那么因为 $x$ 是整数，我们就知道成立的 $x$ 个数就是 $R-L+1$。这就是一棵树的答案求解方式。最后把每棵树的答案相乘即可。

注意如果这棵树只有一个点，那么答案就是 $r-l+1$。否则，在开始遍历之前，需要任意找一个根节点连着的点以计算四个数的初始值。