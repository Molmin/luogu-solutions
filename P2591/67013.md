首先我们读题。

1. 对于任何两个函数fi (x) 和fj (x),(i != j)，恰好存在一个x 使得fi (x) = fj (x)，并且存在无穷多的x 使得fi (x) < fj (x)。
### 由此可知任意两线交于一点，且两条直线一定不重合。

- 不存在x 使得fi (x) = fj (x) = fk (x)
### 由此可知任意三线不交于同一点。


## 那么开始推一下应该咋做：

1. 假设有N条直线**（假设N很大很大(°ー°〃)）**，然后每条直线的形式都是$y=kx+b$，则其$k$值一定各不相同**（不然就会平行或重合，不符合题干）**。

1. 把这N条直线的编号安照其$k$值由大到小进行排序，则编号最小的直线在$x$值足够小的时候，一定是位于最下面**（因为这样到后面才能与其他直线相交）**。

 P.S.按照$k$值排序之后有一点很方便，$k$表示直线的增长率，这就是说，$k$值最大的直线在$x$足够大的时候一定在最上面**（想象一下那从最下面穿到最上面的直线(｀・ω・´)）**

1. 如此排完顺序之后，我们发现在每个函数与其他函数相交时，一定是编号较小的的值在相交之后会大于编号较大的**（应该很好理解，不多废话了┓( ´∀` )┏）**

1. 那么我们可以回到题目了，先去寻找题目所说的第一层的段数，简单来说就是找图上最下层轮廓上有多少交点。把交点数加上1就是答案。

1. 寻找交点时，我们按照$x$从小到大的顺序去找，最开始在最下面的直线是第一条，随着第一条直线的上升，它会与其他直线相交，但是顺序实际上是不确定的**（见下图，左：1先与3相交，右：1先与2相交）**，也就是说最下层的轮廓实际上有很多种合法的可能。因为我们要求**最小**的段数，就要让交点尽量少。我们当然希望在这第一个交点与第一条直线相交的直线是**编号最大**的**（因为这样的话，编号最大的直线一定在此之前一定和其它直线都已经相交，最下层仅有一个交点）**

 ![示范](https://cdn.luogu.com.cn/upload/pic/52140.png)

1. 我们继续找第二层的轮廓，那就是要找时时刻刻第二小的点组成的轮廓。同理，这个轮廓自然也和最下层轮廓一样有许多种可能。同理贪心地考虑，就是最少有三个交点。从第一层到第$N$>>1|1层都符合第$i$层最少有$i*2-1$个交点。

1. 到了第($N$>>1|1)+1层，便更简单了。我们可以简单地将前面的图上下翻转一下**（即原来最下层变成最上层，等等）**，连同理都不用了，直接倒着抄上面得出的结论就行。此时符合第$N-i$层最少有$i*2-1$个交点。

8. #### 特别的，当只有一条直线时答案是1，需要稍微判定一下。

### 综上所述，得出公式：
     ans=(n==1) ? 1:((i<=(n>>1|1)) ? i:(n-i+1))<<1;
     //i表示当前要求的层
     //n表示总层数


P.S. 语文不好，如果发现任何问题请私信我（语句不通，看不懂等），我立刻修改o(╥﹏╥)o

不上代码了，没有必要了...