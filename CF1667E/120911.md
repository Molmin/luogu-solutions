我们把一个点作为重心的条件稍微转化一下，一个点是重心当且仅当其子树大小 $>\frac{n-1}{2}$ 并且其儿子的子树大小均 $\leq \frac{n-1}{2}$。

设 $f_i$ 为点 $i$ 子树大小 $>\frac{n-1}{2}$ 的方案数，然后枚举编号比 $i$ 大的点不在其子树内的点有 $j$ 个，那么首先判一下子树大小符不符合条件，然后在 $n-i$ 个点中选择 $j$ 个点，树被划分成了两部分，一部分是子树内的点，一部分是子树外的点。首先对于子树外的 $i-1+j$ 个点，每个点都可以连向比它小的一个点，所以方案数是 $(i+j-2)!$。而第 $i$ 个点只能连向前 $i-1$ 个点，所以方案数是 $i-1$，剩下 $n-i-j$ 个点的方案数同理，每个点都可以连向 $i$ 或者子树内比它小的点，所以方案数为 $(n-i-j)!$。所以最后的贡献是 $\frac{(n-i)!(i+j-2)!(n-i-j)!\times(i-1)}{j!(n-i-j)!}$，消去 $(n-i-j)!$ 变成 $\frac{(n-i)!\times(i-1)(i+j-2)!}{j!}$。发现这个柿子是一个上升幂的前缀和的形式，上升幂求前缀和可以先转成组合数，然后变成组合数上一列求和，可以发现是 $k$ 次前缀和之后的结果所以可以原式与 $i$ 无关的部分可以化为 $\sum_{j=0}^{j=S} \frac{(i+j-2)!}{j!}=(i-2)!\sum_{j=0}^{j=S}\tbinom{i+j-2}{j}=(i-2)!\tbinom{i+S-1}{S}$。

接着我们设 $g_i$ 为第 $i$ 个点作为重心的方案数，首先 $f_i$ 对 $g_i$ 的贡献系数是 $1$，然后再考虑 $i$ 前面的点 $j$，$f_i$ 对 $g_j$ 的贡献系数是 $f_i$ 中满足 $j$ 是 $i$ 的父亲的方案数在 $f_i$ 中的比例，相当于第 $i$ 个点的父亲不需要在 $i-1$ 个点中选了已经确定是 $j$ 了，即 $f_i$ 对 $g_j$ 的贡献系数是 $\frac{1}{i-1}$。直接从后往前边做边加贡献就行了。

时间复杂度 $O(n)$。