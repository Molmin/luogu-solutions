首先容易发现我们只需要记录每个数有哪些质因子就可以了。我们并不关心他们的次数。

发现不同质因子个数非常少。那有个想法就是在dp的时候记录当前余下的质因子有哪些。

然后你会发现这个转移超级劲爆。复杂度也很高。

考虑优化状态。

一条链上，我们只需要一个共同的质因数就可以使其满足题意。

那么我们只需要记录这个质因数即可。

实现技巧见代码：
https://www.luogu.com.cn/paste/of0x9c7e