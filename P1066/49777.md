首先，一个$n$位的$2^k$进制数，转成二进制之后的位数为$nk$，所以题目中的$r$的位数不能超过$\lceil \frac{w}{k} \rceil$。

因为转成二进制后有位数$w$的限制，所以最高位可能并不是长度为$k$的完整的一段，需要特殊考虑。

首先考虑最高位填$0$的情况，那么剩下的每一位都有$2^k-1$种数可以选择，有由题意可知，选出的数的排列方式是唯一的，所以这部分对答案的贡献为

$$\sum \limits_{i=2}^{\lfloor \frac{w}{k} \rfloor} \binom{2^k-1}{i}$$

再来考虑最高位不为0的情况，由于位数$w$的限制，所以最高位的位数最多为$n \mod k$，故除了0以外，最高位最多可以填的数有$2^{w \mod k}-1$种，又由题意可知，后面的数都只能填大于前一位的数，所以只能从大于最高位的数里面选，故这一部分的贡献为

$$\sum \limits_{i=1}^{2^{w \mod k}-1} \binom{2^k-i-1}{\lfloor \frac{w}{k} \rfloor}$$

两部分加起来就是答案，所以

$$ans = \sum \limits_{i=2}^{\lfloor \frac{w}{k} \rfloor} \binom{2^k-1}{i} + \sum \limits_{i=1}^{2^{w \mod k}-1} \binom{2^k-i-1}{\lfloor \frac{w}{k} \rfloor}$$

组合数直接递推一下，再加个高精就可以得到答案了。