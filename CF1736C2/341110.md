定于 $lst_i$ 表示能到达位置 $i$ 最左边的端点。那么显然可以递推得到 $lst_i=\max\{lst_{i-1},1,i-a_i+1\}$，显然答案就是 $\sum\limits_{i=1}^n i-lst_i+1$，显然此时的 $lst$ 具有单调性。

对于每次修改，$lst_p$ 会有 $3$ 种可能的结果。

* $lst_p$ 的值不变。那么对于答案也不会变.

* $lst_p$ 的值变大，二分找到后面最后一个位置 $i$ 使得 $lst_i \leq lst_p$，会对答案造成影响的就是区间 $[p,i]$，对答案造成的影响是 $\sum\limits_{j=p}^{i}lst_j-lst_p$，搞一个前缀和可以轻松解决。
* $lst_p$ 的值变小，二分找到后面最后一个位置 $i$ 使得 $lst_i\leq lst_p$，会对答案造成影响的就是区间 $[p,i]$，对答案造成的影响是 $\sum\limits_{j=p}^i lst_j-\max(lst_{j-1},j-a_j+1)$。

为了维护后面的那一坨减号，考虑离线询问，将询问按照 $p$ 的降序排列。

建一棵线段树，维护 $\max\limits_{j=p}^i\{j-a_j+1\}$。对于每次是变小的询问，二分找到最后一个小于 $x=\max(lst_{p-1},p-a_p+1)$ 的位置 $pos$，后面那一堆就是 $\sum\limits_{i=pos+1}^I Tree_i+(pos-i+1)x$。至于每次更新就是在线段树上二分找最后一个小于等于 $p-a_p+1$ 的位置，然后区间赋值。综上，线段树要支持的操作就是区间赋值，区间求和，二分查询，所以要维护区间和，区间最大值。
