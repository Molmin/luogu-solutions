## AGC029F 题解

这篇题解的目的，是给出一种不用霍尔定理的方法的较为严谨的证明，

（虽然本质还是霍尔定理，但可以不用霍尔定理阐述）

故以下的讲解基于您已经了解了题中二分图的建法，

所以如果您想学习如何做这道题，建议先看其他的题解。

那么，接下来，是对不用霍尔定理的做法的正确性的证明。

首先，如果存在若干个点集 $E_{1},E_2,\cdots E_k$，满足：

$|E_1\cup E_2\cup\cdots\cup E_k|\le k$，即所有点集的并所包含的点数不超过点集本身的数量，则问题一定无解，

因为这些点集中的每一个都会提供一条边，而不超过 $k$ 个点间存在共 $k$ 条边，就一定会出现环。

那么，问题有解的必要条件就是，对任意若干个点集，都有 $|E_1\cup E_2\cup\cdots\cup E_k|>k$。

而我们断言，如果我们跑出的二分图的最大匹配是完美匹配，则这个必要条件就是充要条件。

（当然，如果您学过霍尔定理的话，就会知道，满足了这个必要条件后，二分图一定存在完美匹配）

对上面的断言，我们考虑给出一组构造性证明。

首先，我们找到这棵树的根，就是那个在二分图中没有被匹配到的点 $u$，

则必然存在一点集 $E$ 包含 $u$，否则会有 $n-1$ 个点集包含共 $n-1$ 个点，这与上面的必要条件矛盾。

我们找到在二分图中与 $E$ 组成匹配的点 $u_2$，易知 $u_2\ne u$，我们在树中把 $u_2$ 的父亲设置成 $u$ 显然合法。

此时，必然存在一点集 $E_2$ 与集合 $\left\{u,u_2\right\}$ 有交，否则会有 $n-2$ 个点集包含 $n-2$ 个点，出现矛盾。

那么，我们再次找到二分图中与 $E_2$ 匹配的点 $u_3$，则因为 $E_2\cap\left\{u,u_2\right\}\ne\varnothing$，

故我们一定能在 $\left\{u,u_2\right\}$ 中找到一点，作为树上 $u_3$ 的父亲且合法。 

我们再依法炮制，不停的做以前的操作，

即通过上面的必要条件来说明，存在新的点集 $E_i$ 与 $\left\{u,u_2,\cdots u_{i}\right\}$ 有交，

我们找到与 $E_i$ 匹配的点 $u_{i+1}$，并由 $E_i\cap\left\{u,u_2,\cdots u_{i}\right\}\ne\varnothing$ 的前提，

必定存在 $v\in\left\{u,u_2,\cdots u_{i}\right\}$，满足：将 $v$ 作为 $u_{i+1}$ 在树上的父亲，是合法的。

如果此时 $i=n$，则我们就构造出了一棵合法的树，否则我们对 $\left\{u,u_2,\cdots u_{i+1}\right\}$ 继续做以上操作。

这样，我们就说明了，如果建出的二分图的最大匹配是完美匹配，

且给出的 $n-1$ 个点集满足，对任意若干个点集 $E_1,E_2,\cdots E_k$，都有 $|E_1\cup E_2\cup\cdots\cup E_k|>k$，

则一定存在一棵合法的树，与二分图的匹配对应。

也就是说，此时完美匹配的具体形状就不重要了，即任意一组完美匹配都有对应的合法解。

至此，我们对不用霍尔定理的做法的正确性的证明也就结束了。