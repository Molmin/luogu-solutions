

作为本道题的翻译，我最先尝逝了本题，因为那时题目还是暂无评定，所以直接打暴力，结果第二个测试点就超时了。

# 分段处理
第 $i$ 次加入集合的数是 $t_i$，我们需要找到一个临界点 $p$，$p$ 能把这个集合分成两部分，$p$ 应满足 $a_p\le2 b_p$（$a_i$ 表示第 $i$ 次操作时的 $S_{\max}$，$b_i$ 表示第 $i$ 次操作中的 $S_{\min}$），而且 $p$ 还得满足对于任意的 $k\in[1,p)$，均有 $a_k>2b_k$，而且我们还可以发现 ，$a_{i-1}-a_i\le1$，且 $b_{k}=k$，这也告诉我们，对于所有的 $t_i$，均有 $t_i=t_{i-1}-1$ 或者 $t_i=t_{i-1}-2$，我们再开一个数组 $d$，表示 $t_{i-1}-t_{i}$，显然，若 $d_i=0$，那有两个 $a_i-i$，有一个 $a_i-i+1$，接下来我们来运用数组 $d$ 以及一个字符集，差为 $0$，放入 $10$，否则放入 $110$，这就是 $d$ 数组：

```
0 10 11010 1101101011010
```
你应该找到一些蛛丝马迹了，别急，我们继续推，设 $P_i$ 表示 $d$ 数组第 $i$ 项的串，那么 $P_{i+1}$ 就是 $P_i$ 所有的 $0$ 换成 $10$，$1$ 换成 $110$ 得到的。我们设递推数组 $F_{s,i} (0\le s\le1)$ 表示为 $Q_i$ 经过 $i$ 次变换得到的东西，那么不难发现一下规律：
$$
\begin{cases}
F_{1,i}&=&2F_{1,i-1}+F_{1,i-1}\\
F_{0,i}&=&F_{0,i-1}+F_{1,i-1}
\end{cases}
$$


第一部分做的差不多了，现在转到第二部分。

我们设，$p$ 次操作后的 $S$ 的递增集合为 $A$，那我们不难发现，对于刚加入的数 $t_i$，均有 $t_i=\min A$，每两轮插入的数是相等的。而 $p$ 与 $p+1$ 轮的操作必定是数组的最小值！所以后半部分答案是：
$$
A_2-(A_3-(A_4-(A_5-\ldots(A_{n-p}-A_{n-p-1})\ldots)))
$$

# 最终答案
因为 $a_p-p\le p$，$A_i=a_{n-i+1}$，我们就可以通过数学方法得到答案 $C$：
- $(n-p)\bmod 2=0$ 时，$C= p-\sum\limits_{i=p+1}^{n-1}d_i$。
- 否则，$C=n-\sum\limits_{i=1}^p d_i-p-\sum\limits_{p+2}^{n-1}d_i$。

我们只需要二分答案 $p$ 即可，时间复杂度 $\mathcal{O}(T\log n)$。