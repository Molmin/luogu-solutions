**这里是官方题解！**


### 题面描述

长度为 $n$ 的序列，有 $q$ 个操作。每次 $A_{s+i-1}\gets A_{s+i-1}+i^{k_i}\times w_iA$。

输出最后的结果。

### 题解

$ \bullet\ \rm Subtask \ 1: n \le 3\times 10^3,q\le 3\times 10^3,m\le 9$

按照上面给出的伪代码暴力即可。

$ \bullet\ \rm Subtask \ 2: n \le 3\times 10^5,q\le 3\times 10^5,m=0$

经典的差分数组。每次 $A_s\gets A_s + w,A_{s+l}\gets A_{s+l}-w$，最后统计前缀和即可。

$ \bullet\ \rm Subtask \ 3: n \le 3\times 10^5,q\le 3\times 10^5,m=1$

从这里开始就进入正题了。

比如，我们需要给 $[4,10]$ 进行一次操作，那么操作后的结果显然为：

$ \text{0 0 0 1 2 3 4 5 6 7 0 0 0} \cdots $ 

对其进行差分(即后一项减去前一项)，可以得到：

$ \text{0 0 0 1 1 1 1 1 1 1 -7 0 0} \cdots $

很显然，里面出现了一串 $1$ 。我们只需要按照 $ \rm Subtask\ 2 $ 的写法即可。但是比较特殊的是，我们需要另外开一个差分数组来对这个差分数组进行差分。至于剩下来的一个 $7$，暴力即可。

$ \bullet \ \rm Subtask \ 4\&5: n \le 3\times 10^5,q\le 3\times 10^5,m=9$ 

这里需要我们找规律了。

假设我们进行一次操作后，希望得到的结果为

$ 1^a,2^a,3^a,4^a \cdots b^a,(b+1)^a,(b+2)^a \cdots1 
a $

那么我们可以发现，进行一次差分之后，结果为

$ 1^a,2^a-1^a,3^a-2^a\cdots b^a,(b+1)^a-b^a,(b+2)^a-(b+1)^a \cdots1 $

其中，形如 $(b+1)^a-b^a(b+1)$ 的式子可以用二项式定理强行展开：

$(b+1)^a-b^a=\sum_{i=1}^a\dbinom{a}{i}b^i-b^a=\sum_{i=1}^{a-1}\dbinom{a}{i}(b+1)$

此时我们惊喜的发现，次数为 $a$ 的问题可以转化 $a-1$ 个子问题进行解决，这几个子问题在下一个差分数组上。所以用分治就可以了。

$ \bullet\ \rm Subtask \ 6: n\le 5\times 10^5,m\leq 9,q\le 1\times 10^6$ 

非常令人迷惑的一个点。

如果你已经成功把上一个程序写出来了，你就能够发现，在这 $k$ 个差分数组 $D_i$ 上，进行分治操作后最后大概长这样：

$D_1:$ $ X_1 $ $0$ $0$ $0$ $0$ $ \cdots $ $0$ $0$ $0$ $0$ $0$ $Y_1$ $0$ $0$ $\dots$ 

$D_2:$ $0$ $ X_2 $ $0$ $0$ $0$ $ \cdots $ $0$ $0$ $0$ $0$ $0$ $Y_2$ $0$ $0$ $\dots$ 

$D_3:$ $0$ $0$ $ X_3 $ $0$ $0$ $ \cdots $ $0$ $0$ $0$ $0$ $0$ $Y_3$ $0$ $0$ $\dots$ 

$D_4:$ $0$ $0$ $0$ $ X_4 $ $0$ $ \cdots $ $0$ $0$ $0$ $0$ $0$ $Y_4$ $0$ $0$ $\dots$


其中， $X$ 部分的数值对应的数字只跟当前处理的 $k$ 有关，所以可以打表算出来；后面的 $Y$ 部分就要细心观察了。

能够发现 $Y_i$ 的数值与 $X_i,X_{i+1}\cdots X$  有关。经过进一步探索，我们能够找到这个关系式：

$Y_i=\sum_{j=i}^k T_{l-i,j-i+1}X_i $ 

其中, $T_{i,j}$ 表示杨辉三角第 $i$ 行从左往右数第 $j$ 个。

所以我们只要预处理出杨辉三角前 $n$ 层前 $m$ 个就行了。