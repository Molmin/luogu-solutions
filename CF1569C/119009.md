设最大值为 $mx$，个数为 $cm$，严格次大值为 $se$，个数为 $cs$ ，可以证明答案一定只与这些量有关。

首先处理一些特殊情况：

- $cm > 1$，任何排列方式均可，答案为 $n!$；
- $cm = 1, mx - se > 1$，任何排列方式均不合法，答案为 $0$。

现在就只剩下了 $cm = 1, mx - se = 1$ 的情况。

注意到一个排列方式合法的充要条件是至少存在一个 $se$ 在 $mx$ 后面。

“至少”的条件要是直接处理的话需要奇怪的容斥，不是很好办，因此考虑用总方案数减去不合法方案数，即所有的 $se$ 都在 $mx$ 前的情况。

这样，就是先在序列中选出 $cs + 1$ 个空位，把所有的 $se$ 和 $mx$ 放到里头，然后剩下的 $n - cs - 1$ 个 $< se$ 的数可以任意排列，所有的 $se$ 也可以任意排列，故总的答案为：

$$n! - \dbinom{n}{cs + 1}(n - cs - 1)!(cs)!$$