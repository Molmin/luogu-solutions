给定一棵 $n$ 个点带边权的树，$q$ 次**在线**询问 $p$ 到 $[l,r]$ 内的点路径的交的长度。

$1\leq n,q\leq 2\times 10^5$。

考虑用 ST 表求出 $[l,r]$ 内点的 LCA 为点 $u$。

- $u,p$ 无祖先后代关系，答案为 $dis(u,p)$。
- $u$ 在 $p$ 子树内，答案即为 $dis(u,p)$，因为所有点都在 $p$ 子树内，在 $u$ 处汇合。
- $p$ 在 $u$ 子树内。

  - 若 $p$ 子树内有 $[l,r]$ 内的点，则答案是 $0$，因为 $p$ 子树内外都有点，路径会没有交。
  - 否则二分找到最高的点 $p'$ 满足 $p'$ 子树内无 $[l,r]$ 内的点，答案为 $dis(fa_{p'},p)$，因为此时所有点都会走到 $fa_{p'}$ 之后再走向 $p$，这一步可以用主席树来维护。

时间复杂度 $\mathcal O(n\log^2 n)$，空间复杂度 $\mathcal O(n\log n)$。

[code](https://www.luogu.com.cn/paste/doe9ws84)。