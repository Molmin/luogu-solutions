CF908D New Year and Arbitrary Arrangement

题意：给定三个数 $k,pa,pb$，一开始是空字符串，每次有 $\frac{pa}{pa+pb}$ 的概率在字符串末尾填上 $a$，有 $\frac{pb}{pa+pb}$ 的概率在字符串末尾填上 $b$，直到有至少 $k$ 个子序列为 $ab$ 时停止，求停止时子序列为 $ab$ 的个数，数据范围：$k\leq 1000,1\leq pa,pb\leq 1000000$ 

设状态要特别注意，因为字符串有可能无限延伸，所以考虑结束后的前缀是好做的，设 $f[i][j]$ 表示前缀有 $i$ 个字符 $a$ 和 $j$ 个子序列 $ab$ 的期望 $ab$ 子序列数，转移很好转移 $f[i][j]=\frac{pa}{pa+pb}\times f[i+1][j]+b\times f[i][i+j]$ 

注意边界情况 $i+j\geq k$，这时只要一个 $b$ 就能满足条件，今天 $i207M$ 给我们讲了一个结论：

> 一个发生概率为 $P$ 的事件，期望 $\frac{1}{P}$ 次发生

这个结论有两种证法，第一种我没听明白，第二种是裂项相消法

这个期望可以写成 $\sum_{i=1}^n i\cdot P(第i步发生的概率)$ 化简后成 $\sum_{i=1}^n i\cdot ((1-p)^{i-1}\cdot p)$ 这是一个等差数列乘上一个等比数列，用裂项相消就能得出以上结论

回~来~

只要一个 $b$ 就能满足，但是 $b$ 发生的概率为 $\frac{pb}{pa+pb}$，期望成功次数是 $\frac{pa+pb}{pb}$，但由于其中一个 $b$ 要跟着前面的 $a$，那么就是 $\frac{pa}{pb}$，边界情况就是 $i+j+\frac{pa}{pb}$ 

搞一搞，码非常简单