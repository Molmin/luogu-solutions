好像……挺简单的？

手玩，可以发现位置 $(i,j)$ 上的数字为 $b_{i,j}=\lfloor\frac{\sum_{k=\min(i,j)}^{\max(i,j)}}{k}\rfloor$。

可以发现这个数表是对称的，$(x_1,y_1,x_2,y_2)$ 四个变量的矩形不好处理，可以通过容斥将其表示为若干个斜边与主对角线重合的三角形的加减。

对数列做个前缀和，问题转化为：

$$\sum_{i=l}^r\sum_{j=l}^r\lfloor\frac{s_{max(i,j)}-s_{\min(i,j)-1}}{k}\rfloor$$

将 $s$ 数列除以 $k$ 的商拿出来单独算（显然可以 $O(n)-O(1)$），而 $s$ 的余数相减只会产生 $-1$ 或者 $0$ 的贡献，不难发现其为区间逆序对形式，二次离线莫队即可。

复杂度 $O(n\sqrt n)$。