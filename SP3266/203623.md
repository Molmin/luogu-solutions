一种简单的 $2\log$ 在线做法。

线段树。每个节点保存 $[l,r]$ 区间排序后的序列。容易得知空间复杂度为 $n\log n$。建树的时间复杂度事实上可以做到 $n\log n$，对下面两个有序序列归并。但是众所周知我的归并常数莫名的大，由乃打扑克那题归并被卡到 $82\ pts$，所以就选择了直接 `sort`。

分析一下时间复杂度，为 

$$\sum_{i=1}^{\log n} 2^i \times i$$

所以大概是 $n\log ^2 n$？

不过好在上面那个是个上界，而且 `sort` 常数小，所以这部分还好。

下面就比较简单了：每次先按正常的线段树往下递归分解为 $\log n$ 个区间，然后对于每个区间都二分一下，事情就解决了。

速度还可以，也挺好写的，一次就过了。