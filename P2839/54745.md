### Description
给你一个序列，每次询问给出四个数 $a,b,c,d$，求所有区间 $[l,r]$ 满足 $l \in [a,b], r \in [c,d]$ 的中位数的最大值。强制在线

$n \leq 20000, Q \leq 25000,a_i \leq 10^9$

### Solution

考虑二分答案。假设现在二分出来的是 $x$ ，那么把 $\ge x$ 的位置设成 $1$ ，$< x$ 的设为 $-1$ 。那么一个区间的中位数 $\ge x$ 等价于这个区间的和 $\ge 0$

如何处理题目给的左右端点的限制？

可以发现 $[l,r]$ 必然包含 $[b+1,c-1]$ (如果 $b+1 \leq c+1$ 的话）所以 $[l, r]$ 的和必然包含 $[b+1, c-1]$ 的和

显然让 $[l,r]$ 的和最大的方案是取 $[a,b]$ 的最大右段和 和 $[c,d]$ 的最大左段和

这些都可以用线段树维护。但这样需要每个数都开一颗线段树，空间爆炸。

把数组排序，这样每个数的线段树显然只是由前一个数的线段树把一个点的权值从 $1$ 改为 $-1$ 。可以使用主席树的思想（貌似就是主席树

然后就做完了。复杂度 $O(m \log^2 n)$ 

### Code
[看代码戳这里](https://acfunction.github.io/2019/01/20/BZOJ2653/)