
## 题意

给出一棵树，支持动态加边，问满足存在 $u\to w,v\to w$ 的不相交路径的 $(u,v,w)$ **有序** 三元组数量。

## 思路

首先看树上的问题，发现 $w$ 是特殊的。

我们以 $w$ 来统计答案。

如果没有限制，方案数是 $(n-1)^2$ 减去一定不合法的方案数，也就是  $u,v$ 处于 $w$ 的同一子树。

也就是 $\sum\limits_{v\in son(u)}siz_v^2+(n-siz_u)^2$ 别忘记了父亲那边的子树。

然后考虑连边的问题。

每连上了一条边，然后考虑变化。

如果不管动态加边的话，考虑一张普通无向图的方法。

明显可以边双缩点算贡献，这里边双内部任意 3 个点都合法，这是边双的定义，然后和外部的贡献可以套用树的部分。

记得两个点在边双内部，一个在外部的贡献。

这样就是经典的动态维护边双问题了。

使用并查集维护每一个边双，然后并查集指向每个边双深度最小的节点。

然后即可暴力树上爬即可，发现每个点只能被遍历一次，所以复杂度有保证，答案就合并的时候暴力维护即可。

复杂度 $O(n)$，这里并查集的复杂度应该是线性的，这里是单纯的树上均摊每个点跳一次。



