问题可以退化成两个部分：

 - 给定 $n$，求 $[1,2,\dots,n]$ 有多少个有序划分；
 - 给定 $n$，求这些有序划分中所有有序划分里面集合数量之和。

其中一个有序划分是一个非空集合序列 $A=[S_1,S_2,\dots,S_k]$ ，满足任意一个在 ${1,2,\dots,n}$ 里面的元素在恰好一个 $S_1,S_2,\dots,S_k$ 里面。两个有序划分 $A,B$ 不同当且仅当它们的长度不同或者存在一个 $k$ 使得 $A_k\neq B_k$。注意集合无序，但是序列有序。

第一个答案为输出分母，第二个答案为输出分子。

分别推式子。

## 第一部分

枚举划分成多少集合，叫 $k$。如果无序的话，那么这里的答案 $\left\{{n\atop k}\right\}$，但是因为有序，这个不够。由于所有集合互不相同，可以直接乘 $k!$ 来补起来。

因为这道题目有多组数据，时间复杂度更快来直接考虑生成函数（这里用 egf 因为显然更方便）

$$F(z)=\sum_{n=0}^\infty(\sum_{k=0}^n\begin{Bmatrix}n\\k\end{Bmatrix}k!)\frac{z^n}{n!}$$

推

$$F(z)=\sum_{k=0}^\infty(e^z-1)^k$$

$$F(z)=\frac{1}{2-e^z}$$

## 第二部分

这个可以从上面微微改变来推出来。每一次枚举 $n,k$ 的时候在考虑一下对这个 $n$ 的答案贡献。这个贡献就是序列多长：$k$。所以 $\left\{{n\atop k}\right\}k!$ 变成 $\left\{{n\atop k}\right\}k!k$ 就可以了。

$$G(z)=\sum_{n=0}^\infty(\sum_{k=0}^n\begin{Bmatrix}n\\k\end{Bmatrix}k!k)\frac{z^n}{n!}$$

$$G(z)=\sum_{k=0}^\infty k(e^z-1)^k$$

用式子 $\sum kc^k=\frac{c}{(1-c)^2}$

$$G(z)=\frac{e^z-1}{(2-e^z)^2}$$

好了，直接做多项式 exp&逆元&乘法 就够，然后注意一堆细节就可以，我调试了好长时间（

最终答案：

$$a(n)=n!\frac{[x^n]\frac{1}{2-e^z}}{[x^n]\frac{e^z-1}{(2-e^z)^2}}$$

特别注意

$$\frac{[x^n]F(x)}{[x^n]G(x)}\neq[x^n]\frac{F(x)}{G(x)}$$

代码由于板子太长，就不放在这里了。