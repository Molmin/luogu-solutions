
当不限制主对角线的时候，一种构造方案是 $i$ 行 $j$ 列放 $ij$（从 $0$ 开始编号），那么对于任意 $a,b,c,d$，均有 $ab+cd$ 和 $ad+bc$ 模 $n$ 不同，因为 $n$ 是一个质数。

现在限制了主对角线，那么每一行的数只要全部偏移到主对角线满足这个限制就可以了。

代码见 CF 提交。