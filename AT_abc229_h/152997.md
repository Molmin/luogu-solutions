这题的前置知识超现实数本文不讲, 只阐述一下 std 做法.

每列是独立的, 则一个列的状态可以有 $3^n$ 种, 它们连成一个 DAG, 问题变成有一个 DAG, 每条边为白色或者黑色, 分别对应只有先手能这样走和只有后手能这样走, 总共有 $n$ 个棋子, 两人轮流移动棋子, 不能移动的人输.

这是经典的不公平博弈, 超现实数解决, 我们只需要证明 DAG 上的每个点的数值都不会是未定义即可.

我们证明评估价值可以通过 DAG 的拓扑序中的归纳法来定义, 假设我们现在关注的是点 $v$, 而且拓扑序在它之前的所有点都有定义, 那么只需证明如果存在一条白边 $v\rightarrow a$ 和一条黑边 $v\rightarrow b$, 那么 $eval_a<eval_b$, 其中 $eval$ 表示评估价值.

如果 $v\rightarrow a$ 和 $v\rightarrow b$ 都表示吃掉一个棋子, 那么我们令 $c$ 为这两个棋子都被吃掉的状态, 那么存在黑边 $a\rightarrow c$ 和白边 $b\rightarrow c$, 根据归纳假设 $eval(a)<eval(c)<eval(b)$.

同样的, 如果两个操作相互不干扰, 那么都存在上述这种 $c$, 可以用类似方法论证, 唯一例外是 $v\rightarrow a$ 对应吃黑棋, $v\rightarrow b$ 对应推进这个棋(白棋同理), 但在这种情况下存在白边 $b\rightarrow a$, 所以 $eval(a)<eval(b)$.

直接按超现实数做法做即可.