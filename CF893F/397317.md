这题强制在线，感觉线段树合并好写一些，现有题解里一车主席树还有树套树。

一个很 naive 的想法是维护一棵关于深度的线段树，然后我们发现这样查询就成了区间 $dep_x $ 到 $\min(dep_x+k,n)$，取 $\min$ 是因为可能超过 $n$ 就寄掉了。

然后就是我们写 merge 的时候不要将一棵线段树合到另一棵上，而是建新树合并，因为直接合并会破坏合并的那棵树贡献。

剩下的都是一些基本的操作。

线段树合并的时间复杂度一直是个玄学东西，一般情况下是 $\mathcal{O(n\log{n})}$，虽然玄学一点，但是跑 $10^5$ 还是没问题的。

[码。](https://codeforces.com/contest/893/submission/170705693)