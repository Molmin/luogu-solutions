提供一种类似分散层叠优化区域树的做法。

~~纯属口胡，但个人感觉挺靠谱的，要是有问题欢迎来 D 我~~

## 思路


看到 “子树” ，看到 “深度距离” 首先考虑把 dfs 序拉下来，然后把每一个点深度拉下来。

那么不难发现问题变成了强制在线询问某一个矩形内的最小值。

一种做法是主席树，这里不用主席树，改用一种更为暴力的做法——树套树。

但是一般的树套树是 $O(n\log^2 n)$ 的， $m=10^6$ 的情况下可能会松不过去。

不难发现，一般的树套树结构中，我们都是在多棵内层树当中把结果查询出来之后合并，但是由于内层树也是线段树故要多乘一只 $\log$ 。

但是我们这里做的是 $\text{RMQ}$ 问题，用线段树处理就显得有些不太优秀。

我们考虑把内层结构改成 **st表** ，对于每一个节点储存这段区间内所有节点排序后的结果，然后建 st 表。

但是这样每一次询问还要二分，复杂度并没有得到优化。

不难发现我们在线段树上的每一个父亲节点上都可以存储当前节点在儿子中的后继，那么我们直接在根节点上二分一次，后面的节点就都可以 $O(1)$ 查询了。

复杂度 $O(n\log^2n+m\log n)$ ，用四毛子处理 $\text{RMQ}$ 问题也许可以做到 $O(n\log n + m\log n)$ ，但没必要。