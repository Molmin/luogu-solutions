# ARC110E Shorten ABC

[洛谷：ARC110E Shorten ABC](https://www.luogu.com.cn/problem/AT_arc110_e) 

[Atcoder：ARC110E Shorten ABC](https://atcoder.jp/contests/arc110/tasks/arc110_e) 

## Problem

给定一个长度为 $N$ 的字符串 $S$，包含 `A,B,C`。

你可以进行若干次如下操作：

- 选定 $i\in [1,n-1]$，满足 $S_i\neq S_{i+1}$，将这两个字符替换为 `A,B,C` 没有出现的那个，比如你可以将 `AB` 替换为 `C`。

求操作后不同串的个数对 $1000000007$ 取模。

## Range

-  $1 \leq N \leq 10^6$ 

## Solution

看起来很像 [ARC094F] Normalization。

那道题将 `A,B,C` 替换为 `0,1,2`，用了和 $\% 3$ 相等的性质，

而这道题把 `A,B,C` 替换为 `1,2,3`，一次操作相当于把 $x$ 和 $y$ 整体替换为 $x \oplus y$，最终得到的序列就是把原序列划分成很多段，然后求每个段的异或和。

对于操作中需满足 $x\neq y$，有以下情况是满足条件的区间：

- 区间内只有一个数。
- 区间内的异或和不为 $0$ 且不能全为同一个数。

然而对每个段求出异或和后，不同的划分可能得到相同的结果。

我们考虑一个初始字符串 $S$ 形成最终字符串 $T$ 的过程：$T$ 的每一个字符对应 $S$ 的一段区间。

 设 $f_i$ 为考虑 $S$ 的前 $i$ 个字符的答案，`dp` 过程为在前 $i$ 个字符形成的最终字符串后新增一个字符，而这个字符要在 $S$ 中对应一段区间。对于多个异或和相等的区间，我们只选择长度最小的那个，这样就避免计重。

转移是这样的：（记 $len_{i, j}$ 为以 $i$ 为开头，形成 $T$ 中字符 $j$ 的 $S$ 中的最短区间长度，$a_i$ 为 $S$ 中字符转化后的数字）
$$
\begin{aligned}
len_{i ,j} = 
\begin{cases}
1, & a_{i} = j \\
len_{i + 1, j \oplus a_i} + 1,& a_i \neq j
\end{cases}
\end{aligned}
$$
注意无法导出字符时，该状态无法往后转移给任意一个有用 $f$ 值，可以把 $nxt$ 设成 $n + 1$。

对于 $f$ 的转移：
$$
f_{i + len_{i + 1, j}} \leftarrow f_{i}
$$
初始 $f_0 = 1$，表示什么字符都没有算一种方案。

考虑最后如何统计答案。如果只考虑 $f_{n}$，那么有的 $f_{i}$ 因为我们的限制而转移不过去，但实际上可以将后面那段没法单独形成字符的区间归到已形成的串中的最后一个字符。

因此枚举每一个位置，如果 $f_i \oplus f_n = 0$，就计入答案。可见 $f_n$ 其实是正确答案的一部分。

[code ARC110E](https://atcoder.jp/contests/arc110/submissions/36748892) 