超级无敌炫酷原神大王题目。

先考察对于一些员工，它们是不是可以不重复的放到这棵树里。

抽象成一个二分图匹配模型，将每个员工与所在子树的所有点连边，所有员工都能放下等价于此二分图有完美匹配，由 hall 定理，等价于任意一个员工的子集 $S$ 都能匹配到至少 $|S|$ 个顶点。把 $S$ 中的员工所在的子树分成一堆互不相交的子树，容易发现条件等价于每个这样的子树都满足条件，为了让条件尽量紧，应该把所有该子树内的员工都选上。

综上，一个员工集合可以放到树里等价于对于任何一棵子树，该子树内的员工树都不超过该子树大小。

接下来考虑 $m=0$ 怎么做。

直接将员工按照 $v$ 从大到小加入，如果能放进去就放，放不进去就不管他，动态维护每个子树内还能放多少员工，可以通过树剖做到 $O(n\log^2 n)$ 的复杂度。

但是原问题看起来很不能从大到小加入，所以我们还需要一个支持随机加入的算法。

首先，如果加入该员工后当前员工集合仍然满足条件，那么肯定是直接加进去。如果不满足条件，说明该员工所在节点 $u$ 有一个祖先对应的子树已经放满了，那我们找到限制最紧的子树 $v$，即最深的放满的祖先，看看这个子树内都放了哪些员工，并把其中权值最小的员工拿出来，如果当前员工替换掉这个员工更优秀，那么就替换掉，否则保持不变。容易发现被替换的这个员工不可能再替换掉其它员工，因此这个贪心策略是正确的。这个过程可以使用线段树维护子树内当前权值最小的员工，复杂度仍为单次 $O(\log^2 n)$。

那么对于带删除的原问题，考虑使用线段树分治规避掉删除员工这一操作，代价是复杂度上多一个 $\log$，可以接受。

总复杂度 $O(n\log^3 n)$，可以通过本题，使用全局平衡二叉树维护链加链 $\min$ 可以做到 $O(n\log^2 n)$，意义不大。