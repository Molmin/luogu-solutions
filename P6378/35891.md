本题的关键之处在于解决 2-SAT 中 "若干个点只能选择一个" 的问题。

考虑某个点向除它之外的点连边，那么需要连 $n^2$ 条边，不够优秀。

考虑一个点 $x$ 向点 $[1,x-1] \bigcup [x+1,n]$ 连边，显然可以前缀和优化。

设点 $f_i$ 是点 $[1,i]$ 是否被选择的状态，点 $g_i$ 是点 $[i,n]$ 是否被选择的状态，直接连就行，需要连 $O(n)$ 条边。

当然，使用线段树/倍增优化也行，需要连 $O(n\log n)$ 条边。