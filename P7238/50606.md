这里是出题人题解。

---

- 对于 $n\leq10^3$ 的数据：构造。

树的直径：一棵树上最远两点间的距离。

利用链式前向星建图，按题意建出最后的树。

求最终树的直径，加一即为所求。

---

- 对于 $n\leq10^6$ 的数据：树的直径。

考虑先找到「单位树」的直径。

性质：「单位树」中一条边 $(u,v)$，如果在树的直径中，那么最终树的直径也一定由其拓展得来。

理由是，根据构造规则，边 $(u,v)$ 一定会产生一棵树，那么这棵树包含的点一定比这个边更多，所以 **经过那棵树的答案** 一定不会比 **经过这条边的答案** 更劣。

可以自己通过作图或结合样例理解这个性质。

如果理解了该性质，那么只需要在「单位树」的直径上稍加拓展即得最终直径。

---

树的直径可以参考洛谷日报或其他博文，这里用到的是其中一类方法。

留下两个简单问题给读者思考：

1. 原树的直径需要通过数学计算得到新树的直径，这里需要保存原树直径的两端点的深度 $d_1,d_2$。
2. 有些人认为拓展成 $k$ 阶难度会大幅增加，更有意义，而通过该解法得到的数学公式，只需稍加修改即得 $k$ 阶公式。