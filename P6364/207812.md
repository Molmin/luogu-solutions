才学半年OI的初一蒟蒻居然连普及-的题目都不会写了！！！（其实是因为时间来不及所以没写好）

由于题目中$n \le 10^6$，所以只能用线性的算法（搜索什么的就不用想了，当然也不会有人想搜索吧……）。

考虑设$f[i]$表示第$i$个学生最少需要准备的橙子数。（初值为$1$，因为至少需要$1$个橙子）

首先从$2$到$n$正着遍历一遍，处理$a[i-1] \le a[i]$的情况：

+ 如果$a[i]>a[i-1]$，说明第$i$个人需要的橙子数至少是第$i-1$个人需要的橙子数加$1$的值，即$f[i]=f[i-1]+1$。
+ 如果$a[i]=a[i-1]$则$f[i]=f[i-1]$（这个应该很好懂）。

再从$n$到$2$反着遍历一遍，处理$a[i-1] \ge a[i]$的情况：

+ 如果$a[i-1]>a[i]$，按照前面的思路，应该是$f[i-1]=f[i]+1$……

  ### 吗？
  ### 错了！！！
  因为此时$f[i-1]$已经有值，所以要拿$f[i]+1$与$f[i-1]$比较，选取最大的一个，这样后面如果再有$a[j-1]>a[j]$的情况，就能保证有足够的橙子而不需要修改前面的值。
  
+ 如果$a[i-1]=a[i]$，则$f[i]=max(f[i-1],f[i])$（同理）。

最后输出$\sum_{i=1}^nf[i]$就行了。

### 注意：一定要开long long！！！

代码：

```cpp
#include <stdio.h>
#define max(a,b) (a)>(b)?(a):(b)
//自己定义的宏，求最大值的
int n,a[1000001];long long ans,f[1000001];
int main(){
    scanf("%d",&n);
    for(int i=1;i<=n;i++) scanf("%d",&a[i]),f[i]=1ll;//f[i]需初始化为1
    for(int i=2;i<=n;i++){//正着扫一遍
  	if(a[i]>a[i-1]) f[i]=f[i-1]+1;//a[i]>a[i-1]的情况
  	else if(a[i]==a[i-1]) f[i]=f[i-1];//a[i]=a[i-1]的情况
    }
    for(int i=n;i>=2;i--){//反着扫一遍
        if(a[i]<a[i-1]) f[i-1]=max(f[i-1],f[i]+1);//相当于a[i-1]>a[i]的情况，处理f[i-1]而不是f[i]，一定要取max!
        else if(a[i]==a[i-1]) f[i-1]=max(f[i],f[i-1]);//a[i]=a[i-1]的情况
    }
    for(int i=1;i<=n;i++) ans+=f[i];//求和
    printf("%lld\n",ans);//输出橙子总和
    return 0;//完美结束
}
```
~~为什么这么简单的题目我在比赛时没写出来……~~

**注：2020.4.12 修改了代码的一些漏洞**