其实题目并不难,只是相当于做了两道题而已..

首先需要了解的一点是:我们最终需要回到1号点,所以每一条边肯定都会走至少2次,并且对于一棵树,一条边允许走两次的话存在一笔画的方案.所以我们直接把走的所需时间*2就好了.这样就不需要考虑回到1号点的问题了.

然后对于Subtask 0..

实际上就是Subtask 1的做法..

直接dfs暴力枚举和不和第$i$个角色对话并且记录愉悦值,然后直接暴力算出需要走多久.

然后把上面的东西按照走的时间排个序,然后对于每一个询问选择最大的愉悦值就好了..

Subtask 2的话..

树形DP..

我们可以定义状态$f[i][j]$表示在$i$的子树中走最多$j$的单位时间所能获得的最大愉悦值.

这个转移方程应该比较显然吧..如果不太清楚直接看代码部分就好了..(其实只是懒而已..)

[代码](https://www.luogu.org/paste/9ysudvv6)