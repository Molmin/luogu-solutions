和官方题解不太一样的推法（自己认为比较自然

首先想象一根不拉的拉面，也就是一个线段被等分成 $n$ 份，每一份依次染上 $1,2,\cdots,n$ 色，每一次将这个线段对折，对折 $k$ 次。问题变为对折完后长为 $\frac{1}{2^k}$ 的线段的 $\frac{x}{n}$ 处所含的 $2^k$ 层中，每一种颜色出现次数的加权和。

这里可以先把 $n$ 中 $2$ 的幂次去掉变成奇数，$O(n \log n)$ 暴力模拟前面 $\log n$ 次折叠，以下推导中默认 $n$ 是奇数。

此时不可能再约分了，注意到每一个贡献差不多就是 $\frac{2^k}{n}$，偏差的 $1$ 具体是：

先差分，差分完后应该贡献 $[\frac{i2^k+x}{n}](a_i-a_{i+1})$，不用取整的式子是容易计算的，因此我们可以改为计算 $(i 2^k +x)\bmod n \times b_i$，其中 $b$ 是 $a$ 的差分序列。再注意到 $i2^k+x \to i2^{k+1}+x$ 这个有向图是若干个圈的并，每一个圈长度都相同为 $2$ 模 $n$ 的阶，我们可以把每一个圈都分别算一次循环卷积求出所有本质不同的 $k$ 的答案，再把所有对应位置的答案加起来即可。 

具体回答询问的时候利用光速幂很容易做到 $O(1)$，总复杂度 $O(n\log n +q)$。