由数据范围可知，这道题一定是一道结论题Or数学题。

所以，我们打开样例，立刻臆测了一个$Ans=n-1$的算法，然后……

后来，经过我们不懈的测试~~骗分~~，终于发现：

> 当$n=4$或$n=10$时，$Ans = n+1$

那这是为什么呢？

---

首先，我们要读题：

大意是，给你一张图，请你求出它的最小生成树的边权和。

那么，我们采用递推的思想。用$f_i$表示$i$个点最小生成树的边权和。

那么显然：

$f_i \leqslant \min(S) + f_{i-1}$，其中$S = \{e|e\in E,e.dest=i \}$

（即到达$i$号点中边权最小的一条边连上）

显然，如果$\exists e\in E,e.dest=i,e.val=1$那是最好的，而此时$f_i = 1 + f_{i-1}$

所以，我们接下来就要证明：绝大多数情况下，$f_i = 1 + f_{i-1}$。

> 为下面叙述方便，规定$n\;\bot\; m$为$\gcd(n,m)=1$。

# Part 1 -- 初步分析

假设$\exists m \in [ 1,n),\exists e$且$e.from=m,e.to=n,e.val=1$，

则必有：

$((m+1)^2-1)\;\bot\; ((n+1)^2-1))$

根据辗转相减法，得：

$((m+1)^2-1)\;\bot\; ((n+1)^2-(m+1)^2)\qquad$（因为$m<n$，所以两边都为正。）

因式分解，得：

$(m(m+2))\;\bot\; (n+m+2)(n-m)$

注意，这个式子非常重要，因为从两边各取一个因式，两两互质（显然，反证法可得）。所以，我们可以得到四组互质：

$\begin{cases}n\;\bot\; m\\n\;\bot\; (m+2)\\(n+2)\;\bot\;m\\(n+2)\;\bot\;(m+2)\end{cases}$

这四个式子同时成立是存在边权和为$n-1$的最小生成树的充要条件。

至此，第一部分结束。

# Part 2 -- 深挖关系

接下来我们就会一脸懵逼：

这几个式子咋用哪？

看官莫急，我们换一个角度：

> 何为互质？

>  ——答：没有相同的质因数。

没错，接下来我们就从质因数的角度分析这几个式子。

---

以第二个为例：

$n\;\bot\; (m+2)$

如果不成立，那能说明什么？

即$\exists p,n\equiv 0(\mod p),m\equiv p-2(\mod p)$。

也就是说，对于一个质数$p$，如果$n\mod p,m\mod p\in \{0,p-2\}$，则这四个式子中必然有一个不成立，也就不存在边权和为$n-1$的最小生成树。

画成图表就是这样（红格代表$m$可以）

![](https://cdn.luogu.com.cn/upload/image_hosting/5a8t4a10.png)

我们~~很感性地~~发现，从$\mod 5$开始，红色的面积大幅上升，所以我们只需考虑$\mod 2$和$\mod 3$即可。

~~然而mod5还是有影响的。~~

所以，我们枚举$0\sim 11$的$n$、$m$，看看规律：

（红色代表可以，白色代表被$\mod 2$，$\mod 3$Pass掉的情况，而黄色代表被$\mod 5$Pass掉的情况。~~虽然理论上$(11,11)$也得被Pass，但无伤大雅，所以偷懒了qaq。~~）

![](https://cdn.luogu.com.cn/upload/image_hosting/kmsa8nsv.png)

~~好漂亮啊~~

所以根据上图~~感性~~分析一下，在$n \in [0,11]$时，哪些点不行呢？

显然$m<n$，所以经处理后图长这样：

![](https://cdn.luogu.com.cn/upload/image_hosting/jsr8clzr.png)

发现有$4$行空着，那么我们分别来看一看：

> $0$：$n$不能为零啊……

> $1$：单身狗的自卑……

> $4$，$10$：妥妥的……

所以，$4$和$10$不能做到。

# Part 3 -- 结尾

那么，是不是所有的$n\equiv 4(\mod 6)$就都炸了呢？莫慌，我们来分析分析。

## $n \equiv 0(\mod 6)$

1. $6$：我真险。
2. $\geqslant 6$：$11$收入囊中。

此时此刻，我们来看一看$6k$的心理：

> 我手里有一个$5$，还有一个$11$，

> 任意一个质数显然干不掉我们两个。

> 两个质数也干不掉，我有奇偶性撑腰$\sim$

所以，$n\equiv 0(\mod 6)$搞定。

## $n \equiv 1,2,3,5(\mod 6)$

~~请读者自证，基本同理。~~

## $n \equiv 4(\mod 6)$

1. $16$：幸好我有一个$5$和一个$11$。
2. ~~请读者自行理解。~~

综上所述，只有$n=4,10$是特例，其余所有的都可以得到$f_i=f_{i-1}+1$

---

Wait!如果链在$4$这里断了，那么我们是怎么做到继续递推的？

答：只须构造一个点数为$5$，边权和为$4$的$MST$即可。

幸运的是——$(4+1)^2-1=24,(5+1)^2-1=35,24\;\bot\; 35$！

于是只需自$4$向$5$连边即可。

而$(1+1)^2-1=3,3\;\bot\; 35$，所以$f_5=f_3+2$

$10$亦同理，留给读者思考（~~明明是$5ab$太蒟了，根本算不出来~~）

---

最后一个问题：如果$n=4,10$，那么边最少究竟是多少呢？

我们发现，自$4$号点向前面连边，最小的$\gcd$为$3$，$10$亦同理。

所以，$f_4=f_3+3,f_{10}=f_9+3$，化简得$f_i=i+1(i=4,10)$

所以，最终的答案是$f_n=\begin{cases}n-1&n\ne 4,10\\n+1&n=4,10\end{cases}\qquad(n \in N^{+})$

代码就不放了，重点是理解证明过程。

# 鸣谢

@unputdownable ， @_ZMF_ 巨佬的证明提示及帮助。