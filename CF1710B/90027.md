给个不过脑子的做法。适合我这种没有长脑子的人。

首先考虑算出每个位置最终的降雨量。注意到如果一个位置不是某天的中心，它最终的降雨量肯定是不优于两边的，原因显然。所以只用考虑所有降雨中心最终的降雨量。

先将所有天的降雨按中心位置从小到大排序。这样每一次降雨能影响到的位置范围是数组中连续的一段，不妨记为 $[L_i,R_i]$。

将绝对值号拆开分类讨论，先处理位置在第 $x_i$ 前的情况，每个位置的增量为 $(p_i-x_i)+x_j$，括号内的为定值，$x_j$ 对于每一位也是定值，用两个数组差分即可。

位置在 $p_i$ 后的同理，详见文末代码链接。

现在已有每个位置的降雨量 $v_i$，仍然是依次枚举撤销 $i$ 天的影响：

如果影响范围外有大于限制的值，即 $\exists j \in\Big([1,L_i) \cup (R_i,n]\Big)\cap \mathbb{N_+},v_j>m$，当前位置答案为 0。

如果影响范围内存在，即 $\exists j \in [L_i,R_i]\cap \mathbb{N_+},v_j-(p_i-|x_i-x_j|)>m$，当前位置答案为 0。

思路仍然是分类讨论拆绝对值，维护区间 $v_i+x_i,v_i-x_i$ 的最大值即可，st 表和线段树等数据结构任选。

[Code](https://codeforces.com/contest/1710/submission/175198252)