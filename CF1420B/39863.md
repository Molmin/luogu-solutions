注意到一个性质：

> $a_i$ 只可能跟与 $a_i$ 转成二进制之后位数相同的 $a_j$ 产生贡献。

证明：

设 $a_i,a_j$ 为转成二进制之后位数不同的两个数（不妨设 $a_j>a_i$），则他们转成二进制后形式必然如下：

```
ai: 0...0....
aj: 0...1....
```

那么有：

```
ai^aj: 0...1....
ai&aj: 0...0....
```

可以注意到在 $a_i,a_j$ 不同的第一位就已经出现了 $a_i\text{XOR}a_j$ 为 $1$，而 $a_i\text{AND}a_j$ 为 $0$ 的情况，即 $a_i\text{XOR}a_j$ 必然大于 $a_i\text{AND}a_j$.

故只有 $a_i,a_j$ 具有相同的二进制位数的时候 $a_i,a_j$ 才可能产生贡献。

于是我们可以枚举二进制位数，仅对二进制位数为当前枚举的二进制位数的 $a$ 统计答案，时间复杂度为 $O(nlog\text{maxa})$，其中 $\text{maxa}$ 表示最大的 $a_i$。