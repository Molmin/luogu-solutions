考虑给出 $S$，如何求 $P, Q$。先考虑 $P$，那我们肯定想让 $P$ 的每一项都尽量往前靠。设 $[1, k]$ 为合法括号串，$S_{k + 1} = \texttt{)}$，那 $P$ 的前 $k$ 项依次为 $1 \sim k$，第 $k + 1$ 项不能为 $k + 1$ 了，那找到 $k + 1$ 之后的第一个左括号，设其位置为 $p$，那 $P_{k + 1} = p, P_{k + 2} = k + 1$。一直如此直到某个时刻，前缀左括号数和右括号数相等，并且下一个字符是左括号，那就回到了一开始的情况，从这个左括号往后填。这样可以求出 $P$，求 $Q$ 类似地可以从后往前就变成了求 $P$。

考虑画出折线图，那可以发现，$x = 0$ 上方部分可以依次填不需要改动顺序，$x = 0$ 下方就先找到从左往右第一个之前没选过的左括号，和第一个之前没选过的右括号配对。

现在考虑原题，给出 $P, Q$，构造 $S$。先暂时不考虑无解情况。发现如果 $P_{2i - 1} < P_{2i}$，这一段一定在 $x = 0$ 上方；如果 $P_{2i - 1} > P_{2i}$，这一段一定在 $x = 0$ 下方，并且可以确定 $S_{2i - 1} = \texttt{(}, S_{2i} = \texttt{)}$。那我们可以确定，折线在 $x = 0$ 下方部分的 $S$ 了。这时候我们惊喜地发现，因为求 $Q$ 的过程是反过来的，所以可以类似地，根据 $Q_{2i - 1} < Q_{2i}$ 确定折线在 $x = 0$ 上方部分的 $S$。两个合在一起，我们发现 $S$ 可以被唯一确定！

但是你先别急，还没做完。因为我们发现有很多繁琐的无解情况需要特判。若 $S$ 还有没被确定的部分，就一定无解；否则可以根据 $S$ 求出 $P, Q$，验证是否和题目给出的 $P, Q$ 一致即可。

时间复杂度是优秀的 $O(n)$。

[code](https://atcoder.jp/contests/arc141/submissions/42237479)

-----

一定要多思考，不能怠惰啊。