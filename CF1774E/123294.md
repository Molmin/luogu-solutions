如果第一颗棋子要经过 $i$，相当于第二颗棋子要经过 $i$ 的 $d$ 级祖先。用 DP 实现该过程，设 $d_i$ 表示 $i$ 子树内距离 $i$ 最远的第二颗棋子必须经过的位置与 $i$ 的距离，对于第二颗棋子的 $d$ 级祖先也是类似。答案即第一颗棋子必须经过的位置的虚树大小的两倍，加上第二颗棋子必须经过的位置的虚树大小的两倍。

时间复杂度 $\mathcal{O}(n)$，[代码](https://codeforces.com/contest/1774/submission/185659777)。