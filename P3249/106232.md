大概的思路就是平面图转对偶图，然后平面当点建树，记录面积和面积的平方的子树和，利用一些性质求解。

这道题的难点就在于

1. 把已有的点，选择一些边，化成一个个独立的平面(有可能不封闭)。
2. 由于询问给定的是边界，如何判定边界中含有多少个独立平面。

对于第一个难点，可以采用平面图转对偶图的形式来实现，即定起点，进行极角排序。

找出一条边的后继边，划分平面。

不难发现，如果是双向边，若平面接壤，恰好是各占一条。

同时求平面面积，如果面积为负，则说明这个平面不封闭，由于在询问中不会产生贡献，可以把其当成树的根。

建树的时候，记录一下树边(即遍历到的的双向边)，面积和面积的平方的子树和，这个在询问时起到很大的作用。

如图

![20.PNG][1]

这个树建出来是一条链($1->2->3->4->5$)。

若询问要求$3,4$平面，那么也就是做一个容斥，$3$子树减去$5$子树即可。

由于边界上，一定含有一条树边连接$3$与$3$的父亲$2$，即红色的$BI$，以及$5$与$5$的父亲$4$，即红色的$DE$。

那么就可以利用这个性质，推广一下:如果在边界上碰到一条树边，判断一下这条边的方向(是由父亲指向儿子，还是儿子指向父亲)之后对贡献取一下正负就可以做到容斥。

其实这个方向没有太大必要，取个绝对值是一样的。

还有一个小技巧，由于面积可能出现$.5$的情况，乘下$2$就好了。



  [1]: http://lb2003.top/usr/uploads/2020/04/3513445950.png