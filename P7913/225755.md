- **做法**：

首先，我们思考一下。因为有“先到先得”这个条件，那么如果有 $k+1$ 个廊桥的话，最后一个廊桥一定是在原来只有 $k$ 个廊桥的基础上选的。

考虑归纳，容易知道 $0$ 个廊桥的时候答案为 $0$。那么我们只需要思考已知 $k$ 的答案如何计算 $k+1$ 的答案。

首先，最前面一个未选的区间肯定是要选的。接着由“先到先得”这个原则，我们肯定是选左端点离最后一个已选区间的右端点最近的那个未选区间。那么我们对所有区间的左端点开一棵平衡树，每次选右端点的后继即可。

每个区间最多进出平衡树一次，那么时间复杂度为 $O((m1+m2)\log n)$。

统计出来每边放的廊桥所对应的答案之后，枚举两边分别放多少个廊桥加起来取最大值即可。

- [代码](https://www.luogu.com.cn/paste/zx3f3x8o)