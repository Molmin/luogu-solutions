P8491 [IOI2022] 囚徒挑战 题解。

首先发现要比较大小。加之本题非常小的上界限制，确定了按位比较的基本思路。所以一个粗估的做法是：

> 假设 $b$ 进制，则每次用一个二元组 $(x,y)$ 表示当前在比较第 $x$ 位，A 的第 $x$ 位为 $y$（$y=b$ 表示尚未询问），每次一个人进来，如果 $y=b$ 就翻 A 袋子更新 $y$，否则翻 B 袋子作比较，如果相同就更一个 $(x-1,b)$，否则返回答案。
> 

把二元组映射成一个数即可。这样可以做到 $\lceil\log_bn\rceil\times (b+1)$ 的上限，毛估估一下取到 $b=3$，上限 $32$。

优化点显然在于那个 $y=b$ 太浪费了。考虑每次交替记下 A、B 袋子，每次比完不取 $(x-1,b)$ 而是取记下 $x-1$ 位的比较数。这样可以把 $b+1$ 砍成 $b$，上限 $24$。

这样过程里的每一步基本都必要了。实在要说就是 $A\neq B$ 让最后一步放 $0/2$ 的情况直接能返回，进而做到上限 $22$。

---

观察样例发现 $n=3$ 的情况只需要 $1$ 就可以了。？

发现优化的点在于问出 $1$ 或者 $n$ 就直接判定结果了。

进一步 $n=4$ 也只需要 $1$。这个干的事情和 $24\to 22$ 的过程其实是相似的！

那考虑每一步按位操作是不是都能砍掉左右两边？

这样我们搞出一个迫真按位，即不按照位来，而是记录可能的值域区间，每次砍成三块，不断缩小。

但这样的操作虽然让每层都缩小了 $2$，但体现在实际上还是只能做到上限 $21$。

这时的步骤大概是：$5000\to 1666\to 555\to\cdots\to 20\to 6\to 2$，考虑操作一下让 $6$ 以下只需要 $2$ 步。可以发现从中砍成两块就行。（或者按照一个更普适的说法，在这层取 $b=2$）

这样就在上限 $20$ 内解决了本题。没啥放代码的必要性吧。