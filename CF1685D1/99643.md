# 题意
给你一个长度为 $n$ 的排列 $p$ ，要求构造出一个相应的长度为 $n$ 的排列 $q$，最小化：
$$
\sum_{i=1}^{n}|q_i-p_{q_{i\bmod n+1}}|
$$

# 解法
挺阳间的小清新构造。

显然我们应该考虑转换掉上述的价值式子，令 $w_{q_{i+1}}=q_i$，那么上述式子就转换成了
$$
\sum_{i=1}^{n}|w_{q_{i+1}}-p_{q_{i+1}}|
$$
$$
=\sum_{i=1}^{n}|w_i-p_i|
$$

那么当 $w_i=p_i$ 时，原式等于 0 ，是最优的。

但是你观察 $w$ 的性质，显然不是任意的排列都会合理，$w$ 是 $p$ 的一个置换，且这个置换是一个唯一的循环置换，也就是说，一个合法的 $w$ 只能有一个环。

现在目标转换成了构造一个合法的 $w$ 。我们考虑先令 $w_i=p_i$，在其基础上调整成一个环。

我们捆出 $n$ 个二元组，$P_i=(id_i,x_i)$ ，其中 $x_i=p_{id_i}$。我们把它们按照 $x$ 从小到大排序。

枚举排序后的每一个二元组，若 $id_{i}$ 和 $id_{i+1}$ 目前不在一个环内，那么交换 $(w_i,w_{i+1})$，这样就可以合并两个环。不难发现这是合并环的最优策略。

设 $c$ 为初始情况下环的个数，容易发现代价下界是 $2c$，由于排了序，我们可以取到下界，所以构造出来的 $w$ 的最优性可以得到保证。