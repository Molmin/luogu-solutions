考虑到每个操作的选择其实是相对独立的，也就是说只要确定了当前已经选择的食物集合 $S$ 和当前的体重 $w$，未来的决策和 $S$ 中每个食物具体如何选择没有关系。 

因此我们每个食物单独考虑，如果 $a_i=1$ 那么必然是选择加法。

排除掉所有 $a_i=1$ 的情况，我们考虑剩下的怎么选。

一个重要的性质是如果有加法的话，必然是先加后乘，证明：

废话，每次乘法对一个数的贡献至少为 2.

另一个重要的性质是剩下的加法数量至多为 1，考虑证明：

假设选择了两次加法，他们的增量分别是 $b_i,b_j,b_i\leq b_j$，那么他对答案的贡献是 $\left(b_i+b_j\right)\times s$，其中 $s$ 表示选择乘法的数的乘积。我们考虑把不选 $b_i$，他的贡献就是 $b_j\times s\times a_i$，显然 $b_i+b_j\leq b_j \times a_i$.

暴力枚举就好了，比较的时候注意一点细节就可以避免高精度。