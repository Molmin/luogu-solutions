兔队的题解已经很清楚了，但蒟蒻在这里想说明一下思考的过程

### 先看A树，

首先注意到只能选叶子。因此断的边都是确定的，只有连的边会出现决策。

然而对于非叶子节点它的断边就不一定了，但注意到如果确定一个联通块不操作的话，把其它的点挂在这个联通块上，就可以确定每个点的断边都是父边

如何确定一个连通块不操作？考虑枚举这个联通块，那么显然枚举一个点就够了，然而可能所有的点都操作，这样的话我们注意到每个点最多操作一次，因此只需要确定第一次操作的方式即可。

上述思想是**将无根树转化为有根树**

那么现在还存在一个问题，即确定根后怎么处理

### 我们回过头来看B树

第一次操作后B树也将变为一棵有根树，我们惊奇的发现，这个时候**每次操作添加的边也是确定的！**

因为我们先看根的直接儿子，它们的父边要不就是本来就存在，要不就是它们添的，因此每个点如果操作就会连向它在B树上的父亲。

然后显然有结论：

> 设$p_u$为$u$的节点的操作时间，$p_{fa_u} < p_u$

注意这里的$fa$是B树上的父亲

这个结论很好证明，因为如果先操作$u$，那么$fa_u$将会获得一个度，继而变成非叶节点

同样的，在A树上，也有同样的结论

> 设$p_u$为$u$的节点的操作时间，$p_{fa_u} > p_u$

之后的思路就很明确了，建图跑最短路即可

时间$O(Tn^4)$，atcoder没卡我（好耶）