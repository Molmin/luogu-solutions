## 题目大意

给定一个长度为 $n$ 的序列。

每次询问一个区间 $[l,r]$，相同的数最多只能取 $k$ 个，问总共能取几个数。

题目要求强制在线

## Sol

考虑这样一个问题，询问一个区间中有几个不同的数。

即 $k=1$ 并且离线的情况。

**但是**

本题要求强制在线。

考虑可持久化线段树。

$T_l$ 存的是 $last_i<l$ 的 $i$，在 $i$ 的位置上 $+1$. 这样每次在 $T_l$ 这棵树上查询 $[l,r]$ 的区间和即可。

对于每个数最多可以算 $k$ 次，只需要处理出 $lastk_i$ 即可。（即 $i$ 前面第 $k$ 次出现 $a_i$ 的位置）

时间复杂度 $O(n \log n)$。