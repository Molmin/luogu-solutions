# 题意
题目说的很清楚了，就不赘述了。

# 操作
操作 $1$ ,$2$ 没什么好说的，直接大力上线段树或者文艺平衡树即可，操作   $4$ 也很简单，因为不超过 $10$ 次，直接暴力中序遍历即可，我们重点来看操作 $3$ ，将一个区间内的变量乘上 $x$ ，实际上就是这个区间内的次数加一，也就是将这个区间内的系数整体向右平移一位，同时别忘了加上 $x^{r+1}$  那项的系数，同时原来  $\ x^{l}\ $ 的系数也就变成了零所以还要插入一个空节点 ,然后就变成了 fhq__treap 模板题了，这个题连区间和都不用维护，可谓是业界良心。

操作 $3$ ,代码：
```cpp
			cin>>l>>r;l++,r++;
			split(root,l-1,x,y),split(y,r-l,y,z),split(z,1,z,r1),split(r1,1,r1,r2);
			z->plus(r1->w);r1->w=0;//x,r1,y,z,r2
			root=merge(merge(x,merge(r1,y)),merge(z,r2));
```

由于是乘法优先级更高，所以我们在进行区间乘的时候别忘了更新加法标记。

# 代码

由于题解还没人用指针，蒟蒻决定用指针写一次。
有一些小细节：
1. 由于有操作 $3$ ，长度有可能超过 $10^{5}$ ，我们在建树的时候要多开几个节点。

2. 乘法标记记得赋初值 $1$ ，不然输出全是 $0$ （这个应该好查出来）。

3. 写操作 $3$ 的时候一定要静下心来，仔细处理区间之间的关系，最好按顺序一个一个裂开。

4. fhq_treap 老生常谈了，记得合并！

5. 多项式系数从 $0 $ 开始，而  fhq_treap 维护从 $0 $ 开始的区间会出问题，整体加一即可。

6. 求值的时候别忘了 push_down。

[ 代码戳这里 ](https://www.luogu.com.cn/paste/27fz5ycb)