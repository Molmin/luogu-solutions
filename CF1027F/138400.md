~~额朋友们好 这篇题解是来讲卡常的 因为这是一只线对的菜鸡~~

第一眼看到就知道可以二分答案 + 判二分图完美匹配，但是网络流跑不过去。那就考虑 Hall 定理。

如果有两天都选不了的就滚蛋。如果只能选一天，那就强制选，然后会导致连锁反应——一些其他人也必须强制选，就递归实现即可，如果有无法搞的就滚蛋。剩下来的都是可以选两天的，于是把人放左边，天放右边连二分图。应用 Hall 定理，对于任意左部子集，如果连过去之后不连通，显然可以拆成若干个连通的子条件，不需要考虑。所以只要考虑连通的情况。

选一个人要把连的两天都带上，这个「两」不难想到把人看成边，连两天，那么就是不能存在一个边集使得它的导出子图包含点数要小于边数。于是就建个图再说啦。由于是连通的，有 $|E|\geq|V|-1$（这就是仅考虑连通情况的好处），要满足 $|E|\leq|V|$，只有 $|E|=|V|-1$ 或 $|E|=|V|$，分别等价于树和基环树。然后不难发现，一个连通块的所有边导出子图都是树或基环树，和该连通块是树或基环树是等价的。那就跑出所有连通块然后看是否树或基环树，等价于判断是否有 $|E|\leq|V|$。

这样是线对的。然后考虑到一开始递归处理只能选一天的情况有点难写，可以强行加到最终的结论上，就是选一个点的话就可以选对应的只能选它的所有人，就建若干个自环即可。

看到题解区基本全是线性的，我不禁自惭形秽。~~但是图论题总不可能出到 1e7 吧？那不出到 1e7 的话线性和线对不是一样的吗？~~ 然后真就 T 掉了，懒得改前向星干脆直接上路径压缩 + 启发式双优化并查集，虽说是 $\mathrm O(n\alpha(n)\log n)$，但常数比 `vector` + 递归要小好多了。~~最终以 3900+ms A 掉了，~~**_[code](https://www.luogu.com.cn/paste/cxwaeyh5)_**。