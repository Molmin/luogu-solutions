使用 Hall 定理，题目转化为：

> 每张卡牌有两个权值 $a,b$，选择一个权值作为其最终权值 $x$，把另一个序列 $A$ 的区间 $[x,\infty]$ 加一。每张单面卡牌会使得 $A[x,\infty]$ 减一。有 $q$ 次询问，每次再给出一张卡牌 $(a',b')$，加入到牌堆里。在这种情况下，求一种选择 $a$ 数量最多的选择方案，使得操作完后 $\forall i,A_i\ge 0$。

如果枚举 $(a',b')$ 选哪边，可以简化为

> 每张卡牌有两个权值 $a,b$，选择一个权值作为其最终权值 $x$，把另一个序列 $A$ 的区间 $[x,\infty]$ 加一。每张单面卡牌会使得 $A[x,\infty]$ 减一。有 $q$ 次询问，给出 $k$，求一种选择 $a$ 数量最多的选择方案，使得操作完后 $\forall i<k,A_i\ge 0;\forall i\ge k,A_i\ge -1$。

如果钦定每张牌先选 $a$，不行再改成 $b$（只有 $b<a$ 才有意义），可以简化为

> 给出序列 $A$，以及 $n$ 个区间 $[b,a)$。有 $q$ 次询问，给出 $k$，求一种选择 区间数量最少的选择方案，给所有选择的区间 $[l,r)$，执行 $A[l,r)$ 加一，使得操作完后 $\forall i<k,A_i\ge 0;\forall i\ge k,A_i\ge -1$。

接下来就有一步非常 AGC，*看上去平平常常，自己想起来却未必顺顺当当。*

可以证明，设 $i$ 是最大的 $A_i<-1$ 的位置。设 $I=[l,r]$ 是 $l$ 最小的包含 $i$ 的区间，则最优解一定会选 $I$。

> 证明：考虑某个最优解（不包含 $I$）中右端点最小的包含 $i$ 的区间 $J$。
>
> 1. 这次询问里面 $i$ 的限制是 $\ge 0$。至少有两个区间包含了 $i$，故 $J$ 的右端点被包含了至少两次，删去一次不会变得不合法。所以把 $J$ 换成 $I$ 不劣。
> 2. 这次询问里面 $i$ 的限制是 $\ge -1$。那么 $i$ 后面都没有限制了，当然左端点越左越好。

因此，不停重复以下过程：

- 找最右边的 $A_i<-1$ 的 $i$。
- 选择区间 $I$，更新 $A$。

可以得到一些一定选的区间。

选完这些区间后，$A_i\ge -1$，变成了这个问题：

> 给出序列 $A$，以及 $n$ 个区间 $[b,a)$。$A$ 中只有 $0,-1$。有 $q$ 次询问，给出 $k$，求一种选择区间数量最少的选择方案，使得 $<k$ 的所有 $-1$ 的位置都被区间覆盖了。

这时，显然不停贪心选包含最左边 $-1$ 而右端点最右的区间最优，而这个贪心过程对于所有 $k$ 都一样，可以预处理出答案。

用 `priority_queue` 维护选区间的过程，$A$ 的维护可以差分做到线性。