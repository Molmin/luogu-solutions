题意：

求构造一个长度为 $n$ 而每个数取 $[1,m]$ 之间的“完美序列”$A$ ，使得其中所有数之和最小化。如果不存在，输出 $-1$ 。

完美序列的定义：对于所有 $K$ 个约束条件，对于第 $i$ 个约束条件，满足以下三者之一：

+ $A_{p_i}<x_i$ 且 $A_{q_i}<y_i$ ；
+ $A_{p_i}=x_i$ 且 $A_{q_i}=y_i$ ；
+ $A_{p_i}>x_i$ 且 $A_{q_i}>y_i$ 。

$1\le n,m,k\le 2\times 10^5$ 。数据合法。

---

想到一个增量法方案。

因为每个数一开始都是一个 $[1,m]$ 的区间形式，所以可以从上到下，对于每个节点**分裂区间**。

但是碰到了困难（因为不知道如何存储）故弃。

---

下面是官方题解的思路：

碰到操作的时候，对于条件 $i$ ，等价于 $A_{P_i}\le X-1$ 当且仅当 $A_{Q_i}\le Y-1$ 而且 $A_{P_i}\le X$ 当且仅当 $A_{Q_i}\le Y$ 。可以把它拆成两个约束条件看。所以我们只要让 $A_{P_i}$ 和 $A_{Q_i}$ 要么都符合条件（指分别小于等于 $X,Y$）要么都不符合条件即可。

首先初始 $A$ 所有元素为 $1$ 。不断约束使得 $A$ 符合条件。

然后对于一个个条件不断更新：如果 $A_{P_i}$ 大于 $X_i$ ，那么 $A_{Q_i}$ 就更新为 $\max(A_{Q_i},Y_i+1)$ 。同理 $A_{Q_i}$ 大于 $Y_i$ 也对 $A_{P_i}$ 做类似处理。

最后判断一下在 $M$ 的值域之内即可。

这样做的正确性显然：增量法，假设之前已经构造出了最优解，这两个元素无疑是最小的。如果符合条件就无需变动，否则就取一个对于两者都最小的不符合值域的值。

所以就可以 $O(n+k)$ 做了。