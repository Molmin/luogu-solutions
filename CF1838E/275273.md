**结论：$a_i$ 对答案没有影响。**

考虑设计一个 $O(nm)$ dp，$f_{i, j}$ 表示填到第 $i$ 个位置，匹配到了 $a$ 的第 $j$ 个位置。发现无论 $a_j$ 是什么，总是恰好有 $1$ 个 $1 \sim k$ 的数，满足填了它之后 $j$ 加 $1$，恰好有 $k - 1$ 个数，满足填了它后 $j$ 不改变。

既然跟 $a_i$ 是什么无关，就不妨让 $a_i = 1$，可以转化成，计数长度为 $m$，值域 $[1, k]$，至少有 $n$ 个 $1$ 的序列。这个计数是平凡的，容斥，变成 $1$ 的个数 $< n$。枚举 $1$ 的个数即可，答案为：

$$k^m - \sum\limits_{i = 0}^{n - 1} \binom{m}{i} (k - 1)^{m - i}$$

注意这题不能预处理阶乘及其逆元，但是 $\binom{m}{i}$ 是可以通过 $\binom{m}{i - 1}$ 递推得到的。

[code](https://codeforces.com/contest/1838/submission/208676286)