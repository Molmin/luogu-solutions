废话不多说，直接开门见山。

**定理：** 生物之间的灭绝结构形成了一个森林，森林上的节点的灭绝会且仅会导致以它为根的子树的灭绝。~~好惨~~

**分析：** 对于生产者，不妨给它添加一个假象的食物——太阳。那么定理中的森林就变成了一棵树，可以称它为“灭绝树。”

下面说明如何通过增量法把灭绝树建出来，同时也是对灭绝树的存在的证明。

首先，把食物网按照从猎物到捕食者的顺序拓扑排序，有且仅有太阳没有任何的入边，所以拓扑排序的第一个就是太阳。把太阳加入灭绝树，此时，灭绝树只有太阳一个点。

之后，一次考虑每个生物$i$。已经构建好排序在$i$之前的生物组成的灭绝树，假设$i$生物的食物有$p_1,p_2,\cdots,p_k$,（这些节点在拓扑序中比$i$靠前），$i$会灭绝，当且仅当$p_1,p_2,\cdots,p_k$全部灭绝，当且仅当$LCA(p_1,p_2,\cdots,p_k)$灭绝。

于是，可以在树上加上$LCA$到$i$的边，把$i$加到树中。

处理完所有的生物，我们就可以得到整个图的灭绝树。

一旦得到灭绝树，每个生物的灾难值就可以通过以它为根的子树的大小$-1$来计算。

这便可以通过一次$DFS$来解决。

**复杂度分析（$LCA$使用倍增算法）:** 拓扑排序$O(n+m)$,求$LCA$共$m$次，每次$O(log_2n)$，加点共$n$次，每次$O(log_2n)$,$DFS$为$O(n)$，总时间复杂度为：$O(nlog_2n+mlog_2m)$