提供一个线段树做法。

容易发现这个题目可以转化成“枚举两个数 $a$，$b$，求有多少个在区间 $[a, b]$ 里的数 $c$ 满足 $a$ 位置的数小于 $c$ 位置的数的 $c$ 的个数乘求有多少个在区间 $[b, n]$ 里的数 $d$ 满足 $b$ 位置的数小于 $d$ 位置的数的 $d$ 的个数”的值。

时间复杂度为 $\mathcal O(T\cdot n^2\cdot \log^2n)$。

代码略。
