首先离线问题，考虑对区间右端点 $r$ 做 $1\to n$ 的扫描线。

扫描线过程中维护

+ ${a^\prime}_i=a_i\operatorname{and}\cdots\operatorname{and}a_r$
+ ${b^\prime}_i=b_i\operatorname{or}\cdots\operatorname{or}a_r$
+ ${c^\prime}_i=\gcd(c_i,\cdots,c_r)$

然后我们发现这样一个性质（？：随着 $r$ 的增大，

+ ${a^\prime}_i$ 的 $1$ 位会逐渐变成 $0$。
+ ${b^\prime}_i$ 的 $0$ 位会逐渐变成 $1$。
+ ${c^\prime}_i$ 的质因子会逐渐被去掉。

而这三者的变化次数都是 $\log n$ 级别。

我们维护 $s_i$ 为左端点 $\le i$，右端点 $\le r$ 的区间价值总和，对于 $L,R$ 的询问，答案就是 $s_{R}-s_{L-1}$。

考虑 $r$ 的一次右移对 ${a^\prime}_i,{b^\prime}_i,{c^\prime}_i$ 的影响，进而考虑对 $s_i$ 的影响（其实就是 $[i,r+1],[i+1,r+1],\cdots,[r+1,r+1]$ 的价值和）。

根据上面的性质，我们发现：对于 ${a^\prime}_i,{b^\prime}_i,{c^\prime}_i$ 而言，在 $i$ 很靠近 $r$ 时影响很大，而每远离一点影响就比前一次小。到达一个位置 $p$ 之后就再也没有影响了。

并且，有影响的位置每次都是 $O(\log n)$ 个，因此可以考虑对于每次移动 $r$，都暴力遍历找到 $p$，复杂度是 $O(n\log n)$ 的。然后对于 $p,\cdots,r$ 的位置，暴力计算新价值和。

那 $1,\cdots,p-1$ 的位置的答案怎么办呢？我们发现这一轮没有影响他们的答案，所以他们的答案更新其实和上一轮修改的答案更新是一样的，不需要再计算。

于是我们给每个位置都打上标记，代表它上一次修改增加的价值和 $w$，同时多维护一个上一轮修改的时间 $t$，那么 $r$ 时刻总体答案可以理解为 $s_i+(r-t)\times w$。

当然暴力计算答案这一步要先把之前打的标记的贡献算到 $s_i$ 里面去，再把新的贡献打在标记里面。

分析一下时间。我们枚举 $p$ 这步就 $O(n\log n)$ 了，按位与和按位或作为位运算是 $O(1)$ 的。$\gcd$ 看起来复杂度不太对，但是总共只会有 $O(\log n)$ 个因子，你用辗转相除求 $\gcd$ 即使求 $\log n$ 次也只有 $O(\log n)$ 的计算量。