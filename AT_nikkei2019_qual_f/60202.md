首先 $x=1,2,3$ 的情况很容易处理，然后如果 $x=3$ 无解，那么 $x$ 为任意奇数时均无解，特判即可。

然后考虑每次将 $x$ 变为 $x+2$ 后答案以及具体取的宝石如何变化，再分 $x$ 为奇数偶数两类分别求解。

每种颜色的宝石内部按价值从大到小排序，那么可以将颜色分为目前没有取的和取了至少两颗的两类。

加入两个宝石有以下 $4$ 种情况：

$(1).$加入两颗宝石（颜色可以相同），两种颜色的宝石都至少取了两颗。

$(2).$加入一对颜色相同的宝石。

$(3).$删除一颗宝石，加入三颗颜色相同的宝石。

$(4).$删除一对颜色相同的宝石，加入三颗颜色相同的宝石，再加入另一颗宝石。

开 $5$ 个堆维护剩余能直接加入的宝石、一对/三个颜色相同的宝石、已经加入的单个/一对宝石。

其本质是带反悔贪心。