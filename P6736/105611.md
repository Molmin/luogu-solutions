好像挺简单的。

$n=1$ 就是萌萌 BSGS。

$n=2$ 你手动画出来就是一个幂塔 $a^{a^{a^{a^{\cdots}}}}$（共 $n$ 个 $a$），你解一层之后哦 BSGS 模数就会变为它的欧拉函数值，也就是嵌套层数不超过 $O(\log n)$。

实际上只需要暴力枚举答案然后判断即可。

$n=3$ 的做法是类似的，你解一层幂塔之后模数也会变成欧拉函数，所以暴力枚举答案随便算算就好了。

还有一种做法，就是因为幂塔的高度高于 $2\log p$ 就没有意义了，而暴力展开一层可以发现后面的数字巨大，所以对于 $b>3$ 都满足 $a\uparrow^3 b=a \uparrow^3 3$。

暴力算 $a\uparrow^3 2$ 与 $a\uparrow^3 3$ 即可。

不太想写代码啊 QAQ。

复杂度 $O(T\sqrt p\log p)$。