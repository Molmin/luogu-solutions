# Solution

就这么一道简单题，怎么卡我这么久。

设 $dp_u$ 表示以 $u$ 结尾的没有相邻项的本质不同的子序列个数。

考虑每个字符串能不能被表示出来。我们每次在所有能选的相同字符中选最靠前的那一个，这样就可以避免重复。

考虑 $dp_u$ 可以从哪转移。设 $S_u$ 上一次出现的位置为 $lst_{S_u}$。那么从 $v<lst_{S_u}-1$ 的地方转移可以强制让他不合法，因为这样我们可以选 $lst_{S_u}$ 而不是 $u$，会产生重复。不过 $v=lst_{S_u}-1$ 除外，因为当时并不能选相邻的。

所以能转移的 $v$ 的区间为 $\{lst_{S_u}-1\} \cup[lst_{S_u},u-2]$。前缀和优化即可。

代码：[code](https://atcoder.jp/contests/abc214/submissions/43278779)

PS : 学习了一下官方题解，其实不需要前缀和优化，因为总的枚举数是 $O(26n)$ 这个量级的。