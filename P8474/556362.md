我们先设 $f_i$ 表示长度为 $i$ 的逆序对总数。

题目中有一句提示：只要 $a$ 中的元素大小关系是确定的，那 $f_{|a|}$ 就是确定的。

所以我们考虑对于 $f_i$，我们在第一个位置添加一个元素 $x$，后面的元素的大小关系是确定的，答案是确定的，正好就是 $f_{i-1}$，此时 $x$ 会对 $[2,i]$ 产生 $x-1$ 个逆序对，因为 $x\in[1,n]$，所以 $i$ 的答案就是 $\sum\limits_{j=1}^i2^{(j-1)f_{i-1}}=(2^i-1)2^{f_{i-1}}$。

因为 $f_i$ 看着不方便，我们可以将 $f_i$ 转化为 $2^{f_i}$，那么此时的递推式就是 $f_{i}=(2^i-1)f_{i-1}$。