首先，看到最后的式子乘上一个数，明显假期望，这是一道计数题。

题目要求选 m 张牌，打掉 k 张牌，并且是最优策略。这是本题的特色，也是突破口。考虑强化牌的系数大于 1，那么肯定是有多少打多少。如果大于 k 张就打 $k-1$ 张。至于攻击牌就是捡大的打就好。那么我们首先需要做的就是排序。

因为操作中涉及乘法和加法，这东西肯定要分开转移。

设计状态 $f_{i,j}$ 为攻击牌选了 i 张，排完序后最后一张是 j所有方案的总和。$g_{i,j}$ 为强化牌选了 i 张，排完序后最后一张是 j 所有方案乘积的总和。$num_{i,j}$ 表示与上面同样意义的情况下的方案数。

得到 DP 方程：
$$f_{i,j}=\sum_{k=1}^{j-1}{f_{i-1,k}+num_{i-1,k}\times val_j}$$

$$g_{i,j}=\sum_{k=1}^{j-1}{g_{i-1,k}\times w_j}$$

$$num_{i,j}=\sum_{k=1}^{j-1}{num_{i-1,k}}$$

这是三维的，复杂度太高，观察到有一堆求和，显然可以前缀和优化砍掉一维。

下一步我们考虑统计答案，按照我们上面的思路，我们需要枚举这 m 张牌强化牌选了多少张。分类讨论：

1. 选的牌数小于 k，那么这个时候是选多少打多少。

2. 选的牌数大于等于 k，这时打 $k-1$ 张。

接下来得把状态用上，选 i 张打 j 张的贡献：

$$ans=\sum_{l=1}^{n}{f_{j,l}\times C_{n-l}^{i-j}}$$

g 数组的贡献与其相同，这个组合数的意义很简单，就是当前是打了 j 张，最后一张在 l，然后对于没打的是在剩下的 $n-l$ 中选出 $i-j$ 张牌。

需要注意当 $k=1$ 时，强化牌的强化为 1，但是强化牌的组合是不止一个的，于是要乘上 $C_{n}^{i}$。



