发现题解区的写法跟我的都不太一样呢..

如果只考虑 $i$ 到 $j$ 的边权不超过 $w$，那就是一个点分治模板（P4178）。

那么加上长度不超过 $l$ 的限制以后，该怎么解决？

考虑在计算每个重心（即子问题的根节点）对答案的贡献时，用一个树状数组来来维护每个点到根节点的长度，再来进行统计。

不过 模板 $+$ 树状数组 的做法有一个问题，那就是会算重，具体指的是同子树内的两个节点对答案的贡献可能会被多算。解决方法也不难想，枚举重心的每个儿子就行了。这样一来复杂度仍是正确的。

时间复杂度 $\mathcal{O(n \log^2 n)}$，空间复杂度 $\mathcal{O}(n)$。

[AC Code](https://codeforces.com/contest/293/submission/188824912)