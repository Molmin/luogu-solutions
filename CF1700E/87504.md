[Link](https://www.luogu.com.cn/problem/CF1700E)

看到这个奇怪的问题，可以想到枚举。

首先对原题做一些转化：对于两个相邻的格子，从数字较小的那个向另一个连有向边。如此建图之后，“可解”就变成：除了填 $1$ 的格子，其它格的入度均不为 $0$。

那么首先对给定的填法建图（其实只用统计入度），如果已经满足条件，输出 $0$ 即可。否则，记 $cnt$ 为入度为 $0$ 的格数（不含 $1$）。

由于只能交换一对格子，所以至多影响 $10$ 个格子的度，当 $cnt \gt 10$ 时可以直接输出 $2$。

然后，由于入度为 $0$ 的格需要被消灭，所以其周围 $4$ 格与本身一定至少一个被改变。枚举这个格子和与之交换的格子即可。注意不要重复枚举。

下面的问题是判定交换两个格子是否满足条件。这并不麻烦。

首先把与这两个格子相关的边全部断开，也就是修改入度。注意不要重复。

然后交换数字，再连边。在此过程中，记录所涉及点入度的改变量。

最后对所有初始入度为 $0$ 的点判断一下，再对所有涉及的点判断一下入度就可以了。注意初始化不能用 memset（其实我没试过，不过大概率会 TLE）。

时间复杂度 $O(n\times m)$，但是大常数，但是能过。

代码写得很丑，开始绕了许多弯路。[Code](https://www.luogu.com.cn/paste/4s6kwixk)

Upd：修改了格式。