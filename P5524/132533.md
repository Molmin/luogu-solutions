**P5524 sol**

首 A，我的首 A 被抢了！！！

~~属于常数大师了。~~


-----------------------------------------------

其实还是扫描线的套路，维护每个颜色段所属的操作。

$1$ 操作可以是看在交换两个颜色段以及它们所属的操作。通过分类讨论不难证明这是对的。注意不是将所属的操作赋为**当前的交换操作，而是交换所属的 $2$ 操作。**


分类讨论的是左端点的着落情况。

可以理解成交换了两个 $2$ 操作的染色对象，但不完全等价。

显然对于每次 $3$ 操作，我们每次扫描线时查询最后一个影响到它的操作，显然该操作在它前面，在这个位置加上查询的答案即可。

树状数组辅助求和，时间复杂度 $O(n \log n)$，应该写线段树的，大意了！！！

如果有朋友也是颜色段均摊被卡常了，那就：

- set 不要套结构体；

- 初始的颜色段直接插入一个即可；

- 树状数组查询的时候得先看当前有没有挂询问，然后对于所有 $r$ 的查询可以在查之前预处理出来；

- 卡一下快读

这样可以虚假通过此题，感谢 lxl 开了 1s。