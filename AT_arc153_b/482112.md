看到这个题感觉很像 [文艺平衡树](https://www.luogu.com.cn/problem/P3391) 维护的东西，不过被放到了二维上来。

我们先观察这个操作的性质。不难发现：原来在同一列的，操作完还在同一列。原来在同一行的，操作完还在同一行。原因显然。

那么根据这个性质，我们是否可以直接压掉一维。考虑对所有**行号**做一套所有的操作，得到新的行号。这样原来在第 $i$ 行的现在在第几行我们就知道了。同理，对所有**列号**做一套所有的操作，得到新的列号。这样原来在第 $j$ 列的现在在第几列我们就知道了。

在两维问题转化成一维问题后，复杂度也降到了 [文艺平衡树](https://www.luogu.com.cn/problem/P3391) 的复杂度。

贺一个板子即可。注意做两次 [文艺平衡树](https://www.luogu.com.cn/problem/P3391) 中间要清空，否则会混乱邪恶，而且 $n,m$ 别写反了。

[AC Code](https://atcoder.jp/contests/arc153/submissions/38011125)

开空间记得 `vector<string>`，因为 $n,m$ 不一定同阶。