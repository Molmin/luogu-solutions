\*3400

最近思路太乱了，但还是写写吧，不敲键盘手就不会动。

比较套路的一道题，虽然思路稍繁琐，但大致有方向，不像隔壁看到\*2900像看神仙题一样。

为了不变量重名，将部分题目信息换成大写：$n,t,k\to N,T,K$。

首先车是从左往右拉的，题目中说：

> A train can not take people from the $i$ -th station if there are people at the $i-1$ -th station.

容易想到只要在某时刻，拉了 $p$ 车站的人，那么这个时刻 $\forall 1\le i<p$ 的站台上一定都是空的。

对于一个车站 $p$，前面的车站受到它的影响，它需要拉人前面的站会被清空。

而后面的车站与它没有过多的关联，因为只要后面需要拉人它一定被清空，它只要保证在后面不需要时自己合法即可。

但它的合法对后面的车站是必要的，同时后面需要它就可以很好的将状态重置。

大概胡思乱想到这里就可以写 DP 了，设：

$f_{i,j,k}$ 表示前 $i$ 站，在不考虑后面车站将前面清空的影响时，只考虑它们，能存活到 $j$ 小时的最小车数。

$k$ 表示初状态，有且仅有显然的两种：题目给出的 $a_i$，被后面强制清空全是 $0$。

**注意1**：我们**钦定每辆车必须满载而过**，如果将全局清空，我们可以看作拉了 $N+1$ 处的无限容量无限人，即 $a_{N+1}=\infty,c_{N+1}=\infty$。

于是答案为 $f_{N+1,T,1}$，其中 $k=1$ 表示第一种初状态，我们通过 $k\cdot a_i$ 来简单表示 $i$ 站的初值。

若难以实现有 $f_{i,j,k}=\infty$，显然 $N+1$ 处无限使得答案不会 $\infty$。

只设答案是不太够的，因为我们还要清空的状态才能正常转移上述思维过程，我们再设：

$g_{i,j,k}$ 表示前 $i$ 站，在不考虑后面车站将前面清空的影响时，只考虑它们，存活到了 $j+0.5$ 小时**并在当前时刻拉到了 $i$ 站**的最小车数。

$k$ 还是初状态，注意这里多了个 $0.5$，因为题目让我们在 In the middle of the appointed hour 拉人，无伤大雅。

**注意2**：并不一定拉了 $i$ 站的人，“拉到”**意即让 $\forall j\in[1,i)$ 清空**就算拉到了。

转移是简单的，我们每次钦定在某个时刻拉第 $i$ 站的人即可，注意还有不到上限不拉人的情况，我们分类讨论：

不妨先设 $suma_i=\sum_{j=1}^i a_j,sumb_i=\sum_{j=1}^i b_j,sumc_i=\sum_{j=1}^i c_j$。

- $a_i+jb_i\le c_i$ 接下来两种情况建立在 $f_{i-1,j,k}\neq \infty$，即前 $i$ 站不会有难以满载的情况，有 

  $$f_{i,j,k}=f_{i-1,j,k}$$

  即不拉 $i$ 站人。
- $a_i+jn_i\le c_i$，有：

  $$g_{i,j,k}=\lceil\frac{k\cdot suma_{i-1}+j\cdot sumb_{i-1}}K\rceil$$
  
  即清空人而不拉 $i$ 站的人，需要 $f_{i-1,j,k}\neq\infty$ 保证能恰好把 $i-1$ 清空而不会提前漏车过来。

  这里能转移当 $\lceil\frac{k\cdot suma_{i-1}+j\cdot sumb_{i-1}}K\rceil\cdot K\le k\cdot suma_i+j\cdot sumb_i$，因为**注意1**中我们提到每辆车满载。
- $a_i+jb_i> c_i$，不妨钦定转移决策为 $t$ 时刻，即**上一次**拉到 $i$ 站是在~~上次~~ $t$。

  考虑我们需要拉的人，该设的状态都设了，上次拉人使用了 $g_{i,t,k}$。
  
  由于把 $[1,i)$ 拉完且满载，故 $i$ 站剩的人恰为 $r=k\cdot suma_i+t\cdot sumb_i-K\cdot g_{i,t,k}$，令 $r$ 表示这个数。
  
  我们已经将前面都清空了，为的就是拉掉一点这里的人，为了再存活到 $j$ 我们需要拉 $v=\lceil\frac{\max{(r+(t-j)b_i-c_i,0)}}K\rceil$ 车 $i$ 这里的人。
  
  注意保证满载有，能转当 $v\cdot K\le r$。
  
  剩下的 $j-t$ 时刻我们无需也不会拉到 $i$，前面已经将其状态处理好了，剩下的 $i-1$ 正常存活，有：
  
  $$f_{i,j,k}=g_{i,t,k}+v+f_{i-1,j-t,0}$$
- $a_i+jb_i> c_i$，$g_{i,j,k}$ 的思路大致是一样的，只是最后在 $j+0.5$ 时刻要把 $i-1$ 前清空，类比 $a_i+jb_i\le c_i$ 时的转移得出：

  $$g_{i,j,k}=g_{i,t,k}+v+\lceil\frac{(j-t)\cdot sumb_{i-1}}K\rceil$$
  
  以上两种情况同样需要 $f_{i-1,j-t,0}\neq \infty$，此处能转移当 $\lceil\frac{(j-t)\cdot sumb_{i-1}}K\rceil\cdot K\le (t-j)sumb_i$，满足满载的条件。
  
代码很好写，可以看[官解](https://www.luogu.com.cn/paste/1ariq90a)。