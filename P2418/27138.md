看过几位ac本题的题解后，我只能说代码看他们的，我来把思路说得明确一些。

纯区间动规只能30分，数据结构的限制；暴力70分（我想吐血）；现在说一下ac的线段树+单调子序列+区间动规（注意不是单调最长子序列）。

首先建树，查询，修改三个函数必须打上，再加上每个区间的价值。总区间的价值为该次遍历所得到的的区间所具有的**较**小房间数，这样就方便了接下来的操作，因为我们每次先修改总区间的价值，再用查询函数找出已知的**最**小价值并用一个数组进行记录，该数组第i项即为从1到i的区间最小价值（所谓的的最小价值实际上是[1,1][1,2][1,3][1,4]...中最小的较小价值，来比较是否应该对记录进行大规模的更新）。

建完树后，记录下每个区间（[1,1][1,2][1,3]...）的两种人数之差，在输入时找出单调序列并以此进行更新（此处用到区间动规的思想，[1,i]区间最小房间数由[1,j]的最小房间数（这是真的最小房间数）加上确保为一个集合的[j+1,i]（[1,i]==min([1,j]+1,[1,i]),j<i）推出），每次用最小价值与[1,i]推出新的最小价值（保证最小价值不会干扰到区间中[1,j]与[j,i]的合并，因为[j,i]可能尚未推出最小房间数），最后注意输出这个数组的最后一项而非记录的最小价值，因为整个区间的末端可能并不满足[j+1,i]小于最小价值。
