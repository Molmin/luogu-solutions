前排提示：建议手玩理解。

先来考虑一个弱化版的问题，如果 $a$ 是一个**排列**该怎么做。

自然想到把逆序对连边，我们希望当一个数到达其应当到达的位置时，这个位置的所有边已经全部交换过，那么相当于每次把最后一位删去。

我们需要满足什么要求把这些边都走完？

要求即为之前有逆序对的位置现在仍然有逆序对，也就是相对的排名不变。满足这个要求非常简单，只需要我们按照交换位置上的数升序排序。

简单理解一下，假设现在倒序枚举到位置 $i$，$i$ 上的数为 $j$，那么 $[j+1,i]$ 所在的位置都对 $i$ 有连边，一次移动，那么 $j$ 去到了 $j+1$，$j+1$ 由 $j$ 过渡到 $j+2$，以此类推，满足了我们的要求，而 $i$ 最终也去到了 $i$ 这个位置。

以下建议结合数据 $\{3,4,3,1,2\}$ 理解。

那么如果不是排列，就会出现“原来位置上是逆序对，而现在的数位置相等”的情况，就要求先换到原来数更小的位置。

例如上面数据在把 $4$ 归位之后，得到 $\{2,3,3,1,4\}$，此时交换过 $2$ 后，先交换哪个 $3$ 实际上决定了 $2$ 将会去到那里，显然我们想要去到一个原来位置上数小的以满足逆序对要求，也就是选择 $(3,4)$。

最后就是题目要求不下降，因此默认的一个关键字就是下标，而当我们遇到原来和现在位置上数都相等的情况，就优先放到靠前的位置上去。

总结一下：排列比较好理解，序列和排列最大区别在于重复，实际上多个重复的怎么交换最重要的是第一个换谁，这决定了上一个较小的数去到哪里，我们希望去到一个合法的位置，若可以去到原来位置上数更小的就会优先选这个，反之选更靠前的位置。

对一个位置的全部交换的本质就是把当前要放到这里的数删去，剩下的数顺位移动到相应的位置。