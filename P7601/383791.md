是[YLST II](https://www.luogu.com.cn/problem/P5047)的进阶版，$O(\sqrt n)-O(1)$ 的二维分块的“练手题”。

首先看数据范围 $n\le10^5,m\le5\times10^5$，这玩意儿还是区间逆序对的加强版，时间范围是 $3s$，肯定不是给更劣的复杂度，而是给常数的。这题竟然没卡空间（雾）。

考虑 YLSTII 的二离，但这题是区间不同逆序对，也就是说加入一个数时若贡献区间中有相同的数，那它的贡献区间就只能在两个数的中间，这东西又不能再差分一遍（若再差分就相当于一个点一个点算贡献，总共 $O(n\sqrt m)$ 个转移，岂不是原地爆炸？），所以就需要二维区间查询，单点修改，复杂度是 $O(\sqrt n)-O(1)$。

$O(1)$ 查询要求我们用前缀和维护，然后还要 $O(\sqrt n)$ 修改，所以两维平均一维 $O(n^{0.25})$ 的复杂度，所以这一部分块长是 $n^{0.75}$，对于 $n\times n^{0.75}$ 和 $n^{0.75}\times n$ 的矩形，我们再分一个 $n^{0.75}\times n^{0.5}$ 和 $n^{0.5}\times n^{0.75}$ 的矩形，再次之，对于 $n^{0.75}\times n^{0.75}$ 的矩形，分成 $n^{0.5}\times n^{0.5}$ 的矩形，先不考虑散块，可以发现现在可以做到 $O(\sqrt n)-O(1)$。

然后是散块，因为相同的数不影响，所以给他们钦定一个顺序，使得每个纵坐标对应唯一的横坐标，每个横坐标对应唯一的纵坐标，且横纵坐标都在 $[1,n]$ 内，于是画图发现每个点对应的散块只有至多 $O(\sqrt n)$ 个点，反过来想，每个点能以散块贡献的也只有 $O(\sqrt n)$ 个点，横坐标和纵坐标分别枚举到 $n^{0.5}\times n^{0.5}$ 的块的端点，用上面的性质去看就知道了，这东西可以直接暴力维护。

**注意：**
- $n^{0.75}$ 和 $n^{0.5}$ 必须成倍数，因为预处理会使空间时间一起爆。
- 散块贡献注意不要重复加。
- “前缀和”需要我们在某些询问时将序列倒过来或将值取反，后缀和也可以，只是有点难打。
- 莫队排序的块长是 $\frac{n}{\sqrt m}$，不然常数会有点大，但不一定会 TLE，只是增加了概率。
- 有个双黑经验[P7448](https://www.luogu.com.cn/problem/P7448)，美汁汁。