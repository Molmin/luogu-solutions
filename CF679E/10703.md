注意到在可能的值域（约为 ${10}^{14}$）内，$42$ 的次幂并不多，尝试从这个角度考虑。

操作 3 比较棘手，解决的办法是用线段树维护当前值到下一个 $42$ 的次幂的差值。

做操作时让这个差值做区间减法，在线段树递归的时候，如果差值会变成负数，就需要再递归进子区间进行修改，但是如果这个区间被打上了区间覆盖标记，就直接修改这个标记就行。

执行完后，如果存在差值为 $0$ 的位置，就再执行一次。

这个做法的复杂度，使用势能函数可以分析得出为 $\mathcal O (q \log n \log_{42} v)$。

具体地说，令当前线段树的势能函数等于每个值相同的连续段，比此连续段的值大的，在值域内的 $42$ 的次幂的个数的总和，乘以 $\log n$。

则操作 2 和操作 3 的摊还代价都为 $\mathcal O (\log n \log_{42} v)$。

时间复杂度为 $\mathcal O ((n + q) \log n \log_{42} v)$，其中 $v$ 为值域，约为 ${10}^9 q$，[评测链接](https://codeforces.com/contest/679/submission/71983368)。