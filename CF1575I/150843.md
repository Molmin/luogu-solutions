我是傻逼我不会算 $\max(|x-y|,|x+y|)$ ~~然后我用奇奇怪怪的方法过了这题。~~

~~假设我们不知道~~$\sout{\max(|x-y|,|x+y|)=|x|+|y|}$~~。~~

题意：

一颗 $n$ 个结点的树，点有点权，一条边 $(u,v)$ 的边权为 $\max(|a_u-a_v|,|a_u+a_v|)$，$m$ 次操作，每次修改一个点的点权或查询一条路径上的边权和。

首先可以边权转点权，然后一个很显然的暴力就是查询时树剖，修改时暴力将与之相邻的边权都修改一遍。

这样暴力虽然查询是 $O\left(\log^2n\right)$ 的，但是修改是 $O\left( \deg\times \log n\right)$ 的，会被菊花图之类的卡掉。

那么可以用根号分治来平衡修改和查询的复杂度，定义一个阈值 $B$。

在树剖时将 $\deg$ 大于 $B$ 的点单独拿出来当作一条链的链顶，这样的点不超过 $\dfrac{n}{B}$ 个。

修改时只暴力修改 $\deg\leq B$ 的点，每次修改 $O\left(B\log n\right)$。

然后在查询的时候将链顶和其重儿子的边单独拿出来修改，将链顶和其父亲的边单独拿出来修改，每次查询 $O\left(\dfrac{n}{B}\log n\right)$。

大概是当 $B=\sqrt{n}$ 的时候最优。

~~但是我场上 debug de不出来，把 B 的大小改成 n 交了一发（暴力），想看一下到底是不是根号分治出了问题，结果直接过了。刚刚调出来发现竟然跑不过暴力。~~

[根号分治](https://www.luogu.com.cn/paste/aotyonka)，[~~暴力~~](https://www.luogu.com.cn/paste/erhk3nr6)~~（其实没啥区别就是暴力更快）~~