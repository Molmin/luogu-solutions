目前题解都是二分的做法，来水一篇数学解法 qaq。

首先肯定要分类讨论。

- $k \ge n^2$

由于这样的一个图形，一共有 $1+2+\cdots+n-1+n+n-1+ \cdots +2+1=n^2$ 个图案，所以我们可以把每一行都填满。

所以直接输出 $2 \times n-1$ 即可。

- $k \leq \dfrac{n(n+1)}{2}$

这意味着我们最多可以把前 $n$ 层填满。也就是说，我们每一行需要填入的数的个数一定是递增的。

我们不妨假设 $x$ 为能够填入的最多行数，就是我们的答案。

所以我们可以得到一个不等式：

$$\dfrac{x(x-1)}{2} < k \leq \dfrac{x(x+1)}{2}$$

这个不等式的意思是说，我们可以填入的个数，要填满前 $x-1$ 行且能继续填到第 $x$ 行，但是不能填到第 $x+1$ 行。

这里解一个不等式为例，其他的不等式可以类似求解：

解

$$\dfrac{x(x-1)}{2} < k$$

两边同时乘以 $2$ 得

$$x^2-x<2k$$

将左式配方并移项，得

$$(x-\dfrac{1}{2})^2<2k+\dfrac{1}{4}$$

考虑到我们的 $x-\dfrac{1}{2}$ 一定取得正数，所以这个不等式的一部分解集

$$x-\dfrac{1}{2}>-\sqrt{2k+\dfrac{1}{4}}$$

舍去，得到

$$x-\dfrac{1}{2}<\sqrt{2k+\dfrac{1}{4}}$$

即

$$x < \sqrt{2k+\dfrac{1}{4}}+\dfrac{1}{2}$$

而对于不等式

$$k \leq \dfrac{x(x+1)}{2}$$

我们可以用类似得方法得到

$$x \ge \sqrt{2k+\dfrac{1}{4}}-\dfrac{1}{2}$$

所以对于这一部分的解集为 

$$\sqrt{2k+\dfrac{1}{4}}-\dfrac{1}{2} \leq x <\sqrt{2k+\dfrac{1}{4}}+\dfrac{1}{2}$$

显然这个不等式有且只有一个正整数解，这个解可以通过对 $\sqrt{2k+\dfrac{1}{4}}-\dfrac{1}{2}$ 的值上取整得到。

所以我们就得到了答案。

- $\dfrac{n(n+1)}{2}<k <n^2$

不难发现，这时候我们会填写到下半部分。似乎有点难搞？

我们不妨转化一下——

记 $l=n^2-k$，现在我们只需要求用 $l$ 个消息能够填**满**的总行数 $x$，最终答案用 $2 \times n-1-x$ 即可。

由于是填满 $x$ 行，但是填不满第 $x+1$ 行，于是我们可以得到不等式

$$\dfrac{x(x+1)}{2}\leq l <\dfrac{(x+1)(x+2)}{2}$$

按照上面的步骤可以解得

$$\sqrt{2l+\dfrac{1}{4}}-\dfrac{3}{2}<x \leq \sqrt{2l+\dfrac{1}{4}}-\dfrac{1}{2}$$

所以我们需要的 $x$ 只用对 $\sqrt{2l+\dfrac{1}{4}}-\dfrac{1}{2}$ 下取整即可。

## 几个代码实现小细节

在解完不等式后，要注意判断上下取整得到答案的问题。例如第 $3$ 个分析中，如果我们对 $\sqrt{2l+\dfrac{1}{4}}-\dfrac{3}{2}$ 上取整，有可能 $\sqrt{2l+\dfrac{1}{4}}-\dfrac{3}{2}$ 自身就是整数，导致取得的 $x=\sqrt{2l+\dfrac{1}{4}}-\dfrac{3}{2}$，与不等式相矛盾。

还有，由于这个是数学方法，对于精度的要求可能会比较大，需要用 `long double` 记录 $\sqrt{2k+\dfrac{1}{4}}$ 的值，再算出 $x$ 的值，这样精度误差会小一点（反正我是这样才过去的）。

另外，这个做法不知道为什么，一份 AC 过的代码有时候能过，有时候过不了（可以参见我的提交记录[一](https://www.luogu.com.cn/record/65962109)、[二](https://www.luogu.com.cn/record/65963049)），不知道是不是哪里又有精度问题还是怎么的，欢迎大佬在讨论区里指出！

如果不想避免这种情况，考虑到精度误差不会很大，可以特判一下 $ans-1,ans,ans+1$ 中哪一个是正确答案（

时间复杂度 $\text{O}(T)$。

代码不放了，感觉讲的还挺详细的（