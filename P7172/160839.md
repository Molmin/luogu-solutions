题意：使用奇怪的方式建一个有 $ (n+1) \times (n+2) \div 2 $ 个节点的树，每次给定两个点询问其 $ \rm LCA $。

首先大眼观察：答案似乎只可能是给定的 $ n $ 个节点？

并不，如果两个节点之间存在祖先关系的话那么就寄了。。。

所以考虑先把祖先关系判掉，然后询问就只剩下没有祖先关系的了。

没有祖先关系，答案就只可能是给定的 $ n $ 个节点了！/mgx

因为没有祖先关系，所以考虑找到自己到根节点的第一个给定的节点。

这样要分两种情况，巨麻烦，于是找子树内不包括自己的深度最小的给定的节点。

假设自身是 $ u $，该节点是 $ v $，以及自身处于第 $ x $ 层，该节点处于第 $ y $ 层，有：
$$ u+\frac {(y-x)(y+x-1)} 2=v $$
可以自行理解一下这是为什么。移项得：
$$ u-\frac {x^2-x} 2=v-\frac {y^2-y} 2 $$
$$ u-\frac {x(x-1)} 2=v-\frac {y(y-1)} 2 $$
不过这个柿子是错的，因为如果有特殊点在往儿子走的路径的左边就假了。

所以要分别减去某个序列的前缀比自身小的数，二维偏序强制在线，只能使用主席树或者 K-DT。

所以对 $ u-\frac {x(x-1)} 2- $ 减去前面比自己大的节点，对相同的给定的节点开一个栈，按照深度从小到大的顺序排个序，直接二分就好了。

然后 $ v $ 在只有这 $ n $ 个节点的树上的父亲就是 $ u $ 到根节点的第一个给定的节点。

建出原树可以倒序扫描 $ a $ 数组，然后记录 $ lst $，最后若有节点没有父亲那么就令父亲为 $ 1 $。

如果我是最后一层的节点？将最后一层的节点全部加入栈即可。

接下来考虑有祖先关系的。有祖先关系的节点在压缩后的树上一定也有祖先关系，通过 $ dfn $ 序判断这个，还需要通过上面的式子再判断一遍（因为如果两个节点到根节点的第一个给定的节点是同一个节点，但是属于两个不同的子树那就没有祖先关系），之后直接返回编号小的节点即可。

代码咕了（不过这种做法应该会比主席树快吧