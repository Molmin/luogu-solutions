很好的一道题！！！

首先我们可以得到一共有$2^n-1$种合法的集合（片段）。

为了方便，我们让片段的出现变得有序，最后再将答案处以$m!$即可。
由于每一个元素都必须要出现偶数次，所以我们如果选了$m-1$个片段，那么最后一个片段就可以直接根据奇偶性确定。

从$2^n-1$个片段中选择$m-1$个的方案为${2^n-1\choose m-1}$。
考虑记$f_m$为m个片段合法的方案数，如果令$f_m=A_{2^n-1}^{m-1}$，那么我们会发现最后一个片段有可能为空集，同时也有可能是之前出现过的片段，于是我们要将这些不合法的情况给删除。

如果是空集，那么可以保证前$m-1$个片段的方案数合法，那么直接减去$f_{m-1}$。

如果是前面出现过的片段，考虑枚举和它相同的片段的位置是哪一个（总共$m-1$个位置），然后剩下来的$m-2$个片段的情况也一定是合法的，共有$f_{m-2}$种，确定了这$m-2$中之后，有$2^n-1-(m-2)$个片段可以供这个位置挑选，所以要减去的情况是$(m-1)\times f_{m-2}\times (2^n-1-(m-2))$。

然后就可以直接递推了。

其实直接利用组合数来计算，即不考虑顺序也是可以的，方法类似，有兴趣可以自己推一下（复杂度多带一个快速幂）。

代码很短，如果看不懂的话可以看一下[代码](https://blog.csdn.net/ylsoi/article/details/84977707)帮助理解