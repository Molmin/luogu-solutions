把 $<10^{4.5}$ 的质数分开来处理，这样剩余每个数至多剩余 33 个不同的质因子。考虑我们不需把每个数分解质因数，只需要能够构造一个等价的质数集合即可。构造方法如下：

对于所有 $1 \leq i < j \leq n$，将 $\gcd(a_i, a_j) ,a_i / \gcd(a_i,a_j) ,a_j / \gcd(a_i,a_j)$ 加入到集合 $S$ 中。将其中存在 $S$ 中的数作为因数的数删掉，剩下的集合就是一个合法的质数集合。

接下来的一个朴素做法是莫队，需要一些精妙的实现使得那个 $\log$ 是加上去的而不是乘上去的。

会用到质数的快速幂，这个可以预处理相当于对于每个质数维护一个出现次数集合，支持加减和查询最大的出现次数。首先维护一个桶来去重，然后开一个 `long long`，并每次查询最高的 $11$ 出现的位置。
时间复杂度近似于 $O(n^3 \log n)$，需要一些非常精细的操作。

代码由于太丑不放了，如果读者能够读懂上述内容，想必不难实现程序。