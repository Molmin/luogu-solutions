这题紫真的虚高，感觉绿差不多，不过我和各位的想法不太一样？

考虑一个经典的树上差分，定义

$$
g_u=w_{u\to fa}-\sum_{c\in son_u}w_{c\to u}
$$

那么容易发现 $w_{u\to fa}$ 就是 $u$ 子树内 $g$ 的和。

考虑每次操作后 $g$ 的变换，发现就是 $g_u\gets g_u+1,g_v\gets g_v+1,g_{lca}\gets g_{lca}-2$，mod 2 意义下就是 $g_u\gets g_u+1,g_v\gets g_v+1$。

我们考虑反向推回去，就会发现 $g$ 最后应当全是偶数，容易发现这一结论是双向的。

那么我们随便算个 $g$ 就可以了。代码不放了。