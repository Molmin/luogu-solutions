考虑逆序列 $q$，则可以把构造树的方式重写为：

> 对于每一个 $i$，找到最大的 $q_j$ 使得 $j < i$，然后在 $q_i,q_j$ 间连边。

即把 $q$ 中每个数连向其前缀最大值。

不难发现这样连出的树是一个”毛毛虫“，即一条主链旁连着若干个点。这是因为链上的点都是前缀最大值，在下一个极值前的点都直接连向这个最大值。

如果输入的树不满足此要求一定无解，下面我们给出满足此要求时的构造方法。

首先对于主链，显然顺序的排列是最优的。那么如果我们经过了一个有挂着其它点的链上节点，我们发现显然先将能用的最小的点使用上最优，其顺序应该是【从小到大排列挂载的点】+ 【链上的点】。比如目前遍历到 `3`，有一个点挂载了两个点，则添加 `4 5 3`，这也是样例中的情况。

但我们发现主链有两种遍历方式，我们考虑如何求出最优的那个。考虑链上每个点的挂载节点的数量组成的序列，容易发现字典序最小的那个更优。

实现上可以使用求直径的方式求出主链，然后处理难度不高。复杂度 $O(n)$。