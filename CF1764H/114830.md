考虑这样的一个思路：我们把每个颜色段开头放一个球，每次操作相当于把 $[L+1,R]$ 中的球拿掉，再在 $R+1$ 处放一个球，**不过要满足原本 $[L+1,R]$ 中要有球**。如果没有有球条件的话我们可以分别对没覆盖到的点和区间自己加的点记一下答案，扫描线一下即可。

加上条件后我们考虑修正一下上面的做法。我们定义一个区间被“激活”当且仅当满足上面有球的条件，那么显然的，我们在从 $1\sim m$ 扫的时候，一个区间只会从没“激活”到“激活”。被“激活”只有两种情况：1. 覆盖到了之前没有区间覆盖的点；2. 覆盖到了之前某个区间产生的点。第一种情况我们可以倒着 ODT（set 维护连续段），第二种情况我们注意到一个区间最多只能激活接下来与它最近的可覆盖它产生的球的区间。这样我们用 $O(n\log n)$ 即可依次维护好两种情况。最后拿一个树状数组扫描线一下跨过右边界的贡献个数即可。
