哪门子的 *3400？？

考虑一个区间从操作序列某个位置开始被操作，何时被完全删除。发现就是其中每个点的被删除时间的 $\max$，因为每个点是独立的。

所以直接倒着扫描线。先断环为链，然后维护每个点的被删除时间 $t$。考虑在操作序列头加入一个区间的影响，$t_l$ 会变成 $t_{l\dots r}$ 的 $\max$，$t_{l+1\dots r}$ 显然是变成当前的区间。

所以直接 ODT 维护，搞个树状数组维护 $t$ 就行了。$O(n\log n)$，不知道能不能更好。

upd：确实可以。

树状数组要干的事情其实是单点加，前缀求和。其中前缀每次增加 $1$。

所以完全不需要树状数组。用个数组维护每个位置的值，可以支持单点修改和把前缀增加 $1$。

用更优秀的数据结构维护 ODT 可以得到更好的复杂度。