这一道题一看就像是建虚树，先考虑把虚树建出来，由于某些颜色会被阻断，所以不能够直接用树上路径长度求出，所以每一个点只能更新与它相邻的点，所以，先用孩子更新父亲，然后再用父亲更新孩子，这样做两遍之后就可以得出答案。至于依次染色的限制，可以直接用优先级解决掉（以到达时间为第一关键字，颜色种类为第二关键词）。思路还是挺简洁明了的。

时间复杂度$O(n\text{log}n)$，不过我的代码应该带上了一个很大的常数，如果用树链剖分求LCA应该会快不少。

感觉自己的语文水平不太够啊，如果真的看不懂就看代码吧，代码应该也不难理解。

代码可以去我的博客看：[Codeforces 1320E. Treeland and Viruses 题解](https://www.cnblogs.com/withhope/p/12394858.html)