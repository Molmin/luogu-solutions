首先想到一个朴素 DP：$f_{i, j, k, 0/1}$ 表示 $i$ 个位置、起点为 $j$、终点为 $k$，当前方向为向左 / 向右的方案数，转移可以考虑插入一个位置作为新的终点。

这样子显然复杂度过高。考虑将 $s \to t$ 拆成 $s \to 1 \to t$，进而变为 $1 \to s$ 和 $1 \to t$。那么由于起点总在最左侧，我们并不需要 $j$ 这一维。前缀和优化一下可以在 $O(n^2)$ 的时空复杂度内 DP 出 $f_{i, k}$ 表示 $i$ 个位置、起点为 $1$、终点为 $k$ 的方案数。

接下来考虑合并。枚举 $(1, s), (s, t), [t + 1, n]$ 中分别有多少位置在 $1 \to s$ 这段中即可。这看似是 $O(n^3)$ 的，不过最坏运算次数大概是 $(\frac n 3)^3$，有 $\frac 1 {27}$ 的常数。加上一些有关内存访问的优化之后可以轻松通过本题，极限数据 0.8s 左右。

时间复杂度 $O(n^3)$（常数大概 $\frac 1 {27}$），空间复杂度 $O(n^2)$。

发现了之前一个模拟题的经验，写篇题解玩。