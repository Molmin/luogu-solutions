> 给定一棵 $n$ 个节点的树，每条边有一个颜色 $w_i$，定义 $f(u,v)$ 表示 $u,v$ 的路径上出现恰好一次的颜色数量，求 $\sum_{u<v}f(u,v)$。  

考虑对于每一种颜色，分别计算经过恰好一条这种颜色的边的方案数。

如果删去所有某种颜色的边，剩下一些连通块，然后我们枚举每一条这个颜色的边，把两个大小相乘然后求和，就是这种颜色的贡献了。

考虑优化这个过程，对于每个点 $u$，定义这个点的颜色是**这个点到父亲的这条边颜色**，我们只需要计算以 $u$ 为根的子树内不经过和 $u$ 颜色相同的点可以到达的点数，我们把这个值用 $dp_u$ 表示。

我们可以直接 dfs 计算 $dp_u$，过程中用栈维护每种颜色最近一次出现的且比它深度小的点的编号即可。

然后我们再 dfs 一次，还是用栈维护每种颜色最近一次出现的且比它深度小的点的编号，计算每个点颜色和栈顶元素的两个 $dp$ 值的乘积，然后求和即可。

时间复杂度为 $O(n)$。[代码](https://www.luogu.com.cn/paste/nde46uj7)