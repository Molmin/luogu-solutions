来点不动脑子的简单 2log 线段树分治。

发现答案的计算方式可以是对于每种颜色的边，将其删除后剩下若干连通块，贡献就是这些边连接的连通块大小的乘积（恰好经过一条该颜色的边），于是线段树分治把删除变为两段存在，也就是颜色为 $c$ 的边在处理颜色 $[1,c-1],[c+1,n]$ 时都存在，用仅按秩合并的并查集维护连通块大小即可，到底层结点枚举对应颜色的所有边计算贡献，复杂度 $O(n\log^2 n)$，跑的不算特别慢。

[代码](https://codeforces.com/contest/1681/submission/159113766) 非常好写。

