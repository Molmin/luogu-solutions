### 题目分析

求一棵树的平衡度，考虑暴力枚举这棵树的叶子节点，然后求出该树被从根节点到这一叶子节点的链分割为左右两部分后两部分的边的总重之差，取最小值。

那么要解决的问题就是如何快速求出某条链左部分和右部分的总重了。由于边是有顺序的，考虑一种类似于前缀和的方法，具体如下。

### $k=1$

预处理好树的叶子节点。对于每一个叶子，考虑维护下面两个量：

- $le(i)$：从左往右深度优先搜索到叶子 $i$ 经过的所有边的总重

  比如下图红色节点的 $le$ 值就是所有红色边的总重之和。

  ![1](https://cdn.luogu.com.cn/upload/image_hosting/ecszp7u6.png)

- $sum(i)$：从根节点到叶子 $i$ 的链上所有边的总重之和

这些都可以用一个 dfs 完成预处理。

于是——

![2](https://cdn.luogu.com.cn/upload/image_hosting/1di0ew4h.png)

不难发现，上图红色链左部分（蓝色）总重之和可表示为 $le(1)-sum(1)$；右部分（绿色）总重之和可表示为 $le(2)-le(1)$。

从左往右枚举叶子节点，对应的链的左部分总重之和单调递增，右部分单调递减，左右部分的差值单调递增，并且有一个零点，于是又可以二分枚举，找出左右部分差值的最小绝对值即是答案。总复杂度 $O(T(n+\log n))$。

### $k=2$

沿用上面的思想方法。

对于每个节点对应的子树，可以预处理出这个字子树最左边和最右边的叶子节点，然后二分枚举。只不过要将上面维护的两个量扩展一下，为每个节点都维护，不仅仅是叶子：

- $le(i)$：从左往右深度优先搜索到节点 $i$ 经过的所有边的总重
- $sum(i)$：从根节点到节点 $i$ 的链上所有边的总重之和

预处理还是都可以用一个 dfs 完成。

于是——

![3](https://cdn.luogu.com.cn/upload/image_hosting/wpnzn8f1.png)

对于节点 $0$ 对应的这棵子树，不难发现，上图红色链及其左部分（蓝色）总重之和可表示为 $le(1)-le(0)$，红链上的边的总重之和可表示为 $sum(1)-sum(0)$，于是蓝色部分总重为：
$$
le(1)-le(0)-sum(1)+sum(0)
$$
绿色部分总重为 $le(2)-le(1)$。

枚举每一个节点对应的子树，二分枚举其叶子节点即可求出答案。总复杂度 $O(T(n+n\log n))$。

赛时代码写得很难看，以上流程讲述应该足够清晰了，就不贴代码了。（逃