先考虑哪些数可能会产生重复。

对于第 $x$ 行，显然只有第 $x^2,x^3...x^k$ 行上的数可能与它有重复。

考虑去计算这个东西，设 $f_k$ 表示对应的答案。

问题转化为 $i\in [1,k],j\in [1,m]$，求 $ij$ 有多少个不同的取值。

由于 $k$ 是 $\log n$ 级别的，可以直接暴力枚举，然后枚举 $x$ 就做完了。

时间复杂度 $O(m\log n+n)$。