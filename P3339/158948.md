对于这道题结论，思考了一整天后无果。

后来发现这个结论并不普适，如 $k=3,k=8$ 时就不满足此结论，于是我有不充分的理由怀疑这道题结论是凑出来的。

或者说应该是当 $k$ 满足一定条件后得到的，一个仿佛正确的猜想是 **仅当 $k+1$ 是质数时满足**。

但由于本人实力有限，并不能用题解(指贴吧的一张不糊的图片)所谓的数学梳理证明此结论，仅给出以上作提示。

第一篇题解已经把结论讲得很清楚了，但仍需补充说明一下如何求出 $A_k$ 。如果要阅读全文不建议跳读。

本文主要阐述题解中用人类智慧推出 $A_k$ 的部分，以下不考虑 $k=1/2$，因为 $k=1$ 是经典 Nim 问题可以单独考虑，$k=2$ 暴力打个表或者找规律即可，故有 $k$ 为偶数，$k/2$ 为奇数($k=10/30$)。

求 $A_k[x]$ 时，由于有 $A_k[0]=0$，我们可以看作选至多 $k$ 个 $A_k[y],y\le x$ 异或起来得到的第一个凑不出来的数(mex 的理解方法)，我们称选一个数代价为 1。

可以发现的是 $x\le k+1$ 时都恰好在进位时凑不出来，于是可以看作补了一个进的那位，即(下表均用二进制数表示 $A_k$)：

$\begin{array}{|c|c|c|c|c|} &1&2&...&k+1\\2^0&1&0&0&0\\2^1&0&1&0&0\\2^{...}&0&0&...&0\\2^{k+1}&0&0&0&1\end{array}$

于是后面的 $A_k$ 就可以选择 $A_k[x]$ 来代表 $x$ 位为 1。

到 $k+2$ 时我们发现凑 $0\sim k+1$ 位都为 1 的数时恰凑不出来，因为只能选 $k$ 个数，也即 $k$ 个 1。

于是我们补了一个“全 1 数”，即：

$\begin{array}{|c|c|c|c|c|c|} &1&2&...&k+1&k+2\\2^0&1&0&0&0&1\\2^1&0&1&0&0&1\\2^{...}&0&0&...&0&1\\2^{k+1}&0&0&0&1&1\\2^{k+2}&0&0&0&0&0\end{array}$

原来我们凑出任意一种后 $k$ 位至多需要 $k$ 的代价来凑($k$ 个 1)，而有了“全 1 数”相当于我们可以用 $k/2+1$ 的代价凑出任意一种后 $k+1$ 位，因为我们有了取反操作。

剩下的 $k/2-1$ 的代价凑前面的 $k/2-1$ 位，一直可以凑到 $x\le k+2+k/2-1+1=3k/2+2$，即：

$\begin{array}{|c|c|c|c|c|c|c|c|c|} &1&2&...&k+1&k+2&k+3&......&3k/2+2\\2^0&1&0&0&0&1&0&0&0\\2^1&0&1&0&0&1&0&0&0\\2^{...}&0&0&...&0&1&0&0&0\\2^{k+1}&0&0&0&1&1&0&0&0\\2^{k+2}&0&0&0&0&0&1&0&0\\2^{......}&0&0&0&0&0&0&......&0\\2^{3k/2+1}&0&0&0&0&0&0&0&1\end{array}$

到 $3k/2+3$ 时我们前面 $k/2$ 位最多要用 $k/2$ 的代价($k/2$ 个 1 的全 1 数)，后面就只留了 $k/2$ 的代价用，那么第一个需要 $k/2+1$ 个的后 $k+1$ 位就是我们停止的数。

**即 11..1(前 k/2 位)11..1(k/2+1 个 1)00..0(k/2 个 0)**(表格写不动了qwq)

我们称现在的前面为**中间**，因为后面还有更前面的位。

紧接着我们因为这中间 $k/2$ 位的全 1 数，又可以以 $(k/2-1)/2+1$ 的代价凑出中间的 $k/2$ 位，这里的 $(k/2-1)$ 是因为 $k/2$ 均为奇数(就懒得写下去整了)。

最后面 $k+1$ 位代价不变，那么我们还剩 $(k/2-1)/2-1$ 的代价来凑最前面的 $(k/2-1)/2-1$ 位，实际上最后凑不出来而补上的位应为前面的 $(k/2-1)/2$ 位。

巧妙地，我们发现到这里已经足够凑到 $k+1$ 进制最高的为 $k$ 的位数，因为题目中有 $\text{数}\le10^{18}/10^{80}$，后面的也就不用再考虑。

引用第一篇题解的代码+我的注解：

```cpp
inline void pre(){
	ll t=0;
	Rep(i,1,1024){//k=2 人类智慧可以(?)看出来的规律
		vis[i]=(vis[i>>1]^(i&1));
		if(vis[i])A2[++t]=i;
	}//看不懂可以看第二篇的打表qwq
//k=10
Rep(i,0,10)A10[i]=1<<i;//最后面面的 k/2+1 位
Rep(i,12,16)A10[i]=1<<i-1;//中间的 k/2 位
Rep(i,18,19)A10[i]=1<<i-2;//最前面的 (k/2-1)/2 位
A10[11]=(1<<11)-1,A10[17]=(1<<16)-(1<<11)+(1<<6)-1;//两个全 1 数
Red(i,20,1)A10[i]=A10[i-1];A10[0]=0;//前面为了赋值的方便最后要鬼畜的移位
//以下同理
	Rep(i,0,30)A30[i]=1<<i;Rep(i,32,46)A30[i]=1ll<<i-1;Rep(i,48,54)A30[i]=1ll<<i-2;
	A30[31]=(1ll<<31)-1,A30[47]=(1ll<<46)-(1ll<<31)+(1<<16)-1;
	Red(i,55,1)A30[i]=A30[i-1];A30[0]=0;//k=30
}
```