首先看到 $b_i \in [1, 2]$，这明显是一个值得去发现性质的点。因为油箱容量不变（废话），所以遇到 $1$ 能加满就加满，只有在实在没油的情况下才会去加 $2$。发现这个合并并不是那么优美，因为每次剩下的油量都不一样，那么考虑每次都在油箱空了的时候去合并。  

- 如果当前 $b_i = 1$ 

  - 并且 $b_{i + 1} \not = 2$，直接交完当前需要的油钱，移动到下一个位置。

  - 否则后面将会有 $len$ 个连续的 $2$，对于这一段区间记为 $[i + 1, i + len]$，记 $a_i$ 的前缀和数组为 $sum$，需要二分出第一个 $pos$，使得 $sum[i + 1 \dots pos] \le k$，那么这一段区间的所有油都应该在 $i$ 处只花 $1$ 的代价加上，这是就会出现后面一段 $[pos + 1, i + len]$ 的油不够，那么这一段只能花 $2$ 的代价买油。

- 如果当前 $b_i = 2$，直接交 $2 \times a_i$，往下移动。

于是得到了从每一个点出发走一步在最优情况下能够到达的位置记为 $nxt_{pos, 0}$，显然这是一个倍增数组。  

最后会发现一个小问题，在倍增完之后有可能到不了终点，并且这一段是连续的 $1$，那么直接计算两者之间的距离就能解决了。