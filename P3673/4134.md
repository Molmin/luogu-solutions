假设第i句话为“第p句话为真”，我们就把i-p连一条白边，如果为“第p句话为假”，我们就把i-p连一条黑边。


我们考虑白边连接的两句话真假是相同的，黑边连接的两句话真假是相反的，所以这些边都是无向边，n个点恰有n条边，所以这一定是一堆环套树。我们可以发现满足题目条件只需每个环上都只有偶数条黑边。


看这个数据范围似乎需要一个$O(n^4)$左右的做法，考虑设$f[i][j]$表示i条黑边和j条白边连成了一个联通的环套树的方案数，考虑枚举环上有几条黑边，几条白边，那么考虑剩下的都是树边，把整个环缩成一个点，那么就相当于求出一棵生成树，但是环点可以任选一个点往外连出边。


这里可以直接dp，记$g[i][j]$为大小为i的环点连出去j条边的方案数，然后枚举当前环上这个点连出去几条边转移即可。比较优秀的做法是使用基尔霍夫矩阵，这里略。


求出$f[i][j]$之后再考虑每个联通块中有几条黑边几条白边，再设一个dp继续暴力转移一波即可。
