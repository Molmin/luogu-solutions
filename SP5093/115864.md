前言：本人很菜，没想到什么优秀的做法，仅仅是能通过此题。这里就抛砖引玉一下，希望能有人给出时间复杂度更低的解法。

****
题目条件转换一下，就是一个 $n$ 个点的有向图，每个点的出度都是 $1$，沿着每个点走 $k$ 条边都能回到出发点。

容易发现这个图的连通块都是环。那么答案就是把 $n$ 个点分成若干个部分，每个部分的点数都是 $k$ 的因子，再把每个部分进行环排列（即 点数减一 的阶乘），得到 EGF 为：
$$f(x)=\exp \left( \sum_{d|k}\frac{x^d}{d} \right)$$
正常来说这里直接套多项式 $\exp$ 的模板就做完了，但很可惜 $m$ 不一定是质数。考虑求导得到
$$f'(x)=f(x)\sum_{d|k}x^{d-1}$$
提取系数有
$$(i+1)f_{i+1}=\sum_{d|k}f_{i-d+1}$$
我们想求 $n!f_n$，设 $g_i=i!f_i$：
$$g_{i+1}=\sum_{d|k}i^{\underline{d-1}}g_{i-d+1}$$
这个 $i^{\underline{d-1}}$ 在模数不是质数的情况下不好处理，我用的是一种简单粗暴的做法：线段树。这样推一项的时间复杂度是 $\mathcal O(d(k) \log n)$，总时间复杂度就是 $\mathcal O(d(k)n \log n)$ 的。