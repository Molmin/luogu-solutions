题意：

给定排列，记子区间 $[L,R]$ 是好的，则存在 $i,j\in[L,R]$ 满足 $a_ia_j=\max\limits_{k=L}^R(a_k)$。

$q$ 次询问区间有多少子区间是好的，

$n \leqslant 2\times 10^5,q\leqslant 10^6$

---

显然，我们能抽出 $n\ln n$ 个三元组 $(i,j,k)$，满足只要区间 $[L,R]$ 包含它，且最大值为 $a_k$，那么就有 $1$ 的贡献。

考虑放在二维平面上，考虑平面的下三角部分。那么每次相当于矩形赋 $1$，多次查询矩形和。

这个不太好维护，我们再找一下性质。

首先对于不同的 $k$，对应的矩形显然不会相交。

否则容易发现，这些矩形的右边界和下边界都是一致的。

具体来说，因为每个三元组都是形如左端点在范围 $[A,B]$ 之间，右端点在 $[C,D]$，而 $A,D$ 只用于限制最大值为 $a_k$，因此这些矩形的 $A,D$ 都是固定的。

于是我们对于相同的 $k$ 可以容易的拆成若干个互不相干的矩形，然后扫描线就好了。
