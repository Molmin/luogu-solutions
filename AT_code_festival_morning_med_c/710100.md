## 形式化题意

有一个初始状态为 OFF 的开关（开关状态有 OFF/ON 两种），每次操作有 $p$ 的概率改变开关状态，求 $n$ 次操作后开关状态为 ON 的概率。

$n,p$ 为给定常数，其中 $1\leq n \leq 10^{18}$，**小数** $p\in [0,1]$。

## Sol

很容易想到一种 $dp$，设 $dp_{i,0/1}$ 表示进行了 $i$ 次操作后开关状态为关/开的概率。

分类第 $i$ 次操作有没有改变开关状态，则转移是显然的：

- $dp_{i,0}=dp_{i-1,1}\times p + dp_{i-1,0}\times (1-p)$

- $dp_{i,1}=dp_{i-1,0}\times p + dp_{i-1,1}\times (1-p)$

当然由于 $dp_{i,0}+dp_{i,1}$ 必定为 $1$，所以这里 $0/1$ 这一维可以省去。

重新定义 $dp_i$ 表示进行了 $i$ 次操作后开关状态为开的概率。

由上述推导可知 $dp_i=(1-dp_{i-1})\times p + dp_{i-1}\times (1-p)=(1-2p)dp_{i-1}+p$ 

直接转移是 $O(n)$ 的，但是我们观察上面那个式子，这不就是我们熟悉的 $a_n=ka_{n-1}+b$ 的数列通项嘛！

最终得到 $dp_n=\dfrac{1-(1-2p)^n}{2}$，直接计算即可。

```cpp
long double t=pow(1-2*p,n);
cout<<setprecision(15)<<fixed<<(1-t)/2;
```