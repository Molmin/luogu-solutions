考场上我写了个 97pts 做法，感觉自己像个智障。

不难想到直接跑 SPFA。

具体地，我们想到设 $dis_{i,j}$ 表示从起点到达第 $i$ 个点使用 $j$ 次除二魔法的最少代价。

在最短路的过程中,目前点为 $x$，下一个点为 $y$：

对于 $arr_y=0$ 的点，可以直接将最短路径更新为 $0$。

对于 $arr_y=1$ 的点，进行朴素的最短路更新。

对于 $arr_y=2$ 的点，进行朴素的最短路更新，同时尝试使用除二魔法更新 $dis_{y,j+1}$。

这个过程很暴力，但是在 $k\leq 30$ 的数据过得很轻松。

对于 $k\leq 80$ 的数据我们同样可以这么做，进一步地，我们可以令 $k\gets \min(k,80)$。

这是因为题面给出了一定的误差，$k\leq 10^6$ 除很多，最后和转换后的答案误差不大。

由于我没登上网站，拿不到代码，所以就不贴了。