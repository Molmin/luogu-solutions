考虑 $f(a,b)=1$ 即有 $f(b,a)=1$ 得 $f(a,a)=f(b,b)=1$，那么如果视为一张无向图（忽略自环）的话，图中有孤立点。

先考虑满足自反性的情况。考虑图的每一个极大连通子集，根据传递性一定是一个团。

那么考虑计数这样的图的数量，很明显就是贝尔数，其生成函数是 $\exp (e^x-1)$，容易在 $O(n\log n)$ 时间内求出。

再考虑不满足自反性，那么我们枚举孤立点的数量，答案就是
$$
\sum_{k<n}\dbinom{n}{k}B_k=\sum_{k}\dbinom{n}{k}B_k-B_n=B_{n+1}-B_n
$$
总复杂度 $O(n\log n)$。

另外顺便一提，如果你想只做到 $O(n^2)$ 还不想预处理组合数，那么你可以考虑[贝尔三角形](https://oi-wiki.org/math/combinatorics/bell/#_2)，这样在合数情况下也能做。