由于这题大概率会有根号分治的题解，我这就只分析一下算法的复杂度正确性。

首先花费 $n$ 个数使用 1 操作得出每个节点的深度。

考虑按深度逐层梳理。设有 $k$ 层，第 $i$ 层有 $a_i$ 个节点，则全部使用 1 操作的代价为 $a_i \times a_{i+1}$ 全部使用 2 操作的代价为 $\sum\limits_{j=i}^k a_j$。显然光用任何一个操作都可以被卡成输出 $n^2$ 个数。考虑优化。

由于 1 操作跟当前层和下一层的点数有关，考虑按点数分类讨论。取闸值 T 为分界点，当 $a_i$ 大于 $T$ 时使用 2 操作，否则使用 1 操作，输出数量为 $(nT+n^2/T)$

证明：

讨论当前层的节点个数：

- $a_i>T$

易证全部使用二操作花费的代价不超过 $n$，这里直接按 $n$ 来看待。

可以发现，这种情况最多出现 $n/T$ 次，每次输出数量为 $n$，故总输出数量为 $n^2/T$

- $a_i<T$ 且 $a_{i+1}<T$

这种情况的花费为 $a_i\times a_{i+1} \times \dfrac{n}{a_i+a_{i+1}}$


由于 $a_i+a_{i+1}$ 变大会使这个式子变小，这里默认 $a_i = a_{i+1} = a_i+a_{i+1} = T$（虽然不可能，但不存在比这种情况更劣的输出方案），那么这个输出代价为 $nT$。

 $a_i < T$ 且 $a_{i+1}>T$。
 
这种情况的花费仍然为 $a_i\times a_{i+1} \times \dfrac{n}{a_i+a_{i+1}}$

注意这种情况下仍然有 $a_i+a_{i+1} > a_{i+1}$，为了方便我们直接在原式中将他们划等号并约分，则最后这个部分的输出花费为$a_i \times n$，必然不劣于 $nT$

令 $T=\sqrt{n}$，则我们可以在 $n\sqrt{n}$输出数量内解决问题