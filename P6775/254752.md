场外选手口胡一波。

先证明，如果 $m \ge n-1$ 一定有解。

我们试图做一道菜，用完一种原材料，这样 $m \le n-1$ 的性质会一直被保留，直到最后 $n=2,m=1$。

分类讨论：

如果任何一种原材料剩余的克数都不小于 $k$，那么依次使用每一种原材料直到用光，此时每一道菜都至多使用了 $2$ 种原材料。

否则，一定存在一种原材料，它的克数不超过 $k$。

如果存在克数不小于 $k$ 的原材料 $A$ 和小于 $k$ 的原材料 $B$，那么用光 $B$，剩下的用 $A$ 去做一道菜；

否则，取出克数最大的两种原材料 $C,D$，用光 $C$，剩下的用 $D$ 做一道菜。由于 $m \ge n-1$ 不难证明 $C,D$ 的克数和不小于 $k$。

这样，我们就给出了 $m \le n-1$ 的构造。

我们再构造一张图：如果两种原材料共做一道菜那么就连边。不难证明任何一个连通块中 $m \ge n-1$，所以如果 $m=n-2$ 并且有解，那么至少两个连通块，也就是存在一个 $l \le m$ 使得存在 $l$ 中原材料它们的总重量恰好是 $(l-1)k$，这样用它们做 $l+1$ 道菜剩余的也这样即可。

这是一个很裸的 $01$ 背包问题，将每一个原材料的克数减去 $k$ 之后和为 $-k$ 即可。

此时直接使用 $bitset$ 记录前 $t$ 个数选或者不选能得到的和的所有值，就可以做到 $Tn^2k/w$ 的复杂度，其中 $w=64$。

当然还要输出方案，当输出方案的时候，只要先找到最小的有解的 $t$，然后现在如果在第 $p$ 位，还需要 $S$ 的重量时，看一下$p-1$ 个 $bitset$ 中 $m$ 那一位是否为 $1$，如果是那么第 $p$ 位就不取，否则就取，就可以得到一种方案。

~~什么？代码？上午我口胡的时候没有电脑，哪里来的代码？~~