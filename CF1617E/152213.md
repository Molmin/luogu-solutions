想象一下，操作过程必然是，先不停操作掉最高位让 $x$ 变小，然后不停操作产生新的最高位直到达到 $y$。判断一个数能否达到 $y$，可以不停操作掉 $y$ 的最高位，这样会得到 $O(\log v)$ 个数。可以发现，对于每个 $a_i$，不停操作掉它的最高位得到一个序列，那么我们实际上是求两个序列的长度和减去它们 lcp 长度的 $2$ 倍的最小值。由于这个序列显然是递减的，它给出一棵根为 $0$ 的内向树，操作数就是这个树上的距离，所以求直径即可。复杂度 $O(n\log v)$。

因为不是很理解如何一眼建出图来所以写一篇。