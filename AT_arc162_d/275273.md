注意到，如果给定每个点的度数 $d_i$，那么根据 Prufer 序可得，合法本质不同无根树数量为 $\frac{(n - 2)!}{\prod\limits_{i = 1}^n (d_i - 1)!}$。

考虑拆贡献，钦定一个点是好点，在这样的基础上求本质不同无根树数量。

设钦定 $u$ 为好点。那么 $u$ 子树内所有点都在 $[u, n]$ 内。注意到求无根树的式子只关心树的大小和 $(d_i - 1)!$ 的乘积，并且合法当且仅当 $\sum (d_i - 1) = n - 2$，于是考虑背包，设 $f_{i, j, k}$ 为 $[i, n]$ 中，被选的点度数和为 $j$，数量为 $k$ 的方案数。

考虑完 $u$ 子树后，把这些点全部删掉，$u$ 作为叶子再参与接下来整棵树方案数的计算即可。

时间复杂度 $O(n^3)$。

[code](https://atcoder.jp/contests/arc162/submissions/42727920)