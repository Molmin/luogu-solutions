鉴于 $k$ 的数据范围非常小，容易想到对每种颜色处理最短路。

令 $dis_{i,j}$ 表示所有第 $i$ 种颜色的点，到 $j$ 号点的最短路。由于每种颜色点会有多个，考虑对于每种颜色设超级源点 $k_i$，对该颜色每个点连 $0$ 边，最后对于每个超级源点跑最短路即可。

至于统计答案我想到了 $2$ 种方法：排序，优先队列。排序和优先队列复杂度都是 $O(n\log n)$。

另外，因为边权为 $1$，最短路跑BFS就好辣。