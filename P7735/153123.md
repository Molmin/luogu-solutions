考虑这样一个转化：

对于每次修改操作，将 $x \rightarrow y$ 路径上的所有点的颜色染成一种新颜色（假设初始时所有点颜色两两不同），那么在某一个时刻，两端的点颜色相同的边就是一条重边。

对原树进行重链剖分并维护一棵线段树，每个线段树节点维护当前区间最左边点和最右边点的颜色，以及区间内有多少对相邻且颜色相同的点。

对于修改操作，直接将链上的所有点赋值成新颜色，可以直接打懒标记。

对于询问操作，在重链上跳的同时记录一下上一次访问的重链的顶端的点的颜色，来判断这次跳到的重链的底端点颜色是否和那个重链的顶端点颜色相同，如果相同让答案+1

时间复杂度 $O(n\log^2 n)$ ，可以通过