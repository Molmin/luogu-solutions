[ P4804 [CCC2016] 生命中的圆 ](https://www.luogu.com.cn/problem/P4804)

一道有意思的推结论题，因为神鱼比赛重了所以来补一下。



结论：设原环为 $a$ ，令 $p=2^k$ ，则 $a_i$ 经过 $k$ 次变换后的值为 $a_{i-p}\oplus a_{i+p}$ （在环的意义下）。



可以采用数学归纳法证明。



- 当 $p=1,k=0$ 时，容易发现 $a_i$ 由其相邻两项决定，只有 $1$ 个为 $1$ 时其才为 $1$ 。二者刚好是题目中给我们的变化条件。



- 当 $p=2,k=1$ 时，我们可以尝试分类：

>当 $a_{i-2}$ 与 $a_{i+2}$ 相同时，原环的部分可以表现为 $A\square\square\square A$ ，令其在原环中编号为 $a_{l+1},a_{l+2},a_{l+3},a_{l+4},a_{l+5}$ ，由此我们可以发现当 $a_{l+3}=a_{l+1}=a_{l+5}=A$ 时，一次变换后的 $a_{l+2}$ 与 $a_{l+4}$ 必为 $0$ （ $a_{l+1}\oplus a_{l+3}=a_{l+3}\oplus a_{l+5} =0$ ） ，因而再进行一次变换时 $a_{l+3}$ 必定为 $0$ 。而当 $a_{l+3}=B$ 时，一次变换后的 $a_{l+2}$ 与 $a_{l+4}$ 必为 $1$ （ $a_{l+1}\oplus a_{l+3}=a_{l+3}\oplus a_{l+5} =1$ ），则再进行一次变换后的 $a_{l+3}$ 仍为 $0$ 。

>当 $a_{i-2}$ 与 $a_{i+2}$ 不同时，原环的部分可以表现为 $B\square\square\square A$ ，令其在原环中编号为 $a_{l+1},a_{l+2},a_{l+3},a_{l+4},a_{l+5}$ ，由此我们可以发现当 $a_{l+3}=a_{l+1}=B$ 时，一次变换后的 $a_{l+2}$ 必为 $0$ ， $a_{l+4}$ 必为 $1$ （ $a_{l+1}\oplus a_{l+3}=0,a_{l+3}\oplus a_{l+5} =1$ ） ，因而再进行一次变换时 $a_{l+3}$ 必定为 $1$ 。同理可得，当 $a_{l+3}=a_{l+5}=A$ 时，经过 $2$ 轮变换后的 $a_{l+3}$ 也必定为 $1$ 。 



- 当 $p=2^k,k>1$ 时，我们令 $k-1$ 的结论成立，则有：

>当 $a_{i-p}$ 与  $a_{i+p}$ 相同时，原环部分可以表现为 $A\square\cdots\square\cdots\square A$ ，容易发现当 $a_{i}=a_{i-p}=a_{i+p}=A$ 或 $a_i=B$ 时，区间的剩余两部分都为 $k-1$ 的子问题，而这两个子问题根据结论来讲答案都必然为 $1$ ，因此原问题答案为 $0$ 。

>当 $a_{i-p}$ 与  $a_{i+p}$ 不同时，原环部分可以表现为 $A\square\cdots\square\cdots\square B$ ，容易发现当 $a_{i}=a_{i-p}=A$ 或 $a_i=a_{i+p}=B$ 时，区间的剩余两部分也都为 $k-1$ 的子问题，而这两个子问题根据结论来讲答案都必然一个为 $1$ ，一个为 $0$ ，因此原问题答案为 $1$ 。



因此我们不难发现，可以通过小问题来推广大问题，原命题由此得证。



于是我们只需要将 $T$ 二进制分解，即可在 $O(n\log T)$ 得时间复杂度内解决。