[AGC025D Choosing Points](https://atcoder.jp/contests/agc025/tasks/agc025_d)

**Hint：二分图。**

这道题最难的地方是观察出来二分图的性质。

通过直觉可以发现不会存在等边三角形，即不会存在 **三个格点之间的距离都是 $d$**，也就是所有距离为 $d$ 的格点间连边会构成一张二分图。下面来证明这件事。

先将距离为 $d$ 的式子列出来：$(x_1-x_2)^2+(y_1-y_2)^2=d$。对 $d$ 的奇偶性分开讨论。若 $d$ 为奇数，则 $(x_1-x_2)^2$ 和 $(y_1-y_2)^2$ 必然一奇一偶。又因为一个数的平方与该数奇偶性相同，所以 $x_1-x_2$ 和 $y_1-y_2$ 一奇一偶，则 $x_1-y_1$ 和 $x_2-y_2$ 一奇一偶。至此，把 $x-y$ 为奇数的选成一个集合，$x-y$ 为偶数的选成一个集合就可以了。

若 $d$ 为偶数，则分两种情况：$d\equiv 2\pmod 4$ 和 $d\equiv 0\pmod 4$。先考虑前者，容易发现 $x_1-x_2$ 和 $y_1-y_2$ 必须同为奇数，即 $x_1,x_2$ 和 $y_1,y_2$ 奇偶性都不同，所以在 $x,y$ 奇偶性相同与否的两个独立图中都是二分图，合起来也是。

下面剩下 $4|d$ 的情况。由于 $4|d$，所以可以将等式两边都除以 $4$，即：
$$
(\frac{x_1-x_2}{2})^2+(\frac{y_1-y_2}{2})^2=\frac{d}{4}
$$

还可以继续往下除，直到 $\frac{d}{4^p}$ 不为 $4$ 的倍数为止，而其他情况我们都证明了二分图，所以 $d\equiv 0\pmod 4$ 的情况也证明完毕。

有了这个结论以后，可以对 $D_1$ 和 $D_2$ 都分别拉一张二分图出来，每个点在两张图中都有染色，共四种情况：$(0,0),(0,1),(1,0),(1,1)$（$(x,y)$ 表示在第一张图中颜色为 $x$，第二张图中颜色为 $y$）。根据鸽笼原理，一共 $(2n)^2=4n^2$ 个点，这四种的点必然有一种是 $\geq n^2$ 的。

实现就不多讲了，我用的最暴力的 $\mathcal{O}(n^3)$ 也可以通过。[代码](https://atcoder.jp/contests/agc025/submissions/36811267)。