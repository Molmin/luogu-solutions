翻译有误：不是一个长度为 $n$ 的**数组** $p$，而是一个长度为 $n$ 的**排列** $p$。

题意就是 $k$ 轮冒泡排序。结论题。为了避免疑惑，这里会说得尽量明白一些。

***

假设 $a_1,a_2,a_3,...,a_n$ 对应 $v_1,v_2,v_3,...,v_n$。现在取任意两个 $i,j$，且 $i<j$。然后交换 $a_i,a_j$。有两种情况：

- $a_j>a_i$，此时因为一个比 $a_i$ 大的数被放到了 $a_i$ 前面，必然 $v_j$（此时的 $j$ 位置上是 $a_i$）会至少增加 $1$，即 $v_i$ 变化。
- $a_j<a_i$，同理。

因此对于一个确定的 $a$，任何对它的操作都必然导致 $p$ 改变。

结论：对于一个确定且合法的 $v$，$p$ 是唯一确定的，反之亦然。

接着分析一轮冒泡排序之后 $v$ 的变化情况。对于第一个 $a_i>a_{i+1}$ 的 $i$，$a_i$ 将会不断往右 swap，这个过程相当于把 $a_i$ 右边的元素拉到左边来，拉到 $v_j=0$ 的 $j$ 的时候就停止。原因显然：$j$ 前面没有比 $a_j$ 大的元素，$a_i$ 也不例外；因此 $a_j>a_i$（且 $j>i$），无法进行交换。这时候 $a_i$ 前面的元素都是比 $a_i$ 小的，所以 $v_i=0$。

另外，交换的一个影响是比 $a_i$ 小的那些元素全都被往左边 swap 了，但是相对顺序没有变，且在它们前面**只有**一个 $a_i$ 消失了，因此 $v$ 变化是：舍弃最左端，**整体左移一位**，然后**整体减一**（与 $0$ 取 $\max$）。在最右边补上 $0$。

所以冒泡 $k$ 次，等价于所有的 $v$ 往左移 $k$ 位，且整体 $-k$，末尾 $k$ 位都是 $0$。

因为 $p$ 与 $v$ 一一对应，所以 $p$ 方案数等于 $v$ 方案数。需要做的就是根据 $v'$ 确定 $v$。讨论 $v'$ 的情况：

- 对于 $i \leq k$，根据上面的结论，$v_i=0$；
- $v'_i$ 不确定，此时可以任意取，$[0,i-1]$；
- $v'_i=0$，因为这里有个与 $0$ 取 $\max$ 的过程，所以不能唯一确定原来的 $v_i$，即原来的 $v_i$ 可能是 $[0,k]$ 之间的任何数；
- $v'_i>0$’，此时 $v_i$ 唯一确定，为 $v'_i+k$。

还要考虑无解：

- $v_i\ge i$。第 $i$ 个数前面不可能有超过 $i-1$ 个数都比 $a_i$ 大。
- 对于 $i \leq k$，$v_i\not =0$。根据上面的结论，末 $k$ 位肯定是 $0$。

代码非常简单，就不放了。