[Link](https://www.luogu.com.cn/problem/P2487)

[Blog阅读体验更佳](https://tony102.xyz/index.php/2021/03/23/luogu2487-sdoi2011%e6%8b%a6%e6%88%aa%e5%af%bc%e5%bc%b9/)

这道题不要去darkbzoj上交，估计是当时没加SPJ导致你无论如何都过不去



### Sol

导弹拦截大家都会

现在已经给你了导弹来的顺序，我们把这个顺序记做 $t_i$

我们先来解决第一问，也就是最多能拦截的导弹数量。我们设 $f_i$ 表示以 $i$ 为最后一枚拦截的导弹前面最多能拦多少枚，记 $g_i$ 为达到 $f_i$ 的方案数。那么 $O(n^2)$ 的转移非常好写。在 $f_i$ 转移的时候看一下答案更新的情况，如果 $f_i$ 不变就乘法原理乘一下 $g_i$ ， 否则变成 $0$ 

注意到 $f_i$ 只能是从 $i$ 的左边转移过来，看看能不能用 cdq 分治解决这个问题。现在 $t_i$ 已经被确定，也就是说，已经有一维被确定，把 $h_i$ 当做第二维，每次 cdq 的时候查一查左边的$h$比右边的 $h$ 大的时候，就会产生贡献。更加具体的，我们把 $f_i$ 和 $g_i$ 插到线段树中，当要更新答案的时候就可以从线段树中取出最大的 $f_i$ 和 $g_i$ 更新当前的结果。

就这么写还是有锅，因为一种方案的方案数应该是以它开头和以它结尾的方案数的成绩。所以我们把三维全部逆过来，然后再做一遍 cdq 就可以了。

此外，注意方案数相加相乘会爆`long long`，用`double`存就可以了



### Code
**[Code戳这里](https://tony102.xyz/index.php/2021/03/23/luogu2487-sdoi2011%e6%8b%a6%e6%88%aa%e5%af%bc%e5%bc%b9/)**