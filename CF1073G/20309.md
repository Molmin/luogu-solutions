有经验的选手应该可以秒杀这个套路题。

首先，LCP 问题可以转化成后缀树上的 lca 问题，然后就可以建虚树，枚举 lca ，开一个桶，批量处理了。

最优复杂度$O(n+\sum{(k_i+q_i)})$。当然这个做法比较没意思，我们想想后缀数组怎么做。

首先，LCP 问题可以转化成区间最小值问题（rmq），然后问题相当于给你两个集合$A,B$，询问两两之间最小值之和。

基础好的选手可以很快的看出解法。先用两个集合给出的值来把数组分段，一个段对应一个区间，显然最小值都是拿这些整段拼起来的。

然后枚举每一段的贡献。用单调栈计算出一个段作为最小值贡献到的端点，然后用一个前缀和计算有多少个区间落在这个范围内就好了。

最优复杂度$O(n+\sum{(k_i+q_i)})$。

代码好写，这里就不贴了。