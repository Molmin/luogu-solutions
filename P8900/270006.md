由于此树为无根树，所以先钦定 $1$ 号结点为根节点。

题目中保证一定存在解，因此可以计算出每个结点最终要打到的值，记为 $ave$。

记以 $x$ 号结点的父亲为 $fa_x$，以其为根的子树的结点个数为 $sum_x$，子树的干草个数总和为 $sumbarn_x$。

因为在以 $x$ 号结点为根的子树内移动干草，并不改变 $sumbarn_x$，这些操作是无用的。

因此，我们记 $\delta (x)$ 为 $sumbarn_x- ave \times sum_x$，即以 $x$ 号结点为根的子树中，和我们想要达到的情况差多少捆干草。

如果 $\delta(x) > 0$，则意味着 $x$ 要向 $fa_x$ 输送 $\delta(x)$ 捆干草。如果 $\delta(x) < 0$，则意味着 $fa_x$ 要向 $x$ 输送 $|\delta(x)|$ 捆干草。如果 $\delta(x) = 0$，则只用在子树内部调整即可。

由此，我们可以得到一个操作序列。但是它们的顺序没有规定，而且某些顺序可能是不合法的。因此，我们需要规划操作的顺序。

我们可以模拟一下操作：$\delta(x) = 0$ 的子树是自给自足的，只需遍历底下的子树即可。$\delta(x) > 0$ 的子树是富余的，所以当访问到这种子树时，要第一时间向上输送干草，这时这颗子树也变为 $\delta(x) = 0$ 的情况。$\delta(x) < 0$ 的子树是缺失的，所以 $fa_x$ 必须第一时间向下输送干草，使 $\delta(x)$ 变为 $0$。

另外地，在一颗树中，必然是先收集干草再输送干草，所以先访问 $\delta(x) > 0$ 的结点，最后访问 $\delta(x) < 0$ 的结点，可以保证不出现没有干草可以输送的情况。

[参考代码](https://www.luogu.com.cn/paste/nzltgfcz)