先%一发zyk

![](https://cdn.luogu.com.cn/upload/image_hosting/p6sdawv6.png)

先考虑把方差拆开
$$D(X)=\sum_{i}(x_i-E(X))^2\times p_i$$
$$D(X)=\sum_{i}x_i^2\times p_i-2\times \sum_{i}x_i\times E(X)\times p_i+\sum_{i}E(X)^2\times p_i$$
$$D(X)=E(X^2)-2\times E(X)^2+E(X)^2\times \sum_{i}p_i$$
$$\sum_ip_i=1$$
$$D(X)=E(X^2)-E(X)^2$$

设$X$为联通块个数，$a$为点数，$b$为边数，$c$为环数
则有
$$X=a-b+c$$
即联通块个数等于点数-边数+环数

根据期望的线性性

$$E(X^2)=E((a-b+c)^2)$$
$$=E(a^2+b^2+c^2+2ac-2ab-2bc)$$
$$=E(a^2)+E(b^2)+E(c^2)+2E(ac)-2E(ab)-2E(bc)$$

然后考虑每个期望怎么求
### $E(a^2)$
#### 解法一
直接写出式子$E(a^2)=\frac{\sum_{i=0}^{n}i^2\times C_{n}^{i}}{2^n}$

这个式子已经可以$O(n)$算了

不过再优化一下，根据$mC_{m}^{n}=nC_{m-1}^{n-1}$,上式显然等于$\frac{n\times (n+1)}{4}$
#### 解法二
$E(a^2)$等于枚举两个点，可以重复，求他们同时存在的概率的和

对于每个点$i$,考虑另外一个点$j$

- 若$i=j$,概率为$\frac{1}{2}$
- 若$i\not=j$,概率为$\frac{1}{4}$

最后的期望为$\frac{n\times(n+1)}{4}$

### $E(b^2)$
$E(b^2)$等于枚举两条边，可以重复，求他们同时存在的概率的和

对于每条边$i$,考虑另一条边$i$

- 若$i=j$，概率为$\frac{1}{4}$
- 若$i$和$j$相连，概率为$\frac{1}{8}$
- 若$i$和$j$没有什么关系，概率为$\frac{1}{16}$

考虑记录每个点的度数，因为没有重边，显然不会重复计数

### $E(c^2)$
$E(c^2)$等于枚举两个环，可以重复，求他们同时存在的概率的和

考虑先算出每个环$i$的大小$size_i$,共$cnt$个环

那么第$i$个环存在的概率$P_i=\frac{1}{2^{size_i}}$

对于每个环$i$,考虑另一个环$i$

- 若$i=j$，概率为$P_i$
- 若$i$与$j$有一个点相同，概率为$P_i\times P_j\times 2$
- 若$i$与$j$没有什么关系，概率为$P_i\times P_j$

### $E(ab)$
$E(b^2)$等于枚举一个点和一条边，求他们同时存在的概率的和

对于每个点$i$,考虑每一条边$i$

- 若$i$是$j$的一个顶点，概率为$\frac{1}{4}$
- 若$i$和$j$没有什么关系，概率为$\frac{1}{8}$

### $E(ac)$
$E(b^2)$等于枚举一个点和一个环，求他们同时存在的概率的和

对于每个点$i$,考虑每一个环$i$

- 若$i$在$j$上，概率为$P_j$
- 若$i$和$j$没有什么关系，概率为$P_j\times \frac{1}{2}$
### $E(bc)$
$E(b^2)$等于枚举一条边和一个环，求他们同时存在的概率的和

对于每个环$i$,考虑每一条边$i$

- 若$j$在$i$上，概率为$P_i$
- 若$j$有一个点在$i$上，概率为$P_i\times \frac{1}{2}$
- 若$i$和$j$没有什么关系，概率为$P_i\times \frac{1}{4}$

### $E(X)$
$$E(a)=\frac{n}{2}$$
$$E(b)=\frac{m}{4}$$
$$E(c)=\sum_{i=1}^{cnt}P_i$$
$$E(X)=E(a)-E(b)+E(c)$$

[代码在这里](https://www.luogu.com.cn/paste/1pt1bpz1)