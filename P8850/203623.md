这个题目是数学题。因为出题人不会数学，所以题目很简单。

题目背景已经提示，操作顺序无关。所以考虑分别将每个 $1$ 移动到目标。

设 $f_i$ 为从点 $i$  移动到点 $1$ 期望操作次数。考虑求出这个。

可以列出方程：

$$f_1=0$$

$$f_i=1+\dfrac  1 2(f_{i-1}+f_{i+1})(i\in[2,n-1])$$

$$f_n=1+\dfrac  1 2(f_{1}+f_{n-1})$$

考察 $f$ 的一些性质。

$f$ 显然具有对称性，即 $f_i=f_{n-i+2}$。

设我们已经求出了 $f_{2\dots k},f_{n-k+2,n}$，考虑求出 $f_{k+1}$ 即 $f_{n-k+1}$。

有：

$$f_{k+1}=1+\dfrac  1 2(f_k+f_{k+2})$$

$$\dots$$

$$f_{n-k+1}=1+\dfrac  1 2(f_{n-k}+f_{n-k+2})$$

两边求和：

$$S=\sum_{i=k+1}^{n-k+1}  f_i$$

$$=n-2k+1+\dfrac 1 2( \sum_{i=k}^{n-k} f_i+\sum_{i=k+2}^{n-k+2} f_i)$$

$$=n-2k+1+\dfrac 1 2(S+f_k-f_{n-k+1}+S-f_{k+1}+f_{n-k+2})$$

$$=n-2k+1+S+f_k-f_{k+1}$$

所以有递推式 $f_{k+1}=f_k+n-2k+1$。

现在问题即将 $a$ 旋转，最小化 $\sum_{i=1}^n a_if_i$。

~~好了这里显然是个卷积形式，跑卷积就行了~~

~~然而虽然模数是 NTT 模数但是根本没用好吧~~

考虑旋转次数 $k$。

$$\sum_{i=1}^{n-k} a_i f_{i+k}+\sum_{i=n-k+1}^na_if_{k-n+i}$$

$k\to k+1$：

$$\sum_{i=1}^{n-k-1} a_i f_{i+k+1}+\sum_{i=n-k}^na_if_{k-n+i+1}$$

增量为：

$$\sum_{i=1}^{n-k-1} a_i (n-2(i+k)+1)+\sum_{i=n-k+1}^na_i(n-2(k-n+i)+1)-a_{n-k}(n-1)$$

拆开后容易维护。时间复杂度线性。