有趣的题。

容易发现最终的要求就是所有点的入度为 1。

那么只要预处理出来一开始每一种类型的边会使哪些点的入度+1，最后枚举一下方案并 check 就行了。

有三种实现这个的方法。

- bitset。复杂度 $O(\dfrac{nk!}{w})$。大力卡常理论上可以过去。实际上由于 STL 的 bitset 常数过大会裂开来，需要手写。

- 考虑如果一个点入度大于等于 2 则不行。那么预处理出两两的互斥关系，最后 $O(k^2)$ check 就可以了。

- Hash。给每个点赋随机权值，最后检查和。简单好写但会被叉。

代码就不放了，挑一种实现即可，极其容易。