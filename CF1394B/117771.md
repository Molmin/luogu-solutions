要让每个点都能走回自己，就等价于每个点都在环上，也等价于每个点的入度恰好为 $1$。

很明显答案最多是 $9!=362880$，然后很自然的想到暴力检查，很明显因为点太多过不了。

我们换一种思路，令点对 $(x,y)$ 代表 $c_x=y$ 这个状态，那么状态数就是 $1+2+\cdots+9=54$ 个。

首先，我们先处理出每个点的出度，再把一个点的出边排个序。

然后检查每个状态，把所有出度为 $x$ 的点连出的第 $y$ 条边连向的点拿出来，看一看有没有重复的。

判断 $(x_1,y_1)$ 和 $(x_2,y_2)$ 是否冲突，直接枚举复杂度是 $O(k^2n)$ 的，莽不过去。

换个思路，我们把每个点的入边拿出来，记录边的起点的度数和这是第几条边，不难发现这构成了一个状态 $(x,y)$。

把每个点存好的状态两两之间标记无法共存，最后直接大力枚举 $9!$ 种情况。

因为一个点的入边可能有很多，注意要把状态去个重。

总的复杂度 $O(k^2\times k!+n)$。