首先将所有数的平方因子除掉，这样不影响答案；

如果某个数有三个素因子，可以证明其至少有$8$个因数；所以每个数都最多有两个素因子。又因为我们已经去除了所有平方因子，所以所有数只有三种可能性，$1$、$p$、$p*q$（$p$、$q$是素数）。如果存在一个$1$，则答案一定是$1$。否则，我们需要选择最少数量的数，使得这些数的乘积是平方数。

我们考虑建图解决这个问题。我们将每个素数对应一个图中的节点（特别地，$1$也对应一个节点），每个数组中的数对应一条无向边。对于每个数$p*q$，我们把节点$p$和节点$q$连起来；对于每个素数$p$，我们把节点$p$和节点$1$连起来。

下面我们证明，对于图中的任何一个简单环，这个环上的边对应的数的乘积一定是完全平方数：对于环上的一个节点$p$，环上必然有恰好两条边与节点$p$相连，所以必然有恰好两个选出的数包含了素因子$p$，所以$p$在乘积中的次幂是$2$。所以乘积一定是完全平方数。

所以我们只需要找到图中的最小环就可以。

一个方法是，注意到图中不存在连接两个$>1000$的节点之间有边（这是因为，如果它们之间有边，那么这条边对应的数组中的数一定$>1000*1000=10^6$），所以每一个至少有两条边的环中必然包含至少一个$<1000$的节点。所以我们只需要从每个$<1000$的素数所对应的节点做一遍bfs，就可以找到所有环，更新答案。

时间复杂度是$O(n*sqrt(C))$，其中$C$代表$a_i$中的最大值。代码不难写，就不放了qwq