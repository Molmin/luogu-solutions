有意思的题。

我们先考虑把每个数的所有完全平方因子去掉。

因为每个数的因数个数不超过 $7$，所以其必定只会包含 $0, 1$ 或 $2$ 种质因子。

所以所有数都可以表示为 $1, p, p \times q$ 三种类型。

如果有 $1$，则直接输出他就行了。

接下来我们观察到匹配完全平方数时很像首尾相接形成了一个环。于是我们套路地将每个质数设成一个点，对于每个 $p \times q$ 类的数连接 $p$ 与 $q$。

那么对于 $p$ 一类数怎么办？我们发现它其实只提供了一边，所以建一个虚点 $s$，连接 $p$ 和 $s$ 即可。

最后我们就是要求一个无权图的最小环。我们发现我们只需要把 $\leqslant \sqrt{\max\{a_i\}}$ 的点作为根跑一遍最短路树就可以了。

该题启示：遇事不决建个图，建图不决造虚点。