#### Description

> 给定一个字符串 $S$，求将 `?` 替换后的所有字符串中有多少个长度为三的子序列为 `ABC`，其中 $S$ 中的 `?` 可以换成 `A` / `B` / `C`。

#### Solution

考虑 dp，设 $f_{i,1/2/3}$ 为截止到第 $i$ 个字符有多少个子序列为 `A` / `AB` / `ABC`。

设 $g$ 为 $S$ 有多少个 `?`，则有转移：

- 当 $S_i=$ `A`，`A` 的情况可以进行更新：
	- $f_{i,1}=f_{i-1,1}+3^{g}$；
    - $f_{i,2}=f_{i-1,2}$；
    - $f_{i,3}=f_{i-1,3}$；
- 当 $S_i=$ `B`，`AB` 的情况可以进行更新：
	- $f_{i,1}=f_{i-1,1}$；
    - $f_{i,2}=f_{i-1,2}+f_{i-1,1}$；
    - $f_{i,3}=f_{i-1,3}$；
- 当 $S_i=$ `C`，`ABC` 的情况可以进行更新：
	- $f_{i,1}=f_{i-1,1}$；
    - $f_{i,2}=f_{i-1,2}$；
    - $f_{i,3}=f_{i-1,3}+f_{i-1,2}$；
- 当 $S_i=$ `?`，则一共 $3^{g}$ 种情况就划分为了三种，加 `A` 加 `B` 加 `C`，则 `A` `AB` `ABC` 三种子序列的转移量也从上一种情况除以 $3$ 得到（可以感性理解为有 $1/3$ 的概率得到这个子序列想要的字符），那剩下的 $2/3$ 就是不符合要求的，直接从第 $i-1$ 项转移过来即可，即为：
	- $f_{i,1}=\frac{f_{i-1,1}+3^{g}} 3+\frac{2f_{i-1,1}} 3=f_{i-1,1}+3^{g-1}$；
    - $f_{i,2}=\frac{f_{i-1,2}+f_{i-1,1}} 3+\frac{2f_{i-1,2}} 3=f_{i-1,2}+\frac{f_{i-1,1}}3$；
    - $f_{i,3}=\frac{f_{i-1,3}+f_{i-1,2}} 3+\frac{2f_{i-1,3}} 3=f_{i-1,3}+\frac{f_{i-1,2}}3$。
    
最后输出 $f_{n,3}$ 即可。