挺自闭的，做麻烦了。

下文阐述 std 做法，我的原做法可以在[此](https://www.luogu.com.cn/paste/ajn3m5j7)查看。

建出基环树，只需分树上/环上点贡献考虑。

树上贡献比较简单，长剖，自下而上依次考虑每条长链贡献即可，每次都是一次卷积。

环上若不考虑走多遍环，只需断环为链做一遍卷积。由于最后需乘上一个 $\frac{1}{1-x^c}$（$c$ 为环长）并求和，我们只需分环长讨论（不同环长只有根号种），每次做一遍前缀和即可。

复杂度 $O(n\sqrt n)$。