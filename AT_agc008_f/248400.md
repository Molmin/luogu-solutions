f. **[[AGC008F] Black Radius](https://atcoder.jp/contests/agc008/tasks/agc008_f)（8）**

神仙题！

先考虑 $s$ 全为 $1$ 的情况。

假设 $S(u,d)$ 表示和 $u$ 距离不超过 $d$ 的点组成的集合。我们先不考虑全集的情况，那么 $d<f_u$，其中 $f_u$ 表示 $u$ 到树上最远点的距离。不难发现对任何的 $u\not =v$ 都有 $S(u,d)\not= S(v,d)$。

但是对于直接算 $\sum(f_i-1)$ 会有重复，但是根据上面的结论，我们知道给定集合 $S,d$ 至多存在一个 $u$ 满足 $S(u,d)=S$。这让我们想到我们**对于一个 $\bm S$ 只对最小的 $\bm d$ 算贡献。**

也就是对任意和 $u$ 相邻的 $v$ 都有 $S(u,d)\not=S(v,d-1)$。换句话说也就是 **以 $\bm u$ 为根，有一个点不在 $\bm v$ 的子树当中且和 $\bm u$ 距离为 $\bm{d-1}$**。再转化一下，也就是 **以 $\bm u$ 为根的次小深度子树深度大于等于 $\bm{d-1}$**。假设 $g_u$ 为次小深度子树，也就是 $g_u\geq d-1$。

上面两个条件加一起，就会有 $d\leq \min(f_u-1,g_u+1)$。直接求和发现过了。

至此我们获得了 $1300$ 的部分点。

我们接下来要考虑 $s$ 有 $0$ 的情况。

和上面类似的，只是 $d$ 比较小的时候不可取。于是我们推测 $d$ 的取值还是一个区间。

-  如果 $s_u=1$，那么 $d$ 下限为 $0$。
-  反之，我们要找到一个点 $v$ 满足 $s_v=1$ 且存在 $d_0$ 满足 $S(v,d_0)=S(u,d)$。这要求 $d$ 大于等于 $v$ 所在子树的最大深度。于是 $d$ 的下限 $h_u$ 为所有含有 $1$ 子树最大深度的最小值。

完结撒花！

[submission](https://atcoder.jp/contests/agc008/submissions/43699110)