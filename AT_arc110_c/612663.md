讲一个比楼上简单很多的方法。

不难发现，因为每相邻的两个位置最多交换一次，也就是说一个数的位置必然非严格单调递增或者非严格单调递减，举例：

- 对于数列 $A=\{3,1,2\}$，如果交换 $A_2$ 和 $A_3$，那么 $A=\{3,2,1\}$，很显然，之后 $A_3=1$ 将无法再回到原本的位置（因为位置 $2$ 和 $3$ 已经交换过，$A_3$ 将无法通过交换使位置变为 $1$ 或 $2$）。

因此，对于 $1\le i<N$，当我们要交换 $A_i$ 和 $A_{i+1}$ 当且仅当 $A_i>i$ 且 $A_{i+1}<i+1$，同时也很容易发现如果要使 $A_i$ 和 $A_{i+1}$ 归位就必需交换 $A_i$ 和 $A_{i+1}$，与什么时候交换无关。接下来就很简单了，先扫一遍数组，对于每一个满足上述条件的 $i$，将其装进一个队列，每次处理完队头（设其为 $x$）再看看 $A_x$ 和 $A_{x-1}$ 能不能交换以及 $A_{x+1}$ 和 $A_{x+2}$ 能不能交换，若能则加入队列，重复直至队列为空。

记得判断是否无解。

[代码](https://atcoder.jp/contests/arc110/submissions/43746015)