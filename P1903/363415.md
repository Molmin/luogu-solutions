这题作为 [P4690](/problem/P4690) 的弱化版居然没有用 CDQ 分治做的题解？

那我复制一下我写的 P4690 题解：

先考虑不带修怎么做，即 [P1972](/problem/P1972)，我们对每个点维护 $pre_i$ 代表与它颜色相同且下标在它之前的，下标最大的点的下标。（好绕口）

那么我们对于一个区间询问，考虑对于每种颜色，只统计它在区间中出现的最左边一次，也就是查询有多少 $l \leq i \leq r$，满足 $pre_i<l$。那么我们可以作二维偏序来得到答案。

有了不带修的做法，单点修改的做法就很显然了。注意到进行一次单点修改对 $pre$ 数组的影响是 $O(1)$ 的。因此我们把一次单点修改变成一次删除和一次插入，这样就是在二维偏序的基础上加了时间维。因此我们可以作三维偏序。CDQ 分治即可。

时间复杂度双 $\log$，空间复杂度线性，优于树套树和莫队做法。