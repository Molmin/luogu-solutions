打 $CF$ 团队赛做到了这道题，口胡出了一个暴力重构每个块的分块做法，写了一半发现修改不可做，开始推式子。

已知

$$a_i + k_i <= a_{i + 1}$$

有

$$a_{i + 1} - k_i >= a_i$$

$$a_{i + 1} - k_i - k_{i - 1} >= a_i - k_{i - 1}$$

$$\ldots$$

$$a_{i + 1} - k_i - \ldots - k_1 >= a_i - k_{i - 1} - \ldots - k_1$$

记 

$$sum_i = \sum_{j = 1}^{i} k_i$$

有

$$a_{i + 1} - sum_i >= a_i - sum_{i - 1}$$

记 

$$d_i = a_i - sum_{i - 1}$$

有

$$d_i >= d_{i - 1}$$

线段树维护 $d_i$ 即可。

修改时，单点修改即可。

查询时，从右往左在线段树上找第一个满足条件的节点即可。

关于线段树找节点的操作，推荐 $51nod$ 一道类似的[题目](http://www.51nod.com/Challenge/Problem.html#!#problemId=1701)

就做完了。