## [AGC037D](https://atcoder.jp/contests/agc037/tasks/agc037_d)

### 基本转化

从 $D$ 变成 $C$ ， 发现只需要保证每行中是它这一行 $D$ 中元素的排列即可。

从 $C$ 变成 $B$ ， 发现 $B$ 需要 在 $C$ 中是同一行的元素要通过列上的交换变到一行上，也就是保证 $C$ 中同一行的元素不能在相同的列上。

### sol1 (爆标)

问题转化成了，给定一个 $n\times m$ 的矩阵 $\rm A$ ， 再给定 $n$ 个形如以下的限制：指定 $m$ 个元素，要求他们不能在同一列上。

保证每个元素被指定一次，要求任意排列每一行满足限制。

继续观察性质，发现我们想要泛化问题，可以把初始给定的矩阵和操作也转化成限制，也就是初始矩阵给定的每一行元素不能在同一列上。

这样，问题就只剩下了 $2\times n$ 个限制，需要给每个元素染上 $m$ 种颜色中的一种，使得每个限制的集合内颜色不同。

别忘了我们转化的过程中，限制并不一般，具有任意一个元素出现且仅出现在两个限制内，且存在 $n$ 个无交的限制的并集是全集，并且这 $n$ 个限制的补集也满足无交且并是全集。

既然可以分成两个是全集的集合，考虑建一张二分图出来，左右两部分分别是 $n$ 个并集是全集的无交限制。

每个元素出现且仅出现在两个限制内，就把他们连一条边。

问题变成了给定一个左右分别有 $n$ 个点的二分图，每个点有 $m$ 条边，要求给每条边染 $1 \sim m$ 的色，使得每个点连出的边中恰好包含 $m$ 种颜色。

这个问题是 Vizing 定理的经典形式，直接套用其构造性证明方法，即可做到 $O(n\times nm)=O(n^3)$ ， [code](https://atcoder.jp/contests/agc037/submissions/32528777)

### sol2 (标算)

还有另外一种转化的方式，考虑先把 $D$ 中同一行的元素染上一种色。

那么就是给定一个 $n \times m$ 的矩阵 $\rm A$，每个元素被染上了一种颜色，保证一共有 $n$ 种颜色且每种出现 $m$ 个。

要求排列每一行，使得每列包含恰好 $n$ 种颜色。

每行建立一个节点，每个颜色建立一个节点，每行向包含的每个颜色连包含次数条边。

这个二分图的一个完美匹配对应了一列的方案，只需要跑 $m$ 次就可以得到 $\rm B$ 矩阵。

问题是怎么证明这个图一定扛得住 $m$ 个完美匹配。

还剩 $k$ 列没选择的时候，这张图是一张 k-正则 二分图，根据 Hall 定理的推论，一定存在完美匹配。

> 一个无向图，每个点度数都是 $k$ ，则称这个图为 k-正则图。

>假设存在一个集合 $S$, $|N(S)|<|S|$, 由于 $|S|$ 向 $|N(S)|$ 连了 $|S|\times k$ 条边，所以 $N(S)$ 至少有 $|S|\times k$ 条边，但是 $N(S)$ 只有 $N(S)\times k$ 条边，与假设矛盾，故推论成立。


### summary

我们惊奇的发现，虽然从两种完全不同的角度思考，但是建出来的图竟然是完全一样的！

~~也就是你们不跑 $m$ 次最大流而是直接跑 Vizing 定理也可以爆标哦~~~。

同时，也可以这么去理解 sol1，在这个图上找一个完美匹配，然后把他们都染上一种染色，第 $i$ 次染第 $i$ 种染色，因为是完美匹配，所以每个点在这种颜色都有且仅有一条边覆盖它，一定能保证每个点恰好包含 $n$ 种颜色。