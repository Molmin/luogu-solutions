考虑是把 $b$ 里的元素任意插到 $a$ 序列中，则 $b$ 序列插入的相对位置一定是小的在前，大的在后，否则交换则可以减少至少一对逆序对，则 $b$ 的插入只会和 $a$ 中元素构成逆序对。

两个序列一起离散化后先计算 $a$ 中逆序对，然后对 $a$ 序列建立线段树，枚举指针 $v$，$<v$ 的设为 $1$，否则设为 $0$，那么在 $pos$ 后插入 $v$ 的花费就是 $[1,pos]$ 中 $1$ 的个数加上 $(pos,n]$ 中 $0$ 的个数，记为 $d_{pos}$，我们要求的就是把 $v$ 移到 $b_i$ 后最小的 $d_{pos}$，线段树也实际维护的是 $d_{0\cdots pos}$。

实际上把 $p$ 位置的 $0$ 改为 $1$ 对应的就是给 $[p,n]$ 减一，$[0,p)$ 加一。注意特殊处理一下相等的情况即可。

时间复杂度 $O(m\log n)$。

[code](https://codeforces.com/contest/1601/submission/133017168)。