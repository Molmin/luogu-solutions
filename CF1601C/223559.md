### $\text{Difficulty : 2300}$
---
### 解题思路：

大概可以从两个角度出发。

#### 数据结构

对于只存在大小关系的情况，可以直接考虑离散化。之后就发现这里面一共只有 $O(n)$ 个“关键数值”了。

对于一个特定的 $b$ 计算贡献，考虑某一个时刻将 $b$ 向后交换一个位置，发现如果被交换的数 $k$ 比 $b$ 小则产生 $-1$ 的贡献，比 $b$ 大则产生 $1$ 的贡献，相等不会变化。对于这个变化量求一个前缀和就能得到每一个位置上的结果。

若 $b$ 产生变化，需要对于每一个变化的位置进行更改。每一次求结果则需要对于所有前缀和求最小值。

直接随便用个什么数据结构维护一下就好了。

#### 分治

观察到 $b$ 是随意插入 $a$ 的，不妨让 $b$ 从小到大排序，很容易感觉到 $b$ 在从小到大的顺序的情况下，插入的顺序应当是递增的。 

然后发现对于一个 $b_i$，它的最佳位置和其它的所有 $b_i$ 之间是无关的。每一次算出对于 $b_L$ 到 $b_R$ 之间所有值的插入位置都应当在 $a_l$ 到 $a_r$ 之间，求出中间的一个位置的位置就能一下子缩小一半的范围了。

复杂度都是 $O(n\log n)$ 的。
