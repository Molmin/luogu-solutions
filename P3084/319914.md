挺有趣的神仙 dp 题目，建议仔细思考一下。

首先考虑 dp，那么 $f[i]$ 很自然就是第 $i$ 头牛为有斑点的情况下前 $i$ 头牛的有斑点牛数量的最大值。

那么可以发现，$f[i]$ 只可以由一部分 dp 值转移得到，可以发现这些可以转移的是连续的一段。那么假设最小的为 $s[i]$，最大的是 $e[i]$。

那么 $e[i]$ 为**最大的满足不与 $i$ 在同一张照片中出现的点。**也就是覆盖 $i$ 的照片中，左端点的最小值 $-1$。

$s[i]$ 就是**左端点，右端点均 $<i$ 的照片中的最大的左端点。**

注意到 $e,s$ 数组均可以通过 dp 得到。转移方程很容易推出。
$$
e[i]=\min(e[i+1],\text{lmin}[i]-1)\\s[i]=\max(s[i-1],\text{lmax}[i-1])
$$
其中 $\text{lmin}, \text{lmax}$ 的意义分别为以 $i$ 为右端点的左端点最小值与最大值，可以通过预处理得到。

由递推式容易发现 $e[i]\leq e[i+1]$ 且 $s[i]\leq s[i+1]$，因此**转移部分只增不减，可以使用单调队列维护。**

最后注意一下细节，要判断无解情况。

[Code Here](https://www.luogu.com.cn/paste/q3xweyy7)