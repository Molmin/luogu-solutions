这个 $10^{14}$ 的数据范围，根号算法提示的就有点明显了吧。~~一开始以为是 BSGS？~~

首先注意到的一点是：设起始点为 $x$，由于 $s\perp p$，$\gcd(y=xs^z,p)$ 始终是不变的，等于之前的 $\gcd(x,p)$。所以对于每个 $\gcd$，它们是互相独立的，考虑独立开来算。那么考虑 $\gcd$ 等于 $d$ 的一组，就是所有 $\gcd(x,p)=d$ 的 $x$，显然有 $d\mid x$，那么两边除以 $d$ 之后得到 $\dfrac xd\perp\dfrac pd$，那么在这个除以 $d$ 的意义下讨论显然是不妨碍正确性的，这个感性理解一下即可。于是我们要求的是：对所有 $\dfrac pd$，即所有 $d\mid p$，要制服以模 $d$ 的简化剩余系为起始点的所有老鼠要的最少老鼠夹数之和。显然每个要求的都是相似的规模不同的问题，考虑对特定 $d$ 讨论。

由于 $s\perp p$，一定有 $s\perp d$，所以 $s$ 在模 $d$ 意义下有阶。不难发现对于起始点 $x\perp d$，走 $\mathrm{ord}_ds$ 次就会回来，途中会经过 $\mathrm{ord}_ds$ 个位置。而对于这些位置走任意次能到达的位置集合也是相同的，循环顺序就是 shift 若干位。把这些位置打包起来，又可以发现，一定可以不重不漏的把每个位置打进恰好一个包里。因为如果存在这个能到达的位置集合不相等但是有交集，那就混掉了，就不对了。这样的话，每个包随便放一个就可以解决掉一整包，每包互不干涉，不难得到答案就是包数 $\dfrac{\varphi(d)}{\mathrm{ord}_ds}$。

于是现在问题转化成了 $\sum\limits_{d\mid p}\dfrac{\varphi(d)}{\mathrm{ord}_ds}$。考虑怎么快速求这玩意。考虑枚举这个 $d$，并且对每个 $d$ 求出 $\varphi(d)$ 和 $\mathrm{ord}_ds$。对 $\varphi$，如果每个单独单点求，要分解质因数，是根号的，不知道能不能过。不难想到更优秀的方法：仅对 $p$ 分解质因数，然后 dfs 出 $p$ 所有因数的质因子分解式，一边 dfs 一边累乘，这样 dfs 的过程就是 $\mathrm O(\mathrm d(p))$ 的（不过要算上一开始分解质因数的根号）。接下来是 $\mathrm{ord}_ds$。之前一直以为阶这玩意只能用 BSGS 求 $a^x\equiv 1\pmod p$，今天发现一定有 $x\mid\varphi(p)$，直接枚举 $\varphi(p)$ 的因数然后光速幂判即可（对一般的 RHS 不能这样的原因是不能确定 $x$ 的整除关系）。虽说这样也是根号的（枚举因数），可实质上是 $\mathrm O(\mathrm d(p))$，假如已经提前把因数列表存下来的话（其实可以 PR 分解质因数枚举因数严格做到 $\mathrm O(\mathrm d(p))$？我不会）。而这题，显然有若 $d\mid p$ 则 $\varphi(d)\mid\varphi(p)$，我们求 $\mathrm{ord}_ds$ 的时候可以不枚举 $\varphi(d)$ 的因数而选择 $\varphi(p)$。于是预处理 $\varphi(p)$ 的因数列表，每次就是 $\mathrm O(\mathrm d(\varphi(p)))$。所以最终的总复杂度是 $\mathrm O(\sqrt p+\mathrm d(p)\mathrm d(\varphi(p)))$。到 SF 主页里查一下表发现 $\mathrm d$ 在 $10^{14}$ 以内是 $1.5\times10^4$ 级别的，平方一下就是 $2\times10^8$，不慌，鬼都知道跑不满。

对于 $\dfrac{\varphi(d)}{\mathrm{ord}_ds}$ 这个式子的处理方式并不重要，可能有其他复杂度更好的算法。这题的核心是推出这个式子的过程。