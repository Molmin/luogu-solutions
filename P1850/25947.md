首先，考虑对于所有的教室与道路，地图本身是存在最短路的，我们先用floyd求出任意两点之间的最短距离。

其次，针对所有事件可能发生的情况：

1.当前的课不换的情况：

(1)上一节课也没换；

(2)上一节课换了----成功or不成功；

2.当前的课换的情况：

(1)当前课成功换了：

a.上一节课换了----上一节课成功or不成功

b.上一节课没换；

(2)当前的课换了失败：

a.上一节课换了----上一节课成功or不成功

b.上一节课没换；

最后，按步就班地结合题中给出的概率，以及我们用floyd求出的距离，列出转移方程：

![](http://images2017.cnblogs.com/blog/1160478/201709/1160478-20170916203513453-359447125.png)

![](http://images2017.cnblogs.com/blog/1160478/201709/1160478-20170916203643047-689777039.png)
