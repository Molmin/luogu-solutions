这题后半部分可以直接套保守回归的板子，具体见 2018 年高睿泉的集训队论文《浅谈保序回归问题》 论文里讲的比我讲的好多了，本文将不在赘述保守回归算法的部分，重点讲一讲本题的剩余部分。

刚看到题解 ，又是 “拟阵” 啊，“极大线性无关组”这样令人劝退的名词，却没有一篇通俗朴素的题解，所以本蒟蒻就来讲一下我自己的理解，应该会比较好懂。

----

先考虑 $A$ ，$B$ 是同理的。注意到 $A$ 在题目中的描述是这样的：对于 $A$ 中任何子集，异或和都不是零，且 $A $ 是所有满足上述条件中最大的。

看一下 $A $ 的性质：对于 $i \not \in A $，$c_i$ 都可以表示为 $A$ 的子集 $Sub$ 的异或和（否则就可以加入 $A$ 那么原本的 $A$ 就不是最大的了）。换句话说，用 $A$ 中的子集的异或和可以表示出任何一个不在 $A$ 中的元素，并且这个子集是唯一的（如果不是唯一的，那么这两个子集的 并集减去交集 的异或和就是 $0$ 和题意不符）。

稍加思考发现我们无法完全枚举出所有符合题意的集合 $S$，所以我们考虑怎么对 $A$ 进行删减获得一个新的 $S$。 先考虑 $A$ 的一个子集 $Sub\subset A$ 若有 $\oplus_{j \in Sub} c_j=c_k$ 即 $Sub$ 的元素的异或和为 $c_k$  ，则 $k$ 可以替换任意一个 $c_j$ 。替换之后不会出现异或和为零的子集（因为本来没有异或和为零的子集，删减一个点不会出现异或和为零，之后加入 $c_k$ 若有异或和为零的子集，那么必然有 $\oplus_{j \in Sub'} c_j=c_k$ 即 $A $ 中含有一个新的不包括 $j$ 的子集异或和为 $c_k$ ，这样与上述结论相悖，所以原命题得证）。


那么 $A$ 是最小的花费的条件是 $v_k\ge \max_{i\in Sub}v_i$，表示 $k$ 的花费比 $Sub$ 中的任意一个花费都高，这个是必要条件，充分性的证明可以从替换的方面考虑（即不能用合法的替换把 $A$ 换成花费更小的，因为每次选 $A$ 外的元素换进 $A$ 中花费都是增加的）。由于性质可知，每一个 $k$ 都对应这这样一个 $S_k$ ，如何快速找到呢，这里可以用到线性基。


搞出 $A$ 的线性基 $d$ 和 $d_i$ 对应的 $q_i$ 表示 $\oplus_{j\in q_i}c_j=d_i$ 即 $d_i$ 是由哪些数异或出来的，那么对于每一个 $k$，都可以用线性基的基本操作来搞出对应的 $Sub_k$，然后把 $j \in Sub_k$ 与 $k$ 的大小关系当做有向边加入图中，对 $B$ 也如此操作就可以转换为：给一个无向图，每个点的权值都要比这个点能到达的点大，修改一个点的花费是 $(x-v_i)^2$ ($x$ 表示修改后，$v_i$ 表示修改前) ，问最少花费，这就成功变成一个 保守回归问题（见开头，这里不赘述）。

