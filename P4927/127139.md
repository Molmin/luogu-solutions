プラネタリウムはいかがでしょう？

どんな时も决して消えることのない、美しい无穷のきらめき。

満天の星々がみなさまをお待ちしています。



------------
### 题意

有一颗维护区间和的线段树，每次按权值占比概率进入子树，求权值和期望。

### 思路

计算每个叶子结点的期望权值，那么第 $i$ 个点的期望为 $\frac{sum_i^2}{\sum{sum}}$,其中 $\sum{sum}$ 代表所有节点的权值之和。

现在加上区间修改操作，只需要区间维护 ${sum^2}$ 就可以了。

假设某个操作让区间 $l \sim r$ 增加了 $k$。

那么 $\Delta{sum^2}= \sum_{l}^r{sum} \times 2k \times (r-l) + (r-l)^2 \times k^2$	

发现在区间加的时候，总期望的变化只和 $\sum_{l}^r{(sum \times (r-l))}$ 与 $\sum_{l}^r{(r-l)^2}$ 有关，后者只需要预处理即可。前者则可以利用后者维护:

$(\sum_{l}^r{sum}+k \times (r-l)) \times (r-l)=\sum_{l}^r{(sum \times (r-l))}+k(r-l)^2$

用带 lazy tag 的线段树维护即可。