设 $f_{i,j}$ 为从第 $1$ 行到 $(i + 1, j)$ 的最短路。

因为我们并不关心最后到达的是哪一个格子，于是强制 $f_{i,j}$ 为必须从 $(i, j)$ 往下走一格到 $(i + 1, j)$ 的最短路。

有转移：

$$f_{i,r+1} \gets f_{i-1,j} + r + 2 - j, j \in [l, r]$$

$$f_{i,j} \gets f_{i-1,j} + 1, j \notin [l, r]$$

$[l, r]$ 表示第 $i$ 行被 ban 掉的区间。

这个东西显然能用线段树优化。具体地，枚举到第 $i$ 行，线段树每个叶子结点 $[j,j]$ 存 $f_{i,j} - j$ 的最小值。对于第一种转移，区间查最小值，单点修；对于第二种转移，区间加 $1$。注意到 $j \in [l,r], f_{i,j}$ 不合法，把它们加上一个 $+\infty$ 即可。

时间复杂度线性对数。

[code](https://atcoder.jp/contests/abc177/submissions/41307830)