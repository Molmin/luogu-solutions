简要题意：给你一串二元组。有一个栈，初始为空，将一个二元组入栈前会不断将栈顶出栈直到栈空或者栈顶和将入栈的二元组满足某关系。每次询问给定一个区间，问将这个区间的二元组依次入栈时，有多少个二元组入栈前会把栈弹空。

分析：诈骗题，那个关系是什么完全不重要。

容易注意到，在某个二元组出栈前，栈内在这个二元组以后的部分，与从这个二元组开始入栈的结果是一样的。从而，每个二元组能弹出到哪些二元组不受从哪个二元组开始入栈影响。

因此，先从头模拟一遍入栈操作，然后记录每个二元组真正入栈前栈顶的编号，那么比这个编号大的全都可以被这个二元组或者更之前的二元组弹出。记第 $k$ 个二元组可以弹出 $L_k,L_k+1,\cdots,k-2,k-1$。

那么，每个询问 $l,r$ 相当于问 $\sum\limits_{i=l}^r[L_i\le l]$。容易想到离线询问或者使用可持久化数据结构，然后按 $L_i$ 从小到大修改再区间查询。

于是这题就做完了。

[参考代码：可持久化线段树](https://www.luogu.com.cn/paste/ceg7fvsv)