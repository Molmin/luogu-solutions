whker 过来写一篇题解。

观察到每个二元组会被它前面的一个二元组卡住，或者没有，我们将其记为 $lst_i$，没有记 $lst_i=0$。

用单调栈求出 $lst$ 数组后，考虑对于一个二元组 $x$ 在区间 $[l,r]$ 满足什么要求时会记作“成功的”。

不难想到，如果唯一能卡住他的二元组在区间外，即 $lst_x<l$，那么这一定是一个“成功的”二元组。

然后就可以实现了，具体用树状数组、倍增还是其它都随便你，复杂度为 $O(n\log n)$。