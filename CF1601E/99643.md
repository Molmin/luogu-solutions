考虑一次询问的情况，显然有一个贪心：
$$
ans=\sum_{i=l+kx,i\leq r}\min\limits_{l\leq j\leq i}\{a[j]\}
$$
考虑优化这个前缀最小值的前缀和。

考虑到只会在与 $l$ 模 $k$ 同余的时候取值，我们把每个长度为 $k+1$ 的段捆包，右端点为 $i$ 记为 $c_i$ ，一个 $c_i$ 造成的影响范围必然是对于后面的某一段里面，新的 $c_j(j>i)$ 不如 $c_i$ 优，直到遇到比 $c_i$ 优的再换。那么我们可以通过从 $l+k$ 开始查询后继，再计算贡献，这种方式可以起到一点点优化效果。

一个个跳非常的慢，我们考虑倍增。

我们枚举每一种余数，在所有同余的位置上跑一个单调栈，预处理一个 $to[i][j]$ 表示 $i$ 后面第 $2^j$ 个比 $c_i$ 小的位置，再计算一个产生的贡献 $s[i][j]$ ，倍增跳求解即可。