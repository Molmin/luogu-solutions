完全没想到要费用提前计算啊？                    

考虑分组这个东西，只能通过一些奇技淫巧变成一个在序列上正推的过程 DP，不妨考虑怎么转化题意。                 

由于一组的答案只和组的最小值以及最大值有关，又由于“分组”本身是无序的，不难想到先排个序，这样正着扫过去，每一组的最小值一定出现在最大值前面。           

然后这时候如果有人告诉你要费用提前计算那么你是不是就会了？       

由于我们发现，dp 的转移肯定得具有无后效性，现在的重难点在于转化成一个无后效性的题意。        

假设一组选择的最小值在 $a_l$，最大值在 $a_r$，那么一组的答案可以表示成 $\sum_{i = l} ^ {r - 1} a_{i + 1} - a_i$，这样就有费用提前计算的样子了，并且可以分摊贡献。

考虑维护 $dp_{i,j,p}$ 表示此时对于前 $i$ 个数还有 $j$ 个组没有确定最大值且此时的不和谐度之和已经为 $p$。             

那么将新的点 $a_{i + 1}$ 加入 dp 中，我们考虑这个点是作为一个组的起点，终点，单独成一组，或是直接被归入一个组中但不作为起/终点。       

不难发现这四种情况下，对于不和谐度的新增贡献都是 $(a_{i + 1} - a_i) \times j$，记 $dt = (a_{i + 1} - a_i) \times j$。


1. 对于单独成段，就直接转移：

$dp_{i + 1,j,p + dt} \leftarrow dp_{i,j,p}$

2. 对于被归入一个组中，我们不在意它被归入了哪个组，只知道它此时可以被归入 $j$ 个组，所以应该由 $dp_{i,j,p} \times j$ 转移：

$dp_{i + 1,j,p + dt} \leftarrow j \times dp_{i,j,p}$

3. 对于作为一个组的起点，那么不确定的组数量加 $1$，转移：

$dp_{i + 1,j + 1,p + dt} \leftarrow dp_{i,j,p}$

4. 对于作为一个组的终点，我们也不关心它被归入了哪个组，只知道它此时可以被归入 $j$ 个组，并且此时不确定的组数量减 $1$，转移：

$dp_{i + 1,j - 1,p + dt} \leftarrow dp_{i,j,p} \times j$

时空复杂度 $O(n^2k)$。

