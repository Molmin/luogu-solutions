标签: 转化, 贪心, 线段树, 拓扑排序.

~~题目编号是个很厉害的数字啊~~

定义一个数组 $Q$, 使得 $Q_{P_i}=i$, 即把每一个数字的位置记录在 $Q$ 内, 因为前面的**权值尽量小**等价于**权值小的尽量前**, 所以 $P$ 字典序最小等价于 $Q$ 字典序最小, 只需要考虑求字典序最小的 $Q$ 就好了.

$Q$ 的交换规则是权值差$\geqslant k$的相邻元素可以换顺序, 容易发现若 $abs(Q_i-Q_j) < k$, $Q_i, Q_j$ 的**相对顺序**不会改变, 我们暴力地将这类 $Q_i, Q_j$ 连边, 可以得到一张拓扑图,  用堆来贪心的跑字典序最小的拓扑序就好了.

但是我们注意到上述方法边数是 $\mathcal O(n^2)$ 的, 需要进行优化. 观察发现暴力方法会有很多无用边. 例如三条有向边$(i,j), (j,k),(i,k)$中这条 $(i,k)$ 是无用的.

考虑从后往前遍历 $Q$ , $Q_i$ **连向的数**必然属于 $(Q_i-K, Q_i)\cup(Q_i,Q_i+K)$, 发现 $(Q_i-K, Q_i)$ 内所有元素已经确定了相对顺序, $(Q_i,Q_i+K)$ 也是, 所以我们只需要将 $Q_i$ 分别向两个区间内下标最小的元素连边就行了. 区间内下标最小的元素可以用线段树来维护.

时间复杂度 $\mathcal O(n\log n)$, 空间复杂度 $O(n)$.
