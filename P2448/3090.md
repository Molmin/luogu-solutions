很容易看出这是一道逆序对的题，然而数据范围并不允许直接树状数组或者归并排序。

于是我们想到离散化。

对于小于最小值或者大于最大值的，显然不会对逆序对产生什么影响。

对于中间的数，我们开一个数组进行离散化，然后用树状数组维护一下就可以了。

核心代码：

```cpp

T.modify(a[n],1);
for1(i,n-1,1)
{  
    LL len=num[i+1]-num[i];  
    ans+=((len-1)*T.query(i));  
    T.modify(i,len);
    ans+=T.query(a[i]-1); 
    T.modify(a[i],1);
}
```cpp