关键在能否想到线段树合并。

当时想到了离散化（很慌没打出来。。。），树上差分，lca倍增，当时觉滴倍增很难打，一看n<100000,于是选择

用向上标记法，然而少了一行代码，，，，爆零两行泪。。。

 

 

现在看来倍增真是一点不难啊好打有好用，所以不要有为难情绪，刚就完了。（平日板子要多打记熟啊）

之所以没想到线段树合并是因为当时真的没有透彻理解，

所以新知识点还是要知道它能干什么，知道它的用处。

离散化用来干掉1->10^9，考试的时候真的傻认为要是有10^9种不就完了吗，，，然后发现忘了还有m次操作这东东，所以z离散化后len最大也就m个卡掉了很多

以前一个物品的题直接dfs,lca树上差分就行，现在有10^9个（离散后10^5个），空间时间不可能一个一个去维护所以 得用线段树合并。

所以得离线来做（我承认现在才知道离线在线是嘛玩意。。丢人啊。。。）

每个点有很多信息所以权值线段树用来优化空间（当然也能优化时间），对每个点动态开树插入和删除（lca,f[lca]），最后dfs,父亲合并儿子。

所以需维护区间的maxcnt以及其id，在merge时就需要多传一下l,r(1,len)，如果l==r更新maxx值和id，需要注意的是如果maxx<=0,id干成0（题目要求）。

sd错误：merge时忘了加上root[x]=merge,如果root[x]=0,就会...炸。还有空间没开够得开到maxn*50。

优化：插入时如果lca==x||lca==y,那就插入了一次删了一次所以干脆不插入。。。