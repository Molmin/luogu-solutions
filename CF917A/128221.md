## 题目大意

给定一个由 '(', '?', ')' 三种字符组成的字符串 $s$，长度为 $n$（$2≤n≤5000$），问有多少个合法的子串。一个字符串合法是说，把其中的 '?' 替换成 '(' 或 ')'，能够使得每一个左括号都找到唯一与之对应的右括号。

## 思路

第一反应是可以动态规划判断一个子串 $[l, r]$ 是否合法，合法的字符串满足以下两个条件之一：

-  $s_l,s_r$组成一对括号，并且子串 $[l + 1, r - 1]$ 合法；

-  存在某个 $l < k < r$，使得子串 $[l, k]$ 合法，子串 $[k + 1, r]$ 也合法。

但第二个条件的判断是 $O(n^3)$ 的，输入串长度 $5000$ 的话并不能过。



------------

事实上，一个字符串 $s$（长度为 $n$）合法等价于如下三个条件：

- $2 | n$ ;

- 对于所有 $1 ≤ i ≤ n$：字串 $[1, i]$ 中所有 '(' 的数量 + 所有 '?' 的数量 >= 所有 ')' 的数量 ;

- 对于所有 $1 ≤ i ≤ n$：字串 $[1, i]$ 中所有 ')' 的数量 + 所有 '?' 的数量 >= 所有 '(' 的数量 。

必要性显然，充分性的话如果没有 '?' 的话等于说只要把一个串任意分成左右两半，左边的'('数量不少于 ')' 数量，右边的 ')' 数量不少于 '(' 数量，整个串里他们数量相等。那么这个串就是合法的（可以想象一个栈，左括号就把一个物品压栈，右括号就出栈，这样的条件保证任何时候不会让空栈做出栈操作，并且所有操作完毕后栈为空）。



------------

## Code

~~讲得很清楚了，就不给代码了。~~

