关注到对于一组 $(c,d)$，无论中间怎么折腾，水的总量始终有 $V=c+d$。考虑枚举总量 $V$，如何一次处理出所有 $c+d=V$ 的答案。

因为总量确定，所以第一桶水的水量始终维持在区间 $[\max\{0,V-b\},\min\{V,a\}]$ 内。考虑操作编号为 $x$ 轴，第一桶水量为 $y$ 轴建系。$x=0$，$y$ 在范围内的整点为起点，则点轨迹可以刻画为 $y=y+v_i$，然后和上下边界分别取极值。

关注到每次移动后，总有一些点的轨迹会贴到上下边界。而对于始终没碰过上下边界的点，它们的位移量是相同的，任取一点计算即可。

因此对于一个 $V$ 我们只需要计算三个点的终值，而这是很容易完成的。接下来就是确定每个点最后是哪类。

考虑把点的运动变成上下边界的运动，计算上边界运动的最低点和下边界运动的最高点。当这两部分不交的时候，三类很自然的被划分开。有交的时候，考虑交点那一侧先贴一侧边界，中间又变道到另一侧边界。换而言之此时所有起点的终点均相同，直接算即可。

复杂度 $O(n(a+b)+ab)$。[record](https://codeforces.com/contest/1809/submission/210503956)。 