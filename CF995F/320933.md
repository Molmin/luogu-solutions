最近才会了拉格朗日插值的一些东西。

还是写一篇题解巩固一下。

### 思路

考虑暴力如何去写。

$$dp_{i,j}=dp_{i,j-1}+\prod_{x\in son(i)}dp_{x,j}$$

这是一个暴力 $dp$ 的方程，时间复杂度 $O(nd)$。

考虑如何优化。

我们将答案看做一个多项式 $f(x)$ 表示 $dp_{1,x}$。

拓展到整棵树上即，$f(u,x)$ 表示 $dp_{u,x}$。

我们猜测 $f(u,x)$ 是一个 $siz_u$ 项多项式。

证明：

使用归纳法。

- 当 $u$ 为叶子是原式成立。
- 当 $v\in son(u)$，且 $v$ 成立时：

$$f(u,x)-f(u,x-1)=\prod_{v\in son(u)}f(v,x)$$

那么 $f(u,x)-f(u,x-1)$ 为 $\sum_{v\in son(u)}siz_v$ 项多项式。

将差分还原，次数加一即 $\sum_{v\in son(u)}siz_v+1=siz_u$ 项多项式。

证毕。

使用拉格朗日插值进行优化。

由于一个 $n$ 次多项式可以用 $n+1$ 个点表示。

那么我们可以求出 $f(1,0\cdots n)$ 后。

使用拉格朗日插值快速求出 $f(1,d)$ 的答案：

$$f(d)=\sum_{i=0}^n f(i)\prod_{j\ne i}\frac{d-j}{i-j}$$

代码比较简单。

[code](https://www.luogu.com.cn/record/104959333)