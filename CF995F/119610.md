## 标签：

数学，容斥，$Dp$

## 来源：

$CF995F$

## 题意：

$given \ a \ tree$

$given \ a \ number \ D$

询问有多少方案使得，每个点的取值在$[1,D]$之间

且每个节点的值小于等于父亲。$(D\leq 10^9 , n \leq 3000)$

# $Solution$

我们考虑，若$D$非常的小，应该怎么做。一个显然的树形$Dp$

$$Dp_{i,j}=\prod{v \in son}\sum_{k=1}^iDp_{v,k}$$

对于后面那个$sum$，我们直接前缀和优化一下就好了。

但是我们现在的问题是$D$非常的大，但相对于来说$n$比较

的小。于是我们这样考虑。

假设我们取出了一个大小为$j$的数列，使得这棵树合法的方

案数，就是将每个数离散化后的$Dp_{1,j}$，但是对于这个

而言我们其实只是在大小为$j$的数列中去取数，且根为$j$

的方案。如果我们直到确切的每一个$g_j$，表示选出恰好

$j$个数的方案，我们就可以直接用组合数乘一下，算出答案。

即：

$$Ans=\sum_{i=1}^{min(D,n)}g_i \dbinom{D}{i} $$

于是我们考虑求出每一个$g_j$,利用容斥原理。

我们考虑对于每一个$g_j$

$$g_i=Dp_{1,i}-\sum_{j=1}^{i-1}g_j \dbinom{i - 1}{j-1}$$

