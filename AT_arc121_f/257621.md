首先显然一眼树形 dp。

这种复杂些的树形计数 dp 可以考虑先思考下合法方案的性质。

考虑对于一种方案，按照什么顺序缩边才能使其尽可能满足最终点权为 $1$ 呢？

可以发现，对于 `&1` 的节点和 `|0` 的节点，是毫无用处的；对于 `&0` 的节点，我们应该尽可能将其往前放；对于 `|1` 的节点，我们应该尽可能将其往后放。

所以就有如下贪心方式：先将所有 `&` 边形成的连通块缩边，此时剩下的所有边皆为 `|`，然后判断是否有某一个连通块值为 $1$ 即可。

所以使用树形 dp 计数的时候也可以使用类似的方式进行计数。显然，我们会注意两点：当前 `&` 连通块的值，以及子树内是否有值为 `1` 的连通块。

于是不妨设 $dp_{u,0/1,0/1}$ 表示这个，然后跑树形背包进行转移即可。总时间复杂度 $O(n)$。

转移方程很长，有些细节，如下：

![](https://cdn.luogu.com.cn/upload/image_hosting/x32tjjg4.png)