题意：

给定有向带权图，若干次询问，每次给出 $v,s,t$，问是否存在经过 $v$ 的回路权值 $\equiv t-s\bmod t$。

---

题解：

显然回路上所有点都在 $v$ 所在的强连通分量中，且强连通分量中任何两个点间必有回路，所以每个强连通分量答案是一致的。

对于一个回路，连续走 $t$ 遍就相当于没有走过，但却可以经过这个回路走到路上的另一个点。

考虑求出所有回路的一组“基”，使得所有回路都可以表示成基的线性组合（系数为整数），然后我们可以证明：假设基中所有元素的权值 $\gcd$ 为 $g$，那么任何回路的权值都是 $g$ 的倍数。

这是因为，假设存在回路权值不是 $g$ 倍数，它必然无法被基表示，那么基也就不是基了。

同样，根据裴蜀定理，我们有如下结论：

- 令 $g'=\gcd(g,t)$，对于所有 $i\in [0,t/g')$，都存在一个回路的权值 $x$ 使得 $x\equiv ig'\bmod t$。

证明：首先利用裴蜀定理求 $ug+vt=ig'$，只需构造 $ug$，再次利用裴蜀定理，将 $ug$ 表示为若干回路相加减，而减一个回路相当于走 $k-1$ 次，因为所有点都在一个强连通分量中，所以可以用若干重复走 $k$ 次的回路连起来。

所以我们如果能够对每个强连通分量求出其 $g$，对于询问，首先算 $g'=\gcd(g,t)$，再看 $g'$ 是否是 $\gcd(s,t)$ 的因数，即可确定答案是 YES 还是 NO。

那么如何求所有环的一组基呢？考虑用 DFS 树，对正图和反图都求一个 DFS 树，确定一个根 $r$，令正图上 $r\to x$ 的路径为 $P(x)$，反图上为 $Q(x)$。

注意我们不需要基是最小的，首先我们将 $P(x)+Q(x)$ 加进基中，称为 $x$ 元；然后对于每条边 $(u,v)$ 再将 $P(u)+(u,v)+Q(v)$ 加入基中，称为 $(u,v)$ 元。

如此一来，对于任意一个回路，我们先将环上所有边的 $(u,v)$ 元加起来，再减去所有环上点的 $x$ 元，就实现了用基表示这个回路的方案。

用 Tarjan 算法缩点，并两次 DFS，假设算 $\gcd$ 的时间复杂度为 $O(\log v)$，那么总时间复杂度为 $O(n+(m+q)\log v)$。



