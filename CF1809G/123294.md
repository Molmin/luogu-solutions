[CF1809G Prediction](https://www.luogu.com.cn/problem/CF1809G)

考虑符合要求的 $a$ 的排列 $b$，两个选手比赛时评级较高的选手胜出。因此，题目中的条件等价于：对任意 $2\leq i\leq n$，$|b_i - \max_{j < i} b_j| > k$。

因为 $a_n$ 和 $a_{n - 1}$ 一定会比赛，所以当 $a_{n - 1} + k \geq a_n$ 时，无解，答案为 $0$。

设 $l_i$ 表示最大的 $j$ 使得 $a_j + k < a_i$，$r_i$ 表示最小的 $j$ 使得 $a_i + k < a_j$。

考虑钦定前缀最大值的位置 $q_1, q_2, \cdots, q_c$ 计算对应排列方案数。对于 $a_{q_i}$，位置大于 $l_{q_i}$ 的 $a$ 必须放在 $a_{q_{i + 1}}$ 之后。从限制强到限制弱依次插入每个元素。

- 对于 $q_c$，将 $l_{q_c} + 1\sim n$ 不含 $q_c$ 的所有位置放在 $q_c$ 之后，方案数为 $(n - l_{q_c} - 1) !$。
- 从 $c - 1$ 到 $1$ 枚举 $i$，注意到 $q_i \leq l_{q_{i + 1}}$（否则不合法），所以相当于将 $l_{q_i} + 1\sim l_{q_{i + 1}}$ 不含 $q_i$ 的所有位置 $S$ 放在 $q_{i + 1}$ 之后，此时 $l_{q_{i + 1}} + 1\sim n$ 不含 $q_i$ 的所有位置已经在 $q_{i + 1}$ 之后。因此，考虑每个位置插在哪个元素后面，方案数为 $n - l_{q_{i + 1}}\sim n - l_{q_i} - 2$ 的积。
- 最后将 $1\sim l_{q_1}$ 放在 $q_1$ 之后，方案数为 $n - l_{q_1}\sim n - 1$ 的积。
- 整理，得方案数 $(n - 1)! \prod_{i = 1} ^ {c - 1} (n - l_{q_i} - 1) ^ {-1}$。

设 $f_i$ 表示 $q_1 = i$ 的方案数之和，从后往前转移，前缀和优化即可。

时间复杂度 $\mathcal{O}(n)$。[代码](https://codeforces.com/contest/1809/submission/199356704)。