这类题的经典套路是求出支配点对后扫描线。

求出支配点对后的扫描线是平凡的，相当于单调修改，区间查询最小值。难点在于如何求出支配点对。

由于 $a_r>a_l$ 的情况和 $a_r<a_l$ 的情况是等价的，我们不妨只关注 $a_r>a_l$ 的情况。

考察 $a_i$ 作为右端点时支配点对的情况。

一个朴素的思路是找出所有满足 $a_j<a_i,j<i$ 的 $j$，但无疑这样是 $\mathcal{O}(n^2)$ 的。

我们不妨把满足上述条件的 $j$ 所组成的序列顺序提出，记作 $b_{1\dots, m}$，那么我们可以暂且把 $(a_i,a_{b_1})$ 作为一个合法的支配点。

而后我们考察 $b_{2,\dots,m}$，我们发现若 $a_{b_j}-a_{b_1}<a_i-a_{b_j}$，则 $b_j$ 在之前的过程中就已经被考虑过，因此我们只需要进一步的在 $b_{2,\dots,m}$ 中提出满足 $\frac{a_i+a_{b_1}}{2}\leq a_{b_j}$ 的 $b_j$，并不断重复如下过程，这是容易用线段树维护的。显然的，对于 $a_i$，产生的支配点对个数是 $\mathcal{O}(\log V)$ 个，其中 $V$ 为值域。

故最后总支配点对数为 $\mathcal{O}(n\log V)$ 个，时间复杂度 $\mathcal{O}(n\log n\log V+q\log n)$。



