提供一个三只老哥的做法，喜提最烈解/cy

考虑 CDQ 分治后，需要求出左右端点分别在 $[l,mid]$ 和 $(mid,r]$ 的数对数量。

设 $b_i$ 为 $[i,mid]$ 或 $[mid+1,r]$ 中 $a_i$ 的最大值。

则原式转化为 $a_i+a_j=\max(b_i,b_j)$。

有一个 $\max$，分情况讨论就好了：

- 若 $b_i>b_j$，需要求出 $(mid,r]$ 中 $a_j=b_i-a_i$ 的 $j$ 的数量。

- 若 $b_i\le b_j$，需要求出 $(mid,r]$ 中 $b_j-a_j=a_i$ 的 $j$ 的数量。

把 $b$ 看做下标，用树状数组套 vector 维护就好了，查询等于某个数的数量只需要两次二分。

注意每次插入数后 vector 都排序会 T，则先将下标和键值看做二元组排序，然后顺序插入就好了。

注意每次清空时记录树状数组用了哪些节点，每次只清空那些节点对应的 vector 就好了。

