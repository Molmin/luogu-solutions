有删减，原文见[**我的博客**](https://www.cnblogs.com/SharpnessV/p/14928842.html)。


直接朴素模拟一下，时间复杂度是 $\mathcal{O}(TN^2)$ ，可以通过 $40\%$ 个测试点。

我们只需要记录 $0/1$ 表示是否可达，直接状压，可以做到 $\mathcal{O}(TN)$ 转移。但是有些格子在某些时间不可到达，处理这个限制仍然是 $\mathcal{O}(TN^2)$ 。这个做法可以优化约 $10$ 倍常数，可以通过 $70\%$ 的测试点。


考虑根号分治，对于 $a_{i,j}\ge \sqrt{T}$  ，最多有 $\sqrt T$ 个时间点该格子是开放的，暴力维护即可，时间复杂度 $\mathcal{O}(N^2\sqrt T)$ 。

对于 $a_{i,j}< \sqrt T$ ，最多有 $168$ 个质数。

我们记录 $f[i][j][k]$ 表示第 $i$ 个质数 $p_i$，时间为 $p_i^j$ 的倍数，第 $k$ 行的状态，对每个 $a_{i,j}$ 分解质因数即可。

然后对于每个时间 $t$ ，我们对 $t$ 分解质因数，然后对于每个质数的 $f[i][j]$ 按位与即可。注意这里 $j=0$ 的质数 $p_i$ 也要计算进去。

直接计算的时间复杂度是 $\mathcal{O}(|P|TN)$ ，$|P|=168$ ，比朴素模拟还要劣。

所以我们可以预处理 $g[l][r][k]=f[l][0][k]\ \&\ f[l+1][0][k]\ \&\ \cdots\ \&\ f[r][0][k]$ 。这部分的时间复杂度是 $\mathcal{O}(|P|^2N)$ 。
