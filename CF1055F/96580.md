首先考虑一个树上问题。

异或可以抵消掉，所以令 $dis_u = dis_{fa} \oplus w$。

$dis_u \oplus dis_v$ 就是这一条路径上的 $xor$ 了。

然后变成了一个序列上的问题。

发现这个其实就是任意选两个点，$dis_u \oplus dis_v$ 的 kth。

这个玩意是可以枚举 $2^k$ 看合不合法的。

然后往另外一边一直走下去。

搞个 $trie$ 树对每一层进行操作即可。