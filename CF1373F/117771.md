首先，很明显 $\sum b_i \ge \sum a_i$ 是必要条件。

现在我们假设有至少种分配方案可行，设 $i+1$ 城市帮 $i$ 城市分担了 $c_i$ 户家庭，则存在一种方案使得存在 $k$ 满足 $c_k=0$。

> 简证：任取一种方案，如果不存在这样的 $k$ ，设 $m=\min c_i $，那么将所有 $c_i$ 都变成 $c_i-m$，那么一定有一种合法的方案对应新的 $\{c_i \}$，且有 $k$ 满足 $c_k=0$。

所以我们现在假定 $p$ 城市的家庭连的都是 $p$ 城市的基站（$b_p \ge a_p$）。

现在 $p+1$ 城市家庭可以连到 $p+1,p+2$ 城市的基站，所以应该有 $a_{p+1} \le b_{p+1}+b_{p+2}$。

因为 $p$ 城市不会对 $p+1$ 造成任何影响，所以 $p+1$ 城市的家庭尽量都要连到 $p+1$ 城市的基站上；可以求出 $p+1$ 对 $p+2$ 的影响是 $\min \{0,a_{p+1}-b_{p+1} \}$。

所以 $p+2$ 城市的所有家庭能连上网就等价于 $a_{p+1}+a_{p+2} \le b_{p+1}+b_{p+2}+b_{p+3}$。

类似的，也应有 $\sum_{i=1}^k a_{p+i} \le \sum_{i=1}^{k+1}b_{p+i}$ 对于所有的 $k$ 都成立。

令 $s_k=\sum_{i=2}^{k+1}b_i-\sum_{i=1}^k a_i$ ，则条件转化为 $s_{k+p}-s_{p-1}+b_p \ge 0$ 对于所有 $k$ 都成立，即 $\min s_i \ge s_{p-1}-b_p$。

用单调队列 $O(n)$ 求区间最小值即可。