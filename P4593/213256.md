总的来说，这是一道结论题。

接下来我将会采取子任务讲解的形式来分析这道题目。

$Subtask$ $1$ $m = 0$

此时只需要一张亵渎，所有随从都会死亡。

所以答案是 $\sum_{i=1}^ni$ ，这个式子用等差数列求和一下就可以了，大家应该都会的。

$Subtask$ $2$ $m = 1$

此时需要两张亵渎才能消灭所有随从，考虑第一次亵渎所贡献的分数。

即为 $\sum_{i=1}^ni^2-a_1^2$

同样地，再次考虑第二次亵渎所贡献的分数。

此时所有的数已经被减掉了 $a_1$ ，且体力值小于 $a_1$ 的随从已全部被消灭。

故此时答案为 $\sum_{i=1}^{n-a_1} i^2$ 

$Subtask$ $3$ $n=10^{13}$ , $m = 50$

这是本次的重头戏，但其实有了之前的想法作铺垫，还是比较好理解的。

我们先思考，每次算得分时都要计算伤害的 $K$ 次方，而这个值是未知的。

但是显然 $K$ 是需要我们先算出来的。

当一个随从都没有被删除的时候，我们很轻松地使用了一张亵渎就结束了，但是删除了一个随从，我们就用了两张，顺着这个思路，我们可以得出一些结论。

删除一个随从就会把原本连续的数列分隔成两段，而删除随从后造成需要再次使用的根本原因就是分隔之后，本应该杀死的随从是不存在的，就不能再次使用法术了，所以一次不行，就再来一次。

所以，有 $m$ 个随从被删除，需要的卡牌数量就是 $m+1$ 了。

接下来，我们思考怎么计算卡牌的贡献。

按照之前的思路，我们卡牌的贡献可以用总体贡献（也就是对不删除任何随从的贡献）减去多算的贡献（被删除随从的贡献）。

以每张卡牌为序，于是就有以下式子。

$ans=\sum_{i=0}^m(\sum_{j=1}^{n-a[i]}j^{m+1}- \sum_{j=i+1}^m{(a[j]-a[i]})^{m+1})$

特别地， $a[0]=0$ 。

如果你理解了之前的两种思路，那这个式子理解起来其实是不难的。

暴力计算这个式子的值是 $O(nmlogn)$ 。

过不了，完全过不了。

分析发现，时间复杂度的瓶颈在于求 $j^{m+1}$ 的求和部分，而现在的问题就转化为，如何快速地求出 $\sum_{i=1}^ni^k$ 。

这个问题也就是经典的自然数幂和问题，有多种经典方式可以求出，例如伯努利数，斯特林数，拉格朗日插值等。

不过这些我都不会，我选择最简单易懂的算法，递推法。

这个的递推式基于一种“算两次”的思想，考虑计算这样一个式子。

$(i+1)^{k+1}-i^{k+1}=C_{k+1}^{1}i^k+C_{k+1}^{2}i^{k-1}+...+C_{k+1}^{k}i+1$ 

这个式子怎么来的呢，其实就是用二项式定理把左边的 $(i+1)^{k+1}$ 项展开，把 $i^k$ 合并即可。

对左边 $1-n$ 求和，对右边 $1-n$ 求和。

就可以得出递推式子了，用这种递推的方式算，复杂度是 $O(K^2)$ 的，但拉格朗日插值可以做到 $O(K)$ 计算，反正我不会。

这里的递推过程我用的是递归计算，这就导致每次计算时会遇到很多重复的状态，在顺序结构的循环计算中，我们是用数组保存下了那些值的，计算时可以直接用，但我之前递归时忘了保存，这就导致了复杂度的退化，退化成什么程度我也不是很清楚，用一个数组dp[k]保存状态，记忆化搜索，快了不少。

时间复杂度是 $O(m^3+m^2logm)$ 的，跑得飞快，比某些拉格朗日插值做法还要快。






