```
面对悲伤也一笑而过吧。
```

CF1147F。

---------------------------------------------
一个很好的[铺垫题目](https://www.luogu.com.cn/problem/P4055)。

很妙的一道题。

据幼兔本兔所言这种题存在一个常见的套路（包括铺垫题目里面也是），即对于二分图博弈问题，后手可以考虑构造二分图完全匹配，就是你走哪里我也走哪里这种行为。

我们只考虑作为后手不当先手，且自己属性为 ```I```，为了方便讨论对于自己属性为 ```D``` 的情况我们把边权置为相反数即可等价于 ```I``` 情况。

用 $w$ 表示边权，我们考虑如果存在匹配 $(a,b),(c,d)$ 两种情况，倘若我们走过边 $(a,b)$，先手走 $(b,c)$，我们就走 $(c,d)$。则此时得保证若 $w_{a,b} > w_{b,c}$，则 $w_{b,c} < w_{c,d}$，前一个条件表示先手可以走这条边，后一个条件表示走该边的应对策略。

先抛出结论：该问题**可被归约于稳定婚姻匹配问题**，由于稳定婚姻匹配问题一定有解，所以后手一定有解。

证明结论。记 $f$ 表示优先级（针对于每个点的所有边），由于稳定婚姻匹配问题预示着不存在对于匹配 $(a,b),(c,d)$，$f(b,c) > f(b,a)$ 且 $f(c,b) > f(c,d)$。   

假设 $a,c$ 为我们初始节点一方，显然 $a,c$ 和 $b,d$ 分开在二分图的两边，则我们 $a,c$ 方指向 $b,d$ 方的边应该按照边权从大到小排序才符合优先级，$b,d$ 方指向 $a,c$ 方的边应该按照边权从小到大排序才符合优先级。

将 $f$ 的关系式转化为 $w$ 的关系式可导出不存在 $w(b,c) < w(a,b)$ 且 $w(c,b) > w(c,d)$，则等价于若 $w(b,c) < w(a,b)$ 则 $w(c,b) < w(c,d)$ 的条件以及若 $w(c,b) > w(c,d)$ 则 $w(b,c) > w(a,b)$ 的两个条件，显然稳定婚姻匹配问题包含了上述的条件。

于是我们进行稳定婚姻匹配问题的求解即可解决这道题。

