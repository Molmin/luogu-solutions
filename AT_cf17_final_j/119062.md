注意到点数比边数少很多，考虑使用 Borůvka 算法。

边权为 $s_x+s_y-2\times s_{lca(x,y)} + w_x+w_y$ ，其中 $s_x$ 表示 $x$ 到根的距离和。

那么考虑对于每个 $x$，找到祖先某个点，钦定这个点是他们的最近公共祖先。此时维护最近公共祖先为根子树内某点 $y$ 的 $s_y+w_y$ 的最小值。这个可以 dp 出来。

至于为什么钦定是对的，是因为如果实际上 最小的 $y$ 与 $x$ 的最近公共祖先不是这个点的话，那答案必然劣于真正最近公共祖先的答案。

Borůvka 算法，要找到属于不同联通块的一条最小的边，合并，并加入答案。

由于 $x,y$ 可能属于一个连通块。dp 的时候可以重载一个类，存最小值和次小值。并限定他们不同属于一个连通块。

有了 dp 值以后，第二次遍历求出 $x$ 答案（这里答案指 $x$ 到不同联通块的最短边），可以贪心地考虑，考虑 最小值和 $x$ 是否在一个连通块。不是就考虑次大值。 容易证明记录两个不同连通块的值，总能与任意 $x$ 形成不同属于一个连通块 这个效果。

然后取一个连通块里面每个点答案（与上文定义一样）的最小值，合并。


[评测记录1](https://atcoder.jp/contests/cf17-final/submissions/33407605)

[评测记录2](https://atcoder.jp/contests/cf17-final/submissions/33407678)
