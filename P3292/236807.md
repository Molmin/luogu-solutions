### 前置知识

- [线性基](https://www.luogu.com.cn/problem/P3812)。
- [LCA](https://www.luogu.com.cn/problem/P3379)。

### 题意简述
- 给定一棵 $n$ 个节点的**树**，求两点间路径上所有点权的**异或最大值**。

- $n \le 2 \times 10^4$，$q \le 2 \times 10^5$。

### 题目分析
异或最大值，想到**线性基**。

因为线性基满足：
对于集合 $A, B$，把 $B$ 的线性基依次插入到 $A$ 的线性基中即可得到 $A \cup B$ 的线性基；
    
故我们可以使用倍增 LCA 的思想，在倍增的同时维护答案的线性基。

预处理出每个节点的 $2^k$ 级祖先的同时处理出每个节点到 $2^k$ 级祖先的线性基即可。

时间复杂度 $O(n \log n \log^2 G_i + q \log n \log^2 G_i) = O(n \log^3 G_i + q \log^3 G_i)$，约为 $11.1 \times 10^9$ 级别。

### [代码](https://www.luogu.com.cn/paste/odjuffsk)

这份代码加上火车头再加上一些毒瘤优化可以用 C++17 过掉这道题（详见本人评测记录）。

### 优化

但是，自带大常数的选手发现只得了 30 分。

下面是为大常数但却希望用 C++ 语言不开 O2 AC 的选手准备的优化。

我们考虑，如果把这两个节点到 LCA 的路径用类似 ST 表的方式维护，即想办法只在答案线性基中只插入常数次节点，那么我们就可以把每次询问的时间复杂度从 $O(\log n \log^2 G_i)$ 降为 $O(\log n + \log^2 G_i)$。

STL 库的常数也比较大，故把所有 STL 中的函数与类手写一遍，再加上读写优化。

做完这些，你就能用 C++ 拿到 70 分的好成绩。

但是还不够。

我们发现，在插入线性基时，插入的数常常会很早变为 $0$，此时直接退出即可。

在倍增 LCA 时，也会有类似的情况出现（提前倍增到指定位置），同样直接进行下一步。

### [代码](https://www.luogu.com.cn/paste/52injktf)