考虑 dp，$f_{i, j, k}$ 表示考虑到第 $i$ 维，$\sum\limits_{x = 1}^i |p_x - r_x| = j, \sum\limits_{x = 1}^i |q_x - r_x| = k$ 的方案数。转移是容易的，枚举 $r_i$ 即可，$f_{i, j, k} = \sum\limits_r f_{i - 1, j - |p_i - r|, k - |q_i - r|}$。

复杂度 $O(nD^3)$，无法接受，考虑**下标拆绝对值后前缀和优化**。简单讨论一下就行。以 $p_i \le q_i$ 的情况为例：

1. $r_i < p_i$，$f_{i, j, k}$ 能从 $\cdots, f_{i - 1, j - 2, k - q_i + p_i - 2}, f_{i - 1, j - 1, k - q_i + p_i - 1}$ 转移；
2. $p_i \le r_i \le q_i$，$f_{i, j, k}$ 能从 $f_{i - 1, j, k - q_i + p_i}, f_{i - 1, j - 1, k - q_i + p_i + 1}, \cdots, f_{i - 1, j - q_i + p_i, k}$ 转移；
3. $r_i > q_i$，$f_{i, j, k}$ 能从 $f_{i - 1, j - b_i + a_i - 1, k - 1}, f_{i - 1, j - b_i + a_i - 2, k - 2}, \cdots$ 转移。

也就是说我们只要维护对角线前缀和就好了。

要注意下标越界的问题。对于第 $1, 3$ 种情况，能转移的是一段前缀或后缀，只要特判下标是否越界即可；对于第 $2$ 种情况，因为能转移的是一段区间，如果下标为负，就要找到第一个 $0$ 开始转移。

想清楚了写起来挺快的，不存在难写的问题。注意一些细节问题即可，比如符号写反，或者没取模等等，别像我一样有一处漏了取模然后傻傻调试 20min 就行。

时间复杂度 $O(nD^2)$，可以通过。

[code](https://atcoder.jp/contests/abc265/submissions/42222964)