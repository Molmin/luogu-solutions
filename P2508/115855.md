同各位大佬一样，安利一下。

# [3Blue1Brown的视频](https://www.bilibili.com/video/av12131743/)
### 题意
- 已经很明朗了。
- 求在平面直角坐标系中，原点为圆心，$R$为半径的圆上的格点数量。
- 格点：坐标都为整数的点。

------------
接下来我就按视频思路梳理一下。

### 探索
我们可以先在图上画出半径为$\sqrt{r}$，的圆，并求出这些圆上的格点数量$Q$。

$r:0,1,2,3,4,5,6,7,8,9,10$  
$Q:1,4,4,0,4,8,0,0,4,4,8$

~~假~~结论：$Q$是$4$的倍数。


------------
详细观察一下$R=5$,即$r=25$的情况

![](https://cdn.luogu.com.cn/upload/image_hosting/jdvyqy9t.png?x-oss-process=image/resize,m_lfit,h_170,w_225)

我们会发现，$12$个格点分别为：   
$(3,4),(4,3),(-3,4),(4,-3),(-4,3),(3,-4),(-3,-4),(-4,-3),(5,0),(0,5),(0,-5),(-5,0)$     

#### 平面坐标系转复平面

如题，把平面向量转为复平面；每个点都代表一个复数。   
[（百度百科-复数）](https://baike.baidu.com/item/%E5%A4%8D%E6%95%B0/254365?fr=aladdin)   
那么$(3,4)$就代表复数：$3+4i$   
那么我们会发现其**复共轭**（用$-i$替换原数中的$i$）：$3-4i$和它的乘积即为：

$(3+4i)(3-4i)=3^2-(4i)^2=9-(-1)\times16=25=r$ 

经过计算，发现每个点都满足与其共轭根相乘得$r$。且这一结论可以推广到全部。  
即模相乘，幅角相加。其模相等，为$\sqrt{r}$。 幅角相加得零。易证。  
而这些点满足：$\forall r,a,b;r,a,b\in{\mathbb{Z}},(a+bi)(a-bi)=r$
那么我们称点$a+bi$为**高斯整数**。

且对于每个$4n+1,n\in \mathbb{Z}$都可以分解为两个高斯整数的积，对于每个$4n+3,n\in\mathbb{Z}$都不能分解，因为他们自己就是高斯整数。


------------
由于**算数基本定理**，我们可以对于一个整数分解为唯一形式。

$n=\prod\limits_{i=1}^np_i^{k_i}$,$p_i$是素数。

同样的我们也可以把一个数分解为若干个**高斯素数**相乘。如：
$$25=(2-i)^2(2+i)^2$$

这样子匹配下来（记住，一对共轭根只能分别在两边）：
$$25=(2-i)(2-i)\times(2+i)(2+i)=(3-4i)(3+4i)$$
$$25=(2+i)(2+i)\times(2-i)(2-i)=(3+4i)(3-4i)$$
$$25=(2+i)(2-i)\times(2+i)(2-i)=5\cdot5$$

在原先的情况下，我们可以通过乘上$-1$来得到不同结果。  
同样的我们也可以通过乘上$i,-1,-i$来得到不同结果。如：
$$25=(-1+2i)(2-i)\times(-1-2i)(2+i)=(-4+3i)(-4-3i)$$
这也就是为什么我们当时得出$Q$都是4的倍数这一结论。



------------
#### 如果是$r=375$呢？   
$375=3* 5^3=3(2-i)(2+i)(2-i)(2+i)(2-i)(2+i)$
$3$落单了！！！，而且$3$还是高斯整数，那么该圆不过任一格点。    
我们如果把一个整数$N$质因数分解为如下形式。
$$N=3^3\cdot 5^4\cdot 13^3$$

这里的高斯整数$3$指数是奇数，那么该圆就不能过格点。  
但如果是这样：

$$N=3^4\cdot 5^4\cdot 13^3$$

$5^4$可以分解为$4$对，总共有$5$种分法。  
$13^3$可以分解为$3$对，总共有$4$种分法。  
$3^4$不能分解，只有$1$种分法

所以$Q=5\times4\times1=20$可别忘了刚刚的四种情况。故
$$Q\ne20,Q=20\times4=80$$

#### 如果是$10$呢?

$10=2\cdot5=(1+i)(2-i)\times(1-i)(2-i)$  
$10=2\cdot5=(1-i)(2-i)\times(1+i)(2-i)$  
这步与接下来的乘$-i$  
$10=2\cdot 5=(1+i)(-i)(2-i)\times(1-i)(i)(2-i)=(1-i)(2-i)\times(1+i)(2-i)$   
重复了！！！    
可以得出结论：对于因子$2^k$对结果是没有影响的


------------
### 解法
那么对于本题，我们可以讲半径$R$看作$\sqrt{R^2}$，即$r=R^2$。  
这个时候如果把$R$质因数分解后
$$R=\prod\limits_{i=1}^np_i^{k_i}$$
若有像$3$一样的高斯整数，那就不用考虑高斯整数，也不用考虑偶数，于是只要考虑$mod 4==1$的质因数就行了。
$$Ans=4\cdot\prod\limits_{i=1}^n(2\cdot k_i+1),k_i\%4==1$$

比如$R=325,r=105625$

$R=5^2\cdot13^1,r=5^{2\times2}\cdot13^{1\times2},Ans=4(2\times2+1)(1\times2+1)$

为了跑得快，我们只想把质数枚举至$\sqrt{R}$。  
但是如果这是个质数或是质数的偶数被，那就不会被筛到。  
而此时的分解为$R=p_i^1$，那么$Ans=Ans\times(2\times1+1)$

### 代码
```cpp
#include<bits/stdc++.h>
using namespace std;
int pri[100005],cnt;
bool used[500005];
int main()
{
    int r;
    long long ans=1;
    scanf("%d",&r);
    int n=sqrt(r);
	for(int i=2;i<=n;i++)//欧拉筛素数
	{
		if(!used[i]) pri[++cnt]=i;
		for(int j=1;j<=cnt&&i*pri[j]<=n;j++)
		{
			used[i*pri[j]]=1;
			if(!(i%pri[j])) break;
		}
	}
    for(int i=1;i<=cnt;i++)//质因数分解
    {
        int sum=0;
        while(r%pri[i]==0)
        {
            sum++;
            r/=pri[i];
        }
        if(pri[i]%4==1)ans*=(sum*2+1);//要满足pi%4==1才能贡献答案
    }
    if(r>1&&r%4==1)ans*=3;//特例
    printf("%lld",ans*4);//别忘了乘四
    system("pause");
    return 0;
}
```
### 后话
视频的后面也提供了一些，可以算是思考吧。

新定义函数$\chi(x)$

$$\chi(x)=\begin{cases}
1&x=4n+1,n\in{\mathbb{Z}}\\
-1&x=4n+3,n\in{\mathbb{Z}}\\
0&x=2n,n\in\mathbb{Z}
\end{cases}$$

这是一个积性函数，~~但是我并不会证明~~。

举个例子，如果一个数$N=2^2\cdot3^4\cdot5^3$

$$Ans=4(1)(1)(3+1)=16$$
$Ans=4[(\chi(1)+\chi(2^1)+\chi(2^2))+(\chi(1)+\chi(3^1)+\chi(3^2)+\chi(3^3)+\chi(3^4))+(\chi(1)+\chi(5^1)+\chi(5^2)+\chi(5^3))]$
$=4(1+0+0)(1-1+1-1+1)(1+1+1+1)=16$

这种方法也能算出来。

**这种方法可以看出什么？**

  把$45$用这种方法拆开看看：
  
  $45=3^2\cdot5^1$
  
  $Ans=4(\chi(1)+\chi(3^1)+\chi(3^2))(\chi(1)+\chi(5^1))$  
  $Ans=4(\chi(1)\chi(1)+\chi(1)\chi(3)+\chi(1)\chi(5)+\chi(3)\chi(3)+\chi(3)\chi(5)+\chi(9)\chi(5))$
  
 因为这是一个积性函数，那我们就：
 
 $Ans=4(\chi(1)+\chi(3)+\chi(5)+\chi(9)+\chi(15)+\chi(45))$
 
 里面的自变量取值，刚好就是$45$的所有因数。
 
 ### 神奇吗？
  
  
  
  
  
  
  
  
  
  














