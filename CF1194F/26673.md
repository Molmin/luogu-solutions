### 题意

有一个序列，现给序列中每个数等概率加一或不加，求满足前缀和 $\leq T$ 最大下标的期望。

### 解题思路

题目中给你了一个式子（$p_i$ 表示最大下标为 $i$ 的概率）：

$$E = \sum_{i=0}^{n} ip_i$$

最大下标恰好为 $i$ 不好求，这引导着我们进行如下变换：

$$E = \sum_{i=0}^{n} P_i$$

此时 $P_i$ 表示最大下标**大于等于** $i$ 的概率，不难发现两式是等价的。

为什么 $P_i$ 就好求了呢？因为只需要序列前 $i$ 个数之和 $\leq T$ ，其他数随便怎么变，依旧在这个概率的范畴中。

设这 $i$ 个数全部不加时的和为 $S_i$ ，显然加的值不超过 $T - S_i$ 。

很自然地，可以列出以下式子：

$$P_i = (\dfrac{1}{2})^{i}\sum_{j=0}^{T-S_i} \binom{i}{j}$$

后面那部分写成 $S(n,\,m) = \sum\limits_{i=0}^{m} \binom{n}{i}$ 的形式，就是 $S(i,\,T - S_i)$ 。我们的目的，就是对每个 $i$ 都求出这样的一个**组合数前缀和**，看上去是不可能的任务。

实际上，有个 $O(n \sqrt{n})$ 的万能做法，但复杂度过大在此不赘述。考虑随着 $i$ 的增加，$T - S_i$ 是下降的。

$$\begin{cases}S(n + 1,\,m) = \sum\limits_{i=0}^{m} \binom{n+1}{m} = \sum\limits_{i=0}^{m} \binom{n}{m} + \binom{n}{m-1} = S(n,\,m) + S(n,\,m - 1) = 2S(n,\,m) - \binom{n}{m} \\S(n,\,m - 1) = S(n,\,m) - \binom{n}{m} \end{cases}$$

于是预处理求组合数必需品，我们便可以通过上面的转移线性完成本题了！

$T - S_i$ 可能极其大，怎么办？注意到 $\binom{n}{m}$ 在 $n < m$ 时等于 $0$ ，$T - S_i$ 不过纸老虎，$\min$ 上 $n$ 就万事大吉。