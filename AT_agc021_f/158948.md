感觉题解的 $f_{i,j}$ 的定义和转移都不是特别清楚？导致我开始都没读懂。。。~~要不就是我理解错了~~

我们按列进行 DP，$f_{j,i}$ 表示当前 DP 到第 $j$ 列，前 $j$ 列选出的黑格子在行上的并集大小为 $i$ 的三元组方案。

为什么这么设？因为行对答案三元组的贡献只有第一次出现的位置有影响，我们新增一列，前面列对当前的影响显然只跟并集的大小有关。

转移考虑新增一列多出了几行，枚举新增了 $k$ 行。

- 若 $k=0$，即没有新增行，那么新增的黑色都在并集内，再考虑当前列最下和最上的黑色：

  - 如果直接没有，有 1 的贡献。
  
  - 如果最上的位置与最下的位置相同，那么只有一个黑色格子，出现在 $i$ 行中任意一行都行，贡献为 $i$。
  
  - 如果不同，从 $i$ 行中选两行，上面作为最上的黑色，下面作为最下的黑色，贡献为 $\tbinom{i}{2}$
  
- 若 $k>0$，即新增了 $k$ 行，由于我们转移的并集大小而不知道并集的具体位置。

  可能有新增行被夹在并集中间，并集内如果选了也可能造成贡献，有点辣手。
  
  (以下 2行 请读作 两行 。。。)
  
  但我们可以知道的是：当前列最下的黑色下面一定有一行白色(看作有第 0 行)，当前列最上的上面一定也有一行白色(看作有第 $n+1$ 行)，考虑加 2 行白色与黑色行放在一起来考虑贡献。
  
  总共 $i+k+2$ 行，其中选出 $k+2$ 行作为 2 行白色和 $k$ 行新增的黑色，其中最下的和最上的为白色，贡献就是 $\tbinom{i+k+2}{k+2}$。
  
  注意这里不管是白色还是新增的黑色都可能被夹在并集中间，也有可能部分在并集外面，~~反正我觉得这样理解就没问题了~~。
  
然后就是总转移式，和其他题解一样：

$f_{j,i}=(1+i+\tbinom{i}{2})f_{j-1,i}+\sum_{k<i}\tbinom{i+2}{i-k+2}f_{j-1,k}$

前面只跟 $i,j$ 有关，可以 $O(1)$ 转移，后面拆开后为 $(i+2)!\sum_{k<i}\dfrac{f_{j-1,k}}{k!}\dfrac{1}{(i-k+2)!}$ 和式部分用 NTT 卷一下即可。

由于我们最后得到的是并集大小，还得从 $n$ 行里面选出并集，故答案为：

$ans=\sum_i\tbinom{n}{i}f_{m,i}$

复杂度瓶颈在每次转移的 NTT，复杂度 $O(m\cdot n\log{n})$。

代码还是帖上吧：

```cpp
	len=Get((n+1)<<1);
	for(F[0][0]=j=1;j<=m;j++)
	{
		for(i=0;i<=n;i++)
		{
			tpf[i]=Ml(F[j-1][i],inv[i]);
			tpg[i]=i?inv[i+2]:0;
		}
		for(;i<len;i++)tpf[i]=tpg[i]=0;
		NTT(tpf,len,1);NTT(tpg,len,1);
		for(i=0;i<len;i++)Mul(tpf[i],tpg[i]);
		NTT(tpf,len,-1);
		for(i=0;i<=n;i++)
		{
			F[j][i]=Ml(tpf[i],fac[i+2]);
			Add(F[j][i],Ml(Md(i+1+((LL)i*(i-1)>>1)),F[j-1][i]));
		}
	}
	for(i=0;i<=n;i++)
	{
		Add(ans,Ml(C(n,i),F[m][i]));
	}
```