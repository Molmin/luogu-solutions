## Solution

先摆一个引理：

> 一个图，如果不连通，那么其补图必然联通。

证明比较显然。对于一个点 $u$，和它不在一个联通块内的任意一个节点在补图中都是联通的。而对于和它在一个联通块内的节点，必然存在一个在另一个连通块里面的中介把他们联通起来了。所以任意两个点都是联通的，即得证。

所以，由蓝边构成的图和由红边构成的图互为补图，其中必有一个联通。那么一个集合是某种颜色联通肯定能保证。

再观察到，当 $S=V$ 时，不能两种颜色都联通，所以原图之中必有且仅有一种颜色不连通，不妨设是蓝色。

那么就是求 $dp_n$ 为大小为 $n$ 的不是蓝色联通的符合要求的图。

那么考虑 $1$ 所在的蓝色边构成的连通块，记大小为 $x$。那么单独抽出这 $x$ 个点，方案数为 $dp_x$（因为我们假设的是蓝色不连通，这个子图中蓝色必然联通，那么让红色不连通，二者等价）。

剩下的 $n-x$ 个点呢？他们无所谓，要么是蓝色不连通要么是红色不连通，答案是 $2dp_{n-x}$。有一个例外是 $x=n-1$ 时，这时候剩下的一个点只有一种选法，所以不能乘以二。

这 $x$ 点和 $n-x$ 点之间由定义都是红边。

所以转移为：

$$dp_n = \sum_{x=1}^{n-1} C_{n-1}^{x-1} \times dp_{x} \times dp_{n-x} \times (2 - [n-x=1])$$

[Submission #190643824](https://codeforces.com/problemset/submission/1792/190643824)

lzm 场切这道题，进步速度堪比 jly，看来明年 MAS rank 1 肯定是他了 /dk