维护一个值域 $[0,2^{20})$ 的不可重集合，支持值域区间 xor,or,and 以及值域区间求元素个数。

元素初始给定后不再额外插入。

$1\leq n\leq 2\times 10^5$，$1\leq q\leq 10^5$。

前置知识：线段树合并，线段树分裂。

对于位运算，考虑通过一棵 Trie 来维护信息，也就是值域线段树，记全集 $U=2^{20}-1$。

操作区间 $[l,r]$ 时，通过线段树分裂将其独立出来，操作完成后再合并回去，于是值域区间操作都变为了全局操作。

全局 xor 是平凡的，它的本质是交换了某些层的左右儿子，可以通过简单的 tag 来实现。

全局 and 可以用 or 和 xor 两种操作完成，具体地，and $x$ 可以改为 xor $U$，or ($x$ xor $U$)，再 xor $U$，于是问题转为了如何实现 or 操作。

注意到元素只会随着操作不断减少，可以考虑均摊的思想来暴力一点执行 or 操作。

在某一位 or 了 1 等价于将这些层的左儿子合并到对应的右儿子上，总合并次数 $O(n\log V)$。

考虑一个结点什么时候需要递归暴力合并儿子，发现只有其在某个 $x$ 的对应位是 1，且该层同时有左儿子和右儿子时能合并，于是需要额外在每个结点维护标记表示在某层的左右儿子的存在性。注意在实现时，把左儿子合并到右儿子之前还要给左儿子额外 xor 上一个当前位以保证标记的正确。

一次合并除了合并时产生的代价还有递归找需要合并结点的复杂度，这个与深度有关，为 $O(\log V)$，于是最终的复杂度就是 $O(n\log^2 V)$。

代码实现参考了 [这篇博文](https://www.cnblogs.com/ac-evil/p/14745498.html)。