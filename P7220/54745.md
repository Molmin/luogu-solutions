考虑把一个点 $(x,y)$ 对应到一个区间 $[x,n-y]$。对于 H 操作而言，相当于给定一个 $x$，对每一个区间 $[l,r]$，如果 $l \leq x \leq r$，那么就把这个区间变成 $[x,r]$。对于 V 操作就是变成 $[l,x]$。

考虑如果所有区间都包含某一个 $p$。那么我们执行一个值为 $x$ 的操作，若 $x \leq p$，那么 V 操作相当于把这个区间的右端点直接设为 $x$，且该区间就不会再包含 $p$ 了。H 操作相当于所有左端点对 $x$ checkmx，并且不会出现不再包含 $p$ 的情况。

我们可以把这个过程放在线段树的分治结构上进行考虑。我们把每个区间存在最小的包含它的区间处（类似猫树的结构）。一个区间被划分后有可能跑到左儿子或者右儿子里面去了，我们要用数据结构来维护这个过程。

在线的做的话我们对每一个线段树节点开一个线段树维护左右端点 checkmx 和 minpos 就能做了，时间 log 方但是空间也带 log。考虑离线把空间变成线性的。我们最开始在根处处理所有的操作，按照时间顺序从前往后维护左端点，如果碰到一个 checkmx 操作把小于他的那些 $l$ 拿出来 merge 在一起再塞回去。碰到一个 $[l,r] \to [l,x]$ 操作就把 $l \leq x$ 全拿出来 pop 了，处理询问就开个数组记录一下第 $i$ 个点当前的 $l$ 是啥，如果已经似了就把询问也丢到儿子里面去。用堆和并查集上记录链表维护就好了捏。  

那么就可以做到时间 $O(n \log^2 n)$，空间线性了。并且常数这块，真的很❤️小❤️的❤️哦

代码：https://www.luogu.com.cn/paste/7dkooj1i
