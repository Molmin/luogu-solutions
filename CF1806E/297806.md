- [摘自此](https://www.luogu.com.cn/blog/261213wrh/cf-r857-div2-ti-xie)。

------------

考虑暴力的同时记搜。不难发现这样做的复杂度即为本质不同点对数。

视 $n$ 和 $q$ 同级，若第 $i$ 层有 $a_i$ 个点，显然其对复杂度的贡献为 $\min({a_i}^2,n)$。于是总复杂度为 $\sum_{i=1}^{n}\min({a_i}^2,n)$，由于 $\sum a_i = n$，可用不等式推出复杂度最大值为 $n \sqrt n$。

于是可以暴力记搜做到大常数 $n \sqrt n$。

考虑优化掉哈希表，不难发现同一层只用记录 $\sqrt n$ 个点即可，于是可以用数组直接记录每一层前 $\sqrt n$ 个点，剩余暴力。此时复杂度小常数  $n \sqrt n$。
