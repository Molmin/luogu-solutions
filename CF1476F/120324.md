往左点灯是从 $i$ 开始向左连续覆盖，于是只需要考虑最左边一个不亮的位置。设 $f(i)$ 表示确定了前 $i$ 个灯的朝向，最多能从 $1$ 开始点亮多少灯。点亮更多的灯一定不会让 $f$ 减少，于是 $f(i)$ 随 $i$ 单调不降。

考虑对 $i$ 的决策：

- 向右：
	- 此时要么 $i$ 不亮，$f(i) \gets f(i-1)$；
    - 要么 $i$ 被左侧的照亮：当 $f(i-1)\ge i$ 时，$f(i) \gets \max\{f(i),i+P_i\}$。
- 向左：
	- 在 $[i-P_i, i-1]$ 中的点不必担心自己的亮暗。
    - 考虑转移。当 $f(j) \ge i-P_i-1$ 时，$[i-P_i,i-1]$ 一段可以**保证是亮的**。所以，**不妨钦点 $[j+1,i-1]$ 所有的灯都向右点**，对答案产生向右的贡献，以避免向左重复照明浪费。
    - $f(i) \gets \max\{f(i),i-1,j+1+P_{j+1},j+2+P_{j+2},\ldots,i-1+P_{i-1}\}$。其中 $i-1$ 一项是防止 $i$ 本身不被照到。
    
于是转移成功地实现了。对于向左的第三种转移，可以二分最大合法的 $j$ 并用树状数组维护 $i+P_i$ 做到 $O(n\log n)$。