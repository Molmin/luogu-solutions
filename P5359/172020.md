### P5359 [SDOI2019] 染色

考虑这样一种情况：格子第一列和最后一列所有颜色已经确定，中间所有格子都未确定。这时本质不同的情况数不多，可以提前预处理答案。情况有 12-34, 12-31, 12-32, 12-12, 12-21 共 $5$ 种。

考虑将所有格子中已经确定一个数和已经全部确定颜色的列拿出来，然后给其中只确定一个数的列确定另外一个数，这玩意显然可以 DP。令 $f(x,c)$ 表示考虑了前 $x$ 段，第 $x$ 段最后没颜色的格子钦定的颜色是 $c$ 的最小代价。

这时我们得到了一个 $O(nc)$ 的做法。注意到这个转移，颜色 $c$ 其实只有至多 $4$ 种不同的等价状态，且其中只有一种状态对应了超过一个 $c$，所以进行一个全局加，和一些单点加即可，查询也只用一些全局查询和一些单点查询。时间复杂度 $O(n)$。

代码长度：很长。