发现一个数不是固定的，当且仅当其左右两边都存在比它小的数。

进一步的，记 $i$ 的位置为 $pos_i$，那么 $i$ 可能移动到的位置为 $\min⁡\{pos_1,\cdots,pos_{i−1}\}+1$ 到 $\max⁡\{pos_1,\cdots,pos_{i−1}\}-1$ 中所有不固定的位置，记为 $d_i$。

然后发现第 $1$ 个不固定的数可以放在 $d_i$ 个位置上，第 $2$ 个可以放在 $d_i$ 个位置上（容易发现这个位置是包含关系，因此易证），等等。

因此答案即为 $\prod_{i=1}^{m}d_i-(i-1)$，$m$ 为不固定的数的个数。

[code](https://codeforces.com/contest/1699/submission/162778049)