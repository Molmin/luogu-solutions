考虑如何构造一个双调的序列。可以参照 [P7915 [CSP-S 2021] 回文](https://www.luogu.com.cn/problem/P7915) ，就是两个单调上升的序列，然后把后面那个翻转一下，再拼接起来就好了。  
会了这个之后，其实本题就是让你把 $n$ 个数分成两堆（下面我称之为左边和右边），然后保证题目的两个数确定的要求，就可以了。  
那么考虑 $f_{now,a,b}$ 表示当前讨论的数是 $now$ 已经排好了 $1$ 到 $now-1$ ，排列方式为左边有 $a$ 个数，右边有 $b$ 个数。  
假设不考虑本题那两个数的要求，那么显然就可以转移：  
$f_{now+1,a+1,b}=f_{now+1,a+1,b}+f_{now,a,b}$  
$f_{now+1,a,b+1}=f_{now+1,a,b+1}+f_{now,a,b}$  
边界就是 $f_{1,0,0} = 1$。  
考虑有 $a_i = x \ \ a_j = y$ 限制的时候。  
是不是只会影响当 $now = x$ 或者 $now = y$ 的时候，那么其实就是，对于第一个转移要么 $a +1\ne i $，要么 $now = x$，同理要么 $a+1 \ne j$ 要么 $now = y$。  
对于第二个要特殊看一下，因为 $b+1$ 是在右边多怎加一个，但是要经过反转的操作，所以反转回原数组就应该是 $n-(b+1)+1 = n-b$。  
那么最终的方程就是:  
$f_{now+1,a+1,b}=f_{now+1,a+1,b}+ f_{now,a,b}\ \ (a+1\ne i \ \lor now=x)\ \land \ (a+1\ne j \ \lor\ now=y)$  
$f_{now+1,a,b+1}=f_{now+1,a,b+1}+ f_{now,a,b}\ \ (n-b\ne i \ \lor\ now=x)\ \land \ (n-b\ne j \ \lor\ now=y)$   
最后算答案的时候就枚举每个单峰，即 $f_{n+1,a,n-a}$ 求和即可。   
复杂度: $O(n^3)$。     
代码：  
https://codeforces.com/contest/1763/submission/186054883