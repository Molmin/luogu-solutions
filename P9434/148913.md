不妨把 $s_2$ 看成向下的刺，那么 $s_1,s_2$ 就会产生交点。$s_3$ 唯一的条件就是在这个交点的右下角。

扫描线，从左往右扫描交点并统计贡献。双指针可以找到符合范围的 $s_1$ 和 $s_3$。设 $a_i$ 为当前 $y=i$ 的 $s_1$ 个数，$b_i$ 为当前 $y<i$ 的 $s_3$ 个数，那么对于一个 $y=k$ 的 $s_2$，它射出去的交点能够产生 $\sum_{i=1}^{k-1}a_i\times b_i$ 的贡献。

使用线段树维护 $a_i,b_i$。需要支持单点修改 $a_i$，区间修改 $b_i$，区间查询 $\sum_i a_i\times b_i$ 的值。这个很简单，只要再多维护一个 $\sum_{i}a_i$ 即可。时间复杂度 $O(n\log n)$。

**[Code](https://www.luogu.com.cn/paste/6ty1w14k)**