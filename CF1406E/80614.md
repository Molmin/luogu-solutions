退役后的第一篇题解。

首先枚举质数肯定是逃不掉的了，这就需要最多 $9592$ 次交互。

所以先需要线性筛预处理出不超过 $n$ 的所有质数。

对于 $x$，首先需要找出它的质因子有哪些，但光一次删除一次判断就需要快 $20000$ 次了。所以肯定过不了。

但是我们发现 $x$ 最多有 $6$ 个质因子，所以我们需要尽量的少枚举无用的质数。

不妨我们将 $\pi(n)$ 个质数按照块长 $\sqrt{\pi(n)}$ 的大小分块处理，这样这些质数最多分布在 $2$ 个块里。

因为除了第一个块存在 $<\sqrt n$ 的质数，其余的块全部都是 $>\sqrt n$ 的质数，然而 $x$ 最多有 $1$ 个 $>\sqrt x$ 的质因子，所以最多分布在 $2$ 个块里。

那么我们其实只需要找出并枚举这 $2$ 个块内的质数即可。

判断是否存在质因子在这个块里，只需要将这些质数进行 $\text B$ 询问，然后通过 $\text{A 1}$ 询问判断删除的数个数是否为理论删除的数的个数。

由于判断这 $2$ 个块是什么还得需要 $\sqrt{\pi(n)}$ 次枚举，所以一共需要花费 $3\sqrt{\pi(n)}$ 次询问。

这依旧没有达到 $10000$ 次交互，那么接下来我们就要直接求出 $x$ 是什么。

因为我们已经确定了 $x$ 的质因子有哪些，所以接下来的 $\text A$ 询问转化成了 $a$ 是不是 $x$ 的因子。

那就很好办了，只需要每次乘一个质因子然后询问，如果是就继续乘，否则换下一个。这样最多乘 $\log n$ 次。

最终交互次数肯定不超过 $10000$ 次。