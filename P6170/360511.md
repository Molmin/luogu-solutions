$\text{Upd 10.17}$ 将非公式的 $\LaTeX$ 换成了公式块。

问题看起来不太好做，不妨先想一想简单的问题。对于三个房间编号 $a,b,c$，且 $a<b<c$，如果 $a,b$ 均有一只奶牛，$c$ 没有奶牛，要想使得 $a$ 没有奶牛，$b,c$ 均有一只奶牛，最优策略应该是什么呢？

  - $a$ 直接到 $c$，这样的花费是 $(c-a)^2$。
  
  - $a$ 到 $b$，$b$ 也到 $c$，这样的花费是 $(b-a)^2+(c-b)^2$。
  
不妨设 $x=b-a,y=c-b$，则：

  - $a$ 直接到 $c$ 的花费为 $(x+y)^2$。
  
  - $a$ 到 $b$，$b$ 也到 $c$ 的花费为 $x^2+y^2=(x+y)^2-2xy<(x+y)^2$。
  
所以我们知道了，第二中方案比第一中方案更优。这个结论说明了什么？很显然，我们在移动牛的过程中，最优的移动方案是，移动的牛不能越过其它的牛。

所以说，我们可以选择一个起点 $s$，从这个起点 $s$ 开始，每一个房间都将多余的奶牛移动到下一个房间。

如果下一个房间还多出来奶牛再如同上述一样处理即可。

那么起点应该怎么选？那就直接枚举一个起点。

这样我们记录每个奶牛的路程 $d_i$，最后答案即为 $\sum_{i=1}^nd_i^2$。

为了方便，我们也要存一下每一个牧场里有哪些牛，直接存会炸掉，所以可以用 `vector` 来维护。

但这样做的复杂度是 $\mathcal{O}(n^2)$ 的，在 $n\le 10^5$ 之下难以承受。

考虑我们把时间浪费在什么地方，移动奶牛肯定是必须消耗一个 $\mathcal{O}(n)$ 的，而恰恰是找起始点的过程中消耗的时间太多，如果我们能通过预处理，得出真正的起点在哪里的话，是不是就能做到 $\mathcal{O}(n)$ 的了？

答案是肯定的。现在问题就是选择起点了。不妨猜一个结论：最大子段和的开头位置。

这个结论可以用反证法证明，读者自证不难（雾

然后就是要求环状的最大子段和，这个直接 $\mathcal{O}(n)$ 的 `dp` 就可以了。不过这里是环状的序列，需要断环成链的小技巧。

另外注意要开 $\text{long long}$。

复杂度 $\mathcal{O}(n)$。