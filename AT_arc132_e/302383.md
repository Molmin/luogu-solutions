感觉被诈骗了。

遇到这种问题应该先考虑最终形态是否有什么特殊性质，发现就这道题而言是有的。会发现最终的 形态应该是中间存在一个空隙，两边有连续的一直绵延到边界的脚印。

于是想到每个空隙成为幸运儿的概率。发现成为幸运儿当且仅当两边都不经过这个空隙，令 $n$ 个方块并且不会碰到特定边界的概率为 $f_x$，发现这玩意似乎可以递推。考虑当前块在排列中的位置，令为倒数第 $y$ 个，那么前面的可以忽略，后面的就转化成了一个规模为 $y$ 的子问题。于是有 $f_{x}=\sum\limits_{i=0}^{x-1}f_{i}\dfrac{1}{2x}$，维护一下前缀和就能常数转移了。然后计算贡献即可，复杂度 $O(n)$。