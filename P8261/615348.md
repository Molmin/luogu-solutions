先口胡一波，假了吼我一声。

我们先把半平面分为上半平面和下半平面。

然后分别构造半平面莫队。

构造方法如下：

随机选 $B$ 个点，然后对于每个半平面找到他上面第一个关键点，然后把该询问挂到这个点上，并且先暂时将这个询问的 $C$ 改为能恰好过该关键点的半平面所对应的的 $C'$。

然后对于每个关键点，将挂在它上面的询问按照斜率排序，所有的点按照相对它的极角排序，然后对斜率进行双指针扫描，求出更改后的询问的答案，这部分的转移量是 $O(n)$ 的。

期望下每个询问距离关键点中有 $O(\dfrac n B)$ 个点，现在考虑如何求出这些点。

我们现在要求出从 $C$ 到更改后的 $C'$ 中那些点，我们还是把点随意分块，然后对其进行旋转扫描线来求出从 $C$ 到 $C'$ 中的点。

该构造方案构造出的转移量为 $O(\dfrac {nm}B + nB)$，取 $B = \sqrt m$ 最优，此时构造方案的的转移量为 $O(n \sqrt m)$ 时间复杂度为 $O(m \sqrt m+n\sqrt m\log^cn)$，其中 $c$ 是取决于实现的常数。