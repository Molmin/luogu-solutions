### 题目大意

维护有向图 $G = (V,E)$（$1 \le |V| \le 5\times 10^5$，$1 \le |E| \le 5 \times 10^5$）．每条边有「被标记」和「不被标记」两种状态，初始所有边均为「被标记」状态．维护 $q$（$0 \le q \le 5\times 10^5$）个操作，分为若干种：

- 给定一条边 $e \in E$，将 $e$ 修改为「被标记」状态．
- 给定一个结点 $v \in V$，将 $v$ 的所有入边修改为「被标记」状态．
- 给定一条边 $e \in E$，将 $e$ 修改为「未被标记」状态．
- 给定一个结点 $v \in V$，将 $v$ 的所有入边修改为「未被标记」状态．

每次操作后，判断 $G$ 中所有「被标记」的边对应的生成子图是否为一个基环内向树森林．

### 简要做法

有向图是内向基环树森林的一个充要条件是所有点出度均为 $1$．考虑维护每个结点的出边数量，发现由于有 $4$ 操作存在，较难维护．

考虑更换维护方式．维护所有被标记的边的起点的组成的可重集合，则有向图是内向基环树森林的一个充要条件是每个结点恰好在该集合种出现一次．对于每个结点 $u$，维护其所有被标记的入边的起点组成的可重集合 $S_u$，则答案集合 $A$ 为所有可重集合的 [Sum](https://en.wikipedia.org/wiki/Multiset)$^{[1]}$．此时，题目中的四种操作变为对于某个集合的添加元素、删除元素、清空、还原初始状态四种操作．

考虑采用哈希来维护答案集合．考虑对于原图中的每个结点 $u$ 创建随机的权值 $a_u$．定义对于可重点集的哈希函数 $H(S) = \sum_{u\in S} a_u$．则题目中的四种操作可转化为为对哈希值的加减运算：

- $H(A) \gets H(A) + a_{\operatorname{start}(e)}$．
- $H(A) \gets H(A) - H(S_u) + H(S'_u)$，$H(S_u) \gets H(S'_u)$．
- $H(A) \gets H(A) - a_{\operatorname{start}(e)}$．
- $H(A) \gets H(A) + H(S_u)$，$H(S_u) \gets 0$．

时间复杂度 $O(n+m+q)$．

### 注释

- \[1\]：可重集合的 Sum 运算和并运算不同，Sum 运算是将所有元素出现次数相加，而并运算为取 $\max$．具体见 [Multiset - Wikipeida](https://en.wikipedia.org/wiki/Multiset)．