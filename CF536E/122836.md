非常无脑的树剖题。

考虑直接给定 $0/1$ 边权怎么做，直接树剖套线段树，线段树上每个节点维护区间前后缀 $1$ 的个数和当前答案，合并信息的什么都是简单的。

有了题目中的限制怎么做，直接将所有询问全部离线下来，然后连着边权一起按大小排序，用类似扫描线的思想实时更新当扫到每个询问时，当前边权的 $0/1$ 状况。

然后就做完了，时间复杂度 $\mathcal{O}(q\log ^2n)$。

如果题目要求强制在线的话，把扫描线线段树的过程换成可持久化线段树是一样的，除了空间变成 $\mathcal{O}(n\log n)$。

难度 $3100$，有至少 $2000$ 都在码代码的难度上。

[码](https://codeforces.com/contest/536/submission/212520543)。