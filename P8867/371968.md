性质 $0$：根据边双联通分量缩点后的图是一颗树。

性质 $1$：非桥边的保护情况任意。

这个显然，因为你可以找到另一条路连接。

性质 $2$：两个点同时是关键点，则两点之间路径上的桥边必须保护。

原因是桥边在路径上是一定被包含的。

性质 $3$：初中因式分解：

$$a_1\cdot a_2\cdot a_3+a_1\cdot a_2\cdot a_3'+a_1\cdot a_2'\cdot a_3+a_1'\cdot a_2\cdot a_3+a_1\cdot a_2'\cdot a_3'+a_1'\cdot a_2\cdot a_3'+a_1'\cdot a_2'\cdot a_3$$

$$=(a_1+a_1')(a_2+a_2')(a_3+a_3')-a_1'\cdot a_2'\cdot a_3'$$

扩展到 $n$ 项的形式显然，这个性质后面会用到。

---

于是我们开始树形 DP：

以下非特殊说明均在缩点后讨论。

我们对于每个点考虑这个点和他的父亲边被不被选，围绕四种情况讨论：

![](https://cdn.luogu.com.cn/upload/image_hosting/uxyhvuj6.png)

定义：

$sz_k$ 表示 $k$ 所在双连通分量大小；$weight_k$ 表示 $k$ 的子树大小；

$dp_{k,0,0}$ 表示**这个子树一个点都不选**的方案数（容易发现，他的值等于 $2^{weight_k-1}$，不过还是 DP 计算一下）；$dp_{k,1,0}$ 表示这个子树选了点，**选了的点之间联通，但每个选了的点与根的路径不联通，或是根的父亲边不选**的方案数；反之，$dp_{k,1,1}$ 表示这个子树选了点，**选了的点之间联通，每个点都与根联通，且根的父亲边被选**的方案数；

$nx$ 表示 $k$ 的某个儿子。

以下分讨中选择边的条件是 $k\ne 1$（根节点没有父亲）。

选择 $k$ 节点的方案数为 $t=2^{sz_k}-1$，不选显然为 $1$。

---
情况 $1$：根以外的点都不选。

这时候只需考虑根的选择情况。

① 点不选，边不选，$dp_{k,0,0}=dp_{k,0,0}+\prod_{nx}dp_{nx,0,0}$。

② 点不选，边选，$dp_{k,0,0}=dp_{k,0,0}+\prod_{nx}dp_{nx,0,0}$。

③ 点选，边不选，$dp_{k,1,0}=dp_{k,1,0}+t\times \prod_{nx}dp_{nx,0,0}$。

④ 点选，边选，$dp_{k,1,1}=dp_{k,1,1}+t\times \prod_{nx}dp_{nx,0,0}$。

----

情况 $2$：只有一个子树选了点，且与根不联通。

显然这时点肯定不选，边可以决策。

① 点不选，边选，$dp_{k,1,0}=dp_{k,1,0}+\sum_{nx}(dp_{nx,1,0}\times \prod_{nx'\ne nx}dp_{nx',0,0})$。

② 点不选，边不选，$dp_{k,1,0}=dp_{k,1,0}+\sum_{nx}(dp_{nx,1,0}\times \prod_{nx'\ne nx}dp_{nx',0,0})$。

--- 

情况 $3$：剩下的情况。

这些情况统一的特性是所有选了点的子树都有与根连边。

这样就有 $2^{\text{子节点个数}}$ 种选与不选的情况。

此时利用上面提到的性质 $3$，就可以线性计算。

① 点不选，边不选，$dp_{k,1,0}=dp_{k,1,0}+\prod_{nx}(dp_{nx,1,1}+dp_{nx,0,0})-\prod_{nx}dp_{nx,0,0}$。

② 点不选，边选，$dp_{k,1,1}=dp_{k,1,1}+\prod_{nx}(dp_{nx,1,1}+dp_{nx,0,0})-\prod_{nx}dp_{nx,0,0}$。

③ 点选，边不选，$dp_{k,1,0}=dp_{k,1,0}+t\times(\prod_{nx}(dp_{nx,1,1}+dp_{nx,0,0})-\prod_{nx}dp_{nx,0,0})$。

④ 点选，边选，$dp_{k,1,1}=dp_{k,1,1}+t\times(\prod_{nx}(dp_{nx,1,1}+dp_{nx,0,0})-\prod_{nx}dp_{nx,0,0})$。

---

答案即为 $dp_{1,1,0}\times 2^{\text{非桥边个数}}$。

---

[代码](https://www.luogu.com.cn/paste/jmbn284t)很丑。


感觉这个 DP 设计蠢得离谱，码量巨大，如有雷同纯属巧合。