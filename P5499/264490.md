写篇题解纪念一下。

首先我们发现按照他这个模式，只有轻儿子才会被统计上去，什么意思呢。

我们把思路逆转一下，也就是只有遇到轻边才会贡献上去。

我们把一个值修改为 $val$，只需要这个点往上爬重链，每次遇到轻边就上传贡献。

然后就是转换符号，直接暴力计算显然是不合理的，直接就挂飞了。

那我们就对于每个点，幻想出他的符号是加号和乘号两种情况时的权值，然后到时候直接在换符号的点上换点权就可以了。

对于查询，就是一整条重链的答案对吧。

做到这里，我直接放弃思考，去码树剖套线段树，然后狠狠超时，查了一天才发现 $\log^2n$ 会超时。

那我们怎么办呢，这很难搞啊。

实际上对于修改考虑这次修改造成的影响，然后对于当前重链整体把影响落到实处就好了。

然后就做完了。

[没有注释的 code1](https://www.luogu.com.cn/paste/ojglge5t)

[有注释的 code2](https://www.luogu.com.cn/paste/dhluf9rx)

最后再给几组 hack 数据。

[hack](https://www.luogu.com.cn/paste/kp29eesu)