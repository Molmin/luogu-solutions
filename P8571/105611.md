就差一点，烦。

为了方便，默认 $n$ 与总串长同阶。

一眼根号分治，大串平凡，可以算出所有串的答案。

小串猫树分治，我们只需处理：加入一个串、查询所有串在一个长度不超过根号的串中出现次数最大值。

根据 [[ZJOI2022] 众数](https://www.luogu.com.cn/problem/P8330) 的经典技巧，从大到小枚举这个出现次数，查询是否有一个串被包含这么多次。

取出查询串在 ACAM 上的虚树，我们只需枚举根号个结点到根的路径上是否存在加入过的串。

“单点标记，链查”转化成“区间标记，单点查”，而我们有 $O(n\log n)$ 次修改，$O(n\sqrt n)$ 次查询。

由于只需处理 0/1 信息，我们只需将序列压位后分块即可，复杂度 $O(n\sqrt n)$。

当然你也可以用 $O(n^{\epsilon})-O(1)$ 的分块做。