首先，
 $$ f(i)=\left\{
\begin{aligned}
i \bmod {K-1},((K-1) \nmid i) \\
{K-1},({(K-1)}\mid i) \\
\end{aligned}
\right.
$$
 然后考虑 $i^i \bmod {K-1}$ 的周期。
 
 前 $\varphi_{K-1}$ 个 $i$ 没有周期，然后后面有长度为 $\text{lcm}(K-1,\varphi_{K-1})$ 的周期。
 
 于是抛弃前 $\varphi_{K-1}$ 个，算出一个周期的和。
 
 把一种方案的完整连续周期去除，剩下的拼在一起，一定是一个周期复制两遍的一个连续子序列。
 
遍历一个周期复制两遍，开一个 $\text{umap}$ 记录每一个前缀和的出现位置即可。

可能需要卡卡常数。