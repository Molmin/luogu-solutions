考虑 $a_i-i\in\{d,-d\}$，设 $a_i-i=d$ 个数为 $x$，为 $-d$ 个数为 $y$，则满足条件的对数为 $xy$。根据均值不等式得到 $|x-y|$ 越小越好，即 $|x-y|=n\bmod 2$，$\min(x,y)=\lfloor\dfrac n2\rfloor$。换句话说，在 $a_i=i$ 中选择 $\dfrac n2$ 个数加上 $d$，剩下减去 $d$。

枚举 $d\in [1,r-l+1]$。计算出 $[1,n]$ 中只能 $+d$ 的数与只能 $-d$ 的数个数，并算出都可以的数的个数。然后组合数。这里是 $\Theta(\sum (r-l))$ 的。

对于每个 $d$ 输出答案，发现有很多答案是重复的，关键在于上面所说的几个有关组合的量都相同。对不等式进行推导，得到前 $\min(-l,r-n)$ 个答案是相同的，计算一次即可。另外，如果当前 $d$ 答案为 $0$ 即可直接退出循环。

时间复杂度 $\Theta(\sum n)$。

[Code](https://www.luogu.com.cn/paste/zsibfbd2)