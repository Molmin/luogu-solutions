将答案的求和式从值域角度考虑，只需求出满足 $f(l,r)=k$ 的 $l,r$ 个数 $c_k$。

转换为 $c_k$ 的前缀和数组 $t_k$，表示 $f(l,r) \ge k$ 的个数。

从小到大依次扫每个 $k$，如果一段连续为 `1` 的极长子串长度不够 $k$，那么可以把这个子串全体换成 `0`。

现在的字符串有若干段 `1`，如果一个子串包含了一整段的 `1` 一定满足 $f(l,r) \ge k$。

接着考虑不包含完整 `1` 段的子串。

这种子串一定夹在两个 `1` 连通块中间；左右端点可以取的范围知道，可以用组合数求出不满足条件的个数。

因为求 $t_k$ 的时候最多有 $\frac{n}{k}$ 个长度 $\ge k$ 的 `1` 串；所以复杂度 $O(n \times \sum_{i=1}^n)=O(n \ln n)$。 