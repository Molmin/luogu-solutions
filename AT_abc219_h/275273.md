套路化了。

比较显然的[关路灯](https://www.luogu.com.cn/problem/P1220)型区间 dp。考虑你 $t$ 时刻熄灭一个初始长度为 $a$ 的蜡烛，得分是 $\max(a - t, 0)$，所以尝试把时间塞进状态。设 $f_{i, j, k, 0/1}$ 表示，熄灭完区间 $[i, j]$ 的蜡烛，当前时间是 $t$，在左端点还是右端点的最大得分。转移考虑走的路径即可。

发现时间可能很大，并且已经没有优化的余地了。考虑换种思路，假设我一开始得了 $\sum\limits_{i = 1}^n a_i$ 分，然后我每走一个单位距离，得分减少 $k$，$k$ 是还剩下的蜡烛数量。但是你发现一个很麻烦的事情是，熄灭蜡烛时得分要与 $0$ 取 $\max$，但是你到这个蜡烛的时候它的得分已经是负数了。

考虑直接钦定每个蜡烛的长度是否计入最后得分，称这样的蜡烛是**有效**的，这样如果遇到负数得分的蜡烛，最优解一定是不把它当成有效。状态添加一维 $k$ 表示熄灭区间 $[i, j]$ 的蜡烛后还剩下 $k$ 个有效蜡烛。转移就根据关路灯的基础上再讨论当前熄灭的这个蜡烛是否有效即可。

没了？

代码很好写。时间复杂度 $O(n^3)$。

[code](https://atcoder.jp/contests/abc219/submissions/42259796)