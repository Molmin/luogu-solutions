看到对所有方案求价值总和，我们将其转化为期望计算。

考虑一个点什么时候被记入答案。当被删除的点 $a_j$ 位于 $a_i$ 左边，这次删除能将 $a_i$ 记入贡献，当且仅当此时 $a_{j+1},\dots,a_i$ 没有被删除。也就是说，$a_{j+1},\dots,a_i$ 的删除时间在 $a_i$ 之后。那么将 $a_j,\dots,a_i$ 按删除时间排序后，$a_j$ 必须排在第一位。由于 $a_j,\dots,a_i$ 的排列总数有 $(j-i+1)!$ 种，其中 $a_j$ 排在第一位的方案数共有 $(j-i)!$ 种。因此 $a_j$ 被删除时能将 $a_i$ 记入贡献的概率为：

$$
\frac{(j-i)!}{(j-i+1)!}=\frac{1}{j-i+1}
$$

同理可得，当 $a_j$ 在 $a_i$ 右边时，删除 $a_j$ 将 $a_i$ 记入贡献的概率为 $\frac{1}{i-j+1}$

因此 $a_i$ 对答案的总贡献为：

$$
\sum_{j=1}^{i-1} \frac{1}{j-i+1} +1+ \sum_{j=i+1}^{n} \frac{1}{i-j+1} = \sum_{i=2}^{i} \frac{1}{i} + \sum_{i=2}^{n-i} \frac{1}{i} +1
$$

答案即为：

$$
n!\sum_{i=1}^n a_i (\sum_{i=2}^{i} \frac{1}{i} + \sum_{i=2}^{n-i} \frac{1}{i} +1)
$$

显然，预处理出 $\sum_{i=2}^{i} \frac{1}{i}$ 即可 $O(n)$ 完成此题。