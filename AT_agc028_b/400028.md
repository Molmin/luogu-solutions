**[AGC028B] Removing Blocks**

直接做不太好做，考虑随机一个排列，它的代价和的期望乘上一个 $n!$ 就是答案。
 
考虑删除一个点，它其实是把此时序列贡献统计了之后重划分为了互不贡献的两边，这有点像笛卡尔树的过程，于是我们建立基于删除时间的小根笛卡尔树，此时一个点权的贡献就是 $A_u\times dep_u$ 

根据期望的线性性，我们常常要考虑一个位置对答案的贡献，于是可以考虑一个点的期望深度。

考虑计算 $E(dep_y)$ ，此时，对于 $y<x$ ，考虑 $y$ 对 $x$ 深度的贡献，则当且仅当 $y$ 是 $y...x$ 中第一个被删除的节点，概率是 ${(x-y)!\over (x-y+1)！}={1\over (x-y+1)}$ 。

则答案就是：
$$
n!\sum_{x=1}^n E(dep_x) \times A_x\\
n!\sum_{x=1}^n (\sum_{y<x}{1\over x-y+1}+\sum_{y>x}{1\over y-x+1}+1) \times A_i
$$
预处理一个 $\sum {1\over i}$ 的前缀和数组就好了。