枚举最终绑在两侧的点的距离 $i$。设 $a$ 的最后一个元素有 $r$ 种可能，则对于 $n$ 为偶数，$r = i$，对于 $n$ 为奇数，$r = i - 1$。

枚举绑在两侧的点之间保留的数的个数 $j$，则答案为 $n \sum_i r \times \sum_{j = 0} ^ {i - 2} \binom {i - 2} {j} (n - 3 - j)!$。$\binom {i - 2} j$ 表示从两侧点之间选 $j$ 个保留，$(n - 3 - j)!$ 表示任意安排不保留且不是最后一个点的所有点的顺序，$r$ 表示最后一个元素有 $r$ 种可能，$n$ 表示任意安排绑在两侧的点。

注意特判 $i = 1$ 的情况。对于 $n$ 为偶数，$i$ 的枚举范围为 $[1, \frac n 2]$，对于 $n$ 为奇数，$i$ 的枚举范围为 $[2, \frac {n + 1} 2]$。时间复杂度 $\mathcal{O}(n ^ 2)$。[代码](https://codeforces.com/contest/1764/submission/183008710)。