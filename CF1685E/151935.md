看了 pb 的提交，其实这题有一个“正常想出思路”的解法，而不是像其他题解一样结论/性质拍脸，于是记录一下。

首先 LIS $\le n$ 太阴间，可以等价于能选出 $n$ 个下降序列，覆盖整个序列。（最长反链等于最小链覆盖）

考虑到序列的长度是 $2n+1$，$n$ 个下降序列的限制很宽，只要是长度是 $2,2,2,2,..,3$ 的拼起来就行了。

于是就有一个想法，把 $n+1$ 拿出来，$[n+2,2n+1]$ 与 $[1,n]$ 配对，再把 $n+1$ 塞进去。

把 $[n+2,2n+1]$ 看成左括号，$[1,n]$ 看成右括号。显然肯定能找到一个旋转位置，形成一个合法括号序列。

这时如果 $n+1$ 在某对括号内，那就塞进去，成功了。否则就可以把 $n+1$ 旋到开头/结尾，使得仍然是合法括号序列。

此时问题已经简洁很多，因为 $n+1$ 被固定了位置。打表一下是否为无解的情况，发现只有 $[1,n],[n+2,2n+1]$ 都是上升序的才是无解。

于是对于有解的情况，看一看能不能调整出解：

如果 $[1,n]$ 不是上升序，有两个数 $x>y$ 且 $x$ 在 $y$ 前，那把 $n+1$ 放最后面，$y$ 对应的对子拆掉，把 $y$ 连在 $x$ 后面，就能腾出位置把 $n+1$ 插进去。

![](https://cdn.luogu.com.cn/upload/image_hosting/6vz2fbtk.png)

如果 $[n+2,2n+1]$ 不是上升序，那就把 $n+1$ 放在最前面，匹配的方式同理。剩下的就是无解了。

然后就是数据结构维护，其他题解有讲，这里不再赘述。

于是我们就能用正常的思维方式想出了这题的神秘结论（
