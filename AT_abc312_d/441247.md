看到数据范围，$|S|\le 3000$，想到一个 $O(n^2)$ 的朴素 DP 做法。
 
我们令 dp 数组 $dp_{i,j}$ 表示当前枚举到第 $i$ 位，还有 $j$ 个左括号没有匹配的方案总数。

然后是转移方程：

- 如果这一位是 ```(``` 的话，不匹配的位数就要多一位，有转移方程 $dp_{i,j}=dp_{i-1,j-1}$；

- 如果是 ```)``` 的话，不匹配的位数就要少一位，有转移方程 $dp_{i,j}=dp_{i-1,j+1}$；

- 如果是 ```?``` 的话，以上两种情况都可以选择，那么转移方程就应该是 $dp_{i,j}=dp_{i-1,j-1}+dp_{i-1,j+1}$。

初始化：第一位如果是 ```)``` 的话要特判处理掉，其余情况就把 $dp_{0,1}$ 赋值为 $1$，枚举区间 $[1,|S|-1]$ 处理答案即可。

核心代码：

```cpp
    for (int i = 1; i < n; i++)
    {
        if (str[i] != '(')
            for (int j = 1; j <= n; j++)
            {
                dp[i][j - 1] += dp[i - 1][j];
                dp[i][j - 1] %= MOD;
            }
        if (str[i] != ')')
            for (int j = 0; j <= n; j++)
            {
                dp[i][j + 1] += dp[i - 1][j];
                dp[i][j + 1] %= MOD;
            }
    }
```