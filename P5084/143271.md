#### 前言

我去问毒瘤@[Fee_cle6418](https://www.luogu.com.cn/user/42156) 要一个SBT（指傻*题），然后他给我了一个普通平衡树……

我解释清楚以后他才把[这个题](https://www.luogu.com.cn/problem/P5084)给我了，然后我口胡做法以后就被他假了，写篇题解纪念一下。

---

#### 正文

题面给的很清楚，不多赘述了。直接看做法。

二元：

得到的条件是 $a+b=x_1$，$ab=x_2$，那么 
$$(a+b)^2=a^2+b^2+2ab=x_1^2$$

显然我们能够推得

$$a^2+b^2=x_1^2-2x_2$$

带入计算即可。

---

三元：

$a+b+c=x_1$，$ab+bc+ca=x_2$，$abc=x_3$，

那么根据欧拉公式，
$$a^3+b^3+c^3-3abc=(a+b+c)(a^2+b^2+c^2-ab-bc-ca)=x_1\cdot (a^2+b^2+c^2-x_2)$$
显然我们只需要求出 $a^2+b^2+c^2$ 的值就行了。

然后我们算 

$$(a+b+c)^2=a^2+b^2+c^2+2ab+2bc+2ca$$
拿着这个等式能够直接快速的求出 $a^2+b^2+c^2$。

$$a^2+b^2+c^2=x_1^2-2x_2$$

然后直接带回去，得到：

$$a^3+b^3+c^3-3x_3=x_1\cdot(x_1^2-2x_2-x_2)=x_1^3-3x_1x_2$$

随手一回代，得到

$$a^3+b^3+c^3=3x_3+x_1^3-3x_1x_2$$

---

四元 (Siyuan)：

$a+b+c+d=x_1$，$ab+bc+cd+da=x_2$，$abc+bcd+cda+dab=x_3$，$abcd=x_4$。

这个时候没有公式可以凭借，只能够硬来，先算两次方：

$(a+b+c+d)^2=a^2+b^2+c^2+d^2+2ab+2bc+2cd+2da$

然后得到 $a^2+b^2+c^2+d^2=x_1^2-2x_2$。

然后是：

$$(a+b+c+d)^3=\sum_{cyc} a^3+\sum_{cyc} 3a^2b+\sum_{cyc} 3ab^2+\sum_{cyc} 6abc$$

显然中间两项可以合并：

$$(a+b+c+d)^3=\sum_{cyc} a^3+\sum_{cyc} 3ab(a+b)+\sum_{cyc} 6abc$$

然后这个式子就能化了：

$$x_1^3=\sum_{cyc} a^3+3x_1x_2+6x_3$$

所以 $\sum_{cyc} a^3=x_1^3-3x_1x_2-6x_3$。

然后 $(a+b+c+d)^4=\sum a^4+\sum_{cyc}4 a^3b+\sum_{cyc} 6a^2b^2+\sum_{cyc}12a^2$

这个其实不推也可。

---

显然其实是有规律的。我们就拿

[T54037 最开始](https://www.luogu.com.cn/problem/T54037)。

显然发现，上面那个题就是这个题的特殊情况，根据Fee自己的话说：

>确实就是 $n=2$ 的。

然后，我们发现那个题可以直接递推解决。考虑在这里一样递推解决。

---

首先考虑 $n=2$ 的递推式：

$a^2+b^2$ 和 $a+b$ 已经求出来了。然后我们看 $a^m+b^m$。

显然，由于 $(a^{\frac{m}{2}}+b^{\frac{m}{2}})^2=a^m+b^m+2a^{\frac{m}{2}}\cdot b^{\frac{m}{2}}$，我们显然又知道 $ab$，直接用类ksm即可。

---

$n=3$ 的递推式：

上面那个看起来舒服，但是反着的，不是很舒服，这次给一个正着推式子的。

$$(a^m+b^m+c^m)^2=a^{2m}+b^{2m}+c^{2m}+2ab^m+2bc^m+2ca^m$$

后面看起来不太舒服，把公因式提出来：

$$(a^m+b^m+c^m)^2=a^{2m}+b^{2m}+2^{2m}+2[(ab)^m+(bc)^m+(ca)^m]$$

然后你要有足够的勇气，尝试一下把后面的 $(ab)^m+(bc)^m+(ca)^m$ 写出来。你写啊写啊写，写不出来，于是开始高兴的玩起了小恐龙。

然后你会惊喜的发现其实这个一元三次方程是可解的。

~~草讲了这么就你tm才讲到能解啊，，~~

由于 $\begin{cases}a+b+c=x_1\\ab+bc+ca=x_2\\abc=x_3 \end{cases}$

我们能够得出 $a,b,c$ 分别是 $x^3-x_1x^2+x_2x+x_3=0$ 的三根，然后拿盛金公式来做，$\Theta(1)$ 出解，然后ksm。

---

最后是 $n=4$。这个就老老实实推式子吧，我也找不到什么好的歪门邪道的方法了，反正数据小，能做就是了（

复杂度显然 $\Theta(m)$。

我们推式子啊推啊推。我们想到用 $n=2$ 的方法来做这个题。

一样的先把条件写出来：

$x_1=a+b+c+d,x_2=ab+bc+cd+da,x_3=abc+bcd+cda+dab,x_4=abcd$

我们尝试推一下答案。为了向出题人致敬，用Fee来记录答案。

$\text{Fee}_0=a^0+b^0+c^0+d^0=4$

$\text{Fee}_1=a+b+c+d=x_1$

$\text{Fee}_2=a^2+b^2+c^2+d^2=x_2^2-2x_1$

$\text{Fee}_3=a^3+b^3+c^3+d^3=x_1\cdot (\text{Fee}_2-x_2)+3x_3$（~~这个式子是我瞎yy出来的，显然就是一个用两次多项式乘上一次多项式的乘法，可能有问题~~）

显然到这里已经有一点递推关系出来了。既然是递推，考虑数学归纳法。

上手考虑 $\text{Fee}_i$ 从 $i-1$ 递推过来，只可能是乘上 $x_1$，我们就让他乘 $x_1$。然后是 $i-2$，乘上 $x_2$，$i-a$ 就是乘 $x_a$，好像这个式子能够推广到 $n\leq 100$，复杂度是 $\Theta(mn)$。~~如果按照 Fee 的说法还能够分治FTT~~。经过一番yy我们得到应该是一加一减的，这样正好能凑成功。

$\text{Fee}_i=x_1\cdot \text{Fee}_{i-1}-x_2\cdot \text{Fee}_{i-2}+x_3\cdot \text{Fee}_{i-3}-x_4\cdot \text{Fee}_{i-4}$

然后拿这个式子去推就行了，复杂度 $\Theta(m)$。当然这个做法也适用于 $n=2,3$。

代码就不贴了，免得到时候丢人。





