前置知识：树链剖分（虽然不需要链操作，所以也不需要维护轻重边，只要按照 dfs 序就行，就算弱化吧 qwq）

---

注意到每个操作 $2$ 只和前面那个操作 $1$ 有关系。

因此我们可以把操作 $2$ 离线下来，按照**前面一个操作 $1$ 的染色的深度**排序。

开始时所有点为绿色。设当前为染色深度 $x$ 的操作，我们只需要：

- 继承染色深度为 $x+1$ 的树。
- 并且把每一个深度为 $x$ 的点都染上黄色。
- 对于深度为 $x$ 的询问，求其子树内的染色点个数。

当然先全部染黄再一层层取消也行的。

容易发现，将树按照 dfs 序变成序列后，第二个步骤即为单点修改，第三个即为区间求和，可以使用树状数组解决。（~~代码里我写的时候因为傻了写了个线段树~~）


特别地，对于刚刚开始还没有染色的询问，答案为 $0$，需要特判。

每个点都要一次染色，还需要进行 $m$ 次区间求和，因此复杂度为 $O((n+m) \log n)$。


[代码](https://www.luogu.com.cn/paste/z9t6qp0j)