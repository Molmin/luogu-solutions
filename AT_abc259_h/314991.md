枚举种类，然后再做。

考虑暴力一：直接 dp。将这一种类所有点的 dp 值设为 $1$，然后 $dp_{i,j}\gets dp_{i,j}+dp_{i-1,j}+dp_{i,j-1}$。答案就是同种类所有点的 dp 值之和。

考虑暴力二：直接组合数。$(a,b)\to (c,d)$ 的方案数即 $\binom {c+d-a-b}{c-a}$。预处理组合数，枚举这一种类点对所有点对。

考虑如何结合，即设置阈值 $B$，若这一种类点数量大于 $B$，则执行暴力一；否则执行暴力二。计算复杂度：暴力一单次复杂度为 $O(n^2)$，最多 $\frac{n^2}{B}$ 次，即为 $O(\frac{n^4}{B})$；暴力二单次执行次数为 $n_i^2$，总的即为 $\sum n_i^2\le (\max n_i)\sum n_i=O(Bn^2)$。总复杂度即 $O(\frac{n^4}{B}+n^2B)$。取 $B=n$ 即有最优复杂度 $O(n^3)$。