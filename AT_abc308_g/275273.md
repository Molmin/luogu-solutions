考虑没有删除操作怎么做。可以动态维护 $ans$，新加进来一个 $x$，我们计算 $\min\limits_{y \in S} x \oplus y$。对 $S$ 建 01Trie，然后从高位往低位按位贪心，在 01Trie 上优先往与 $x$ 这一位相同的方向走，但是前提是它的子树内有数，对于 01Trie 上的每个点维护一个 $sz_u$ 表示以 $u$ 为根的子树内数的个数即可判断。

加上删除操作，容易线段树分治。对所有 $3$ 操作建线段树，把一个数有效的范围对应到线段树上 $\log$ 个区间，然后最后 dfs 一遍即可知道每个 $3$ 操作时哪些数有效。退出线段树当前结点时的撤销，就维护之前的答案，对于这个数对应的叶子到根的路径的所有点 $u$，将 $sz_u$ 减去 $1$ 即可。

时间复杂度 $O(q \log q \log V)$。

[code](https://atcoder.jp/contests/abc308/submissions/43208911)

--------

官方题解的做法挺强的。注意到对于 $x < y < z$，$\min(x \oplus y, y \oplus z) < x \oplus z$，于是我们只用维护值域相邻的数的 $\oplus$ 最小值即可。