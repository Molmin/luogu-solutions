  机房大佬 $\color{black}{\mathbf{c}}\color{red}{\mathbf{p152}}$ 想出来的一个虽然本质是一样的但是感觉比现有题解要好理解的做法。
  
  首先考虑所有字母都在一个连通块内的情况。
  
  发现我们的决策一定是如下图：
  
  ![](https://cdn.luogu.com.cn/upload/image_hosting/1pup10cs.png)
  
  其中向回跑的边必定是在最后一个有需求回到某个点的位置连出。
  
  发现这个题的字符集只有 $20$ ，考虑状压。
  
  考虑枚举链上的最后一个点。
  
  发现可以钦定这个字符需要变成的字符在整条链的最前端而不影响答案。
  
  于是在最后一个点和放在最前面的点中间的点就变成了一个子问题，可以进行转移。
  
  如果考虑不同连通块的情况，其实不需要每个连通块分开计算。
  
  发现如果整张图一起计算的话，由于不连通，缺失的边必然是在主链上，且刚好缺失连通块个数减一条。
  
  所以答案直接减去这个值即可。
  
  code：[https://codeforces.com/contest/1383/submission/158394065](https://codeforces.com/contest/1383/submission/158394065)