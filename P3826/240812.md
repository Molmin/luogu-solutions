为了方便下文的描述，令 $S_p$ 表示当询问天数为 $p$ 时，卖出了哪些蔬菜，$S'_p(i)$ 表示当询问天数为 $p$ 时，第 $i$ 天卖出了哪些蔬菜。

一开始的发现：$S_{p-1}\subseteq S_p$。

这说明可以预处理出卖出蔬菜的**顺序**。（其实不然）

用一个堆维护。每次检查一下当前这个蔬菜是否过期。

> 假如价值高的蔬菜保质期较长怎么办？

这种情况下会出现对于某一个 $i<p$, $S'_{p-1}(i)\neq S'_p(i)$，但巧妙的是，$S_{p-1}\subseteq S_p$ 仍然成立。

题目只要求输出利润，不在乎具体方案，因此可以预处理出一个序列，使得每个询问对应的价值都是该序列的一个前缀。

显然值越大的越应该放在前面，因此还是用堆维护，还是检查一下当前该蔬菜是否过期。

为了避免把价值高，保质期长的蔬菜分配在前面的情况，应该把每个蔬菜尽量往后放。

具体来说，如果当前的蔬菜是第 $i$ 类，先求出这个蔬菜最远能放在第 $day$ 天，假如这一天卖出的蔬菜已经有 $m$ 个，就尝试把该蔬菜放到第 $day-1$ 天，如果仍然不行，就放到第 $day-2$ 天 $\dots$ 如果变成第 $0$ 天，说明这个蔬菜不会被加入序列。由于在此之前加入序列的蔬菜价值都不小于它，因此这样贪心是不劣的。

可以用并查集优化上述过程。

每次询问相当于求序列前 $m\times p$ 个值的和。

时间复杂度：$O(k\log k)$ 其中 $k=n\times m$。

代码不超过 $1.5$ K。