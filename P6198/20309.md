题解全是神仙分治啊，这里给一个不用动脑子的解法。

首先考虑分析上下界，先考虑第一个数，显然$=$序列中$1$的个数。然后删去这些$1$分成子问题。这个问题有后效性，我们发现$-1$越大后效性越小（很不严谨），所以$S_i=S_{i-1}+1$就好了。

这不是重点，关键看我们怎么构造。

~~想到第一步却想不到分治真的没谁了~~

我们发现可以用$S$数组模拟单调栈。这样模拟的过程中我们可以得到$O(n)$个元素的大小限制。现在相当于给你一堆限制构造最小的字典序。

显然这个问题就可以用 拓扑排序+堆 解决了，时间复杂度$O(n\log_2n)$。

~~早知道题这么水就打洛谷月赛了，送了300分~~