提供一种可以支持区间覆盖，区间加以及对于此题询问区间查询的方法。        

~~原来我不是唯一解/fn~~

考虑询问的一种优秀性质：假设我们选择了一个数，那么它旁边的数就永远选不到了。                   

证明很简单，我们考虑选择的数，记为 $a_p$，此时它肯定比两边的数 $a_{p-1},a_{p+1}$ 都要在新定义运算符下更优，考虑如果执行到某一次时下一次不再执行这个数，那么再一段执行次数后 $a_{p-1},a_{p+1}$ 只有可能变得更小，所以之后还是执行 $a_p$ 而不会执行 $a_{p-1},a_{p+1}$。              

考虑维护一下 $a$ 数组的选择情况即可。在线段树上维护一个区间 $[l,r]$ 的四种选择情况：$[l,r],[l,r-1],[l+1,r],[l+1,r-1]$。每一种选择情况维护是否选择左右端点和所选数值之和后，只需在合并时分类讨论端点是否互相影响从对应的区间实现转移即可。

不难发现，稍微再扩展一下这个做法就可以做到区间赋值，区间加以及区间查询。

注意要特判线段树区间长度小于等于 $2$ 的情况。

时间复杂度 $O(n \log n)$。