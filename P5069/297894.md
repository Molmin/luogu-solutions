[末日三问点灯记录](https://www.luogu.com.cn/blog/NaOH-Ftoh/mo-ri-san-wen-dian-deng-ji-lu)，内含所有代码。

我们首先发现，当我们操作一个数之后，这个数旁边两个数就永远不会被操作了，因为它们两个永远都会比中间的数小。

所以该操作等价于，找到当前的最大值，答案加上那个最大值，然后把它和它边上两个数都变成 $0$。

我们考虑一个单调递增的数组执行这种操作的结果。显然，只有 $a_n, a_{n-2}, a_{n-4},\cdots$ 这些数会被选。

那么，我们只要维护出数组中所有的极值（即，比两边都大或者都小的值），我们就可以很快的算出两个极值之间的数给答案的贡献，按照数组下标奇偶放到两棵树状数组中即可。维护极值可以用 set 解决。

总复杂度 $O(n\log n)$，是 Ynoi 中少有的不卡常题。

上文就是这道题的思路，看起来很简单，码长也确实一般，但是有很多细节。要特别注意极小值只有在相邻两个极大值离它的距离**都是**偶数的情况下才会被取到。

