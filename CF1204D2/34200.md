一道很好的题，这里主要讲一下翻译的第一篇。

@Llf0703 题解的代码是没有任何问题的，但是他的讲述可能有些许欠缺。

在此感谢[@FourteenObsidian](https://www.luogu.com.cn/user/108098)对我做此题不可忽视的帮助。

---

引理：我们将一个 **没有任何等效序列** 的串（即不能通过将其中一些0转成1且将一些1转成0使得满足翻译中的第二条）称为 "fixed" 串，那么，"fixed"串有以下性质：

- 我们将数字“1”看成“(”，“0”看成“)”，那么所有的"fixed"串都是一个合法的括号序列；

证明：

为方便描述，我们将把串中数字“1”看成“(”，“0”看成“)”后是一个合法括号序列的串称为“nfixed”串；

我们将既是"nfixed"也是"fixed"的串称为"dfixed"串；

充分性：“nfixed”串一定"fixed"：

我们考虑以下几点：

- 对于串“10”，它是一个"dfixed"串；

- 对于串 $p,q$，若它们均是"dfixed"串，那么 $pq$ 也是"dfixed"串；（显然，你不能改任意一个位置上的值）

- 对于串 $p$，若它是"dfixed"串，那么串 $1p0$ 也是；（考虑按长度归纳证明，若长为 $|s|-2$ 的所有dfixed串都是满足这三条，那么将其前面加1，后面加0，任意改这两个中的哪一个都会使得原串的最长不下降子序列长度+1）

而以上三种操作能生成所有的"nfixed"串，所以证毕。

必要性：只有满足这样的条件的串"fixed"：

引理：对于一个"nfixed"串，它一定满足：它的最长不降子序列长度一定是 $\dfrac{|s|}{2}$，且可以通过全取0或全取1得到；

引理证明：把合法的不降子序列看成一个括号串，则它一定是如")...)(...("的形式；将其中的所有")"换成"("或将其中的所有"("换成")"均能成立且长度不变；

必要性证明：

- 按长度归纳证明，我们发现将其他串**剔除**掉所有的"nfixed"串后，剩下的串一定是形如“0...01...1”（可能没有0或没有1）的形式；我们发现，将这个剩下的串改成"000...0"的形式，再放回原序列中，一定合法；因为对于原来如同"0...0[nfixed]0...01...1[nfixed]1...1"的子串，原来的和改后的最大值均是 $\dfrac{total\_len\_of[fixed]}{2}+others$；所以它有等效序列，不满足我们的定义，所以证毕。

于是，我们可以将原串中的所有"fixed"串剔除（因为它们反正不能被改）；这样我们得到的串就是一个形如"0...01...1"的串，我们将后面的一截"1"改为等长的一截"0"就好啦~

找"fixed"串可以考虑从后往前扫，因为考虑到"fixed"串一定有对于任意后缀，0的个数 $\ge$ 1的个数，不符合的就一定不在fixed串中；

代码实现详见@Llf0703 的题解~