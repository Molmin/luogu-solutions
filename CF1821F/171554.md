首先考虑如何判断是否合法，容易发现，从左往右考虑，能往左边倒就往左边倒。

能全部倒掉就赢了。

有一个最最暴力的想法是定义 $f_{i,j}$ 表示最靠右的一个被占据的位置是 $j$ ，并且决策了 $i$ 棵树的方案数。转移是平凡的，很容易就可以写出从 $f_{i} \rightarrow f_{i+1}$ 的转移式。

发现这个转移是规整的，转移可以用生成函数来描述，每一次转移等价于乘上了：
$$
2 (x^{k+1} + x^{k+2} + \dots + x^{2k+1}) + x^{2k+2} + x^{2k+3} + \dots
$$
改写成封闭形式，则可以得到：
$$
\frac{x^{k+1}(2 - x^k)}{1-x}
$$
于是由初始状态 $f_{0,0} = 1$ 得到答案：
$$
f_n = \frac{x^{mk + m}(2 - x^k)^m}{(1-x)^m}
$$
我们再改写一步：
$$
f_n = x^{mk + m}(2 - x^k)^m\frac{1}{(1-x)^m}
$$
于是，我们可以枚举 $(2 - x^k)^m$ 贡献的项的次数。

在计算中，我们可能会用到这样的一个变换：
$$
\sum_{q=0}^p [x^q] \frac{1}{(1-x)^m} = [x^p]\frac{1}{(1-x)^{m+1}} = \binom{p + n}{m}
$$
因为 $\frac{1}{1-x}$ 的组合意义是滚一次前缀和，然后就做完了。