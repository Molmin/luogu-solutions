- 赛时做法，有问题欢迎提出。

------------

首先发现每一行变换的次数只能为 $0$ 或 $1$，并且发现当前这一行变换只会影响旁边两行的合法性。

据此考虑DP。$f(i,0/1,0/1)$ 表示考虑前 $i$ 行，前 $i-1$ 行已确定合法，第 $i-1$ 行和第 $i$ 行分别是否变换的方案数。转移就考虑枚举 $f(i-1,0/1,0/1)$，这时最后三行状态已知，若第 $i-1$ 行合法，则能转移，反之不能。最后的答案就再判断一下 $f(H,0/1,0/1)$ 对第 $H$ 行是否合法就行。

时间复杂度 $O(HW)$

[代码](https://atcoder.jp/contests/abc283/submissions/37511913)