我这个人极其不擅长转化，甚至一看这个题没有想到计算每条边的贡献就直接开始做，果真还是太逊了。。。

本题题解跟其它题解有亿点不同，虽然想到这种方法比较容易直接，但是推起方程来却~~恶心到吐~~（至少对我来说是这样子的）。。。

如果这道题你没有转化成计算每条边对答案的贡献，也绝非死路一条，还有一条没有办法的办法，就是**硬推**。

首先，你应该很容易的想到枚举子树的大小是多少时的答案，我们设大小为 $i$ 的子树的答案是 $f_i$（初始状态为 $f_0=f_1=0$），很容易想到大致思路是枚举一个 $j$ 然后将 $f_j$ 和 $f_{i-j-1}$ 转移到 $f_i$ 中。

这样并不好转移，因为你还缺很多东西：

$1$、根到其它点的距离之和。

$2$、在两个不同子树的点距离之和。

乍一看条件 $1$ 比较好处理，而且条件 $2$ 好像依赖于条件 $1$，不妨先处理掉条件 $1$。

设 $g_i$ 为大小为 $i$ 的树中根到其它点的距离之和（初始状态为 $g_0=g_1=0$）。

和 $f$ 的转移一样，首先要枚举 $j$，然后通过 $g_j$ 和 $g_{i-j-1}$ 转移到 $g_i$。

由于子树是由哪些点构成的有待确定，所以在转移的时候需要乘上一个组合数 $\binom{i-1}{j}$，代表在 $i-1$ 个点中任选 $j$ 个点加入到左子树中，其余的放进右子树中。

然后因为两个子树通过一个根合并在一块，其所有的点深度全都要加 $1$，又因为一共有 $i!$ 种形态的树，所以增量是 $i!(i-1)$。

大致可以得出一个转移方程：

$$g_i=i!(i-1)+\sum\limits_{j=0}^{i-1}\binom{i-1}{j}(g_j+g_{i-j-1})$$

很可惜，这个转移方程是错的，因为右子树的形态有 $(i-j-1)!$ 种，所以 $g_j$ 需要被加上 $(i-j-1)!$ 次，左子树同理。

正确的转移方程：

$$g_i=i!(i-1)+\sum_{j=0}^{i-1}\binom{i-1}{j}((i-j-1)!\times g_j+j!\times g_{i-j-1})$$

条件 $1$ 已经被解决，还剩下条件 $2$。

首先列出一个不含条件 $2$ 的转移方程式：

$$f_i=g_i+\sum_{j=0}^{i-1}\binom{i-1}{j}(f_i\times (i-j-1)!+f_{i-j-1}\times j!)$$

根据条件 $2$，其实它对答案的贡献无非是**经过根连接两个儿子的两条边的次数**和**以这两个儿子为根到所有子节点的距离之和被分别计算了多少次**。

前者显然为 $j\times j!\times (i-j-1)\times (i-j-1)!$。

后者也很显然，以计算左子树为例，右子树的形态共有 $(i-j-1)!$ 种，每种形态的每个点都要计算一次，所以它的答案是 $g_j\times (i-j-1)!\times (i-j-1)$，右子树同理，所以总贡献次数为 $g_j\times (i-j-1)!\times (i-j-1)+g_{i-j-1}\times j!\times j$。

所以，最终转移方程式为：

$$f_i=g_i+\sum_{j=0}^{i-1}\binom{i-1}{j}(f_i\times (i-j-1)!+f_{i-j-1}\times j!+2j\times j!\times (i-j-1)\times (i-j-1)!+g_j\times (i-j-1)!\times (i-j-1)+g_{i-j-1}\times j!\times j)$$

时间复杂度：$O(n^2)$，显然你一看到这个式子就知道这个常数已经不知道大到哪去了，这数据范围幸亏是 $2000$，要是 $5000$ 此题解就真可能去世了。。。

你可能会问，这方程不是随随便便用 $5\text{min}$ 就能推出来吗，哪里恶心到吐了？？？

抱歉，由于博主水平太低，用了一个多小时才推对式子（虽然想到这个做法也用了快 $20\text{min}$ 了），而且一开始还甚至忘记了有条件 $2$ 这个东西，想到了之后条件 $1$ 又不知道要乘阶乘，一直以为这是个假做法，还不停地在手玩 $n=5$ 的答案，最后是写了个 dfs 暴力枚举每棵树的总深度才看出错来，值得庆幸的是 $n\le 4$ 的时候忘乘阶乘也可以得到正确答案，因为数太小了，根本没有贡献。。。