要使得所选数的乘积为完全平方数，则乘积的所有质因子的指数为偶数。

由于我们只考虑指数的奇偶性而不在乎它具体是多少，因此可以使用异或线形方程组。

将每个数分解质因数，可以构造出一个方程组，行表示质数，列表示给定的数是否选。

最后得到的自由元就是给定的数的数量减去矩阵的列秩，最后答案就是 $2$ 的自由元个数次方减去什么都不选的情况。

列秩可以使用高斯消元求解。在高斯消元的过程中，对于一个列，若该列内有数，则该列与其他列线形独立，对列秩产生贡献。

更形象的说法是，如果存在自由元，说明该线形方程组存在多解，那么存在系数与常数项均为 $0$ 的情况，我们暂时将这样的行称为 $0$ 行。

此时自由元的数量即为方程个数减去 $0$ 行的个数。

由于此题中方程个数与未知数个数不对等，因此应使用未知数个数减去 $0$ 行的个数。