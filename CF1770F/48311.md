## 题目大意

给出三个正整数 $n,x,y$。

对于所有满足如下条件的 $a$ 序列：

- $a$ 的长度为 $n$；

- $\sum_ia_i=x$；

- $\text{OR}_ia_i=y$；

计算 $\bigoplus_i a_i$ 的异或和。

$n< 2^{40},x<2^{60},y<2^{20}$

## 题解

首先，由于每个位置是对称的，因此可以发现 $n$ 为偶数时答案为 $0$，否则为 $a_1$ 所有情况的异或值。

其次，考虑两个限制。先满足 $\sum$ 再满足 $\rm OR$ 不太现实，因此先满足 $\rm OR$ 的限制。

### 方法 1

$\rm OR$ 的限制如果容斥掉会很方便，因此先容斥掉。

然后拆位算，考虑计算 $2^k$ 被计算多少次。

这样子，只需要计算下述式子的值了：

$$

\bigoplus_{\sum a_i=x-2^k}[a_1\subset (y-2^k)][a_2\subset y]...[a_n\subset y]

$$

由于一切再 $\bmod 2$ 的意义下进行，因此逆用卢卡斯定理，可以得到：

$$

(\sum_{\sum a_i=x-2^k}\binom{y-2^k}{a_1}\binom{y}{a_2}...\binom{y}{a_n})\bmod 2

$$

此时再使用范德蒙德卷积化简，可以得到

$$

(\binom{ny-2^k}{x-2^k})\bmod 2=[(x-2^k)\subset(ny-2^k)]

$$

至此，这题就做完了。

时间复杂度 $O(y\log y)$。

### 方法 2

考虑每一位的限制。设 $c_i$ 表示 $2^i$ 位在 $a[1,..,n]$ 中有几个位置是有值的，那么 $\rm OR$ 就是对一些 $c_i>0/=0$ 的限制。

将 $\rm OR$ 为 $0$ 的二进制位剔除，假设剩下的二进制位依次为 $a_1,...,a_p$，那么限制为：

- $\forall i\in[1,p],c_i>0$；

- $\sum_{i=1}^p2^{a_i}c_i=x$；

贡献为：

$\bigoplus_{i=1}^p[c_i\bmod 2]2^{a_i}$

此时，可以发现只有当 $c_i\subset n$ 时 $c_i$ 的方案数是奇数，因此只用考虑这种情况。

那么我们一样将 $n$ 的二进制为 $1$ 的位置提出，设为 $b_1,...,b_q$。

那么 $b_1=0$，否则 $b$ 就不能是奇数，答案就是 $0$（这也间接限制了 $n=0$）。然后一个 $2^{a_i}$ 是否有贡献取决于其 $b_1$ 是否有值。

此时，对和的限制表示方法是（并不是要满足什么条件，而是我们能够刻画这件事情）：

$$

[z^x]\prod_{i=1}^p\prod_{j=1}^q(1+z^{2^{a_i+b_j}})

$$

可以发现，对于 $\rm OR$ 恰相等的还要对于 $b_j$ 的选与不选做一些额外的限制，依旧不好做。因此容斥掉。枚举 $y$ 的子集 $y'$ 并让 $\rm OR$ 再这之中。

然后就真的变成上面的式子了。只是贡献不好塞进去。

考虑枚举 $2^{a_r+b_1}$，并计算是否有贡献（也就是方案数是不是奇数）。

那么所有的 $a_i+b_j$ 就地位等价了。把所有配对搞出来，假设为 $d_1,..,d_t$，他们的地位是等价的。此时我们就是要计算这个值：

$$

([z^{x-2^{a_r}}]\prod_{i=1}^{t}(1+z^{d_i}))\bmod 2

$$

可以发现 $d_i$ 有很多都是相等的，那么这样就可以组合出很多抵消的情况。

假设对于一个 $d_i$，有 $u$ 个和其相等，如果我们要选择 $v$ 个，那么要让方案是奇数就需要有 $v\subset u$，因此，我们就可以将 $u$ 的二进制位拿出来，向上推。

比如说，$d_i=2$ 的有 $5$ 个，那么只有选择 $0,1,4$ 个是有贡献的。因此，可以将 $d$ 变成 $2,4$，这样子就是一样的效果了。（跟上面的将 $n$ 拆分的过程类似）

容易发现，最终情况下，每种值都只有一个，也就是 $(x-2^{a_r})\subset \sum_{i=1}^t2^{d_i}$ 的话就有贡献。

容易发现将 $d_i$ 拆分的过程并不影响上面右式的值，因此容易算出右式的值就是 $ny'-2^{a_r}$。

得到了与方法一一般的结论。

时间复杂度 $O(y\log y)$。