考虑互逆的排列 $p$ 和 $q$（即，满足 $\forall i\in[1,m],q_{p_i}=i$），此时 $p\cdot q$ 的美观度取最大值 $m$。在已知排列 $q$ 的情况下，能够求出唯一的排列 $p$，若再加入另一个排列 $r$，注意到题目中排列的美观度是最长的满足 $a_i=i$ 的前缀长度， $r\cdot q$ 的美观度即为 $p$ 和 $r$ 最长公共前缀长度。

于是，先对每个排列 $a_j$ 求逆，然后枚举 $a_i$，与所有 $a_j$ 尝试匹配，匹配到的最大长度即为答案。

但是这样显然会超时。由于只需要前缀长度，考虑建一颗 trie 树，先将所有 $a_j$ 的逆排列加入，再对每个 $a_i$ 进行匹配。

复杂度 $O(nm)$。

[赛时 AC 代码](https://codeforces.com/contest/1792/submission/190363330)