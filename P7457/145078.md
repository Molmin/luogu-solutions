这里给出一个 $O(n\log V \log n)$ 的离线做法（ $V$ 为值域 ），至于强制在线能做到什么复杂度还有待商量。

对给出的图进行一些简单的转化：连接所有出现过的边，并将边权设为 $Inf$。

这样问题就转化为了

- $1.$ 修改边权（其中删边视为赋 $Inf$）；

- $2.$ 最小化两点 $(x, y)$ 之间路径最大值。

先来解决第二个部分，我们二分最大路径长度 $val$，那么等价于只保留边权不大于 $val$ 的边后 $(x, y)$ 是否联通。

重新审视一下这个问题，现在有多次询问，边权可能发生变化，不妨基于值域分治。

- 将询问挂到时间轴上的对应位置；

- 假设当前答案候选区间为 $[l, r]$，我们按照时间加入权值在 $[0, r]$ 之间的边，同时利用并查集对应时间上的询问；

- 注意到每次加入 $[0, r]$ 之间的边时间复杂度难以接受，我们来观察一下哪些步骤时不必要的，可以发现权值较小的边会被加入很多次；

- 基于值域分治带来了值域上的偏序关系，这启发我们利用这一点，设 $mid = \frac{l + r}{2}$，在加入权值在 $[0, mid]$ 内的边后，直接处理 $[mid + 1, r]$；

- 由于并查集需要撤销，所以不能路径压缩。

这样，我们得到了一个 $O(n\log V \log n)$ 的优秀做法。