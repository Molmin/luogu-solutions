zxy 好强/se/se。

### $\texttt{Solution}$
首先将问题分成 $x=0$ 与 $x\neq 0$ 两部分。

对于前者，问题为选择一组 $n$ 个线性无关的向量的方案数。

这是一个经典问题，方案数为 $\prod_{i=1}^{n}(2^k-2^{i-1})$。

显然，$n>k$ 时答案为 $0$，容易在 $O(k)$ 内计算答案。

对于 $x\neq 0$ 的问题，我们容易发现对于任意 $x$ 方案数一致。

我们不妨认为 $x=1$ 以方便问题。

我们考虑将每个数看成一个 $k$ 维的向量，并将 $1$ 放在第一行形成一个 $(n+1)\times k$ 的矩阵。

设 $f_{i,r}$ 表示考虑完前 $i$ 行，秩为 $r$ 的方案数。

$f_{i,r}=f_{i-1,r}\times 2^{r-1}+f_{i-1,r-1}\times (2^k-2^{r-1})$

第一个转移表示秩不变，又第 $i$ 个行向量的选择不能被第一个向量表示，故系数为 $2^{r-1}$。

那么答案即为 $\sum_{r}f_{n+1,r}$。

我们得到了一个 $O(nk)$ 的做法，考虑优化它。

记 $F_{r}(z)=\sum_{i=0}f_{i,r}z^i$。

考虑将所有秩不变的 dp 转移一次计算。

即 $F_r(z)=F_{r-1}(z)(2^k-2^{r-1})z\sum_{i=0}(2^{r-1}z)^i$。

进行一定的化简可以得到。

$F_r(z)=\frac 1 {2^k-1}z^r\prod_{i=1}^r(2^k-2^{i-1})\prod_{i=1}^r\frac 1 {1-2^{i-1}z}$

我们的答案为 $\sum_{r=1}^k[z^{n+1}]F_r(z)$。

考虑计算 $G_r(z)=\prod_{i=1}^r\frac 1 {1-2^{i-1}z}$。

考虑 $G_r(2z)$ 与 $G_r(z)$ 的关系，

得到 $(1-2^rz)G_r(2z)=(1-z)G_r(z)$。

记 $g_i=[z^i]G_r(z)$。

易得 $g_n=\prod_{i=1}^n\frac{2^{i+r-1}-1}{2^i-1}$。

故 $[z^{n+1}]F_r(z)=\frac 1 {2^k-1}\prod_{i=1}^r(2^k-2^{i-1})\prod_{i=1}^{n+1-r}\frac{2^{i+r-1}-1}{2^i-1}$。

化简到这一步问题就已经基本解决了。

考虑 $r$ 从小到大扫，转移时改变很小，容易做到 $O(k+\log n)$。

[code](https://www.luogu.com.cn/paste/jygvfi8n)