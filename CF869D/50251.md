设每条多余的边为 $u,v$，那么把$u$到根，$v$到根路径上的点做标记。

然后我们对每棵子树缩点，条件是子树中没有被标记的点。然后在缩完点的树上跑dfs统计答案即可