对于弱化版，我们很快能想到枚举每一个 $2\times 2$ 的正方形然后大模拟。我们规定对于一个 $2\times 2$ 的正方形，它每一块的编号如下，它对应的数字为其小写：

![](https://cdn.luogu.com.cn/upload/image_hosting/2q7mqb1d.png)

对于每一块，都有两种可能：$0$ 或 $1$，那就是 $2^4 = 16$ 种情况。

然后再规定一下每一种情况对应的编号，这可以方便进一步的判断。这里规定：一种情况的编号为 $num = 8a+4c+2b+d+1$。

当 $num = $：

1. 无操作。
2. $(ACD),(ABD),(BCD)$。
3. 同 $2$。
4. $(ABC),(ACD)$。
5. 同 $2$。
6. 同 $4$。
7. $(ACD),(ABD)$。
8. $(BCD)$。

9~15. 同 $2,4,7,8$。

16. $(ABC)$，然后同 $2$。

然后你就通过了弱化版。

考虑优化：首先不用枚举所有的正方形，可以想象一下把一堆正方形卡片丢到一个 $n\times m$ 的盒子，然后只留下最底层的卡片。也就是说，我并不需要枚举每一个正方形，我可以跳着枚举。

然后发现一个问题，对于 $n$ 或 $m$ 为奇数的情况，边角会有空隙。我们可以对其单独处理，单独更新；对于坐标 $(n,m)$ 的角块，注意要提到最前面单独处理。

代码过长，所以放在了[剪贴板](https://www.luogu.com.cn/paste/op5wzu92)