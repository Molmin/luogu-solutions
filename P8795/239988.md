# P8795 C++ 题解

**UPDATED on 2022-11-18 修正了一处笔误，感谢 @行吟啸九州 指正**

## 题意简述

- 对于一个数 $x$，可以选定一个质数 $p (p<n)$，将 $x$ 转化为 $p\cdot\lceil\dfrac{x}{p}\rceil$。
- 给定 $n(n\le 10^6)$，求最小的整数 $x$，使得进行两次上述操作后，$x$ 能被修改为 $n$。
- 无解输出 $-1$。 

## 题意分析

首先要发现上述操作的一个关键的性质。这是这道题的突破口。

**关键性质：** 对于 $x$ 转化到 $y$，在 $y$ 为相同的合数的情况下，$x$ 的最小值为 $y-z+1$，其中 $z$ 为 $y$ 的最大质因子。


显然，对 $n$ **直接连用**两次关键性质,是**不可行**的，这样不一定能找到最优解。

举例：$14$。连用两次关键性质的过程是 $14 \rightarrow 8\rightarrow 7$，但实际上的答案是 $6$，因为 $6\rightarrow 10\rightarrow 14$ 且没有更优秀的答案。

但是，我们可以枚举 $i\in(n-z,n)$（同样地，$z$ 代表着 $n$ 的最大质因子），对于 $i$ 用关键性质，取个最小值即可。

无解的判断也很简单，如果 $n$ **不是合数**，就无解。

具体做法如下：

1. 筛出所有不超过 $1000$ 的质数。$n$ 最大是 $10^6$，于是任意一个 $n$ 的质因子（除了最大质因子）都不超过 $1000$，而最大质因子可以通过除去其余所有质因子得到，故上界到 $1000$ 即可。
2. 对于 $n$ 进行质因数分解，得到 $n$ 的最大质因子 $z$。
3. 若 $z=n$，则 $n$ 不是合数，无解。
3. 枚举 $i\in (n-z,n)$，对 $i$ 进行质因数分解，如果 $i$ 是合数，答案为 $i$ 减去其最大质因子再加上 $1$，取个最小值；如果 $i$ 是质数，则跳过。

质数筛的时间可以忽略不计，分解质因数的时间复杂度为 $\Theta(\sqrt n)$，枚举 $i$ 的时间复杂度为 $\Theta(\sqrt n)$，故总时间复杂度为 $\Theta(n)$，能过。

## 代码

有些地方写得不够优秀，仅供参考。

```
#include<bits/stdc++.h>
using namespace std;
int pr[1000010],tot;
bool pr2[1000010];
void mp()
{
	pr[0]=2;
	tot=0;
	for(int i=3;i<=1000;i+=2)
	{
		if(!pr2[i])
		{
			pr[++tot]=i;
			for(int j=i+i;j<=1000;j+=i)
				pr2[j]=1;
		}
	}
}
int main()
{
	mp();
	int n;
	scanf("%d",&n);
	int t=n,maxp=-1;
	for(int i=0;pr[i]<=sqrt(t);i++)
	{
		if(t%pr[i]==0)
		{
			t/=pr[i];
			maxp=pr[i];
			i--;
		}
	}
	if(t)
		maxp=t;
	if(maxp==n)
		return printf("-1")&0;
	int ans=2147483647;
	for(int i=n-maxp+1;i<n;i++)
	{
		int maxpp=-1,tt=i;
		for(int j=0;pr[j]<=sqrt(tt);j++)
		{
			if(tt%pr[j]==0)
			{
				tt/=pr[j];
				maxpp=pr[j];
				j--;
			}
		}
		if(tt)
			maxpp=tt;
		if(maxpp==i)
			continue;
		ans=min(ans,i-maxpp+1);
	}
	printf("%d",ans);
	return 0;
}
```

---

## 关键性质的证明：

记 $y$ 的质因子从小到大依次为 $a_1,a_2,\cdots,a_k$，记 $A={a_1,a_2,\cdots,a_k}$。

显然，当 $y$ 不是合数的时候，不存在能转化为 $y$ 的数。

若操作时选定的质数 $p$ 不是 $y$ 的质因子，则 $x$ 不可能转化到 $y$。因此 $x$ 转化到 $y$ 必然是选定 $p\in A$。 

假设 $x\le y-a_k$，任选 $p\in A$，必然存在一个数 $x_0=y-p=p\times(\dfrac{y}{p}-1)\ge y-a_k \ge x$，使得 $x$ 最多可能转化到 $x_0$ ，而无法转化到 $y$。

而当 $x=y-a_k+1$ 的时候，选择 $p=a_k$，由于 $y-x<p$，则 $x$ 转化后必然变为 $y$。

得证。

**注：写得比较仓促，如果哪边写错了，请及时指出。**