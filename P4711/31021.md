为了跟上yg大神谜一样的步伐,本蒟蒻又回归了......

回归后便选择了这题,与新上的学科有关,顺便把元素表背了......

思路:与其边读边做,最后所有变量都混乱了,不如先把给的表达式转化为基本正常的化学式.
然后再按题意进行模拟就AC了.

Code:
```#include<iostream>
#include<cstdio>
#include<cstring>
#include<cmath>
#include<cstdlib>
#include<algorithm>
#include<ctime>
#include<map>
using namespace std;
int len,x,n,yg;//len是处理后的字符串长度,x为字符串数组下标,n的作用是处理系数,yg用于最后对结果输出是整数还是小数的判断
char c;//c为一开始要读入的字符
double ans,tot;//ans为答案,tot用于处理括号里的化学式,本题明确说明了没有括号嵌套的情况出现,否则就需要开一个tot数组了
string s,ts;//s为处理好的字符串,ts为当前正在处理的化学元素
bool flag=false;//flag为判断是否在括号中的bool型变量
map <string,double> Map;//万能的map
void start(){
    Map["H"]=1.0;
    Map["C"]=12.0;
    Map["N"]=14.0;
    Map["O"]=16.0;
    Map["F"]=19.0;
    Map["Na"]=23.0;
    Map["Mg"]=24.0;
    Map["Al"]=27.0;
    Map["Si"]=28.0;
    Map["P"]=31.0;
    Map["S"]=32.0;
    Map["Cl"]=35.5;
    Map["K"]=39.0;
    Map["Ca"]=40.0;
    Map["Mn"]=55.0;
    Map["Fe"]=56.0;
    Map["Cu"]=64.0;
    Map["Zn"]=65.0;
    Map["Ag"]=108.0;
    Map["I"]=127.0;
    Map["Ba"]=137.0;
    Map["Hf"]=178.5;
    Map["Pt"]=195.0;
    Map["Au"]=197.0;
    Map["Hg"]=201.0;
}//化学元素表,全部存进map里
int main(){
    start();
    while(~scanf("%c",&c)){//这是读入的一种小技巧,字符串单个字母读入专用
        if((c>='A'&&c<='Z')||(c>='a'&&c<='z')||c=='('||c==')'){//如果是字母,或是括号,无需处理,直接加入字符串
            s+=c;//string型可以直接把字符拼接到后面,后面的代码不再赘述
        }
        else if(c=='_'){//如果是'_'
            scanf("%c",&c);//读入无用的'{'
            scanf("%c",&c);//读入第一个字符
            while(c>='0'&&c<='9'){//如果第一个读入的是数字,那么持续读入数字
                s+=c;
                scanf("%c",&c);
            }//如果第一个读入的不是数字,则是无用的'}',对处理结果无影响
        }
        else if(c=='~'){//如果是'~'
            scanf("%c",&c);//读入第一个字符
            if(c=='H'){//如果读入的第一个是'H',则说明水合物系数为1
                s+='~';//字符串后加上'~',方便判断是水合物
                s+='1';//加上其系数1
                scanf("%c",&c);//读入无用的'_'
                scanf("%c",&c);//读入无用的'{'
                scanf("%c",&c);//读入无用的'2'
                scanf("%c",&c);//读入无用的'}'
                scanf("%c",&c);//读入无用的'O'
            }
            else{//如果读入的第一个不是'H',则说明水合物系数不为1
                s+='~';//字符串后加上'~',方便判断是水合物
                while(c>='0'&&c<='9'){//持续读入数字
                    s+=c;
                    scanf("%c",&c);
                }//在读入数字时已经读过无用的'H'
                scanf("%c",&c);//读入无用的'_'
                scanf("%c",&c);//读入无用的'{'
                scanf("%c",&c);//读入无用的'2'
                scanf("%c",&c);//读入无用的'}'
                scanf("%c",&c);//读入无用的'O'
            }
        }
    }
    len=s.size();//string类型的字符串长度用.size()
    while(x<len){//循环
        if(s[x]=='('){//如果是'('
            flag=true;//flag标记为真
        }
        if(flag){//如果flag为真,即已经处于括号中
            tot=0.0;//清零！！！
            x++;//下标++
            while(s[x]!=')'){//如果还没读到')',即依旧处在括号中
                if(s[x]>='A'&&s[x]<='Z'&&s[x+1]>='a'&&s[x+1]<='z'){//如果是两个字母的元素
                    ts="";//清空！！！
                    ts+=s[x],ts+=s[x+1];//加上这两个字母
                    x+=2;//下标+2
                    n=0;//清零！！！
                    if(s[x]>='0'&&s[x]<='9'){//将此元素系数处理出来
                        while(s[x]>='0'&&s[x]<='9'){
                            n=n*10+(s[x]-'0');
                            x++;
                        }
                    }
                    if(n>1){//如果系数大于1
                        tot+=Map[ts]*n;//tot加(元素相对原子质量乘上系数)
                    }
                    else{
                        tot+=Map[ts];//否则tot加元素相对原子质量
                    }
                }
                else if(s[x]>='A'&&s[x]<='Z'){//如果只是单个字母的元素
                    ts="";//清空！！！
                    ts+=s[x];//加上这一个字母
                    x++;//下标++
                    n=0;//清零！！！
                    if(s[x]>='0'&&s[x]<='9'){//将此元素系数处理出来
                        while(s[x]>='0'&&s[x]<='9'){
                            n=n*10+(s[x]-'0');
                            x++;
                        }
                    }
                    if(n>1){//如果系数大于1
                        tot+=Map[ts]*n;//tot加(元素相对原子质量乘上系数)
                    }
                    else{
                        tot+=Map[ts];//否则tot加元素相对原子质量
                    }
                }
                else if(s[x]=='~'){//如果是'~'
                    x++;//下标++
                    n=0;//清零！！！
                    if(s[x]>='0'&&s[x]<='9'){//将水合物系数处理出来
                        while(s[x]>='0'&&s[x]<='9'){
                            n=n*10+(s[x]-'0');
                            x++;
                        }
                    }
                    tot+=n*18.0;//注意,水的元素质量为H2O=(1×2+16)=18,直接用其乘上系数即可
                }
            }
            x++;//下标++
            n=0;//清零！！！
            if(s[x]>='0'&&s[x]<='9'){//将整个括号的系数处理出来
                while(s[x]>='0'&&s[x]<='9'){
                    n=n*10+(s[x]-'0');
                    x++;
                }
            }
            if(n>1){//如果系数大于1
                ans+=tot*n;//答案加上(tot乘上系数)
            }
            else{
                ans+=tot;//否则直接加上tot
            }
            flag=false;
        }//括号外的处理与括号内的一模一样,这里不再赘述
        else if(s[x]>='A'&&s[x]<='Z'&&s[x+1]>='a'&&s[x+1]<='z'){
            ts="";
            ts+=s[x],ts+=s[x+1];
            x+=2;
            n=0;
            if(s[x]>='0'&&s[x]<='9'){
                while(s[x]>='0'&&s[x]<='9'){
                    n=n*10+(s[x]-'0');
                    x++;
                }
            }
            if(n>1){
                ans+=Map[ts]*n;
            }
            else{
                ans+=Map[ts];
            }
        }
        else if(s[x]>='A'&&s[x]<='Z'){
            ts="";
            ts+=s[x];
            x++;
            n=0;
            if(s[x]>='0'&&s[x]<='9'){
                while(s[x]>='0'&&s[x]<='9'){
                    n=n*10+(s[x]-'0');
                    x++;
                }
            }
            if(n>1){
                ans+=Map[ts]*n;
            }
            else{
                ans+=Map[ts];
            }
        }
        else if(s[x]=='~'){
            x++;
            n=0;
            if(s[x]>='0'&&s[x]<='9'){

                while(s[x]>='0'&&s[x]<='9'){
                    n=n*10+(s[x]-'0');
                    x++;
                }
            }
            ans+=n*18.0;
        }
    }
    yg=(int)ans;
    if(ans==(double)yg){
        printf("%d",yg);
    }
    else{
        printf("%.1f",ans);
    }//最后由于ans定义的是double型,所以需要判断答案是否为整数,若为整数,则输出其整数形式,否则输出其小数形式
    return 0;
}```
