简单题，写挂了，感觉模拟赛随便胡了个算法和其他人不太一样，但估计本质还是差不多的。

首先发现时间点之间的间隔大小没有用，只用考虑时间点就只有 $O(n)$ 个，令时间点个数为 $t$。

考虑两个会场发现无本质区别，于是谁选多选少无关而只与两者活动差值有关。

于是设仅在 $1\sim i$ 的时间点之内选活动，使得两个会场活动相差为 $j$，少的那个会场举办的活动最多为 $f_{i,j}$，同理定义仅在 $i\sim t$ 个时间点内选的少的那个最多活动数为 $g_{i,j}$。

转移的话还得预处理 $w_{i,j}$ 表示在 $i\sim j$ 的时间点之间的区间个数，注意这道题比较奇怪端点都可以算进来，然后枚举把 $w$ 给哪个会场就有了转移式：

$$f_{j,k}\to f_{i,k+w_{j,i}}$$

$$f_{j,k}+k\to f_{i,w_{j,i}-k},k\le w_{i,j}$$

$$f_{j,k}+w_{j,i}\to f_{i,k-w_{j,i}},k>w_{i,j}$$

第一问的答案就出来了，就是 $\max_x f_{n,x}$，或是 $\max_x g_{1,x}$。

考虑第二问，首先我们肯定枚举强制选了当前区间 $i$ 的是哪个时间点之内，也即枚举 $w_{j,k},j\le S_i,T_i\le k$。

发现为了合并还得枚举左边的差为 $a$，右边的差为 $b$，总共就 $O(n^5)$ 了，接下来有两种做法：

- 一个sb的模拟赛考场做法是改变枚举顺序后把 $k,b$ 改为预处理，也即我们完全把左边的情况枚举出来，右边的情况通过提前处理快速得到。

  但由于有偏序 $j\le S_i,T_i\le k$ 的同时还得处理合并得到最大值，预处理过后只好上一棵主席树来快速询问，$O(n^3\log n)$，现在都还没改出来。
  
- 真正的简单的做法是把 $i$ 丢掉，先算 $val_{j,k}$ 的答案，再枚举强制选了 $i$ 的时间点之内 $w_{j,k}$，直接取之前算出来的答案即可。

  然后发现上一个做法一样预处理一下，合并的时候就可以把 $w,a,b$ 丢掉一个 $a/b$，没有偏序于是随便写使用的时候都是 $O(1)$ 的，轻松 $O(n^3)$。
  
[代码轻度压行](https://www.luogu.com.cn/paste/up1ge3yi)