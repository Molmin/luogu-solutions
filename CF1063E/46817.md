我的解法貌似和别的题解都不太一样...

每次考虑对于最靠近发射器的一行，然后把这一行统一作用在激光上，再删掉这一行。

考虑这一行的若干个镜子，我们按照类型划分为若干个极长相同类型的子段。对于每一个子段，某一端的镜子内的东西会被直接扔掉（水平射到两侧）。

手玩不难猜到除了 $\forall i=p_i$，答案为 $n-1$。

我们不妨扔掉 $n$ 再来考虑这个问题。显然每一行的所有镜子类型必须相同，我们设想这样一个解决方案的框架：每次处理完一行后仍然是一个排列且恰有一个位置钦定被扔掉。

由于行数很多，我们考虑每一行只处理一次移动，显然“空位置”必须有一面镜子，因此每行恰有3面镜子。

但我们还需要解决这样一个问题：设空位置为 $pos$，假设我们选择了一个位置 $x$ 使得 $x<pos<p_x$， 那么无法安排合适的镜子。

因此考虑让每次待处理的东西都是一段区间，空位置在区间的两端，每次 $x$ 选择区间的另一端，便不会出现上述问题了。

[提交记录](https://codeforces.com/contest/1063/submission/119542235)