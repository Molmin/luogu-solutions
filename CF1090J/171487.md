我不会 AC 自动机。

容斥，每个串只计算 $t$ 的前缀最短的一次出现。

考虑怎么样会重复。

举个例子（CF test 6）:

```
nn qnnq
nnqnn q
```

观察一下，发现算重与这个 $t$ 前缀的 border 有关。

记 $t$ 的第 $i$ 个前缀为 $T_i$，则重复次数就是 $T_{i-border(i)}$ 在 $s$ 中的出现次数。

预处理一下 $T_i$ 在 $s$ 中的出现次数，可以使用 SAM 或者其他奇奇怪怪的东西，然后上个 KMP 就做完了。


实现细节：由于前缀非空，$s_1$ 必然在结果串里，可以忽略 $s_1$ 后再跑程序。

[code](https://codeforces.com/contest/1090/submission/141794865)