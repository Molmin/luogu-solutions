经典期望 $dp$ 套路。做过 P3750 的应该都会。

注意到如果设 $dp_i$ 表示剩余 $i$ 个字符未匹配的期望次数，则转移时会出现不知道前两项的奇怪的二阶线性递推，需要回带回去解方程，非常麻烦。我们考虑更改定义，设 $dp_i$ 表示剩余 $i$ 个字符未匹配时**多匹配一个字符的期望次数。**

这样的好处是，一次翻转要么直接成功，要么转移到了 $dp_{i+1}$，相当于是一阶线性递推。由于翻转成功则直接结束，反转失败则需要翻转回来，可以列出转移方程：

$dp_i=\frac{i}{n}+\frac{n-i}{n}(1+dp_{i+1}+dp_{i})$。

化简得到

$dp_i=\frac{(n-i)dp_{i+1}+n}{i}$。

初始状态是 $dp_{n}=1$，这样可以倒着解出所有的 $dp_i$。设刚开始有 $k$ 个字符未匹配，则答案为 $\sum\limits_{i=1}^kdp_i$。[代码](https://codeforces.com/contest/1778/submission/210729417)。