似乎没人用 LCT？没卡常的代码就 rk1 了。

随便以一个非叶节点为根从下往上考虑，设每个节点子树内的叶子个数为 $tt_x$。

每条边(设边中的儿子为 $x$)向上传一个叶子，如果 $tt_x$ 为偶数会有一个没配对，得多往上传一个，贡献就为 $1+[tt_x\%2=0]$。

总贡献为 $(\sum_x 1+[tt_x\%2=0])-1-[tt_{rt}\%2=0]$ ，因为根没有到父亲的边贡献所以要减掉。

设 $\sum_x1$，也就是树上的点数为 $n$，把式子化简一下：

原式 $=(n+\sum_x[tt_x\%2=0])-1-[tt_{rt}\%2=0]$

注意到总叶子个数为偶数才能两两配对，故有解时一定有 $[tt_{rt}\%2=0]=1$。

故原式 $=n-2+\sum_x[tt_x\%2=0]$

再看询问，就是到根 $tt$ 加一，全局查询。

树剖+线段树 = 两个数据结构 + 两只 log，LCT = 一个数据结构 + 一只 log，码量和复杂度上看都是 LCT 血赚。

具体实现上更简单，选定根后根不变，Make_root 都不用写，每次 Access 就行了。

注意一下加点后 $n$ 也要加就行了。

[跑得快但不会有人看的代码](https://www.luogu.com.cn/paste/s4lcl28j)