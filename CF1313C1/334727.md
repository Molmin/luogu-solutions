> 首先我们发现，最后的答案一定是一个不降序列加上一个不升序列。

这是大多数题解的第一句话，这篇题解重点来解释为什么。

首先我们把所有楼的高度看成一个曲线在变化。


假设一开始曲线不讲，我们来看（某哥们的 `` CF Rating`` ）变化：

![image.png](https://i.loli.net/2021/03/27/HFfl5pxtEVdviQm.png)

现在我们发现，满足这个要求：

> 另外，这里不可以有整数 $j$ 和 $k$ 满足 $j < i < k$ 并且 $a_j > a_i < a_k$
 。第 $j, k$ 块地并不需要与第 $i$ 块地相邻。
 
如果暂时下降，显然也是满足要求的。

![image.png](https://i.loli.net/2021/03/27/NYds3LfBKvhZ8EX.png)


如果再上升呢？

![image.png](https://i.loli.net/2021/03/27/aPVpu5oglvxKfXT.png)

红笔圈着的点，也就是下降到上升的中转点不满足要求了。

所以我们发现：不能出现 $\text{lower} \to \text{higher}$ 的趋势，即不能先下降再上升。

--------

如果一开始就下降，根据上一条，不能再上升了。

综上所述，最后的答案一定是一个不降序列加上一个不升序列。

我们可以枚举一个最高点 $k$ ，让左右两边分别呈上升和下降的趋势即可。变化 $a$ 数组的伪代码（ $k$ 为当前枚举的最高点）

```
for each i=k-1...1
	if a[i] > a[i+1] then a[i]=a[i+1]
for each i=k+1 .. n
	if a[i] > a[i-1] then a[i]=a[i-1]
```

然后这题就做完了。