### 题解（requese）

我们定义一个数如果已经在自己最后的位置上，那么他的状态是 **done**；如果这个数所处的位置奇偶性与这个数的奇偶性相同，那么他的状态是 **half done**；一个数的**半契合性**表示的是这个数的奇偶性与他所处位置的奇偶性是否相同。

我们考虑两种操作：

1、get，对于一个点，暴力地将其 **done**，一个数get代价约为 $\dfrac{n}{x}+1 \to 0$ 不等；

2、swap，花 $4$ 的代价，交换距离为 $2$ 的两个数，并不打乱其他数的顺序。以下给出一例：

```
取 x=5：
1 2 3 4 5 8 7 6
reverse(2,7):
1 7 8 5 4 3 2 6
reverse(3,8):
1 7 6 2 3 4 5 8
reverse(2,7):
1 5 4 3 2 6 7 8
reverse(2,5):
1 2 3 4 5 6 7 8
```

3、change，花 $2$ 的代价，改变 $2$ 个相邻位置上的数的半契合性，并不打乱其他数的半契合性。以下给出一例：

```
取 x=7:
1 2 3 4 5 6 8 7
reverse(1,8):
7 8 6 5 4 3 2 1
reverse(3,8):
7 8 1 2 3 4 5 6
```

于是，我们考虑进行以下步骤：

对于数 $1\to (n-\dfrac{3}{2}x-1)$​​​​​​​​ ，我们将他们 **get**，总次数约为 $\dfrac{n^2}{2x}$​​​​​；

对于数 $(n-\dfrac{3}{2}x) \to n$，我们用 **swap** 将尽可能多的 **half done** 的数都尽可能的往左，使得最后前面 $y$ 个位置全为 **half done** 状态的数，后面 $n-y$ 个位置全部是**非 half done** 状态，总次数约为 $\dfrac{9x^2}{4}$；

然后由于**非 half done** 状态是成对出现的，在此我们考虑：如果**非 half done** 状态个数 $\ge x+1$，那么我们可以用一次翻转操作使得前 $x+1$ 个**非 half done** 状态变为 **half done** 状态；此时如果 **非half done** 状态个数 $\ge \dfrac{x+1}{2}$，那么我们可以再对最后 $x+1$ 个数进行一次翻转，这样 **非half done** 状态个数 $\le \dfrac{x+1}{2}$；

接着我们对后面 **非half done** 状态的数使用 $\dfrac{n-y}{2}$ 次 **change** 操作，总次数约为 $\dfrac{1}{2}x$，此时所有数都是 **half done** 状态；

最后由于后面 $\dfrac{3}{2}x$​ 个数还不是 **done** 状态，所以我们暴力地用 **swap** 将这些数类似于插入排序一下，总次数约为 $\dfrac{9x^2}{4}$​​，此时所有数都是 **done** 状态；

用均值不等式平衡一下，在 $x=\sqrt[3]{\dfrac{n^2}{18}}$​​​ 时较优，最大约为 $19700$​​​ 次；实际上由于前面几个有互相制约性（即一个取满另一个很可能取不满），~~也很难造很卡的数据，~~实际表现远低于 $20000$​​​。

时间复杂度 $O(20n^2)$。

---

upd3.20：

事实上如果我们在一开始加上一定数量的随机翻转区间操作，实际表现甚至不到 $15000$ 步。