将斜率看做点，给的点看做边，那么给点 $(x,y)$ 表示在 $\frac{x+1}{y}$ 与 $\frac{x}{y+1}$ 之间连一条边。问题变为给一张无向图，每次将两有公共端点的边删除，问最多删除多少次。

容易猜出对于每个连通块，若它含 $e$ 条边则能匹配到理论最大值：$\lfloor \frac{e}{2}\rfloor$ 对边。

然后我卡了好久，最后得到了一个简单的处理方法：对于一个连通块求出它的一棵生成树，然后对于一条从 $u$ 到 $u$ 的祖先 $v$ 的返祖边 $(u,v)$，我们把这条边变成 $(u,v')$，其中 $v'$ 是 $u$ 的一个新的儿子。我们发现这个问题实际上是被加强了，因为本来边 $(u,v)$ 可以同时和端点为 $u$ 或 $v$ 的边匹配，但现在它只能和端点为 $u$ 的边匹配了。

但其实这个问题的难度变简单了，因为现在每个连通块都是一棵树。给每个连通块都定一个根，令 $K_u$ 为 $u$ 到父亲节点的边的编号。考虑每次找到深度最深的点 $u$，如果它有兄弟节点 $x$ 则匹配 $(K_u,K_x)$，否则匹配 $(K_u,K_{fa_u})$。

$O(n\log n)$，实现精细一点可能可以 $O(n)$ 吧我也不太清楚。