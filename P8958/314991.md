感觉这题比 T1T2 简单。。

首先题目要求的就是对长为 $2n$ 的每一个合法括号序列中，配对的左右括号权值乘积之和求和。这种对和再求和很容易想到拆贡献，考虑计算 $a_xa_y$ 的贡献，也即有多少个合法括号序列满足位置 $x$ 和位置 $y$ 上的括号是配对的。这要求 $(x,y)$ 和 $[1,x)\cup(y,2n]$ 分别是合法括号序列，那么答案就是 $H_{\frac{(y-x-1)}{2}}H_{n-\frac{(y-x+1)}{2}}$。显然这个值只与 $l=y-x$ 的值有关，那我们只需对每一个 $l$ 求出 $\sum_{y-x=l}a_xa_y$ 就行了。这是一个差卷积的形式，翻转一下再 NTT 卷起来即可。复杂度 $O(n\log n)$。