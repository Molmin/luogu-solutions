乍一看好像很难，转化完了后简单的离谱，代码就5行。

貌似方法和别的题解不一样。

两人操作的过程实际上就是对原序列进行减少或增加逆序对的个数，Jeff每次操作会减少一个逆序对，Furik每次操作有 $\frac{1}{2}$ 的概率减少一个逆序对，有 $\frac{1}{2}$ 的概率增加一个逆序对。

定义 $dp[i]$ 表示当前还剩 $i$ 个逆序对，距离游戏结束的期望步数为多少，如果此时是先手操作，有转移：
$$
dp[i]=dp[i-1]+1
$$

表示Jeff花了一步减去一个逆序对。

当是后手操作时，有转移：
$$

dp[i]=\frac{1}{2}(dp[i-1]+1)+\frac{1}{2}(dp[i]+2)

$$

相当于花一步增加一个，对方又花一步减回来了。

把上面的式子转一下就变成：
$$
dp[i]=dp[i-1]+3
$$

考虑先后手问题，注意到后手的移动并不会改变二者先后手与逆序对奇偶性的相对关系，二者奇偶性相同时是先手，反之是后手。

短的离谱的代码：
```cpp
#include <bits/stdc++.h>
int dp[3010*3010],a[3010],n,cnt;
int main(){
    scanf("%d",&n);
    for(int i=1;i<=n;i++) scanf("%d",&a[i]);
    for(int i=1;i<=n;i++) for(int j=i+1;j<=n;j++) if(a[i]>a[j]) cnt++;
    for(int i=1;i<=cnt;i++) dp[i]=dp[i-1]+((i%2==cnt%2)?1:3);
    printf("%.6lf\n",(double)dp[cnt]);
    return 0;
}
```
