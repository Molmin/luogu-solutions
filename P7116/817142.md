只要有信念，就一定会成功！

### [题意](https://www.luogu.com.cn/problem/P7116)
在 $k$ 维长方体中你规划了一个行进路线，循环往复，直到走出这 $k$ 维长方体，才算走完。

问以这 $k$ 维长方体中的每一个位置为起点，你是否都能走完，如果能，输出你走的步数之和。

### 分析
长方体实在是太大了！如果直接枚举复杂度 $O(w^k)$ 起步十分低效。

因此不难想到应该枚举路径长度，根据每个维度的位移，不仅可以判断是否循环，还可以直接判断有多少个位置可以走这么多步。

但是你发现循环之后可能还有位移，所以步数的上界可达 $O(nw)$，只能写出 $O(nwk)$ 的暴力，[代码](https://www.luogu.com.cn/paste/w6jlv2r7)，可得 $45$ 分，利用逆元或许可以达到 $O(nw)$，但是已经无关紧要。

考虑如何优化，应该严谨地形式化问题，设 $l(i,j)$ 为走 $i$ 步，第 $j$ 维走到的相对最低位置，$r(i,j)$ 为走 $i$ 步，第 $j$ 维走到的相对最高位置，$a_j$ 为走 $n$ 步，第 $j$ 维的位移与 $0$ 取 $\min$，$b_j$ 为走 $n$ 步，第 $j$ 维的位移与 $0$ 取 $\max$。

那么对于走 $m$ 步的情况，如果没有特判得到方案数为 $0$，那么一定有方案数为：
$$F(m)=\prod_{i\ne c_m}(w_i-r(m,i)+l(m,i))$$
而由于走的向量关于 $n$ 循环，则一定有：
$$r(kn+i,j)=(k-1)\cdot b_j+\max(r(i,j)+b_j,r(n,j))$$
$$l(kn+i,j)=(k-1)\cdot a_j+\min(l(i,j)+a_j,l(n,j))$$
而且容易发现，如果走 $n+i$ 步有方案，那么 $i$ 步也一定有其方案贡献，因此设：
$$G(x,y)=\sum_{i=0}^x(in+y)F(in+y)$$
直接暴力算这个可以得到 $80$ 分，令我很疑惑，[代码](https://www.luogu.com.cn/paste/1j2gex5l)。

那么对于单个 $i$ 而言，$F(in+y)$ 可以理解为关于 $i$ 的 $k-1$ 次多项式，而对于 $G(x,y)$ 而言，在 $x$ 为非负整数的时候，可以将 $G(x,y)$ 理解为关于 $x$ 的 $k+1$ 次多项式，因此只需要求出 $x$ 在 $0$ 到 $k+1$ 处的点值即可使用拉格朗日插值插出 $G(x,y)$ 的取值，复杂度为 $O(nk^2)$，[代码](https://www.luogu.com.cn/paste/lgwdhybb)。