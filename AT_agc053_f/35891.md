转化题意：

容易发现，设 $t$ 时刻是最后一个时刻，使得 $A/B$ 投票数量相等。

在 $t$ 时刻前投票的超能力者有 $0.5$ 的概率 win，$t$ 时刻后投票的超能力者一定 win。

于是只需计数前 $t$ 时刻投票的超能力者数目。

我们用另外一个序列来帮助我们计数。

考虑序列 $a$，如果第 $i$ 个投票的投给了多数，$a_i$ 就为 $1$，否则为 $-1$。（如果二者票数一样，如果投票者不是超能力者则有一半概率为 $1$）

那么一个合法的 $a$ 序列形如：

$$
S_0,-1,S_1,-1,\cdots,-1,S_x,1,S_{x+1},1,\cdots,1,S_{x+y}
$$

其中 $S$ 是一个串，满足最长的前提下，每个前缀和都非负，且和为 $0$。

从 $a$ 序列，我们可以唯一得到 $S$。

接下来我们需要计算：

1. $x,y$ 的选择方案。
2. 选出超能力者。
3. 前 $t$ 时刻投票的超能力者数目。
4. 得到原串的概率。
5. 从原串得到 $a$ 序列的概率。

考虑到超能力者只可能对应 $1$，考虑这个序列中 $1$ 的出现次数。

容易发现出现了 $w=\dfrac{2n+1-x+y}{2}$ 个 $1$。

所以选超能力者的方案数是 $\binom{w}{k}$。

另外，考虑每个非超能力者的贡献。

如果一个非超能力者投票时，票数不同则为得到原串的概率贡献 $1/2$，否则为得到 $a$ 序列的概率贡献 $1/2$，因此这部分的贡献是：$\dfrac{1}{2^{2n+1-k}}$。

接下来考虑 $t$ 的取值。

容易发现，在 $S_x$ 之前，每两个 $-1$ 两边就平票了。

经过仔细分析，可以发现：

如果 $x$ 是偶数，那么 $t$ 就是 $S_x$ 的结尾。
否则，$t$ 是 $S_{x-1}$ 的结尾。

而它们中出现 $1$ 的期望数量就是：

$\dfrac{(x+1)(2n+1-x-y)}{(x+y+1)}$ 或者 $\dfrac{x(2n+1-x-y)}{(x+y+1)}$。

而总 $1$ 个数为 $2n+1-x+y$，因此贡献为：

$\dfrac{(x+1)(2n+1-x-y)}{(x+y+1)(2n+1-x+y)}$ 或者 $\dfrac{x(2n+1-x-y)}{(x+y+1)(2n+1-x+y)}$。

我们还需要考虑最后一项，即 $S$ 的选择方案数。

$S$ 是有强大的组合意义的，在两项 $S$ 中插入一个 $1$，易证方案数为从 $(0,0)$ 走斜线到 $(2n+1,x+y)$ 的方案数。

即 $\Large{\binom{2n+1}{\frac{2n+1-x-y}{2}}-\binom{2n+1}{\frac{2n-1-x-y}{2}}}$。

综合起来，由于为每个原串分配超能力者的概率为 $\dfrac{1}{\binom{2n+1}{k}}$，把前面全部乘起来得到：

$$
\text{let } w=\dfrac{x+y-1}{2}:
$$

$$
Ans=\sum_{x,y}\dfrac{(2n+1-x-y)\binom{\frac{2n+1-x+y}{2}}{k}}{(2n+1-x+y)\binom{2n+1}{k}2^{2n+1-k}}
(\binom{2n+1}{n-w}-\binom{2n+1}{n-w-1})
\times
\begin{cases}
\frac{x}{x+y+1}&\text{x 是奇数}\\
\frac{x+1}{x+y+1}&\text{x 是偶数}
\end{cases}
$$

我们只需枚举 $x,y$ 即可得到答案。

整理上式，其实我们只需求：

$$
\dfrac{1}{\binom{2n+1}{k}2^{2n+1-k}}\sum_{x=2t+1,y}\dfrac{x(n-w)\binom{\frac{2n+1-x+y}{2}}{k}}{(w+1)(2n+1-x+y)}
(\binom{2n+1}{n-w}-\binom{2n+1}{n-w-1})
$$

为了方便，只讨论 $x$ 为奇数的情况。

我们有 $y=2w+1-x$，带入得：

$$
\dfrac{1}{\binom{2n+1}{k}2^{2n+1-k}}\sum_{w}\dfrac{x(n-w)\binom{n+w-x+1}{k}}{(w+1)(2n+2w-2x+2)}(\binom{2n+1}{n-w}-\binom{2n+1}{n-w-1})
$$

$$
=\dfrac{1}{\binom{2n+1}{k}2^{2n+1-k}}\sum_{w}\dfrac{(n-w)}{(w+1)}(\binom{2n+1}{n-w}-\binom{2n+1}{n-w-1})\sum_{x=2t+1\leqslant 2w+1}\dfrac{x\binom{n+w-x+1}{k}}{2(n+w-x+1)}
$$

对后面一坨吸收，可以预处理后 $O(1)$ 计算，因此总复杂度 $O(n)$，可以通过此题。

整理一下，我们需要对后面这部分预处理：

$\sum_{x=2t\leqslant 2w+1}\dfrac{x\binom{n+w-x+1}{k}}{2(n+w-x+1)}=\dfrac{1}{2k}\sum_{x=2t+1\leqslant 2w+1}x\binom{n+w-x}{k-1}$

在 $k$ 固定时，我们维护：

$S1_n=\sum\limits_{i=2t+1}^n \binom{i}{k-1}$
$S2_n=\sum\limits_{i=2t+1}^n i\binom{i}{k-1}$

然后就有 $\sum_{x=2t+1\leqslant 2w+1}x\binom{n+w-x}{k-1}=(n+w)(S1_{n+w-1}-S1_{n-w-3})-(S2_{n+w-1}-S2_{n-w-3})$。

同样处理偶数情况。
