### 题意

给定 $n,k$，求有多少满足以下条件的序列 $A$：

- 对于 $1\leq i\leq n$，$0< A_i< 2^k$。

- 对于 $1<i\leq n$，$B_i>B_{i-1}$。

其中 $B_i$ 为 $A_i$ 的前缀或。

$\texttt{Data Range:}1\leq n\leq 10^{18},1\leq k\leq 3\times 10^4$。

### 题解

题单里的题都做不出来了，这就是我吗/dk

到了最后一步想到了各种东西却想不到倍增，这就是我吗/dk

~~也有可能是自己作死之前学题解做法现在记不起来 自己 yy 了个做法发现做到最后不会了~~

由于某些位如果这 $n$ 个数上这一位都为 $0$ 也能合法，所以先考虑一个弱化的版本：对于每个位，$n$ 个数中至少有一个满足这个位为 $1$。

首先题目的限制相当于对于任意的 $1\leq i\leq n$ ，总存在一个 $j$ 使得前 $i-1$ 个数中的第 $j$ 位都为 $0$，且第 $i$ 个数的第 $j$ 位为 $1$。

所以考虑对于每个数，枚举有多少这样的位。设 $a_i$ 表示第 $i$ 个数中某个位为 $1$ 且前 $i-1$ 个数中某个位为 $0$ 的位的数量，那么显然要满足 $a_i>0$，同时 $a_i$ 的和为 $k$。

考虑第 $i$ 个数中满足条件的 $a_i$ 个位在 $n$ 个数中的填法。首先前 $i-1$ 个数这个位必须取 $0$，然后这个数的这个位必须去 $1$，后面的 $n-i$ 个数的这个位可以任选，所以可以算出这 $a_i$ 个位的贡献，进而推出总的贡献为：

$$\sum\binom{k}{a_1,\cdots,a_n}\prod2^{a_j(n-j)}$$

其中和式枚举的是所有满足条件的序列 $a$。

拆掉多项式系数则可以表示为

$$k!\sum\prod\frac{2^{a_j(n-j)}}{a_j!}$$

如果写的好看一点就是

$$k!2^{nk}\sum\prod\frac{1}{a_j!2^{ja_j}}$$

由于 $\sum a_j=k$，右边的一大坨东西实质上就是 $n$ 个序列的卷积。

考虑对右边使用 GF，注意到

$$\sum\frac{x^i}{i!2^{it}}=e^{\frac{x}{2^t}}$$

但是当 $a_j=0$ 时不合法，贡献为 $0$，所以需要减掉常数项，即

$$\prod_{i=1}^{n}\left(e^{\frac{x}{2^i}}-1\right)$$

~~然后我就不知道这个东西怎么求了~~

设 $F_n(x)$ 为这个式子，那么这个式子可以倍增。具体而言即

$$F_{2n}(x)=F_n(x)F_n\left(\frac{x}{2^n}\right)$$

然后就能方便转移了！但是如果存在若干位置使得没有数在这一位上取 $1$ 又该怎么办呢？这里直接将这些位置枚举出来然后算一下就好了，复杂度 $O(k\log k\log n)$。

代码就不放了，毕竟之前写的东西是学的题解做法，又不是自己现在的做法。