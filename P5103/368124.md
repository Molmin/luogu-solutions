[题目链接](https://www.luogu.com.cn/problem/P5103)

首先发现斜着平移比较难处理，所以考虑将平面逆时针旋转 $45^\circ$。

接着发现风化也不好处理，但是风化的一定不会作为答案，所以我们可以离线，然后倒着处理操作，上升变为下降。

![](https://cdn.luogu.com.cn/upload/image_hosting/qm4ccssg.png)

我们发现每个初始 $0$ 点最后的坐标就是它正着做时初始的坐标，且每次操作都只会将连续一段点的 $x,y$ 坐标修改。

我们可以开两棵线段树，一棵维护 $x$ 坐标，一棵维护 $y$ 坐标。

容易发现，操作规律：

对于操作一，将维护 $y$ 坐标的线段树中所有 $x$ 坐标小于 $x_i$ 的 $y$ 坐标减去 $2 \cdot d_i$。

对于操作二，将维护 $x$ 坐标的线段树中所有 $y$ 坐标大于 $x_i$ 的 $x$ 坐标增加 $2 \cdot d_i$。

至于为什么乘二，是因为旋转后中间有空隙。

但是我们发现这个修改位置无法直接确定，于是我们可以在线段树上二分修改的位置。当修改 $y$ 坐标时，我们在 $x$ 线段树上二分小于 $x_i$ 的最大的 $x$，当修改 $x$ 坐标时，在 $y$ 线段树上二分大于 $x_i$ 的最小的 $y$。

至于为什么能二分：

显然相邻的两个 $0$ 的 相对位置是不变的，所以小于一个值的坐标一定在一个区间内。

二分到位置后修改，注意到有可能搜不到这个点，此时不修改就行了。