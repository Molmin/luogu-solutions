二合一！但是这怎么想到能二合一的，太谔谔了！

我们先考虑不管组别了，把人分到红蓝两边使得方案满足第二个条件。那么这时候有个显然的贪心，从 $1$ 到 $n$ 扫每一个人，看当前哪一方有更多他讨厌的人然后把他扔过去。这样的话，我们发现放每个人的时候都有至少一半上取整的边被卡在红蓝之间了，而且把每个人都扫一遍之后所有边都被考虑过了。耶！

然后我们考虑把人分队。我们把所有的队伍随机分到红蓝两边，每个队伍有 $\frac{1}{2}$ 的概率去红方，有 $\frac{1}{2}$ 的概率去蓝方。如果这样分完了之后每个人还能在自己这边找到一个自己想加入的队伍，那我们的构造就完成了。

可以证明，这样随机分配的成功率很高。如果一个人失败，说明他想加入的至少 $16$ 个队伍都没有在自己的这一边，这种情况发生的概率是 $\frac{1}{2^{16}}= \frac{1}{65536}$。~~所以所有 $5\times 10^4$ 个人都成功的概率为 $(1-\frac{1}{65536})^{50000} \approx 46\%$。所以你多随几次之后，就有解了。/tiao~~

修改：这么算是错的，被别的老哥教做人了，因为有人问，有没有可能构造数据使得必定无解。然后我就被搞蒙古了 /cf。

因为，对于一种方案，第一个人失败和第二个人失败并不是独立的！所以我们假装对于任意一种方案，仅有一个人失败，这种情况显然最劣。一个人的失败率是 $\frac{1}{65536}$，所以总失败率至多为 $\sum_{i=1}^{50000}\frac{1}{65536} \approx 76\%$，所以成功率至少还有 $24\%$。这样不仅可以证明不可能无解，也可以证明在较少的次数之后一定能随出来解。