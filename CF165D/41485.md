- ~~最近发现很多树链剖分的题目都可以使用O(mlogn)的DFS序解法~~
## 正题
- 在阅读本题解前，请确保自己已经会这题的$O(mlog^2n)$做法
- 通过仔细阅读题目，我们发现这道题需要我们干三件事
   1. 给树上的一条边+1，或-1
   2. 求树上的路径和
   3. 求树上路径长度
- 首先3就是 $dep[x]+dep[y]-2*dep[LCA(x,y)]$,使用树链剖分求LCA可以做到$O(mlogn)$
- 而1,2操作如果直接使用树链剖分是$O(mlog^2n)$的(参见树链剖分模板)，也是这题的瓶颈所在，那么有没有$O(mlogn)$的解法($LCT$常数大，可能还不如树剖)呢？
- 事实上是存在的，我们考虑以下三件事：
   1. $valsum(x,y)$
   $=valsum(x,LCA(x,t))+valsum(y,LCA(x,y))$
   $=valsum(x,1)-valsum(LCA(x,y),1)+valsum(y,1)-valsum(LCA(x,y),1)$
   2. 由于子树的$DFS$序连续，所以使用树链剖分解决树上的单点修改，查询子树和的题目可以$O(mlogn)$
   3. 以下两个问题是等价的
      1. 操作1：给点$x$的值加$a$，操作2：查询点$y$到点$1$的和
      1. 操作1：给以$x$为根的子树加$a$，操作2：查询点$y$的值
- 接下来，我们就可以$O(mlogn)$解决树链剖分问题了