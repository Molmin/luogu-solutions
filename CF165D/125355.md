# 题目

[传送门](https://www.luogu.com.cn/problem/CF165D)

# 题解

这类题目，不多说可以直接上树剖板子，时间复杂度 $\mathcal O(n\log ^2n)$，此处不作过多赘述，毕竟重点不是这个方法。

实际上我们有比树剖的俩 $\log$ 更优的解法，但是还是利用线段树。

分析这道题实际要我们干的事是什么：

1. 能够任意改边的颜色；
2. 询问俩点之间的距离，以及俩点路径上黑边的数量；

由于所有的工作都是为询问服务，我们先考虑怎么解决询问。

由于是询问两点之间的距离，以及黑边数量，我们能够联想到 $lca$，从 $lca$ 的角度来说，对于距离是很好解决的，但是黑边数量？我们可以用类似求距离的方法，来求黑边的数量，考虑有这样的一个变换：
$$
\text{cnt_black}(u,v)=\text{cnt_black}(u,1)+\text{cnt_black}(v,1)-\text{cnt_black}(lca,1)
$$
也就是说，只要我们可以维护一个点到根节点的黑边数量，我们便亦能求得两点间黑边数量，考虑对于一条边 $(u,v)$（假定 $v$ 更深），如果这条边变黑，即相当于 $v$ 子树内部整体到根的黑边数加一，对于黑变白同理，所以我们可以先得到每个点的 $dfs$ 序，再用线段树维护黑边数即可，时间复杂度 $\mathcal O(n\log n)$.

# 代码

```cpp
https://www.cnblogs.com/Arextre/p/13552974.html
```

