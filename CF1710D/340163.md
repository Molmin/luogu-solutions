这题是在模拟赛上遇到的，有一些不太显然的思路从部分分得到。

首先有一些比较显然的观察（比如直接搞出一条边的条件一类杂而无用的结论），从这些冗杂的结论中看不出任何的可能性，先研究一下样例。

注意到最后一个样例的构造的边，$v-u$ 的值是不减的。出题人故意调整成这个样子显然说不过去……不如往这方面思考。具体的，我们猜测构造方法是从小到大枚举 $v-u$ 的差值构造方案。实际上还能有另一个发现，也即 $(u,v)$ 这个点对应的 $a_{u,v}=1$。

但是仍然不好构造，观察部分分：只有 $n+1$ 个点值为 $1$。这 $n+1$ 个点指的当然是 $n$ 个 $(i,i)$ 以及 $(1,n)$。用手模拟出一个通用的构造方案是：以 $n$ 为根，$1,2$ 为 $n$ 的儿子，其他点为 $1$ 的儿子。容易发现这显然满足条件。

那么再回到这个问题。那么对于一个单独的满足上述限制的包含的结点编号连续的连通块，我们可以使用上面的方法单独构造了。

那么现在整个序列使用上面的方法之后，被拆成了很多个相邻的连通块（当然，$n=3$ 的时候只可能会被拆成两个连通块，但并不影响），现在需要对连通块进行合并。使用之前的发现，从小到大枚举 $v-u$ 的差值进行构造，并且在 $a_{u,v}=1$ 的时候进行一些处理。

如果此时 $u,v$ 不属于同一个连通块，先证明两个连通块 $A,B$ 之间没有其他的连通块。可以形象的理解，假设中间还有另外一个连通块 $C$，那么 $C$ 一定在 $A,B$ 两者间选一个连边。注意到我们是从小到大枚举的差值，那么 $C$ 已经被合并到两者中的一个了。因此 $A,B$ 之间不存在连通块。

再提出一个引论是，对于两个连通块 $A,B$，若 $A \cap B \neq \varnothing$，则 $A \cap B, A \cup B$ 均为合法的连通块，这个结论证明并不困难，不再赘述。这同时引出了我们接下来的构造方法。

假设 $u$ 所在的连通块为 $[l_u,r_u]$，$v$ 所在的连通块为 $[l_v,r_v]$，同时满足 $[u,v]$ 也是连通块。首先可得 $[u,r_u],[l_v,v]$ 是两个合法的连通块，连接 $u,v$ 符合条件，充分性可得。

然后是必要性，不妨先固定边的一个端点为 $u$，另一个端点为 $v'$，若 $v'>v$，则不满足条件；$v'<v$，则会在差值更小的时候 $A,B$ 合并，不符条件。不固定 $u$ 固定 $v$ 的情况同理，同时需要证明两个端点都不在 $u,v$ 上的情况，这个假的比较离谱，就不再多说了。

那么问题就解决了。可能比较突兀，总结一下具体的思路：

- 从小到大枚举边两个端点的差值，判断是否需要建边；   
- 如果需要合并两个连通块：
  - 如果中间有其他的连通块：一定满足一开始说的一种特殊情况，属于边界，可以采取上面的方法构造；   
  - 如果中间没有其他的连通块：连接 $u,v$ 即可。

[测评链接](https://codeforces.com/contest/1710/submission/174689957)。

```cpp
vector<P> Ans;
int a[2005][2005];
int n;
int L[2005],R[2005];
void Solve()
{
	Ans.clear();
	n=read();
	for(int i=1;i<=n;++i)
	{
		for(int j=i;j<=n;++j)
		{
			char c=getchar();
			while(c<'0' || c>'9')	c=getchar();
			a[i][j]=c^'0';
		}
	}
	for(int i=1;i<=n;++i)	L[i]=R[i]=i;
	for(int d=1;d<n;++d)
	{
		for(int u=1;u+d<=n;++u)
		{
			int v=u+d;
			if(a[u][v] && L[u]!=L[v])
			{
				Ans.push_back(mp(u,v));
				bool f=false;
				for(int i=R[u]+1;i<L[v];++i)
				{
					if(L[i]==i)
					{
						if(f)	Ans.push_back(mp(u,i));
						else	Ans.push_back(mp(v,i));
						f=true;
					}
				}
				int l=L[u],r=R[v];
				for(int i=l;i<=r;++i)	L[i]=l,R[i]=r; 
			}
		}
	}
	for(P st:Ans)	write(st.first),putchar(' '),write(st.second),puts("");
}
```
