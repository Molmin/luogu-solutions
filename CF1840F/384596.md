> ~~你指尖跃动的电光，是我此生不变的信仰，唯我……~~

啊不对，放错了。

---

这题有一个结论：如果可行，总时间不超过 $n+m+r$。可惜笔者很菜不会证，官方题解中也没有证明。**不过本篇题解不需要用到这个结论！**

显然可以先将射击按时间排序，将相同时间的一起处理。每次处理时，假设上一步的时间为 $t_1$，上一次处理之后的地图为一个 0/1 二维数组 $p$（$p_{i,j}$ 为 $1$ 代表这个位置可以到达，为 $0$ 代表到达不了），这一次的处理时间为 $t_2$，处理之后的地图（即本次的所求）为 $g$。

假设存在 $i,j$，使 $p_{i,j}=1$ 且 $(n-i)+(m-j)<t_2-t_1$，即在上次射击之后的 $(i,j)$ 这个点可以在这次射击之前（不含）就到终点。那么暴力找出满足条件且 $(n-i)+(m-j)$ 最小的 $i,j$，答案即为 $t_1+(n-i)+(m-j)$。

否则，在这个时间之前（不含）必然到不了终点。

注意：上面这一步需要在所有射击都处理完后再做一次。因为有可能所有在最后一次射击所在时间及其之后到达终点。

那么就需要先求出到这个时间并且假设不射击时的地图 $g'$。

构造辅助 $dp$ 数组：

$$dp_{i,j}=\max\{dp_{i-1,j}-1,dp_{i,j-1}-1,p_{i,j}\times(t_2-t_1+1)\}$$

其中若 $dp_{i,j}>0$，则代表这个点最早会在 $t_2+1-dp_{i,j}$ 这个时间到达；若 $dp_{i,j}=0$ 则代表这个点不能在 $t_2$ 之前（含）到达。

则：

$$g'_{i,j}=\begin{cases}0\ \ \ \ \ dp_{i,j}=0\\1\ \ \ \ \ dp_{i,j}>0\end{cases}$$

那么对于 $g$，只用把这回合会被~~超~~电磁炮打到的地方设为 $0$，其它地方设为 $g'_{i,j}$ 即可。

---

upd 2023/6/10：之前写的有点细节上的小问题。改完重交。