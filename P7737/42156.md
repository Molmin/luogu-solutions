先观察题目给的条件，显然缩了点不影响可达性，那就先缩点。

设有两条边（缩了点之后）$(y,x),(z,x)$，那根据题目要么 $y$ 能到 $z$ 要么 $z$ 能到 $y$。不妨设 $y$ 能到 $z$，则此时删去 $(y,x)$ 一定不影响连通性。

因此，设一个点 $x$ 有几条入边 $(a,x),(b,x),\dots$，**只保留起点拓扑序最后的入边一定不影响连通性。**

根据以上性质，可以把整个图缩成一个有向图，每个点入度都至多为 $1$，这就是树。因此只需要解决 $m=n-1$ 的情况即可。

-  $K=0$：直接判断 $y$ 在不在 $x$ 子树里，在就输出 $x,y$ 链上强联通分量大小之和。
-  $K=1$：设加了 $(p,q)$，分两种情况，走了这条边或者不走这条边，稍微讨论下，留作练习。
-  $K=2$：可以证明要走过每个可能走过的点，每条新加的边至多走两次。分类讨论是怎么走的，及走的顺序。具体地有以下几种情况：
    - 不走新加的边。
    - $x$ 经过某一条新加的边走到 $y$。
    - $x$ 按顺序经过第一条新边、第二条新边（或相反）走到 $y$。
    - $x$ 先走到 $y$，然后经过 $1$ 或 $2$ 条新边绕一圈走回 $x$ 再走到 $y$。
    - $x$ 先走到 $y$，然后经过 $1$ 或 $2$ 条新边不经过 $x$ 绕一圈。
    - $x$ 先经过 $1$ 或 $2$ 条新边不经过 $y$ 绕一圈，然后走到 $y$。
    - $x$ 先走到某个新边的起点，在这个点经过 $1$ 或 $2$ 条新边不经过 $x,y$ 绕一圈，然后走到 $y$。
    
把以上所有情况可能经过的链求并，并上的点数就是答案。使用虚树/树剖都可以做到 $O(n\log n)$，常数不大。