首先考虑钦定一个根，使得树的形态更清晰。

于是我们枚举一个点集 $S$，使得 $S$ 内的点和父亲间的边是 x->fa。

先考虑连 x->fa 的边的方案数，再考虑此基础上连 fa->x 的方案数。

第一部分的方案只和 $|S|$ 大小相关，所以我们考虑 $n$ 个点，连了 $|S|$ 条 x->fa 边的森林一共有多少个，再除以 $\tbinom{n}{|S|}$ 。

考虑构造超级点 $0$ ，使森林内每棵树的根连向 $0$ ，则变成 $n+1$ 个点，$0$ 的度数为 $n-|S|$ 的方案数。 

使用 prufer 序列处理这个问题，易得 $\tbinom{n-1}{n-|S|-1}n^{|S|}$ ，除掉 $\tbinom{n}{|S|}$ 得到 $n^{|S|-1}*(n-|S|)$ 。

第二部分，考虑依次连每一条边，你发现边是无序的，影响了计数。所以我们给边打上标号，一开始连 x->fa 的时候要乘上 $\prod\limits_{i\in S} d_i$ 。

然后这剩下 $n-|S|-1$ 条边，它们的方案数与起点无关，并且每连一条边，终点的个数就会 -1 。所以这里方案就是 $(n-|S|-1)!$ 。

所以一个集合 $|S|$ 的答案就是 $\frac{1}{n\prod d_i!}\prod\limits_{i\in S} d_i\ (n-|S|-1)!(n-|S|)n^{|S|-1}=\frac{1}{n\prod d_i!}\prod\limits_{i\in S} d_i\ (n-|S|)!n^{|S|-1}$ 。

发现除了 $\prod\limits_{i\in S}d_i$ ，其他项只与 $|S|$ 有关，于是利用分治 NTT 求出 $\prod (1+d_ix)$ 即可方便计算答案。