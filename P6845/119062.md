边权转点权，再放到欧拉序上以后，发现变成一个区间问题。其中每个点维护原树上到根节点的边权和。设这个序列为 $\{a\}$。

不难发现这时某两个点 $x,y$ 的 LCA 必然在对应一个在序列上的极小包含这两个点的区间上，并且权值最小。所以钦定一个最小值。若不是 LCA 贡献的，必然比答案劣。于是转换成 

$$\max_{l,r}\{ a[l] +a[l]-2 \min_{l\le i\le r} a[i]\}$$

这样一个问题。于是用线段树用类似最大子段和的方法在 $[l,r]$ 维护这样几个信息。其中 $mid = \lfloor \dfrac{l+r}{2}\rfloor$

- $\max_{l\le i \le r}a[i]$
- $\min_{l\le i \le r}a[i]$
- $\max_{l\le i\le mid,mid+1 \le j\le r}a[i]-2a[j] $
- $\max_{l\le i\le mid,mid+1 \le j\le r}-2a[i]+a[j] $
- $\max_{l,r}\{ a[l] +a[l]-2 \min_{l\le i\le r} a[i]\}$

由于每个点维护的是点到根的路径，不难发现修改一条边，也就是线段树上两个节点，会影响所谓“极小的区间”里的权值。具体体现为区间覆盖。



