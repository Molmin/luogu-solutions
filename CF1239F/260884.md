- 本来不敢发题解，只用作自己记录下（主要是作者太菜了）。
- 但后来想想，算了，笔者做出这题已经很悬了。
- 请把我的题解置于那位大佬的下方。
- 说句闲话，[笔者的童年](https://baike.baidu.com/item/%E7%88%B1%E6%8E%A2%E9%99%A9%E7%9A%84%E6%9C%B5%E6%8B%89/7158373)。

**题意**
- [题目链接](https://www.luogu.com.cn/problem/CF1239F)。
- 给一个无重边自环的无向连通图，删除一部分点但不删完，要求剩余的点在模 $3$ 意义下不变，如果可行构造一个方案。
- $\sum|V|,\sum|E|\le 5\times 10^5$。

**A**
- 最简单的情况。
![](https://cdn.luogu.com.cn/upload/image_hosting/ujbxoc46.png)
- 如果有一个度数模 $3$ 为 $0$ 的点，删掉其它点。
- 剩下的图满足性质：不存在模 $3$ 为 $0$ 的点。

**B**
- 我一开始根本没有想到。
![](https://cdn.luogu.com.cn/upload/image_hosting/xr3b6olb.png)
- 如果有两个度数模 $3$ 为 $1$ 的点，且存在一条只经过模 $3$ 余 $2$ 的路径，且路径内部没有其它边（显然最短路满足要求），删掉其他点。
![](https://cdn.luogu.com.cn/upload/image_hosting/vx4ckmrn.png)
![](https://cdn.luogu.com.cn/upload/image_hosting/2ezdat4l.png)
- 由于图连通，如果有两个度数模 $3$ 余 $1$ 的点，必然存在可行解（考虑路径中间经过一个模 $3$ 余 $1$ 的点的情况，这时你已经得到了满足要求的路径）。

**C**
- 如果度数模 $3$ 为 $2$ 的点形成一个环，而且这个环内部没有其它边（显然最小环满足要求），删掉其他点。
![](https://cdn.luogu.com.cn/upload/image_hosting/d4fsh76s.png)
- 剩下的图满足性质，最多存在一个模 $3$ 为 $1$ 的点，去掉该点，形成模 $3$ 余 $2$ 的点组成的森林。
- 求最小环好像还略有麻烦，建议先掌握深度优先搜索树的有关知识。

**D**
- 最烧脑的环节。
- 既然是森林必然存在叶子，那么每棵树的叶子必然连向唯一的模 $3$ 为 $1$ 的点。
- 很神奇的是，每一棵树连向模 $3$ 为 $1$ 的点的度数可以算出来，因为它们的度数和是 $2k\pmod 3$，内部度数和是 $2(k-1)$，连向模 $3$ 为 $1$ 的点的度数是 $2\pmod 3$。
- 这说明一棵树至少有两个叶节点（好像是废话，除了一个节点的情况本来就有这个性质）。
- 如果有两棵树的话，分别选择内部的两个叶节点（在树内的路径）和模 $3$ 为 $1$ 的点保留下来（模 $3$ 为 $1$ 的点剩下 $4$ 度，路径上的点剩下 $2$ 度），如果路径上存在点连向这模 $3$ 为 $1$ 的点就不行了，不过这样可以直接利用这个路径。
![](https://cdn.luogu.com.cn/upload/image_hosting/oiesacuh.png)
- 最后发现不可能只有一棵树，否则连向模 $3$ 为 $1$ 的点的度数模 $3$ 余 $2$。

**E**
- 分析完这些略有迷惑，讲述一遍算法的流程，理清一些实现的细节。
- 如果有一个度数模 $3$ 为 $0$ 的点，删掉其它点（可能出现的无解情况：整个图只有一个点）。
- 否则如果有至少两个度模 $3$ 为 $1$ 的点，随便拿一个点宽度优先搜索找到另一个度模 $3$ 为 $1$ 的点，删掉不在该路径上的点（可能出现的无解情况：整个图是一条链）。
- 否则搜索整个度模 $3$ 余 $2$ 的点组成的图寻找一条最短的环（可能出现的无解情况：整个图是一个简单环）。
- 否则搜索森林找到两棵树上“叶节点”之间的路径。（可能出现的无解情况：整个图去掉唯一的度模三为 $1$ 的点后，只存在两条链）
- 可以说相当的繁琐，但是并没有比该题的思路困难。
- 不仅思路困难，实现的具体细节也要注意。
- 感觉是那种可以想一两周，打一两天，回味一两个月的题目。

**F**
- 给出四个数据表明我打这道题的困难程度。
- [作者手写的小数据生成器](https://www.luogu.com.cn/paste/3etzb19u)。
- [作者手写的SPJ](https://www.luogu.com.cn/paste/tw9zon7u)。
- 作者的错误：最后一个选择叶节点时没有只找与 $1$ 度点直接连边的点。
- [作者的代码（整整2568B）](https://www.luogu.com.cn/paste/dxbfo3r7)。
- 说句题外话：$\text{goto}$ 真好用。

**G**
- 话说注意到题目的特殊限制了吗：无向连通图，无重边自环。
- 连通有什么用吗？没有，只是让你的代码少一个特判，加快一下思路进程而已。
- 无重边自环的作用十分明显啦，如果存在重边自环，之前的许多结论将不再正确，所以笔者仍然有一个疑惑，存在重边自环的情况能否求解？