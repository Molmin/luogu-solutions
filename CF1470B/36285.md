# CF1471D - Strange Definition
- 数论、质因数、哈希
- https://www.luogu.com.cn/problem/CF1470B

## 题意
两个整数 $x$ 和 $y$ 是*有关的*当且仅当 $\frac{\operatorname{lcm}(x,y)}{\gcd(x,y)}$ 是完全平方数。

你有一个长度为 $n(n\leq 3\cdot 10^5)$ 的序列 $a(1\leq a_i\leq 10^6)$。每一秒，所有的 $a_i$ 都会变成序列中所有和它*有关的*数的乘积。令 $d_i$ 为数列中与 $a_i$ *有关的*数的个数

有 $q$ 次询问，每次询问给出一个 $w(0\leq w\leq 10^{18})$，求在 $w$ 秒时的 $\max\{d_i\}$。

## 思路
$$
    \frac{\operatorname{lcm}(x,y)}{\gcd(x,y)}=\frac{x\cdot y}{\gcd^2(x,y)}=k^2
$$

$$
    xy=\big( k\cdot \gcd(x,y)\big )^2
$$

因此，$\frac{\operatorname{lcm}(x,y)}{\gcd(x,y)}$ 是完全平方数 $\Leftrightarrow x\cdot y$ 是完全平方数。

$x\cdot y$ 是完全平方数，说明对 $x\cdot y$ 分解成若干个质因数相乘的形式后，每一种质因数的指数都是偶数。

假设：
$$x=p_1^{k_1}\cdot p_2^{k_2} \cdot p_3^{k_3}\dots p_n^{k_n}$$
$$y=p_1^{k_1'}\cdot p_2^{k_2'} \cdot p_3^{k_3'}\dots p_n^{k_n'}$$

那么，$k_i$ 与 $k_i'$ 的奇偶性相同。

### 计算第 $0$ 秒时的答案
对每个 $a_i$ 分解质因数，挑出分解的质因数中指数为奇数的计算哈希，在所有 $a_i$ 中哈希相同的就是有关的。

不难发现，如果 $a_i$ 和 $a_j$ 有关，并且 $a_j$ 和 $a_k$ 有关，那么 $a_i$ 和 $a_k$ 有关。

实际上，形成的是连通块，同一个连通块里的元素两两有关。

### 第 $1$ 秒以及第 $1$ 秒过后
从第 $1$ 秒开始，每一秒，$a_i$ 都会变成序列中所有和它*有关的*数的乘积。

如果第 $0$ 秒时：
- 某个 $a_i$ 的某个 $k_j$ 是奇数，并且它所处于的连通块大小为偶数，那么第 $1$ 秒时，它所处的连通块中所有的 $k_j$ 会变成偶数，在这以后，此 $k_j$ 的奇偶性永远不变。
- 其它情况，$k_j$ 的奇偶性不会再变。

因此，在第 $1$ 秒过后，答案不会再改变。

计算第 $0$ 秒和 第 $1$ 秒的答案后，回答询问即可。

**统计第 $1$ 秒的答案**

$ans_1 = \max(ans_0,$ $\sum$所有长度为奇数的连通块的长度 $+\sum$ 所有$k_i$为偶数的连通块长度  $)$