## 题意简述

给定一个不重的数组和 $m$ 次操作，每次操作更改数组中的一个数，时刻保证数组不重。求包括的初始数组的 $m+1$ 个数组两两的并集的元素个数之和。

## 题目分析

对于第 $i$ 次修改操作，计算当前数组与前 $i$ 个历史版本的贡献。因为数组不重，所以并集中一定有自身的 $n$ 个元素，可以先给答案增加 $i \times n$。接下来计算前 $i$ 个历史版本出现但是当前不存在的数字的个数，下文记为 $sum$。统计进答案即可。具体而言，在修改操作时同时维护 $sum$。如将 $p$ 位置更改为 $q$，我们就可以给 $sum$ 加上 $a_p$ 之前出现的次数，减去 $q$ 之前对 $sum$ 的贡献 $del_{q}$。维护这些信息，只需要记录每一个数字出现的时间和删除时给 $sum$ 的贡献即可。

## 代码

```cpp
void solve()
{
    i64 n, m;
    cin >> n >> m;
    vector<int> a(n+1), vis(n+m+1), del(n+m+1);
    for (int i=1;i<=n;++i)
        cin >> a[i];
    i64 ans = 0, sum = 0, p, q;
    for (int i=1;i<=m;++i)
    {
        cin >> p >> q;
        int tmp = i - vis[a[p]] + del[a[p]];
        sum += tmp;
        del[a[p]] = tmp;
        sum -= del[q];
        vis[q] = i;
        ans += n * i + sum;
        a[p] = q;
    }
    cout << ans << '\n';
}
```
