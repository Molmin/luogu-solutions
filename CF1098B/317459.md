### CF1098B Nice table

[题目链接](https://www.luogu.com.cn/problem/CF1098B)

#### 简要题意

给定一个 $nm$ 的矩阵，求最小的操作，使的每个 $2\times2$ 的子矩阵中都含有 `AGCT` 四个字母。

每次操作可以改变矩阵中任意一个字符。

$2\le n,m,n\times m\le 3\times 10^5$。

#### 题解

考虑对于满足任意 $2\times 2$ 子矩阵都含有 `AGCT` 的矩阵的性质。

考虑两种有公共部分的 $2\times 2$ 的矩形：

![](https://cdn.luogu.com.cn/upload/image_hosting/0neyc2s1.png)

观察左侧两条红色部分，设其分别为 $S_1=\{a_{i,j},a_{i+1,j}\},S_2=\{a_{i,j+2},a_{i+1,j+2}\}$，一定有 $S_1=S_2$（注意集合是无序的）。因为两个矩形都有中间公共的白条部分。

同理对于右侧两条绿色的部分，设其分别为 $T_1=\{a_{i,j},a_{i,j+1}\},T_2=\{a_{i+2,j},a_{i+2,j+1}\}$，那么一定有 $T_1=T_2$。

那么考虑对所有列按奇偶性分类，考察奇偶性相同的列之间的关系。

考虑第 $i$ 列和第 $i+2$ 列上元素的关系，从小的情况开始考虑，设第一行和第二行对应的情况是这样的：

$$
\begin{aligned}
\text{1\ \ 1}\\
\text{2\ \ 2}
\end{aligned}
$$

根据 $S_1=\{a_{i,j},a_{i+1,j}\},S_2=\{a_{i,j+2},a_{i+1,j+2}\}$，一定有 $S_1=S_2$，第三行对应的元素一定是相同的。并且可以推出对于所有行 $j$ 一定有 $a_{i,j}=a_{i+2,j}$。

考虑第一行和第二行对应的另一种情况：

$$
\begin{aligned}
\text{1\ \ 2}\\
\text{2\ \ 1}
\end{aligned}
$$

根据 $S_1=\{a_{i,j},a_{i+1,j}\},S_2=\{a_{i,j+2},a_{i+1,j+2}\}$，一定有 $S_1=S_2$，第三行一定是 $\text{1\ \ 2}$。并且不断迭代可以得出其一定是 $\text{1\ \ 2}$，$\text{2\ \ 1}$ 交替出现。

考虑确定第一列上的元素尝试使用第 $i$ 列和第 $i+2$ 列元素关系的观察得出所有和第一列同余的列上的元素的性质。

注意到如果第 $1$ 列是两种元素交替，即形如：

$$
\begin{aligned}
1\\
2\\
1\\
2\\
1\\
....
\end{aligned}
$$

那么所有列一定是 $1,2$ 交替。（因为无论第 $i$ 列和第 $i+2$ 列元素的关系是两种关系中的哪一种第 $i+2$ 列一定是 $1,2$ 交替）

如果第 $1$ 列存在 $3$ 种或 $4$ 种元素，那么所有和第一列同余的列一定与第一列的元素对应位置相同。

并且我们可以直接根据奇数列的状态推出偶数列的状态：

* 如果奇数列是两种元素交替，那么偶数列也已一定是两种元素交替出现。并且其交替的元素恰好是奇数列未出现过的两种元素。

* 如果奇数列出现了 $3$ 种或 $4$ 种元素，那么偶数列也已一定出现了 $3$ 种或 $4$ 种元素。

接下来我们将依据上面两个结论得到题目的重要突破口：如果存在某一列出现了 $3$ 种或 $4$ 种元素，那么对于任意一行的元素一定是两种元素交替出现的。对于行反过来也可以得出关于列的类似的结论（即如果某一行出现了 $3$ 种或 $4$ 种元素，那么对于任意一列的元素一定是两种元素交替）。结合在一起：要么任意一行只有两种元素要么任意一列只有两种元素。

考虑钦定列只有两种元素交替出现（行也是类似的方式处理，在下面不做讨论），枚举奇数列出现的两种元素然后枚举每一列是两种交替情况的哪一种比较优即可。

复杂度 $O(nm)$。


