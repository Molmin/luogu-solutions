用一个 $last$ 数组存每个数最后一次出现的下标，对于当前输入的数 $x$，$dp_{last_{x-1}}$ 为以 $x$ 为最后一个数的方案增加个数（先判断 $last_{x-1}$ 到当前的数之间的序列中间是否为合法序列），对于每一个 $dp$ 数组，将其值加入   $ans$，$ans$ 即为答案。

有一个要特判，如果为 $x=1$，$dp_x=dp_{x-1}+1$。

代码不给了，按照上面的实现就行。